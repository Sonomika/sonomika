"use strict"
define("pikimov/app",["exports","@ember/application","ember-resolver","ember-load-initializers","pikimov/config/environment","@sentry/ember"],function(e,t,o,r,n,i){function a(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,window._appVersion="4.0.5",console.log("v",_appVersion),_config.sentry&&i.init({dsn:"https://2b0015c88142b59380fe8fa33769c201@o4509790971101184.ingest.de.sentry.io/4509790975688784",release:`${n.default.APP.name}@${_appVersion}`,sendDefaultPii:!0,beforeSend:e=>(e.extra=e.extra||{},"undefined"!=typeof _historyUtils&&_historyUtils&&(e.extra.history=_historyUtils.getHistoryDebugList()),e)})
class l extends t.default{constructor(...e){super(...e),a(this,"modulePrefix",n.default.modulePrefix),a(this,"podModulePrefix",n.default.podModulePrefix),a(this,"Resolver",o.default)}}e.default=l,(0,r.default)(l,n.default.modulePrefix)}),define("pikimov/classes/c_library-item",["exports","@ember/object","@sentry/ember"],function(e,t,o){function r(e,t,o){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,o)}function n(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function i(e,t){return e.get(l(e,t))}function a(e,t,o){return e.set(l(e,t),o),o}function l(e,t,o){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:o
throw new TypeError("Private element is not present on this object")}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var s=new WeakMap,c=new WeakMap,u=new WeakMap,m=new WeakMap,p=new WeakMap
e.default=class{constructor(e,t){n(this,"libraryManager",null),n(this,"itemData",null),n(this,"type",null),n(this,"name",null),n(this,"filename",null),n(this,"fileExtension",null),n(this,"folderName",null),n(this,"libUid",null),n(this,"file",null),n(this,"localFileNotFound",!1),n(this,"texture",null),r(this,s,null),r(this,c,null),r(this,u,null),r(this,m,null),r(this,p,null),n(this,"sequenceLoader",null),n(this,"duration",null),n(this,"durationMs",null),n(this,"width",null),n(this,"height",null),n(this,"domElement",null),n(this,"callbackOnLoaded",null),n(this,"isMissing",!1),n(this,"isLoading",!1),n(this,"isLoaded",!1),n(this,"thumbnail",null),n(this,"itemsFolder",null),n(this,"dracoLoader",null),n(this,"ktx2Loader",null)
var o=this
if(o.libraryManager=e,o.itemData=t,o.type=t.type,o.filename=t.filename,o.name=o.filename.split(".").slice(0,-1).join("."),o.fileExtension=o.filename.split(".").pop().toLowerCase(),"imageSequence"==o.type&&(o.sequenceLoader=new c_sequenceLoader(o.itemData),o.name=o.sequenceLoader.getSequenceName()),o.libUid=t.libUid,o.local=t.local,o.itemsFolder="demofiles/"+o.type+"/",o.libraryManager.controller.projectData.settings.onlineFolder){var i=o.libraryManager.controller.projectData.settings.onlineFolder
o.itemsFolder="demofiles/"+i+"/",i.startsWith("http")&&(o.itemsFolder=i,console.log("warning: third party itemsFolder",o.itemsFolder))}}setFileData(e){var t=this,o=t.type
"image"==o&&a(s,t,e),"video"==o&&a(u,t,new Blob([e])),"model"==o&&a(c,t,e),"font"==o&&(a(c,t,e),t.addFontCSS()),"audio"==o&&a(u,t,new Blob([e])),"svg"==o&&a(s,t,e),"imageSequence"==o&&a(m,t,e),"gaussianSplat"==o&&a(s,t,e)}getFileData(){var e=this,t=e.type
return"image"==t?i(s,e):"audio"==t||"video"==t?i(u,e):"font"==t||"model"==t?i(c,e):"imageSequence"==t?i(p,e):"svg"==t||"gaussianSplat"==t?i(s,e):null}getOnlineFileData(){var e=this
e.isLoading=!0
var t=e.type,o=e.itemsFolder+e.filename
"figma"==e.itemData.source&&(console.log("this is a figma file"),o=e.filename)
const r=new XMLHttpRequest
r.open("GET",o,!0),r.responseType="blob",r.onload=function(){if(200!==r.status)return console.log("Error: "+r.status),alert("Error: "+r.status+"\n\nCould not load file\n"+e.filename),void e.libraryManager.controller.backToIndex()
const o=r.response
"image"==t&&(e.setFileData(URL.createObjectURL(o)),e.loadImage()),"svg"==t&&(e.setFileData(URL.createObjectURL(o)),e.loadSVG()),"video"==t&&(e.setFileData(o),e.loadVideo()),"model"==t&&new Response(o).arrayBuffer().then(t=>{e.setFileData(t),e.loadModel()}),"font"==t&&new Response(o).arrayBuffer().then(t=>{e.setFileData(t),e.loadOnlineFont()}),"audio"==t&&(e.setFileData(o),e.loadAudio()),"gaussianSplat"==t&&(console.log("TO DO -- save file data"),console.log(o),e.setFileData(URL.createObjectURL(o)),e.loadSplat())},r.onerror=function(t){console.log("error fetch online file"),console.log(o),console.log(t),alert("Could not load file\n"+e.filename),e.libraryManager.controller.backToIndex()},r.send()}getCloudFileData(){var e=this
navigator.onLine?"video"==e.type&&e.loadVideo():e.onLoadingfailed({h2:"Error loading file",p:"Check internet connexion"})}getLocalFile(){var e=this
if(e.isLoading)console.log("getLocalFile -> already loading")
else{e.callbackOnLoaded=e.onLocalFileLoaded
e.libraryManager.openLocalFolderDialog(function(t,o){null!=t&&(e.isLoading=!0,$(`#filesLocator li[data-libuid="${e.libUid}"] .button`).hide()),requestAnimationFrame(function(){e.getLocalFileCallback(t,o)})},e.filename)}}getLocalFileCallback(e,t){var o=this
if(!e)return o.localFileNotFound=!0,o.isLoading=!1,void o.libraryManager.loadNextLocalFile()
o.localFileNotFound=!1,o.folderName=t
var r=o.type
if("imageSequence"!=r){var n=new FileReader
n.onload=function(e){o.setFileData(e.target.result),"image"==r&&o.loadImage(),"svg"==r&&o.loadSVG(),"video"==r&&o.loadVideo(),"model"==r&&o.loadModel(),"font"==r&&o.onLoaded(),"audio"==r&&o.loadAudio()},"model"==r||"video"==r||"audio"==r||"font"==r?n.readAsArrayBuffer(e):n.readAsDataURL(e)}else{o.sequenceLoader.buildFilesArray(o.libraryManager,function(e){o.setFileData(e),o.loadSequence()})}}loadFile(e){var t=this
if(t.callbackOnLoaded=e,t.itemData.online)t.getOnlineFileData()
else{if(t.itemData.fromCloud)return console.log("load file from cloud * * *"),void t.getCloudFileData()
var o=t.type
"image"==o&&t.loadImage(),"svg"==o&&t.loadSVG(),"audio"==o&&t.loadAudio(),"video"==o&&t.loadVideo(),"model"==o&&t.loadModel(),"font"==o&&t.onLoaded(),"imageSequence"==o&&t.loadSequence(),"gaussianSplat"==o&&t.loadSplat()}}loadImage(){var e=this
"tga"!=getFileExtension(e.filename)?fetch(i(s,e)).then(e=>e.blob()).then(e=>createImageBitmap(e)).then(t=>{e.width=t.width,e.height=t.height,e.createThumbnail(t),e.createImageTexture(t)}).catch(t=>{console.log(t)
var o={h2:"Error loading image file",p:e.name}
e.onLoadingfailed(o)}):dataURLToArrayBuffer(i(s,e)).then(t=>{const o=new DataView(t)
e.width=o.getUint16(12,!0),e.height=o.getUint16(14,!0);(new TGALoader).load(i(s,e),function(t){var o=new OffscreenCanvas(e.width,e.height)
const r=o.getContext("2d"),n=new ImageData(new Uint8ClampedArray(t.image.data.buffer),e.width,e.height)
r.putImageData(n,0,0),e.createThumbnail(o),o=null,t.dispose(),e.createImageTexture()})})}async loadSVG(){var e=this
let t=await fetch(i(s,e)).then(e=>e.blob())
var o=new FileReader
o.onload=function(){const t=document.createElement("div")
document.body.appendChild(t),t.innerHTML=o.result
const r=t.querySelector("svg")
var n=r.getBBox()
const i=function(e){return(new XMLSerializer).serializeToString(e).includes("stroke")&&parseFloat(getComputedStyle(e).strokeWidth)||0}(r),a=i/2,l={x:n.x-a,y:n.y-a,width:n.width+i,height:n.height+i}
var s=l.width,c=l.height,u=s/c,m=2048,p=Math.round(m/u);(m<s||p<c)&&(m=Math.round(s),p=Math.round(c))
var d={w:m,h:p},f=`${l.x} ${l.y} ${l.width} ${l.height}`
r.setAttribute("viewBox",f),r.setAttribute("width",d.w),r.setAttribute("height",d.h),e.width=s,e.height=c
const v=(new XMLSerializer).serializeToString(r)
e.createSVGTexture(v,d),t.remove()},o.onerror=function(){var t={h2:"Error loading svg file",p:e.name}
e.onLoadingfailed(t)},o.readAsText(t)}createSVGTexture(e,t){var o=this
const r=new Blob([e],{type:"image/svg+xml;charset=utf-8"})
var n=URL.createObjectURL(r)
o.setFileData(n)
var i=new Image
i.src=n,i.width=Math.round(t.w),i.height=Math.round(t.h),i.onload=function(){o.createThumbnail(i),o.createImageTexture(),i=null}}loadVideo(){var e=this,r=new fileInfosUtils(e.filename,i(u,e)),n=function(o){e.width=o.width,e.height=o.height,e.duration=o.duration,e.durationMs=o.durationMs,e.itemData.frameRate=o.frameRate,e.itemData.nbFrames=o.nbFrames,e.itemData.videoCodec=o.videoCodec,o.filesize&&(e.itemData.filesize=o.filesize),o.audioTracks?((0,t.set)(e.itemData,"audioTracks",o.audioTracks),e.itemData.nbAudioChannels=o.nbAudioChannels):(e.itemData.audioTracks=void 0,e.itemData.nbAudioChannels=void 0),e.itemData.fromCloud||e.createThumbnail(r.domElement),r.dispose(),r=null,e.onLoaded()},a=function(t){console.log("ERROR video callbackError")
var n="error - import video ."+getFileExtension(e.filename)
gaEvent({event:n}),_config.sentry&&o.captureMessage(n,{extra:{filename:e.filename,message:t}}),r.dispose(),r=null,e.onLoadingfailed(t)}
e.itemData.fromCloud?r.getCloudVideoFileInfos(e.itemData.url,n,a):r.getVideoFileInfos(n,a)}loadAudio(){var e=this,t=new fileInfosUtils(e.filename,i(u,e))
t.getAudioFileInfos(function(o){e.duration=o.duration,e.itemData.nbAudioChannels=o.nbAudioChannels,t.dispose(),t=null,e.onLoaded()},function(o){console.log("ERROR audio callbackError"),gaEvent({event:"error - import audio"}),t.dispose(),t=null,e.onLoadingfailed(o)})}loadModel(){var e=this,r=new GLTFLoader
if(e.dracoLoader||(e.dracoLoader=new DRACOLoader,e.dracoLoader.setDecoderPath(_config.dracoPath)),!e.ktx2Loader){const t=new THREE.WebGLRenderer
e.ktx2Loader=(new KTX2Loader).setTranscoderPath(_config.basisPath).detectSupport(t),t.dispose()}function n(t,r){console.log(r),console.log("error lib model on",e.filename)
var n="error - import model"
gaEvent({event:n}),_config.sentry&&o.captureMessage(n,{extra:{filename:e.filename,error:r}}),e.onLoadingfailed({h2:"3D model error",p:t})}r.setCrossOrigin("anonymous").setDRACOLoader(e.dracoLoader).setKTX2Loader(e.ktx2Loader).setMeshoptDecoder(MeshoptDecoder)
try{r.parse(i(c,e),"./",function(o){(function(o){if(!e.itemData.preScale){var r=(new THREE.Box3).setFromObject(o),n=new THREE.Vector3,i=r.getSize(n).x
r.getSize(n).y>i&&(i=r.getSize(n).y),r.getSize(n).z>i&&(i=r.getSize(n).z)
var a=1/i
a*=5,(a=10*Math.round(10*a))<1&&(a=1),e.itemData.preScale=a}var l=0
o.traverse(function(e){e.isMesh&&(l+=function(e){if(!e.isMesh)return 0
var t=0,o=e.geometry
o.index&&(t=parseInt(o.index.count/3))
return t}(e))}),(0,t.set)(e.itemData,"tris",l),o.traverse(function(e){e.geometry&&e.geometry.dispose(),o.material&&(Array.isArray(o.material)?o.material.forEach(function(e,t){e.texture&&e.texture.dispose(),e.dispose()}):(o.material.texture&&o.material.texture.dispose(),o.material.dispose()))}),o=void 0,e.onLoaded()})(o.scene),r=null},function(e){},function(e){n("An error happened while loading 3D model (P)",e)})}catch(a){n("An error happened while loading 3D model (L)",a)}}loadOnlineFont(){var e=this
console.log("LIB: LOAD ONLINE FONT",e.name)
var t=e.itemsFolder+e.filename
const o=new XMLHttpRequest
o.open("GET",t,!0),o.responseType="arraybuffer",o.onreadystatechange=function(){o.readyState===XMLHttpRequest.DONE&&(200===o.status?(a(c,e,o.response),e.onLoaded()):console.error("Error fetching the file:",o.status))},o.send()}addFontCSS(){var e=i(c,this)
const t=new Uint8Array(e)
let o=""
t.forEach(e=>o+=String.fromCharCode(e)),o=btoa(o)
var r="data:font/ttf;base64,"+o,n=this.name
const a=document.createElement("style")
a.innerHTML=`@font-face {font-family: '${n}';src: url('${r}');}`,document.head.appendChild(a)}async loadSequence(){var e=this,t=i(m,e)
if(e.sequenceLoader.checkFilenames(t)){e.sequenceLoader.checkNbFiles(t),startLoading(),a(p,e,await e.sequenceLoader.load(t))
var o=e.sequenceLoader.getDimensions()
e.width=o.width,e.height=o.height,stopLoading(),e.onLoaded()}}loadSplat(){var e=this
console.log("LOAD LIBITEM SPLAT",e.filename)
var t=e.filename
const o=new SplatLoader
t=i(s,e)
o.loadAsync(t,e=>{e.type}).then(t=>{console.log("LIB splat LOADED"),e.packedSplats=t,stopLoading(),e.onLoaded()}).catch(e=>{console.log("error loading gaussian splat file"),console.error(e)})}onLocalFileLoaded(){var e=this.libraryManager
e.isLibraryLoaded||!e.checkIfLibraryLoaded()?e.loadNextLocalFile():e.onLibraryLoaded()}onLoaded(){var e=this
e.isLoading=!1,(0,t.set)(e,"isLoaded",!0),e.isMissing||(e.domElement&&(e.domElement=null),e.callbackOnLoaded?e.callbackOnLoaded.call(e):console.warn("callbackOnLoaded is null - abort onLoaded"))}onLoadingfailed(e){var o=this
function r(){var e=!0
o.libraryManager.isLibraryLoaded&&(e=!1),e?(o.isLoading=!1,(0,t.set)(o,"isLoaded",!0),(0,t.set)(o,"isMissing",!0),o.callbackOnLoaded.call(o)):o.libraryManager.onImportFailed()}stopLoading(),o.domElement&&(o.domElement=null),e?openModal({h2:e.h2,p:e.p,callbackYes:function(){r()}}):r()}ignoreFile(){var e=this;(0,t.set)(e,"isMissing",!0),e.callbackOnLoaded=null,e.onLoaded()
var o=e.libraryManager
!o.isLibraryLoaded&&o.checkIfLibraryLoaded()&&o.onLibraryLoaded()}createImageTexture(){var e=this
i(s,e)||console.log("error --- NO c.#fileDataURL")
var t=null
t="tga"==getFileExtension(e.filename)?new TGALoader:new THREE.TextureLoader,e.texture=t.load(i(s,e),function(){_config.premultiplyAlpha&&(e.texture.premultiplyAlpha=!0,e.texture.needsUpdate=!0,console.log("texture premultiplyAlpha",e.texture.premultiplyAlpha)),e.onLoaded()},function(e){},function(t){console.log(t),console.log("failed to create texture:",e.filename)})}createThumbnail(e){var t=this,o=document.createElement("canvas"),r=t.width/t.height
o.height=68,o.width=Math.round(o.height*r)
var n=Math.round(o.height*r),i=o.height
o.getContext("2d").drawImage(e,0,0,t.width,t.height,0,0,n,i),t.thumbnail={src:o.toDataURL()},o=null}getNbTimesUsed(){var e=this.libUid,t=this.libraryManager.controller,o=t.projectData.compositions,r=0
return o.forEach(function(o){t.getters.getAllCompositionItems(o).forEach(function(t){t.libUid==e&&r++,"text"==t.type&&t.font==e&&r++})}),r}destroy(){var e=this
e.dracoLoader&&(e.dracoLoader.dispose(),e.dracoLoader=null),e.ktx2Loader&&(e.ktx2Loader.dispose(),e.ktx2Loader=null),e.texture&&(e.texture.dispose(),e.texture=null),e.domElement=null,e.thumbnail=null,a(s,e,null),a(c,e,null),a(u,e,null),a(m,e,null),i(p,e)&&i(p,e).length&&(i(p,e).forEach(function(e){e.close(),e=void 0}),a(p,e,null)),e.callbackOnLoaded=null}}}),define("pikimov/classes/composition-builder",["exports","pikimov/classes/items/image-item","pikimov/classes/items/shape-item","pikimov/classes/items/video-item","pikimov/classes/items/text-item","pikimov/classes/items/model-item","pikimov/classes/items/group-item","pikimov/classes/items/audio-item","pikimov/classes/items/light-item","pikimov/classes/items/image-sequence-item","pikimov/classes/items/composition-item","pikimov/classes/items/camera-item","pikimov/classes/items/camera-target-item","pikimov/classes/items/free-shape-item","pikimov/classes/items/cloud/video-item-cloud","pikimov/classes/items/cloud/audio-item-cloud"],function(e,t,o,r,n,i,a,l,s,c,u,m,p,d,f,v){function h(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=class{constructor(e){h(this,"controller",null),h(this,"compositionManager",null),h(this,"compositionData",null),h(this,"getters",null),h(this,"buildQueue",[]),h(this,"sceneItems",null),h(this,"nbItemsToLoad",0),h(this,"nbItemsReady",0),h(this,"callbackSingleUse",null)
var t=this
t.controller=e.controller,t.compositionManager=e,t.compositionData=e.compositionData,t.getters=t.controller.getters}buildComposition(e){var t=this
t.sceneItems=e,t.populateQueue(),t.processQueue()}populateQueue(){var e=this
e.buildQueue=[]
var t=0;(function o(r,n){var i=0
r.forEach(function(r){e.compositionManager.isActive
var a={itemData:r,compIndex:t,parentCompUid:n,subIndex:i}
e.addToQueue(a),t++,i++,r.items&&o(r.items,r.compUid)})})(e.compositionData.items,null)}addToQueue(e){this.buildQueue.push(e)}processQueue(e=null){var t=this
e&&(t.callbackSingleUse=e),t.controller.setCompositionReadyFlag(!1),requestAnimationFrame(function(){if(t.nbItemsReady=0,t.nbItemsToLoad=t.buildQueue.length,0!=t.nbItemsToLoad){var e=t.buildQueue[0]
e.isLoading=!0,t.doOneItem(e.itemData,e.compIndex)}else t.onAllItemsReady()})}doOneItem(e,h){var g=this,y=g.compositionManager,b=null,x=e.type
return"image"==x&&(b=new t.default(y,e,h)),"svg"==x&&(b=new t.default(y,e,h)),"shape"==x&&(b=new o.default(y,e,h)),"video"==x&&(b=e.fromCloud?new f.default(y,e,h):new r.default(y,e,h)),"text"==x&&(b=new n.default(y,e,h)),"model"==x&&(b=new i.default(y,e,h)),"group"==x&&(b=new a.default(y,e,h)),"audio"==x&&(b=e.fromCloud?new v.default(y,e,h):new l.default(y,e,h)),"light"==x&&(b=new s.default(y,e,h)),"imageSequence"==x&&(b=new c.default(y,e,h)),"composition"==x&&(b=new u.default(y,e,h)),"camera"==x&&(b=new m.default(y,e,h)),"cameraTarget"==x&&(b=new p.default(y,e,h)),"freeShape"==x&&(b=new d.default(y,e,h)),b||console.error("ERROR NEW ITEM TYPE :",x),g.sceneItems.push(b),!g.compositionManager.isActive&&e.hidden?(g.ignoreItem(b),void g.doNextItem()):b.isMissing?(b.onReady(),void g.doNextItem()):void("video"!=e.type?(b.buildItem(),g.doNextItem()):setTimeout(function(){b.buildItem(),g.doNextItem()},50))}doNextItem(){var e=this
0!=e.buildQueue.length&&requestAnimationFrame(function(){var t
for(t=0;t<e.buildQueue.length;t++){var o=e.buildQueue[t]
if(!o.isLoading){o.isLoading=!0,e.doOneItem(o.itemData,o.compIndex)
break}}})}ignoreItem(e){e.isIgnored=!0,e.onReady()}onOneItemReady(e){var t=this,o=-1
t.buildQueue.forEach(function(t,r){t.itemData.compUid==e&&(o=r)}),-1!=o&&(t.buildQueue.splice(o,1),t.nbItemsReady++,t.nbItemsReady==t.nbItemsToLoad&&t.onAllItemsReady())}onAllItemsReady(){var e=this
e.compositionManager.onItemsReady(),e.callbackSingleUse&&(e.callbackSingleUse.call(this),e.callbackSingleUse=null)}}}),define("pikimov/classes/controls-handles",["exports","@ember/object","@sentry/ember"],function(e,t,o){function r(e,t,o){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,o)}function n(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function i(e,t){return e.get(l(e,t))}function a(e,t,o){return e.set(l(e,t),o),o}function l(e,t,o){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:o
throw new TypeError("Private element is not present on this object")}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
var s=new WeakMap,c=new WeakMap,u=new WeakMap,m=new WeakMap,p=new WeakMap
e.default=class{constructor(e,t){n(this,"controller",null),n(this,"sceneItem",null),n(this,"compItem",null),n(this,"getters",null),n(this,"domHandles",null),n(this,"$domHandles",null),n(this,"domOrigin",null),n(this,"$domOrigin",null),n(this,"overCanvas",null),n(this,"overControlsGizmo",null),n(this,"visible",!1),n(this,"startItemTransform",null),n(this,"left",0),n(this,"top",0),n(this,"width",0),n(this,"height",0),r(this,s,{}),r(this,c,{}),n(this,"mouseHasMoved",!0),n(this,"isTranslationActive",!1),n(this,"isRotationActive",!1),n(this,"isScaleActive",!1),r(this,u,null),r(this,m,!1),n(this,"isEditingAnchorPoint",!1),n(this,"isDraggingAnchorPoint",!1),n(this,"startItemAnchorPoint",{}),r(this,p,{}),n(this,"previousAnchorPointCSS",null)
var o=this
o.controller=e,o.sceneItem=t,o.getters=o.controller.getters,o.compItem=o.sceneItem.getCompItem(),o.overCanvas=document.querySelector("#overCanvas"),o.overControlsGizmo=document.querySelector("#overControlsGizmo"),o.worldStart=new THREE.Vector3,o.worldNow=new THREE.Vector3,o.createDomHandles()}createDomHandles(){var e=this
e.domHandles=document.createElement("div"),e.domHandles.className="controlsHandles",e.domHandles.setAttribute("data-compuid",e.sceneItem.compUid),e.domHandles.innerHTML='<span class="square origin"></span>\n\t\t<span class="square tl"><span class="rotCursor"></span><span class="scaleCursor"></span></span>\n\t\t<span class="square tr"><span class="rotCursor"></span><span class="scaleCursor"></span></span>\n\t\t<span class="square br"><span class="rotCursor"></span><span class="scaleCursor"></span></span>\n\t\t<span class="square bl"><span class="rotCursor"></span><span class="scaleCursor"></span></span>',e.overControlsGizmo.appendChild(e.domHandles),e.domOrigin=e.domHandles.querySelector(".square.origin"),e.$domHandles=$(e.domHandles),e.$domOrigin=$(e.domOrigin),e.compItem.rotation.hidden&&e.$domHandles.find(".rotCursor").hide(),e.compItem.scale.hidden&&e.$domHandles.find(".scaleCursor").hide(),e.visible=!1,$(e.domHandles).hide(),e.addEventHandlers()}destroy(){var e=this
e.domHandles&&(e.domHandles.remove(),document.removeEventListener("mousedown",this.onMouseDown),document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp),e.domHandles.removeEventListener("mouseenter",this.onMouseEnter),e.domHandles.removeEventListener("mouseleave",this.onMouseLeave),e.domHandles=null,e.$domHandles=null),e.overCanvas=null,e.compItem=null,e.sceneItem=null}selectItem(){var e=this
e.setStartItemTransform(),e.update(),1==e.controller.selectionUtils.filterSelectionToEditTransform().length&&("anchorPoint"==e.controller.toolbarUtils.currentTool?e.toggleAnchorPointTool(!0):e.toggleAnchorPointTool(!1))}deselectItem(){this.hide()}hide(){var e=this
e.visible&&(e.$domHandles&&e.$domHandles.hide(),e.visible=!1)}show(){this.$domHandles.show(),this.visible=!0}setStartItemTransform(){var e=this
if(e.sceneItem.threejsHook&&!e.sceneItem.isMissing){var t=this.controller.compositionManager
e.getters.getSceneItemByCompUid(t,e.compItem.compUid)||_config.sentry&&o.captureMessage("error setStartItemTransform",{extra:{compUid:e.compItem.compUid,type:e.compItem.type,name:e.compItem.name,isCompositionReady:this.controller.isCompositionReady}})
var r=e.getters.getCompItemCurrentTransformByCompUid(e.compItem.compUid),n=new THREE.Vector3
e.sceneItem.threejsHook.getWorldPosition(n),e.startItemTransform={position:structuredClone(r.position),rotation:structuredClone(r.rotation),scale:structuredClone(r.scale),world:{position:n}},a(p,e,{left:e.left,top:e.top})}}getTransform(e){var t=this,o=t.getters.getCompItemCurrentTransformByCompUid(e.compUid)
return function e(r){var n=t.getters.getJsonItemParentByCompUid(t.controller.activeCompositionData,r)
if(n){var i=t.getters.getCompItemCurrentTransformByCompUid(n.compUid)
o.scale.x*=i.scale.x/100,o.scale.y*=i.scale.y/100,o.scale.z*=i.scale.z/100,o.rotation.z+=i.rotation.z,i.scale.x<0&&(o.rotation.z*=-1),i.scale.y<0&&(o.rotation.z*=-1),e(n.compUid)}}(e.compUid),o}update(){var e=this,t=e.controller,o=t.compositionManager,r=e.sceneItem,n=e.compItem,i=n.type,a=e.$domHandles,l=r.threejsObj,s=t.currentFrame
if(a&&l){var c=!0
if(r.isSelected||(c=!1),t.selectionUtils.filterSelectionToEditTransform().length>2&&e.toggleAnchorPointTool(!1),r.isVisibleInframe(s)||(c=!1),!e.visible&&c&&e.show(),e.visible&&!c&&e.hide(),e.visible){var u=o.renderEngine.activeCamera,m=t.compositionDisplayZoom/100
l.updateMatrixWorld()
var p=new THREE.Matrix4,d=new THREE.Matrix4
p.copy(u.matrixWorldInverse),d.multiplyMatrices(u.projectionMatrix,p)
var f=new THREE.Vector3
f.setFromMatrixPosition(l.matrixWorld),f.applyMatrix4(d)
var v=e.getTransform(n),h=o.getDimensions(),g=h.width/2,y=h.height/2,b=f.x*g+g,x=-f.y*y+y,w=0,k=0,C=r.getDimensionsAt(s)
if(w=C.width,k=C.height,"group"==i&&(w=20/m,k=20/m),"light"==i&&(w=20/m,k=20/m),"text"==i){var S=r.getParamValueAt(0,"text align")
a.removeClass("left right"),n.anchorPoint||("left"==S&&a.addClass("left"),"right"==S&&a.addClass("right"),"justify"==S&&a.addClass("left"))}w*=v.scale.x/100,k*=v.scale.y/100,b*=m,x*=m,w*=m,k*=m,b=Math.round(b),x=Math.round(x),w=Math.round(w),k=Math.round(k),e.left=b,e.top=x,e.width=w,e.height=k
var T=v.rotation.z;-180==v.rotation.x&&-180==v.rotation.z&&(T=0)
var D=1,P=1
w<0&&(w*=-1,D=-1),k<0&&(k*=-1,P=-1)
var M=`translate(${e.getCSSTranslate()}) rotateZ(${T}deg) scale(${D}, ${P})`,j=e.getCSSTransformOrigin()
if(a.css({width:w+"px",height:k+"px",left:b+"px",top:x+"px",transform:M,transformOrigin:j}),n.anchorPoint&&("model"!=i&&e.$domOrigin.css({left:n.anchorPoint.values.x+"%",top:n.anchorPoint.values.y+"%"}),"model"==i)){var E=r.boundingBox,I=Math.round(-1*E.min.x*v.scale.x/100*m),O=Math.round(E.max.y*v.scale.y/100*m)
e.$domOrigin.css({left:I+"px",top:O+"px"})}"freeShape"==i&&e.sceneItem.updateSVGHandles()}}}savePreviousAnchorCSS(){var e=this.domOrigin.getBoundingClientRect()
this.previousAnchorPointCSS={x:e.x,y:e.y}}isPointInsideDiv(e,t,o){var r=o.getBoundingClientRect()
return e>=r.left&&e<=r.right&&t>=r.top&&t<=r.bottom}setMouseXY(e){var t=this,o=e.clientX-t.overCanvas.scrollLeft,r=e.clientY-t.overCanvas.scrollTop,n=$(t.overControlsGizmo).offset()
n||console.log("ERROR - handles offset"),a(c,t,{x:o-n.left,y:r-n.top})}addEventHandlers(){var e=this
e.onMouseDown=this.onMouseDown.bind(this),e.onMouseMove=this.onMouseMove.bind(this),e.onMouseUp=this.onMouseUp.bind(this),e.onMouseEnter=this.onMouseEnter.bind(this),e.onMouseLeave=this.onMouseLeave.bind(this),document.addEventListener("mousedown",this.onMouseDown),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp),e.domHandles.addEventListener("mouseenter",this.onMouseEnter),e.domHandles.addEventListener("mouseleave",this.onMouseLeave)}onMouseDown(e){var t=this
if(t.controller.compositionManager.isReady){var o=document.querySelector("#composition")
if(o)if(t.mouseHasMoved=!1,!o.classList.contains("spaceDown"))if(!$(e.target).is(".FFDControl"))if(t.isPointInsideDiv(e.clientX,e.clientY,o)){if(a(s,t,{x:i(c,t).x,y:i(c,t).y}),t.isPointInsideDiv(e.clientX,e.clientY,t.domHandles)&&_keyboardUtils.controlKey&&t.controller.selectionUtils.toggleItemToSelection(t.compItem),t.controller.uiManager.keyboardFocus(),t.setStartItemTransform(),t.isEditingAnchorPoint&&$(e.target).is(".square.origin"))return t.controller.compositionManager.renderSameFrame(),t.startItemAnchorPoint={x:1*t.compItem.anchorPoint.values.x,y:1*t.compItem.anchorPoint.values.y},void(t.isDraggingAnchorPoint=!0)
t.startGizmoSize={width:Math.abs(t.width),height:Math.abs(t.height)},void 0===i(c,t).x&&t.setMouseXY(e)
var r=i(c,t).x-t.left,n=i(c,t).y-t.top,l=THREE.MathUtils.degToRad(-1*t.startItemTransform.rotation.z),p=r*Math.cos(l)-n*Math.sin(l),d=n*Math.cos(l)+r*Math.sin(l)
a(u,t,{x:p,y:d})
var f=null
i(m,t)&&(f="move"),t.$domHandles.hasClass("overRotationCorner")&&(f="rotate"),t.$domHandles.hasClass("overScaleCorner")&&(f="scale"),"move"==f&&t.startTranslationTool(),"rotate"==f&&t.startRotationTool(),"scale"==f&&t.startScaleTool(e)}}}onMouseMove(e){var t=this,o=t.controller
t.setMouseXY(e),t.mouseHasMoved=!0
var r=e.clientX-t.overCanvas.scrollLeft,n=e.clientY-t.overCanvas.scrollTop,a={x:i(c,t).x-i(s,t).x,y:i(c,t).y-i(s,t).y}
if(t.isDraggingAnchorPoint&&t.sceneItem.isSelected)t.dragAnchorPoint()
else if(t.isPointInsideDiv(r,n,t.overControlsGizmo)||t.isTranslationActive||!t.isRotationActive||!t.isScaleActive){if(!t.isScaleActive&&!t.isRotationActive&&!t.isTranslationActive){var l=!1,m=!1
t.isPointInsideDiv(r,n,t.$domHandles.find("span.scaleCursor").eq(0)[0])&&(l=!0),t.isPointInsideDiv(r,n,t.$domHandles.find("span.scaleCursor").eq(1)[0])&&(l=!0),t.isPointInsideDiv(r,n,t.$domHandles.find("span.scaleCursor").eq(2)[0])&&(l=!0),t.isPointInsideDiv(r,n,t.$domHandles.find("span.scaleCursor").eq(3)[0])&&(l=!0),t.isPointInsideDiv(r,n,t.$domHandles.find("span.rotCursor").eq(0)[0])&&(m="tl"),t.isPointInsideDiv(r,n,t.$domHandles.find("span.rotCursor").eq(1)[0])&&(m="tr"),t.isPointInsideDiv(r,n,t.$domHandles.find("span.rotCursor").eq(2)[0])&&(m="br"),t.isPointInsideDiv(r,n,t.$domHandles.find("span.rotCursor").eq(3)[0])&&(m="bl"),l?t.$domHandles.addClass("overScaleCorner"):t.$domHandles.removeClass("overScaleCorner"),l||!m||t.isScaleActive?(t.$domHandles.removeClass("overRotationCorner"),t.$domHandles.removeClass("tl"),t.$domHandles.removeClass("tr"),t.$domHandles.removeClass("br"),t.$domHandles.removeClass("bl")):(t.$domHandles.addClass("overRotationCorner"),t.$domHandles.addClass(m))}var d=null
if((t.isTranslationActive||t.isRotationActive||t.isScaleActive)&&(d=o.selectionUtils.filterSelectionToEditTransform()),t.isTranslationActive){var f={}
_keyboardUtils.shiftKey&&(Math.abs(a.y)>Math.abs(a.x)?f.y=!0:f.x=!0),d.forEach(function(e){t.updateSceneItemPosition(e,a,f)})}if(t.isRotationActive){var v={x:i(p,t).left,y:i(p,t).top},h={x:i(s,t).x,y:i(s,t).y},g={x:i(c,t).x,y:i(c,t).y},y=get3PointsAngle(v,h,g)
y=-1*THREE.MathUtils.radToDeg(y),d.forEach(function(e){var r=e.controlsHandles.startItemTransform
_keyboardUtils.shiftKey&&(y=45*Math.round(y/45))
var n=r.rotation.z+y
if(n>360&&(n-=360),n<-360&&(n+=360),n=roundValue(n,1),e.compUid!=o.selectionUtils.getSelectedCompUid())var i="translate("+t.getCSSTranslate()+") rotateZ("+n+"deg)"
t.$domHandles.css({transform:i})
var a={x:1*r.rotation.x,y:1*r.rotation.y,z:n}
e.setRotationTo(a)})}if(t.isScaleActive){var b=THREE.MathUtils.degToRad(-1*t.startItemTransform.rotation.z),x=(r=i(c,t).x-i(p,t).left,n=i(c,t).y-i(p,t).top,r*Math.cos(b)-n*Math.sin(b)),w=n*Math.cos(b)+r*Math.sin(b),k=2*x/t.startGizmoSize.width,C=2*w/t.startGizmoSize.height,S=!1
k*i(u,t).x<0&&(S=!0)
var T=!1
C*i(u,t).y<0&&(T=!0),k=Math.abs(k),C=Math.abs(C),_keyboardUtils.shiftKey||(k>C?k=C:C=k),d.forEach(function(e){var o=e.controlsHandles.startItemTransform,r={x:roundValue(k*o.scale.x,1),y:roundValue(C*o.scale.y,1)}
S&&(r.x*=-1),T&&(r.y*=-1)
var n={x:r.x,y:r.y,z:t.startItemTransform.scale.z}
e.setScaleTo(n)})}(t.isTranslationActive||t.isRotationActive||t.isScaleActive)&&(o.playbackUtils.isPlaying||o.compositionManager.renderSameFrame())}}onMouseUp(e){var t=this,o=t.sceneItem
if(t.isDraggingAnchorPoint&&o.isSelected){var r={x:i(c,t).x-i(s,t).x,y:i(c,t).y-i(s,t).y},n=t.controller.currentFrame,a=o.getTransformAt(n)
t.updateSceneItemPosition(o,r)
var l=o.getTransformAt(n),u={x:l.position.x-a.position.x,y:l.position.y-a.position.y,z:l.position.z-a.position.z}
o.itemData.position.keyframes&&o.itemData.position.keyframes.forEach(function(e){if(e.frame!=n){var t=e.values,o={x:t.x+u.x,y:t.y+u.y,z:t.z}
e.values={x:o.x,y:o.y,z:o.z}}}),t.controller.compositionManager.renderSameFrame(),t.savePreviousAnchorCSS(),t.isDraggingAnchorPoint=!1}t.isTranslationActive&&(t.savePreviousAnchorCSS(),t.stopTool("position")),t.isRotationActive&&t.stopTool("rotation"),t.isScaleActive&&t.stopTool("scale")}onMouseEnter(){a(m,this,!0)}onMouseLeave(){a(m,this,!1)}dragAnchorPoint(){var e=this,o=e.sceneItem,r=e.controller.currentFrame,n=o.getDimensionsAt(r),a=new geoUtils(e.controller,o),l=a.domToItemLocal(i(c,e))
a=null
var s={x:l.x/n.width*100,y:l.y/n.height*100}
s.x+=e.startItemAnchorPoint.x,s.y-=e.startItemAnchorPoint.y,s.y*=-1,s.x=roundValue(s.x,1),s.y=roundValue(s.y,1),e.$domOrigin.css({left:`${s.x}%`,top:`${s.y}%`}),(0,t.set)(e.compItem.anchorPoint,"values",{x:s.x,y:s.y})}updateSceneItemPosition(e,t,o={}){var r=this.controller.compositionDisplayZoom,n=e.controlsHandles.startItemTransform,i=null,a=e.getParent()
if(a){var l=new THREE.Vector3
l.x=n.world.position.x+t.x/r*100,l.y=n.world.position.y-t.y/r*100,l.z=n.world.position.z
var s=a.threejsObj.worldToLocal(l)
i={x:s.x,y:-1*s.y,z:n.position.z}}else i={x:n.position.x+t.x/r*100,y:n.position.y+t.y/r*100,z:n.position.z}
o.x&&(i.y=n.position.y),o.y&&(i.x=n.position.x),i.x=roundValue(i.x,1),i.y=roundValue(i.y,1),i.z=roundValue(i.z,1),e.setPositionTo(i)}getCSSTranslate(){var e=this,t="-50%, -50%",o=e.compItem.type
if("model"==o){var r=e.controller.compositionDisplayZoom/100,n=e.getters.getCompItemCurrentTransformByCompUid(e.compItem.compUid),i=e.sceneItem.boundingBox
t=Math.round(i.min.x*n.scale.x/100*r)+"px, "+Math.round(-1*i.max.y*n.scale.y/100*r)+"px"}if("text"==o){var a=e.sceneItem.getParamValueAt(0,"text align")
e.compItem.anchorPoint||("left"==a&&(t="0, -50%"),"right"==a&&(t="-100%, -50%"),"justify"==a&&(t="0, -50%"))}return t}getCSSTransformOrigin(){var e=this,t="50% 50%",o=e.compItem.type
if("model"==o){var r=e.controller.compositionDisplayZoom/100,n=e.getters.getCompItemCurrentTransformByCompUid(e.compItem.compUid),i=e.sceneItem.boundingBox,a=Math.round(i.min.x*n.scale.x/100*r),l=Math.round(-1*i.max.y*n.scale.y/100*r)
t=(a*=-1)+"px "+(l*=-1)+"px"}if("text"==o&&!e.compItem.anchorPoint){var s=e.sceneItem.getParamValueAt(0,"text align")
"left"==s&&(t="0 50%"),"right"==s&&(t="100% 50%"),"justify"==s&&(t="0, 50%")}return t}startTranslationTool(){var e=this
document.body.style.cursor="move",e.isTranslationActive=!0,e.isRotationActive=!1,e.isScaleActive=!1,e.toggleAnchorPointTool(!1)
var t=e.controller.compositionManager.camera,o=$(e.overControlsGizmo),r=o.width(),n=o.height()
e.worldStart.set(i(s,e).x/r*2-1,-i(s,e).y/n*2+1,0),e.worldStart.unproject(t)}startRotationTool(){var e=this,t=null
e.$domHandles.hasClass("tl")&&(t="tl"),e.$domHandles.hasClass("tr")&&(t="tr"),e.$domHandles.hasClass("br")&&(t="br"),e.$domHandles.hasClass("bl")&&(t="bl"),document.body.style.cursor="url(images/cursor-rotation-min-"+t+".svg) 16 16, auto",e.isTranslationActive=!1,e.isRotationActive=!0,e.isScaleActive=!1,e.toggleAnchorPointTool(!1)}startScaleTool(e){var t=this,o=null,r=e.clientX-t.overCanvas.scrollLeft,n=e.clientY-t.overCanvas.scrollTop,i=t.$domHandles.find("span.scaleCursor")
t.isPointInsideDiv(r,n,i.eq(0)[0])&&(o="nwse-resize"),t.isPointInsideDiv(r,n,i.eq(1)[0])&&(o="nesw-resize"),t.isPointInsideDiv(r,n,i.eq(2)[0])&&(o="nwse-resize"),t.isPointInsideDiv(r,n,i.eq(3)[0])&&(o="nesw-resize"),document.body.style.cursor=o,t.isTranslationActive=!1,t.isRotationActive=!1,t.isScaleActive=!0,t.toggleAnchorPointTool(!1)}stopTool(e){var t=this
document.body.style.removeProperty("cursor"),t.isTranslationActive=!1,t.isRotationActive=!1,t.isScaleActive=!1,t.mouseHasMoved&&t.controller.addToHistory("item","edit "+e)}toggleAnchorPointTool(e){var t=this
e?(t.isEditingAnchorPoint=!0,t.$domHandles.addClass("editAnchorPoint")):(t.isEditingAnchorPoint=!1,t.$domHandles.removeClass("editAnchorPoint"),"anchorPoint"==t.controller.toolbarUtils.currentTool&&t.controller.toolbarUtils.setTool(null))}}}),define("pikimov/classes/effects/TwoPassShaderEffect",["exports"],function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class t extends THREE.Pass{constructor(e,t,o){super(),this.shaderMaterialFirst=e,this.shaderMaterialSecond=t,this.renderTarget=o,this.fsQuadFirst=new THREE.FullScreenQuad(e),this.fsQuadSecond=new THREE.FullScreenQuad(t)}render(e,t,o){var r=this
e.setRenderTarget(r.renderTarget),e.clear(),r.shaderMaterialFirst.uniforms.tDiffuse.value=o.texture,r.fsQuadFirst.render(e),r.shaderMaterialSecond.uniforms.tDiffuse.value=o.texture,r.shaderMaterialSecond.uniforms.tIn2.value=r.renderTarget.texture,e.setRenderTarget(t),e.clear(),r.fsQuadSecond.render(e)}}e.default=t}),define("pikimov/classes/effects/bend",["exports","pikimov/classes/effects/c_effect"],function(e,t){function o(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{constructor(e){super(e),o(this,"bender",null)
var t=this
t.bender=new c_bender,t.setCommonProperties(),t.shader=null}updateUniforms(e){var t=this,o=t.sceneItem,r=o.threejsObj
if(r){var n=o.getDimensionsAt(e).width,i="y"
if(1*t.currentValues[0]==2&&(i="z"),"y"==i)n/=o.getTransformAt(e).scale.x/100
var a=t.currentValues[1]/n*2,l=THREE.MathUtils.degToRad(a)
0!=l&&r.traverse(e=>{if(e.geometry){var r=e.geometry.clone()
t.bender.bend(r,i,l),"image"!=o.type&&"video"!=o.type&&"imageSequence"!=o.type&&"composition"!=o.type||a>0&&function(e){const t=[0,0,0]
for(let o=0;o<e.attributes.normal.array.length/9;o++)t[0]=e.attributes.normal.array[9*o],t[1]=e.attributes.normal.array[9*o+1],t[2]=e.attributes.normal.array[9*o+2],e.attributes.normal.array[9*o]=e.attributes.normal.array[9*o+6],e.attributes.normal.array[9*o+1]=e.attributes.normal.array[9*o+7],e.attributes.normal.array[9*o+2]=e.attributes.normal.array[9*o+8],e.attributes.normal.array[9*o+6]=t[0],e.attributes.normal.array[9*o+7]=t[1],e.attributes.normal.array[9*o+8]=t[2]
for(let o=0;o<e.attributes.position.array.length/9;o++)t[0]=e.attributes.position.array[9*o],t[1]=e.attributes.position.array[9*o+1],t[2]=e.attributes.position.array[9*o+2],e.attributes.position.array[9*o]=e.attributes.position.array[9*o+6],e.attributes.position.array[9*o+1]=e.attributes.position.array[9*o+7],e.attributes.position.array[9*o+2]=e.attributes.position.array[9*o+8],e.attributes.position.array[9*o+6]=t[0],e.attributes.position.array[9*o+7]=t[1],e.attributes.position.array[9*o+8]=t[2]
for(let o=0;o<e.attributes.uv.array.length/6;o++)t[0]=e.attributes.uv.array[6*o],t[1]=e.attributes.uv.array[6*o+1],e.attributes.uv.array[6*o]=e.attributes.uv.array[6*o+4],e.attributes.uv.array[6*o+1]=e.attributes.uv.array[6*o+5],e.attributes.uv.array[6*o+4]=t[0],e.attributes.uv.array[6*o+5]=t[1]
e.attributes.normal.needsUpdate=!0,e.attributes.position.needsUpdate=!0,e.attributes.uv.needsUpdate=!0}(r),e.geometry.dispose(),e.geometry=r}})}}destroy(){this.bender=null,this.sceneItem.applyBackUpGeometry()}}e.default=r}),define("pikimov/classes/effects/bloom",["exports","pikimov/classes/effects/c_effect","pikimov/classes/effects/shaders/shader-bloom"],function(e,t,o){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{constructor(e){super(e)
var t=this
t.shader.fragmentShader=o._bloom_fragmentShader
var r=t.getSize()
t.shader.uniforms={tDiffuse:{value:null},u_threshold:{},u_amount:{},u_blurSize:{},iChannelResolution:{value:{x:r.x,y:r.y}}},t.shaderPass=new ShaderPass(t.shader),t.setCommonProperties()}updateUniforms(){var e=this,t=e.getZoom(),o=e.currentValues[2]*t,r=e.shaderPass.uniforms
r.u_threshold.value=e.currentValues[0]/100,r.u_amount.value=e.currentValues[1]/50,r.u_blurSize.value=o}}e.default=r}),define("pikimov/classes/effects/blur",["exports","pikimov/classes/effects/c_effect","pikimov/classes/effects/shaders/shader-blur"],function(e,t,o){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{constructor(e){super(e)
var t=this
t.shader.fragmentShader=o._blur_fragmentShader
var r=t.getSize()
t.shader.uniforms={tDiffuse:{value:null},resolution:{value:{x:r.x,y:r.y}},blur_radius:{},dimension:{}},t.shaderPass=new ShaderPass(t.shader),t.setCommonProperties()}updateUniforms(){var e=this,t=e.getZoom(),o=Math.round(e.currentValues[0]*t),r=e.filterData.params[1].value
0!=o?(e.shaderPass.enabled=!0,e.shaderPass.uniforms.blur_radius.value=o,e.shaderPass.uniforms.dimension.value=r):e.shaderPass.enabled=!1}}e.default=r}),define("pikimov/classes/effects/brightness-contrast",["exports","pikimov/classes/effects/c_effect"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class o extends t.default{constructor(e){super(e)
var t=this
t.shader.fragmentShader="varying vec2 vUv;\nuniform sampler2D tDiffuse;//input\nuniform float u_brightness;\nuniform float u_contrast;\n\nvoid main()\n{\n    mediump vec4 tColorIn = texture(tDiffuse, vUv);\n\n    //if(tColorIn.a < 0.05) discard;//to avoid alpha issues\n\n    //brightness\n    mediump vec4 out_rgba = vec4(tColorIn.rgb + u_brightness, tColorIn.a);\n\n    //contrast\n    out_rgba.rgb = (out_rgba.rgb - vec3(0.5)) * u_contrast + vec3(0.5);\n\n    gl_FragColor = out_rgba;\n}",t.shader.uniforms={tDiffuse:{value:null},u_brightness:{},u_contrast:{}},t.shaderPass=new ShaderPass(t.shader),t.setCommonProperties()}updateUniforms(){var e=this
if(1*e.currentValues[0]!=0||1*e.currentValues[1]!=0){var t=e.currentValues[0]/300,o=e.currentValues[1]/400+1
e.shaderPass.uniforms.u_brightness.value=t,e.shaderPass.uniforms.u_contrast.value=o}else e.shaderPass.enabled=!1}}e.default=o}),define("pikimov/classes/effects/c_effect",["exports","pikimov/classes/shaders/shaders-common"],function(e,t){function o(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=class{constructor(e){o(this,"compositionManager",null),o(this,"sceneItem",null),o(this,"filterData",null),o(this,"indexEffect",null),o(this,"shaderPass",null),o(this,"shader",null),o(this,"currentValues",[])
var r=this
r.filterData=e.effectData,r.compositionManager=e.compositionManager,r.sceneItem=e.sceneItem,r.indexEffect=e.index,_config.isDebug&&console.log("new FX",r.filterData.type),r.shader={vertexShader:t._commonVertexShader}}setCommonProperties(){var e=this.shaderPass
e&&(e.name="FX "+this.filterData.type+" pass",e.material.transparent=!0,e.clear=!0)}getZoom(){var e=this.compositionManager,t=e.getZoom()/100,o=e.controller.minRenderZoom
if(t<o&&(t=o),t>1&&(t=1),!e.isActive){var r=e.controller.compositionManager.getZoom()/100
r<o&&(r=o),r>1&&(r=1),t=r}return t}getSize(){return this.compositionManager.renderEngine.getRenderSize()}getScreenSpaceInfo(){this.sceneItem.threejsHook.updateMatrixWorld(!0)
var e=this.compositionManager.renderEngine.activeCamera
const t=(new THREE.Box3).setFromObject(this.sceneItem.threejsObj),o=t.getCenter(new THREE.Vector3)
o.project(e)
return{center:new THREE.Vector2((o.x+1)/2,(o.y+1)/2),radius:t.getSize(new THREE.Vector3).length()/e.position.distanceTo(o)}}getCurrentFrame(){return this.compositionManager.currentFrame}applyFrame(e){var t=this
t.filterData.params.forEach(function(o,r){var n=t.sceneItem.effectManager.getEffectParamValue(t.filterData,r,e)
t.currentValues[r]=n}),t.updateUniforms(e)}toggleEnabled(e){}updateUI(){}destroy(){this.shaderPass=null,this.shader=null}}}),define("pikimov/classes/effects/chroma-key",["exports","pikimov/classes/effects/c_effect"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class o extends t.default{constructor(e){super(e)
var t=this
if(2==e.effectData.params.length){var o=structuredClone(e.effectData.params[0]),r=structuredClone(e.effectData.params[1])
o.rangeInput=!0,e.effectData.params=[r,o,{name:"smoothness",type:"number",rangeInput:!0,min:0,max:90,value:30}]}t.filterData=e.effectData,t.shader.fragmentShader="varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform mediump vec3 u_color;\nuniform mediump float u_tolerance;\nuniform mediump float u_smoothness;\n\nvoid main()\n{\n    mediump vec4 tColorIn = texture(tDiffuse, vUv);\n\n    //seems good, but should better multiply by the material opacity.\n    //multiply color by alpha to recorrect them\n    tColorIn.rgb /= tColorIn.a;\n\n    mediump float a = min((length(tColorIn.rgb - u_color) - u_tolerance) * u_smoothness, 1.0);\n\n    a *= tColorIn.a;\n    \n    if(a < 0.02) discard;//to avoid alpha issues - kill any pixel less than 2% alpha\n\n    gl_FragColor = vec4(tColorIn.rgb, a);\n}",t.shader.uniforms={tDiffuse:{value:null},u_tolerance:{},u_smoothness:{},u_color:{}},t.shaderPass=new ShaderPass(t.shader),t.setCommonProperties()}updateUniforms(){var e=this,t=e.shaderPass.uniforms
t.u_color.value=valueToSRGB(e.currentValues[0]),t.u_tolerance.value=e.currentValues[1]/100,t.u_smoothness.value=(100-e.currentValues[2])/10}}e.default=o}),define("pikimov/classes/effects/chromatic-aberration",["exports","pikimov/classes/effects/c_effect","pikimov/classes/effects/shaders/shader-chromatic-aberration"],function(e,t,o){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{constructor(e){super(e)
var t=this
t.shader.fragmentShader=o._chromaticAberration_fragmentShader,t.shader.uniforms={tDiffuse:{value:null},resolution:{},u_amount:{},shiftX:{},shiftY:{}},t.shaderPass=new ShaderPass(t.shader),t.setCommonProperties()}updateUniforms(){var e=this,t=e.getZoom(),o=e.getSize(),r=e.currentValues[0]/100,n=e.currentValues[1]*t,i=e.currentValues[2]*t,a=e.shaderPass.uniforms
a.resolution.value={x:o.width,y:o.height},a.u_amount.value=r,a.shiftX.value=n,a.shiftY.value=i}}e.default=r}),define("pikimov/classes/effects/color-balance",["exports","pikimov/classes/effects/c_effect","pikimov/classes/effects/shaders/shader-color-balance"],function(e,t,o){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{constructor(e){super(e)
var t=this
t.shader.fragmentShader=o._colorBalance_fragmentShader,t.currentValues[1]=1*t.filterData.params[1].value,t.currentValues[2]=1*t.filterData.params[2].value,t.currentValues[3]=1*t.filterData.params[3].value,t.currentValues[5]=1*t.filterData.params[5].value,t.currentValues[6]=1*t.filterData.params[6].value,t.currentValues[7]=1*t.filterData.params[7].value,t.currentValues[9]=1*t.filterData.params[9].value,t.currentValues[10]=1*t.filterData.params[10].value,t.currentValues[11]=1*t.filterData.params[11].value
var r={x:1*t.currentValues[1]/100,y:1*t.currentValues[2]/100,z:1*t.currentValues[3]/100}
r.x<0&&(r.x/=5),r.y<0&&(r.y/=5),r.z<0&&(r.z/=5)
var n={x:1*t.currentValues[5]/100,y:1*t.currentValues[6]/100,z:1*t.currentValues[7]/100}
n.x<0&&(n.x/=5),n.y<0&&(n.y/=5),n.z<0&&(n.z/=5)
var i={x:1*t.currentValues[9]/100,y:1*t.currentValues[10]/100,z:1*t.currentValues[11]/100}
i.x<0&&(i.x/=5),i.y<0&&(i.y/=5),i.z<0&&(i.z/=5),t.shader.uniforms={tDiffuse:{value:null},Shadows:{value:r},Midtones:{value:n},Hilights:{value:i},shadowAmountR:{value:.5},shadowAmountG:{value:.5},shadowAmountB:{value:.5},midtoneAmountR:{value:.5},midtoneAmountG:{value:.5},midtoneAmountB:{value:.5},highlightAmountR:{value:1},highlightAmountG:{value:0},highlightAmountB:{value:1},preserveLuminosity:{value:1},shadowsShift:{value:{x:0,y:0,z:0}},midtonesShift:{value:{x:0,y:0,z:0}},highlightsShift:{value:{x:.5,y:0,z:.5}}},t.shaderPass=new ShaderPass(t.shader),t.setCommonProperties()}updateUniforms(){var e=this,t={x:1*e.currentValues[1]/100,y:1*e.currentValues[2]/100,z:1*e.currentValues[3]/100}
t.x<0&&(t.x/=5),t.y<0&&(t.y/=5),t.z<0&&(t.z/=5)
var o={x:1*e.currentValues[5]/100,y:1*e.currentValues[6]/100,z:1*e.currentValues[7]/100}
o.x<0&&(o.x/=5),o.y<0&&(o.y/=5),o.z<0&&(o.z/=5)
var r={x:1*e.currentValues[9]/100,y:1*e.currentValues[10]/100,z:1*e.currentValues[11]/100}
r.x<0&&(r.x/=5),r.y<0&&(r.y/=5),r.z<0&&(r.z/=5)
var n=e.shaderPass.uniforms
n.Shadows.value=t,n.Midtones.value=o,n.Hilights.value=r}}e.default=r}),define("pikimov/classes/effects/coloroverlay",["exports","pikimov/classes/effects/c_effect"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class o extends t.default{constructor(e){super(e)
var t=this
t.shader.fragmentShader="varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform mediump float u_value;\nuniform mediump vec3 u_color;\n\nvoid main()\n{\n    mediump vec4 tColorIn = texture(tDiffuse, vUv);\n\n    //overlay color with alpha from texture\n    mediump vec4 tColor2b = vec4(u_color, tColorIn.a);\n\n    //mix 2 colors\n    mediump vec4 out_rgba = mix(tColorIn, tColor2b, u_value);\n\n    gl_FragColor = out_rgba;\n}",t.shader.uniforms={tDiffuse:{value:null},u_value:{},u_color:{value:new THREE.Color}},t.shaderPass=new ShaderPass(t.shader),t.setCommonProperties()}updateUniforms(){var e=this,t=e.currentValues[1],o=e.shaderPass.uniforms
o.u_value.value=e.currentValues[0]/100,o.u_color.value.set(t).convertLinearToSRGB()}}e.default=o}),define("pikimov/classes/effects/crop-edges",["exports","pikimov/classes/effects/c_effect"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class o extends t.default{constructor(e){super(e)
this.setCommonProperties()}updateUniforms(e){var t=this,o=t.sceneItem.getTransformAt(e),r=t.sceneItem.getDimensionsAt(e)
const n=r.width*o.scale.x/100,i=r.height*o.scale.y/100
t.sceneItem.threejsHook.updateMatrixWorld(!0)
var a=[1-t.currentValues[3]/100,1-t.currentValues[1]/100,1-t.currentValues[2]/100,1-t.currentValues[0]/100]
t.sceneItem.threejsObj.traverse(function(e){var o=e
if(o.geometry&&o.visible&&o.geometry.attributes.position){var r=n*a[0]-n/2,l=n*a[1]-n/2,s=new THREE.Plane(new THREE.Vector3(1,0,0),r),c=new THREE.Plane(new THREE.Vector3(-1,0,0),l),u=i*a[2]-i/2,m=i*a[3]-i/2,p=[s,c,new THREE.Plane(new THREE.Vector3(0,1,0),u),new THREE.Plane(new THREE.Vector3(0,-1,0),m)]
t.updateClippingPlaneInObjectSpace(o,p),o.material&&(o.material.clippingPlanes=p)}})}updateClippingPlaneInObjectSpace(e,t){const o=this.sceneItem.threejsObj.matrixWorld,r=new THREE.Vector3,n=new THREE.Quaternion,i=new THREE.Vector3
o.decompose(r,n,i)
const a=new THREE.Vector3
e.getWorldPosition(a)
const l=this.sceneItem.threejsObj.worldToLocal(a.clone())
r.x+=l.x,r.y+=l.y,r.z+=l.z
const s=(new THREE.Matrix4).compose(r,n,new THREE.Vector3(1,1,1))
t[0].applyMatrix4(s),t[1].applyMatrix4(s),t[2].applyMatrix4(s),t[3].applyMatrix4(s)}destroyPlanes(){this.sceneItem.threejsObj.traverse(function(e){e.material&&(e.material.clippingPlanes=null)})}toggleEnabled(e){e||this.destroyPlanes()}destroy(){var e=this
e.destroyPlanes(),e.shaderPass=null,e.shader=null}}e.default=o}),define("pikimov/classes/effects/displace",["exports","pikimov/classes/effects/c_effect"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class o extends t.default{constructor(e){super(e)
this.setCommonProperties(),this.shader=null}updateUniforms(){var e=this,t=e.currentValues[0],o=e.currentValues[1],r=e.sceneItem.getters.getSceneItemByCompUid(e.sceneItem.compositionManager,o)
if(!r)return
const n=e.sceneItem.texture,i=r.texture,a=new THREE.ShaderMaterial({uniforms:{colorMap:{value:n},depthMap:{value:i},displacementScale:{value:t}},vertexShader:"uniform sampler2D depthMap;\nuniform float displacementScale;\nvarying vec2 vUv;\n\nvoid main(){\nvUv = uv;\nfloat depth = texture2D(depthMap, uv).r;\nvec3 displaced = position + normal * depth * displacementScale;\ngl_Position = projectionMatrix * modelViewMatrix * vec4(displaced, 1.0);\n}\n",fragmentShader:"uniform sampler2D colorMap;\nvarying vec2 vUv;\n\nvoid main(){\nvec4 color = texture2D(colorMap, vUv);\ngl_FragColor = color;\n}\n",side:THREE.DoubleSide})
e.sceneItem.threejsObj.material=a}}e.default=o}),define("pikimov/classes/effects/ffd",["exports","pikimov/classes/effects/c_effect"],function(e,t){function o(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{constructor(e){super(e),o(this,"controller",null),o(this,"latticeMin",null),o(this,"latticeMax",null),o(this,"controlPoints",[]),o(this,"isDraggingPoint",!1),o(this,"draggedIndex",0),o(this,"startPointPosition",null),o(this,"mouseStart",null),o(this,"mouse",null),o(this,"localBBox",null),o(this,"pinkMaterial",null)
var t=this
t.controller=t.compositionManager.controller,t.setCommonProperties(),void 0===t.filterData.params[0].value&&t.createJsonPointsData()}getLocalBoundingBox(){return this.sceneItem.boundingBox.clone()}createJsonPointsData(){var e=this,t=e.getLocalBoundingBox()
t.min.x=Math.round(t.min.x),t.min.y=Math.round(t.min.y),t.min.z=Math.round(t.min.z),t.max.x=Math.round(t.max.x),t.max.y=Math.round(t.max.y),t.max.z=Math.round(t.max.z),e.latticeMin=t.min,e.latticeMax=t.max
var o=e.latticeMin,r=e.latticeMax
"model"!=e.sceneItem.type&&(o.z=0,r.z=0,e.filterData.params[0].value=[new THREE.Vector3(o.x,o.y,o.z),new THREE.Vector3(r.x,o.y,o.z),new THREE.Vector3(o.x,r.y,r.z),new THREE.Vector3(r.x,r.y,r.z)]),"model"==e.sceneItem.type&&(e.filterData.params[0].value=[new THREE.Vector3(o.x,o.y,o.z),new THREE.Vector3(r.x,o.y,o.z),new THREE.Vector3(o.x,r.y,o.z),new THREE.Vector3(r.x,r.y,o.z),new THREE.Vector3(o.x,o.y,r.z),new THREE.Vector3(r.x,o.y,r.z),new THREE.Vector3(o.x,r.y,r.z),new THREE.Vector3(r.x,r.y,r.z)])}getArrayRef(){var e=this,t=e.filterData.params[0]
if(!t.useKeyframes)return t.value
var o=e.getCurrentFrame(),r=null,n=t.keyframes
if(n.forEach(function(e){e.frame==o&&(r=e)}),r)return e.controller.keyframesUtils.checkStaticKeys(n),r.values.p
var i=e.sceneItem.getCompItem(),a=e.indexEffect,l=e.filterData.params[0]
return e.controller.keyframesUtils.addEffectKey(i,l,null,a,0),t.keyframes.forEach(function(e){e.frame==o&&(r=e)}),r?(e.sceneItem.applyFrame(o),r.values.p):(console.error("ERROR ffd key"),null)}addEventHandlers(){this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}onMouseMove(e){var t=this
if(t.isDraggingPoint){var o=document.querySelector("#overCanvas"),r=$(o).offset(),n=e.clientX-o.scrollLeft-r.left,i=e.clientY-o.scrollTop-r.top
return t.mouse={x:n,y:i},t.drag2DHandle(),!1}}onMouseUp(e){var t=this
return!!t.isDraggingPoint&&(t.isDraggingPoint=!1,"2D"==t.sceneItem.cameraType&&t.controlPoints.forEach(function(e){$(e).find("label").eq(0)[0].textContent=""}),t.controller.addToHistory("item","edit corner pin point"),!1)}createControlPoints(){var e=this
if(e.compositionManager.isActive){var t=valueToSRGB(16724940)
e.pinkMaterial=new THREE.MeshBasicMaterial({color:t})
var o=e.currentValues[0],r=e.sceneItem.cameraType
if("2D"==r){var n=e.sceneItem.controlsHandles.domHandles
n||console.log("ERROR: no domHandles"),e.addEventHandlers(),o.forEach(function(t,o){var r=document.createElement("span")
r.className="FFDControl"
var i=document.createElement("label")
r.appendChild(i),$(r).on("mousedown",function(t){var r=e.getCurrentFrame()
e.applyFrame(r)
var n=document.querySelector("#overCanvas"),i=$(n).offset()
e.mouseStart={x:t.clientX-n.scrollLeft-i.left,y:t.clientY-n.scrollTop-i.top},e.isDraggingPoint=!0,e.draggedIndex=o
var a=e.getArrayRef()[e.draggedIndex]
return e.startPointPosition={x:a.x,y:a.y,z:a.z},!1}),e.controlPoints.push(r),n.appendChild(r)})}if("3D"==r){const t=new THREE.SphereGeometry(40,16,16)
o.forEach(function(o,r){const n=new THREE.Mesh(t,e.pinkMaterial)
n.name="FFDControl "+r,n.userData.FFDControl=!0,n.userData.selectControl=function(){e.selectControl(r)},n.userData.dragControl=function(t){e.dragControl(r,t)},e.controlPoints.push(n),e.sceneItem.threejsHook.add(n)})}}}updateControlPoints(e){var t=this
if(t.compositionManager.isActive){var o=t.sceneItem.cameraType
if("2D"==o){var r=t.controller.compositionDisplayZoom/100,n=new THREE.Vector3
t.sceneItem.threejsHook.getWorldScale(n),e.forEach(function(e,o){var i=t.controlPoints[o],a=e.x*r*n.x,l=-1*e.y*r*n.y;(i.style.left=`calc(50% + ${a}px)`,i.style.top=`calc(50% + ${l}px)`,"model"==t.sceneItem.type)&&(l+=t.getLocalBoundingBox().min.y*r*n.y/100,i.style.top=`calc(100% + ${l}px`)})}if("3D"==o){var i=t.sceneItem.threejsHook.scale
e.forEach(function(e,o){var r=t.controlPoints[o]
r.position.copy(e),r.scale.set(1/i.x,1/i.y,1/i.z)})}}}applyFFD4(e,t){var o=this.localBBox,r=o.min,n=o.max
r.z=0,n.z=0
var i=new THREE.Vector3(t[0].x,t[0].y,t[0].z),a=new THREE.Vector3(t[1].x,t[1].y,t[1].z),l=new THREE.Vector3(t[2].x,t[2].y,t[2].z),s=new THREE.Vector3(t[3].x,t[3].y,t[3].z),c=n.x-r.x,u=n.y-r.y
const m=e.attributes.position
for(let d=0;d<m.count;d++){const e=(new THREE.Vector3).fromBufferAttribute(m,d),t=p({x:(e.x-r.x)/c,y:(e.y-r.y)/u})
m.setXYZ(d,t.x,t.y,t.z)}function p(e){const t=i.clone().lerp(a,e.x),o=l.clone().lerp(s,e.x)
return t.lerp(o,e.y)}m.needsUpdate=!0}applyFFD8(e,t,o){var r,n=this.localBBox,i=n.min,a=n.max,l=[]
for(r=0;r<8;r++)l[r]=new THREE.Vector3(o[r].x/1,o[r].y/1,o[r].z/1)
var s=this.sceneItem.threejsObj.matrixWorld
const c=(new THREE.Matrix4).copy(s).invert(),u=(new THREE.Matrix4).extractRotation(e.matrix),m=(new THREE.Matrix4).copy(u).invert(),p=(new THREE.Matrix4).multiplyMatrices(c,e.matrixWorld),d=t.attributes.position
for(let g=0;g<d.count;g++){var f=(new THREE.Vector3).fromBufferAttribute(d,g)
f.applyMatrix4(p)
var v=h(new THREE.Vector3((f.x-i.x)/(a.x-i.x),(f.y-i.y)/(a.y-i.y),(f.z-i.z)/(a.z-i.z)),l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7])
v.x-=e.position.x,v.y-=e.position.y,v.z-=e.position.z,v.applyMatrix4(m),d.setXYZ(g,v.x,v.y,v.z)}function h(e,t,o,r,n,i,a,l,s){const{x:c,y:u,z:m}=e,p=t.clone().lerp(o,c),d=i.clone().lerp(a,c),f=r.clone().lerp(n,c),v=l.clone().lerp(s,c),h=p.clone().lerp(f,u),g=d.clone().lerp(v,u)
return h.lerp(g,m)}d.needsUpdate=!0}updateUniforms(){var e=this,t=e.sceneItem
if(t.threejsObj){e.localBBox||(e.localBBox=e.getLocalBoundingBox(t.threejsObj)),0==e.controlPoints.length&&e.createControlPoints()
var o=e.currentValues[0]
e.updateControlPoints(o),t.threejsObj.traverse(t=>{if(t.geometry){var r=t.geometry.clone()
4==o.length&&e.applyFFD4(r,o),8==o.length&&e.applyFFD8(t,r,o),t.geometry.dispose(),t.geometry=r}})}}drag2DHandle(){var e=this,t=new geoUtils(e.controller,e.sceneItem),o=t.getLocalMouseDelta(e.mouseStart,e.mouse)
t=null
var r=e.getArrayRef(),n=e.draggedIndex
r[n]={x:e.startPointPosition.x+o.x,y:e.startPointPosition.y+o.y,z:e.startPointPosition.z},$(e.controlPoints[n]).find("label").eq(0)[0].textContent=` ${r[n].x}, ${r[n].y} `
var i=e.getCurrentFrame()
e.sceneItem.applyFrame(i),e.compositionManager.requestRender()}selectControl(e){var t=this
t.controller.selectionUtils.clearSelection()
var o=t.controlPoints[e]
t.controller.controlsUtils.transformControls.attach(o)}dragControl(e,t){var o=this
o.getArrayRef()[e]={x:t.x,y:t.y,z:t.z}
var r=o.getCurrentFrame()
o.sceneItem.applyFrame(r),o.compositionManager.requestRender()}toggleEnabled(e){var t=this,o=t.sceneItem.cameraType
if("2D"==o){var r="block"
e||(r="none"),t.controlPoints.forEach(function(e){e.style.display=r})}"3D"==o&&t.controlPoints.forEach(function(t){t.visible=e})}updateUI(){var e=this
if(e.filterData.enabled){var t=e.currentValues[0]
e.updateControlPoints(t)}}destroy(){var e=this,t=e.sceneItem
t.applyBackUpGeometry(),e.compositionManager.isActive&&("2D"==t.cameraType&&(document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp),e.controlPoints.forEach(function(e){e.remove()})),"3D"==t.cameraType&&e.controlPoints.forEach(function(e){e.parent.remove(e)}),e.pinkMaterial&&(e.pinkMaterial.dispose(),e.pinkMaterial=null)),e.shader=null}}e.default=r}),define("pikimov/classes/effects/film-grain",["exports","pikimov/classes/effects/c_effect"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class o extends t.default{constructor(e){super(e)
this.shaderPass=new FilmPass,this.setCommonProperties()}updateUniforms(){this.shaderPass.uniforms.intensity.value=this.currentValues[0]/100}}e.default=o}),define("pikimov/classes/effects/fisheye",["exports","pikimov/classes/effects/c_effect"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class o extends t.default{constructor(e){super(e)
var t=this
t.shader.fragmentShader="varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform float strength;  // Strength of the magnification\nuniform vec2 center;     // Center of the fisheye effect in UV coordinates\n\nvoid main(){\n    vec2 delta = vUv - center;\n    float dist = length(delta);\n    \n    // Apply a smooth radial distortion formula\n    float factor = 1.0 + strength * (1.0 - dist * dist); \n    \n    // Move pixels outward from the center in a curved way\n    vec2 uvDistorted = center + delta * factor;\n\n    // Prevent out-of-bounds artifacts\n    uvDistorted = clamp(uvDistorted, vec2(0.0), vec2(1.0));\n\n    gl_FragColor = texture2D(tDiffuse, uvDistorted);\n}"
var o=t.getSize()
t.shader.uniforms={tDiffuse:{value:null},strength:{value:.5},center:{value:new THREE.Vector2(.5,.5)},resolution:{value:{x:o.x,y:o.y}},radius:{}},t.shaderPass=new ShaderPass(t.shader),t.setCommonProperties()}updateUniforms(){var e=this,t=e.currentValues[0]/100
if(0==t)return void(e.shaderPass.enabled=!1)
e.shaderPass.enabled=!0
const{center:o,radius:r}=e.getScreenSpaceInfo()
var n=e.shaderPass.uniforms
n.center.value=o,n.strength.value=-1*t}}e.default=o}),define("pikimov/classes/effects/fluted-glass",["exports","pikimov/classes/effects/c_effect","pikimov/classes/effects/shaders/shader-fluted-glass"],function(e,t,o){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{constructor(e){super(e)
var t=this
t.shader.fragmentShader=o._flutedGlass_fragmentShader,t.shader.uniforms={tDiffuse:{value:null},resolution:{},uImageAspect:{},uOverlayColor:{value:new THREE.Vector3(0,0,0)},uOverlayColorWhite:{value:new THREE.Vector3(1,1,1)},uMotionValue:{value:0},uRotation:{},uSegments:{},uOverlayOpacity:{}},t.shaderPass=new ShaderPass(t.shader),t.setCommonProperties()}updateUniforms(){var e=this,t=e.getSize(),o=e.shaderPass.uniforms
o.resolution.value={x:t.width,y:t.height},o.uImageAspect.value=t.width/t.height,o.uSegments.value=e.currentValues[0],o.uRotation.value=e.currentValues[1],o.uOverlayOpacity.value=e.currentValues[2]}}e.default=r}),define("pikimov/classes/effects/glitch",["exports","pikimov/classes/effects/c_effect","pikimov/classes/effects/shaders/shader-glitch"],function(e,t,o){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{constructor(e){super(e)
var t=this
t.shader.fragmentShader=o._glitch_fragmentShader,t.shader.uniforms={tDiffuse:{value:null},iTime:{},u_amount:{}},t.shaderPass=new ShaderPass(t.shader),t.setCommonProperties()}updateUniforms(e){var t=this,o=t.getZoom(),r=t.shaderPass.uniforms
r.u_amount.value=t.currentValues[0]/100*o,r.iTime.value=e}}e.default=r}),define("pikimov/classes/effects/glsl-shader",["exports","pikimov/classes/effects/c_effect"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class o extends t.default{constructor(e){super(e)
var t=this
t.shader.fragmentShader=null,t.shader.uniforms={tDiffuse:{value:null}},t.shaderPass=new ShaderPass(t.shader),t.setCommonProperties()}updateUniforms(){var e=this,t=e.currentValues
e.shaderPass.material.fragmentShader=t[0],e.shaderPass.material.needsUpdate=!0}}e.default=o}),define("pikimov/classes/effects/grayscale",["exports","pikimov/classes/effects/c_effect","pikimov/classes/shaders/shaders-common"],function(e,t,o){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{constructor(e){super(e)
var t=this
t.shader.fragmentShader="varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform float u_value;\n"+o._correctByAlpha+"\nvoid main(){\n    mediump vec4 tColorIn = texture(tDiffuse, vUv);\n    mediump float lum = (tColorIn.r + tColorIn.g + tColorIn.b )/3.0;\n    mediump vec4 tColorGrayscale = vec4(lum, lum, lum, tColorIn.a);\n\n    vec4 tColorOut = mix(tColorIn, tColorGrayscale, u_value);\n    tColorOut = correctByAlpha(tColorOut);\n\n    gl_FragColor = tColorOut;\n}",t.shader.uniforms={tDiffuse:{value:null},u_value:{}},t.shaderPass=new ShaderPass(t.shader),t.setCommonProperties()}updateUniforms(){var e=this,t=e.shaderPass.uniforms,o=e.currentValues[0]/100
0!=o?(e.shaderPass.enabled=!0,t.u_value.value=o):e.shaderPass.enabled=!1}}e.default=r}),define("pikimov/classes/effects/halftone",["exports","pikimov/classes/effects/c_effect","pikimov/classes/effects/shaders/shader-halftone"],function(e,t,o){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{constructor(e){super(e)
var t=this,r=t.getSize()
e={shape:1,radius:4,rotateR:Math.PI/12*1,rotateB:Math.PI/12*2,rotateG:Math.PI/12*3,scatter:0,blending:1,blendingMode:1,greyscale:!1,disable:!1}
t.shaderPass=new HalftonePass(r.x,r.y,e),t.shaderPass.material.fragmentShader=o._halftone_fragmentShader,t.setCommonProperties()}updateUniforms(){var e=this,t=e.getZoom(),o=e.shaderPass.uniforms
o.shape.value=1*e.currentValues[0],o.radius.value=1*e.currentValues[1]*t,o.scatter.value=e.currentValues[2]/100,o.blending.value=e.currentValues[3]/100}}e.default=r}),define("pikimov/classes/effects/invert",["exports","pikimov/classes/effects/c_effect","pikimov/classes/effects/shaders/shader-invert"],function(e,t,o){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{constructor(e){super(e)
var t=this
t.shader.fragmentShader=o._invert_fragmentShader,t.shader.uniforms={tDiffuse:{value:null}},t.shaderPass=new ShaderPass(t.shader),t.setCommonProperties()}updateUniforms(){}}e.default=r}),define("pikimov/classes/effects/kaleidoscope",["exports","pikimov/classes/effects/c_effect","pikimov/classes/effects/shaders/shader-kaleidoscope"],function(e,t,o){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{constructor(e){super(e)
var t=this
t.shader.fragmentShader=o._kaleidoscope_fragmentShader,t.shader.uniforms={tDiffuse:{value:null},resolution:{value:new THREE.Vector4},uImageAspect:{},uRotation:{value:0},uRotationAmount:{value:1},uOffsetAmount:{value:1},uScaleFactor:{value:1},uSegments:{value:6},uOffset:{value:new THREE.Vector2(.5,.5)}},t.shaderPass=new ShaderPass(t.shader),t.setCommonProperties()}updateUniforms(){var e=this,t=e.getSize(),o=t.width,r=t.height,n=o/r,i=e.shaderPass.uniforms,a=e.currentValues
let l,s
r/o>1?(l=o/r*1,s=1):(l=1,s=r/o/1),i.resolution.value.x=o,i.resolution.value.y=r,i.resolution.value.z=l,i.resolution.value.w=s,i.uImageAspect.value=n,i.uSegments.value=a[0],i.uRotation.value=THREE.MathUtils.degToRad(a[1]),i.uOffset.value.x=a[2]/100,i.uOffset.value.y=a[3]/100/n}}e.default=r}),define("pikimov/classes/effects/leave-color",["exports","pikimov/classes/effects/c_effect"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class o extends t.default{constructor(e){super(e)
var t=this
t.shader.fragmentShader="varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform vec3 targetColor;\nuniform float similarity;\nuniform float smoothness;\n\n// Convert RGB to Grayscale using luminance\nfloat luminanceLeaveColor(vec3 color) {\n    return dot(color, vec3(0.3, 0.59, 0.11));\n}\n\n// Euclidean distance between two colors\nfloat colorDistance(vec3 c1, vec3 c2) {\n    return length(c1 - c2);\n}\n\nvoid main(){\n    vec4 texColor = texture2D(tDiffuse, vUv);\n    \n    // Compute grayscale version of the color\n    float gray = luminanceLeaveColor(texColor.rgb);\n    vec3 grayscaleColor = vec3(gray);\n    \n    // Compute the distance to the target color\n    float dist = colorDistance(texColor.rgb, targetColor);\n    \n    // Create a smooth transition using a step function with smoothness\n    float factor = smoothstep(similarity - smoothness, similarity + smoothness, dist);\n    \n    // Blend between grayscale and the original color\n    vec3 finalColor = mix(texColor.rgb, grayscaleColor, factor);\n\n    //correct by alpha, needed\n    finalColor.rgb /= texColor.a;\n    \n    gl_FragColor = vec4(finalColor, texColor.a);\n}",t.shader.uniforms={tDiffuse:{value:null},targetColor:{value:new THREE.Color},similarity:{},smoothness:{}},t.shaderPass=new ShaderPass(t.shader),t.setCommonProperties()}updateUniforms(){var e=this,t=e.currentValues[0],o=e.shaderPass.uniforms
o.targetColor.value.set(t).convertLinearToSRGB(),o.similarity.value=e.currentValues[1]/100,o.smoothness.value=e.currentValues[2]/100}}e.default=o}),define("pikimov/classes/effects/levels",["exports","pikimov/classes/effects/c_effect"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class o extends t.default{constructor(e){super(e)
var t=this
t.shader.fragmentShader="varying vec2 vUv;\nuniform sampler2D tDiffuse;\n\nuniform float u_minInput;\nuniform float u_gamma;\nuniform float u_maxInput;\nuniform float u_minOutput;\nuniform float u_maxOutput;\n\n/* ** Gamma correction */\n\n#define GammaCorrection(color, gamma)\t\t\t\t\t\t\t\tpow(color, vec3(1.0/gamma))\n\n/* ** Levels control (input (+gamma), output) */\n\n#define LevelsControlInputRange(color, minInput, maxInput)\t\t\tmin(max(color - vec3(minInput), vec3(0.0)) / (vec3(maxInput) - vec3(minInput)), vec3(1.0))\n#define LevelsControlInput(color, minInput, gamma, maxInput)\t\tGammaCorrection(LevelsControlInputRange(color, minInput, maxInput), gamma)\n#define LevelsControlOutputRange(color, minOutput, maxOutput) \t\tmix(vec3(minOutput), vec3(maxOutput), color)\n#define LevelsControl(color, minInput, gamma, maxInput, minOutput, maxOutput) \tLevelsControlOutputRange(LevelsControlInput(color, minInput, gamma, maxInput), minOutput, maxOutput)\n\nvoid main()\n{\n    mediump vec4 tColorIn = texture(tDiffuse, vUv);\n    \n    //color, minInput, gamma, maxInput, minOutput, maxOutput\n    mediump vec3 out_rgb = LevelsControl(tColorIn.rgb, u_minInput, u_gamma, u_maxInput, u_minOutput, u_maxOutput);\n\n    gl_FragColor = vec4(out_rgb.rgb, tColorIn.a);\n}",t.shader.uniforms={tDiffuse:{value:null},u_minInput:{},u_gamma:{},u_maxInput:{},u_minOutput:{},u_maxOutput:{}},t.shaderPass=new ShaderPass(t.shader),t.setCommonProperties()}updateUniforms(){var e=this,t=e.shaderPass.uniforms
t.u_minInput.value=e.currentValues[0]/255,t.u_gamma.value=e.currentValues[1],t.u_maxInput.value=e.currentValues[2]/255,t.u_minOutput.value=e.currentValues[3]/255,t.u_maxOutput.value=e.currentValues[4]/255}}e.default=o}),define("pikimov/classes/effects/luma-key",["exports","pikimov/classes/effects/c_effect","pikimov/classes/effects/shaders/shader-luma-key"],function(e,t,o){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{constructor(e){super(e)
var t=this
t.shader.fragmentShader=o._lumaKey_fragmentShader,t.shader.uniforms={tDiffuse:{value:null},u_type:{},u_threshold:{},u_tolerance:{}},t.shaderPass=new ShaderPass(t.shader),t.setCommonProperties()}updateUniforms(){var e=this
if(1*e.currentValues[0]!=1||1*e.currentValues[1]!=255)if(1*e.currentValues[0]!=2||1*e.currentValues[1]!=0){e.shaderPass.enabled=!0
var t=e.shaderPass.uniforms
t.u_type.value=e.currentValues[0],t.u_threshold.value=e.currentValues[1]/255,t.u_tolerance.value=e.currentValues[2]/255}else e.shaderPass.enabled=!1
else e.shaderPass.enabled=!1}}e.default=r}),define("pikimov/classes/effects/magnifying-lens",["exports","pikimov/classes/effects/c_effect"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class o extends t.default{constructor(e){super(e)
var t=this
t.shader.fragmentShader=_magnifyingLens_fragmentShader,t.shader.uniforms={tDiffuse:{value:null},resolution:{},lens_xy:{value:null},lens_uv:{value:null},magnification:{},lens_radius:{}},t.shaderPass=new ShaderPass(t.shader),t.setCommonProperties()}updateUniforms(){var e=this,t=e.getZoom(),o=e.getSize(),r=e.shaderPass.uniforms
r.resolution.value={x:o.width,y:o.height},r.lens_radius.value=1*e.currentValues[0]
var n=1*e.currentValues[1],i=o.height/t-1*e.currentValues[2]
i*=t,r.lens_xy.value={x:n,y:i},r.magnification.value=2}}e.default=o})
define("pikimov/classes/effects/mosaic",["exports","pikimov/classes/effects/c_effect","pikimov/classes/effects/shaders/shader-mosaic"],function(e,t,o){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{constructor(e){super(e)
var t=this
t.shader.fragmentShader=o._mosaic_fragmentShader,t.shader.uniforms={tDiffuse:{value:null},horizontalBlocks:{},verticalBlocks:{}},t.shaderPass=new ShaderPass(t.shader),t.setCommonProperties()}updateUniforms(){var e=this,t=e.shaderPass.uniforms
t.horizontalBlocks.value=1*e.currentValues[0],t.verticalBlocks.value=1*e.currentValues[1]}}e.default=r}),define("pikimov/classes/effects/motion-tile",["exports","pikimov/classes/effects/c_effect"],function(e,t){function o(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{constructor(e){super(e),o(this,"phase",0),o(this,"phaseDirection",0),o(this,"marginX",0),o(this,"marginY",0),this.setCommonProperties()}updateUniforms(e){var t=this,o=t.sceneItem,r=o.threejsObj
if(!r)return
t.marginX=1*t.currentValues[2],t.marginY=1*t.currentValues[3],t.phase=1*t.currentValues[4],t.phaseDirection=1*t.currentValues[5]
var n=o.getDimensionsAt(e)
const i=n.width+2*t.marginX,a=n.height+2*t.marginY
var l=o.getTransformAt(e),s=Math.floor(1*t.currentValues[0]),c=Math.floor(1*t.currentValues[1])
0!=t.phase&&(s+=2,c+=2),r.traverse(function(e){var o=e
if(!o.geometry)return
if(!o.visible)return
if(!o.geometry.attributes.position)return
var r=o.clone()
r.scale.set(1,1,1),r.rotation.set(0,0,0)
var n,u,m,p,d=r.geometry.groups.length,f=-1*Math.floor((s-1)/2)*i,v=1*Math.floor((c-1)/2)*a,h=Math.floor((s-1)/2),g=Math.floor((c-1)/2),y=[]
let b=0
var x=[]
for(u=0;u<c;u++)for(n=0;n<s;n++){m=f+n*i,p=v-1*u*a,0!=t.phase&&(u%2!=g%2&&0==t.phaseDirection&&(m-=(100-t.phase)/100*i),n%2!=h%2&&1==t.phaseDirection&&(p+=(100-t.phase)/100*a))
var w=r.geometry.clone()
w.translate(m,p,0),y.push(w)
for(const e of w.groups)x.push({start:e.start+b,count:e.count,materialIndex:e.materialIndex})
b+=w.attributes.position.count}const k=BufferGeometryUtils.mergeGeometries(y,!0);(y.forEach(function(e){e.dispose(),e=null}),1==d)&&(x=[{start:0,count:x[0].count*x.length,materialIndex:0}])
if(k.groups=x,k.computeBoundingSphere(),o.geometry.dispose(),o.geometry=k,0!=t.phase){var C=Math.floor(i*l.scale.x/100/2*t.currentValues[0]),S=new THREE.Plane(new THREE.Vector3(1,0,0),C),T=new THREE.Plane(new THREE.Vector3(-1,0,0),C),D=Math.floor(a*l.scale.y/100/2*t.currentValues[1]),P=[S,T,new THREE.Plane(new THREE.Vector3(0,1,0),D),new THREE.Plane(new THREE.Vector3(0,-1,0),D)]
t.updateClippingPlaneInObjectSpace(o,P),o.material&&(o.material.clippingPlanes=P)}else o.material&&(o.material.clippingPlanes=null)})}updateClippingPlaneInObjectSpace(e,t){const o=e.matrixWorld,r=new THREE.Vector3,n=new THREE.Quaternion,i=new THREE.Vector3
o.decompose(r,n,i)
const a=(new THREE.Matrix4).compose(r,n,new THREE.Vector3(1,1,1))
t[0].applyMatrix4(a),t[1].applyMatrix4(a),t[2].applyMatrix4(a),t[3].applyMatrix4(a)}toggleEnabled(e){}destroy(){var e=this
e.sceneItem.applyBackUpGeometry(),e.shaderPass=null,e.shader=null}}e.default=r}),define("pikimov/classes/effects/noise",["exports","pikimov/classes/effects/c_effect","pikimov/classes/effects/shaders/shader-noise"],function(e,t,o){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{constructor(e){super(e)
var t=this
t.shader.fragmentShader=o._noise_fragmentShader,t.shader.uniforms={tDiffuse:{value:null},time:{},noiseStrength:{}},t.shaderPass=new ShaderPass(t.shader),t.setCommonProperties()}updateUniforms(e){var t=this,o=t.shaderPass.uniforms,r=1*e,n=t.currentValues[1]/50
0!=n?(t.shaderPass.enabled=!0,0==t.currentValues[0]&&(r=0),o.time.value=r,o.noiseStrength.value=n):t.shaderPass.enabled=!1}}e.default=r}),define("pikimov/classes/effects/outline",["exports","pikimov/classes/effects/c_effect","pikimov/classes/effects/shaders/shader-outline"],function(e,t,o){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{constructor(e){super(e)
var t=this
t.shader.fragmentShader=o._outline_fragmentShader,t.shader.uniforms={tDiffuse:{value:null},u_color:{},u_opacity:{},u_size:{}},t.shaderPass=new ShaderPass(t.shader),t.setCommonProperties()}updateUniforms(){var e=this,t=e.shaderPass.uniforms,o=e.currentValues,r=e.getZoom(),n=o[1]/100,i=o[2]*r
if(0!=n&&0!=i){e.shaderPass.enabled=!0
var a=valueToSRGB(o[0])
t.u_color.value=a,t.u_opacity.value=n,t.u_size.value=i}else e.shaderPass.enabled=!1}}e.default=r}),define("pikimov/classes/effects/petzval-lens",["exports","pikimov/classes/effects/c_effect","pikimov/classes/effects/shaders/shader-petzval-lens"],function(e,t,o){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{constructor(e){super(e)
var t=this
t.shader.fragmentShader=o._petzvalLens_fragmentShader
var r=t.getSize()
t.shader.uniforms={tDiffuse:{value:null},resolution:{value:{x:r.x,y:r.y}},curvature:{},aberration:{},vignetteStrength:{},u_center:{},u_vignetteRadius:{}},t.shaderPass=new ShaderPass(t.shader),t.setCommonProperties()}updateUniforms(){var e=this,t=e.shaderPass.uniforms
const{center:o,radius:r}=e.getScreenSpaceInfo()
t.curvature.value=e.currentValues[0]/2,t.aberration.value=e.currentValues[1]/10,t.vignetteStrength.value=e.currentValues[2],t.u_center.value=o,t.u_vignetteRadius.value=r}}e.default=r}),define("pikimov/classes/effects/posterize",["exports","pikimov/classes/effects/c_effect","pikimov/classes/effects/shaders/shader-posterize"],function(e,t,o){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{constructor(e){super(e)
var t=this
t.shader.fragmentShader=o._posterize_fragmentShader,t.shader.uniforms={tDiffuse:{value:null},u_levels:{}},t.shaderPass=new ShaderPass(t.shader),t.setCommonProperties()}updateUniforms(){this.shaderPass.uniforms.u_levels.value=1*this.currentValues[0]}}e.default=r}),define("pikimov/classes/effects/radial-blur",["exports","pikimov/classes/effects/c_effect","pikimov/classes/effects/shaders/shader-radial-blur"],function(e,t,o){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{constructor(e){super(e)
var t=this
t.shader.fragmentShader=o._radialBlur_fragmentShader
var r=t.getSize()
t.shader.uniforms={tDiffuse:{value:null},resolution:{value:{x:r.x,y:r.y}},center:{},strength:{}},t.shaderPass=new ShaderPass(t.shader),t.setCommonProperties()}updateUniforms(){var e=this,t=e.getZoom(),o=e.currentValues[0]/t/1e3
if(0!=o){e.shaderPass.enabled=!0,e.shaderPass.uniforms.strength.value=o
var r=e.getSize(),n=e.currentValues[1]/100,i=1-e.currentValues[2]/100
e.shaderPass.uniforms.center.value={x:r.x*n,y:r.y*i}}else e.shaderPass.enabled=!1}}e.default=r}),define("pikimov/classes/effects/shaders/shader-bloom",["exports"],function(e){Object.defineProperty(e,"__esModule",{value:!0}),e._bloom_fragmentShader=void 0
e._bloom_fragmentShader="varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform vec3      iChannelResolution; // channel resolution (in pixels)\n\nuniform float u_threshold;\nuniform float u_amount;\nuniform float u_blurSize;\n\nvec4 BlurColor (in vec2 Coord, in sampler2D Tex, in float MipBias)\n{\n\tvec2 TexelSize = MipBias/iChannelResolution.xy;\n    \n    vec4  Color = texture(Tex, Coord, MipBias);\n    Color += texture(Tex, Coord + vec2(TexelSize.x,0.0), MipBias);    \t\n    Color += texture(Tex, Coord + vec2(-TexelSize.x,0.0), MipBias);    \t\n    Color += texture(Tex, Coord + vec2(0.0,TexelSize.y), MipBias);    \t\n    Color += texture(Tex, Coord + vec2(0.0,-TexelSize.y), MipBias);    \t\n    Color += texture(Tex, Coord + vec2(TexelSize.x,TexelSize.y), MipBias);    \t\n    Color += texture(Tex, Coord + vec2(-TexelSize.x,TexelSize.y), MipBias);    \t\n    Color += texture(Tex, Coord + vec2(TexelSize.x,-TexelSize.y), MipBias);    \t\n    Color += texture(Tex, Coord + vec2(-TexelSize.x,-TexelSize.y), MipBias);    \n\n    return Color/9.0;\n}\n\nvoid main()\n{\n    float Threshold = u_threshold;\n    float Intensity = u_amount;\n    \n    vec4 Color = texture(tDiffuse, vUv);\n    \n    vec4 Highlight = clamp(BlurColor(vUv, tDiffuse, u_blurSize)-Threshold,0.0,1.0)*1.0/(1.0-Threshold);\n        \n    vec4 tColorOut = 1.0-(1.0-Color)*(1.0-Highlight*Intensity); //Screen Blend Mode\n\n    //BETTER WITH THIS\n    //multiply color by alpha to recorrect them\n    tColorOut.rgb /= tColorOut.a;\n\n    gl_FragColor = tColorOut;\n}"}),define("pikimov/classes/effects/shaders/shader-blur",["exports"],function(e){Object.defineProperty(e,"__esModule",{value:!0}),e._blur_fragmentShader=void 0
e._blur_fragmentShader="#define PI2 6.28318530718\n\nvarying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform vec2 resolution;//renderer size\nuniform lowp int dimension;          //h, v or hv\nuniform mediump float blur_radius;\n\n\nvec4 biDimenions(vec4 tColorIn)\n{\n    float Directions = 16.0;\n    float Quality = 4.0;\n\n    //more quality when more blur radius\n    if (blur_radius >= 20.0)\n    {\n        Directions = 24.0;\n        Quality = 5.0;\n    }\n\n    vec2 Radius = blur_radius/resolution.xy;\n\n    // Blur calculations\n    for( float d=0.0; d<PI2; d+=PI2/Directions)\n    {\n        for(float i=1.0/Quality; i<=1.001; i+=1.0/Quality)\n        {\n            tColorIn += texture( tDiffuse, vUv+vec2(cos(d),sin(d))*Radius*i);\n        }\n    }\n\n    tColorIn /= Quality * Directions +1.0;\n\n    return tColorIn;\n}\n\n//for single direction blur\nvec4 dirBlur(sampler2D tex, vec2 uv, vec2 angle)\n{\n    //looks good @50, can go pretty high tho\n    const int samples = 50;\n\n    vec4 tColorIn = vec4(0);\n    \n    const float delta = 2.0 / float(samples);\n    for(float i = -1.0; i <= 1.0; i += delta)\n    {\n        tColorIn += texture(tex, uv - vec2(angle.x * i, angle.y * i)).rgba * delta * .5;\n    }\n    \n    return tColorIn;\n}\n\n\nvoid main()\n{\n    vec4 tColorIn = texture(tDiffuse, vUv);\n\n    //horizontal + vertical\n    if (dimension == 0)tColorIn = biDimenions(tColorIn);\n\n    //horizontal\n    if (dimension == 1)\n    {\n        float strength = blur_radius / resolution.x; //% of resolution ?\n    \n        vec2 direction = vec2(1.0, 0.0);\n\n        tColorIn = dirBlur(tDiffuse, vUv, strength*direction);\n    }\n\n    //vertical\n    if (dimension == 2)\n    {\n        float strength = blur_radius / resolution.y; //% of resolution ?\n    \n        vec2 direction = vec2(0.0, 1.0);\n        \n        tColorIn = dirBlur(tDiffuse, vUv, strength*direction);\n    }\n\n    //BETTER WITH THIS\n    //multiply color by alpha to recorrect them\n    tColorIn.rgb /= tColorIn.a;\n\n    //if(tColorIn.a < 0.05) discard;//to avoid alpha issues\n\n    gl_FragColor = tColorIn;\n}"}),define("pikimov/classes/effects/shaders/shader-chromatic-aberration",["exports"],function(e){Object.defineProperty(e,"__esModule",{value:!0}),e._chromaticAberration_fragmentShader=void 0
e._chromaticAberration_fragmentShader="varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform vec2 resolution;\nuniform float shiftX;\nuniform float shiftY;\nuniform float u_amount;\n\nvoid main(){\n\n    mediump vec4 tColorIn = texture(tDiffuse, vUv);\n\n    // Convert pixel shift to UV space\n    vec2 shift = vec2(shiftX / resolution.x, shiftY / resolution.y);\n\n    // Offset each channel in different directions\n    vec4 colR = texture2D(tDiffuse, vUv + shift);  // Red shifted diagonally\n    vec4 colG = texture2D(tDiffuse, vUv);          // Green stays in place\n    vec4 colB = texture2D(tDiffuse, vUv - shift);  // Blue shifted diagonally\n\n    vec4 color2 = vec4(colR.r, colG.g, colB.b, colG.a);\n\n    //mix 2 colors\n    gl_FragColor = mix(tColorIn, color2, u_amount);\n}"}),define("pikimov/classes/effects/shaders/shader-color-balance",["exports"],function(e){Object.defineProperty(e,"__esModule",{value:!0}),e._colorBalance_fragmentShader=void 0
e._colorBalance_fragmentShader="varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform vec3 Shadows;\nuniform vec3 Midtones;\nuniform vec3 Hilights;\n\n\nvec3 InvLerp( vec3 A, vec3 B, vec3 t)\n{\n    return (t - A) / (B - A);\n}\n\nvec3 ColorGrade( in vec3 InColor )\n{\n    // Calculate the three offseted colors up-front\n    vec3 OffShadows  = InColor + Shadows;\n    vec3 OffMidtones = InColor + Midtones;\n    vec3 OffHilights = InColor + Hilights;\n    \n    // Linearly interpolate between the 3 new colors, piece-wise\n    return mix(\n        // We pick which of the two control points to interpolate from based on which side of\n        // 0.5 the input color channel lands on\n        mix(OffShadows,  OffMidtones, InvLerp(vec3(0.0), vec3(0.5), InColor)), // <  0.5\n        mix(OffMidtones, OffHilights, InvLerp(vec3(0.5), vec3(1.0), InColor)), // >= 0.5\n        greaterThanEqual(InColor, vec3(0.5))\n    );\n}\n\nvoid main()\n{\n    mediump vec4 tColorIn = texture(tDiffuse, vUv);\n    mediump vec4 out_rgba;\n\n    out_rgba.rgb = ColorGrade(tColorIn.rgb);\n\n    //gamma correction ?? should not be needed\n    //out_rgba.rgb = pow(out_rgba.rgb, vec3(2.2));\n\n    out_rgba.a = tColorIn.a;\n\n    gl_FragColor = out_rgba;\n}"}),define("pikimov/classes/effects/shaders/shader-fluted-glass",["exports"],function(e){Object.defineProperty(e,"__esModule",{value:!0}),e._flutedGlass_fragmentShader=void 0
e._flutedGlass_fragmentShader="precision mediump float;\nvarying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform vec4 resolution;\nuniform float uImageAspect;\nuniform vec3 uOverlayColor;\nuniform vec3 uOverlayColorWhite;\nuniform float uMotionValue;\nuniform float uRotation;\nuniform float uSegments;\nuniform float uOverlayOpacity;\n\nvoid main(){\n    float canvasAspect = resolution.x / resolution.y;\n    float numSlices = uSegments;\n    float rotationRadians = uRotation * (3.14159265 / 180.0);\n\n    // Adjust the UV coordinates for aspect ratio\n    vec2 scaledUV = vUv;\n\n    if (uImageAspect > canvasAspect) {\n        float scale = canvasAspect / uImageAspect;\n        scaledUV.x = (vUv.x - 0.5) * scale + 0.5;\n    } else {\n        float scale = uImageAspect / canvasAspect;\n        scaledUV.y = (vUv.y - 0.5) * scale + 0.5;\n    }\n\n    // Rotate the texture to align it with the warping axis\n    vec2 rotatedUV = vec2(\n        cos(rotationRadians) * (scaledUV.x - 0.5) - sin(rotationRadians) * (scaledUV.y - 0.5) + 0.5,\n        sin(rotationRadians) * (scaledUV.x - 0.5) + cos(rotationRadians) * (scaledUV.y - 0.5) + 0.5\n    );\n\n    // Apply the warping effect along the aligned axis (now horizontal after rotation)\n    float sliceProgress = fract(rotatedUV.x * numSlices + uMotionValue);\n    float amplitude = 0.015; // The amplitude of the sine wave\n    rotatedUV.x += amplitude * sin(sliceProgress * 3.14159265 * 2.0) * (1.0 - 0.5 * abs(sliceProgress - 0.5));\n\n    // Rotate the UVs back to the original orientation\n    vec2 finalUV = vec2(\n        cos(-rotationRadians) * (rotatedUV.x - 0.5) - sin(-rotationRadians) * (rotatedUV.y - 0.5) + 0.5,\n        sin(-rotationRadians) * (rotatedUV.x - 0.5) + cos(-rotationRadians) * (rotatedUV.y - 0.5) + 0.5\n    );\n\n    // Tile texture on edges using the final UVs\n\n    vec2 tileIndex = floor(finalUV);\n    vec2 oddTile = mod(tileIndex, 2.0);\n    vec2 mirroredUV = mix(fract(finalUV), 1.0 - fract(finalUV), oddTile);\n    vec4 color = texture2D(tDiffuse, mirroredUV);\n\n    if (uOverlayOpacity > 0.0) {\n        // Apply overlays with the specified opacity\n        float blackOverlayAlpha = 0.05 * (1.0 - abs(sin(sliceProgress * 3.14159265 * 0.5 + 1.57))) * (uOverlayOpacity / 100.0);\n        color.rgb *= (1.0 - blackOverlayAlpha);\n\n        float whiteOverlayAlpha = 0.15 * (1.0 - abs(sin(sliceProgress * 3.14159265 * 0.7 - 0.7))) * (uOverlayOpacity / 100.0);\n        color.rgb = mix(color.rgb, uOverlayColorWhite, whiteOverlayAlpha);\n    }\n\n    gl_FragColor = color;\n}"}),define("pikimov/classes/effects/shaders/shader-glitch",["exports"],function(e){Object.defineProperty(e,"__esModule",{value:!0}),e._glitch_fragmentShader=void 0
e._glitch_fragmentShader="varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform float u_amount;\nuniform float iTime;\n\n//2D (returns 0 - 1)\nfloat random2d(vec2 n) { \n    return fract(sin(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\n}\n\nfloat randomRange (in vec2 seed, in float min, in float max) {\n    return min + random2d(seed) * (max - min);\n}\n\n// return 1 if v inside 1d range\nfloat insideRange(float v, float bottom, float top) {\n    return step(bottom, v) - step(top, v);\n}\n\n//inputs\nfloat AMT = 0.1; //0 - 1 glitch amount - default was 0.2\nfloat SPEED = 0.6; //0 - 1 speed\n    \nvoid main()\n{\n    float time = floor(iTime * SPEED * 60.0);    \n    \n    //original: between 0 and 1. but too strong so between 0 and 0,5\n    float AMT = u_amount / 2.0;\n\n    //copy orig\n    vec3 outCol = texture(tDiffuse, vUv).rgb;\n    \n    //randomly offset slices horizontally\n    float maxOffset = AMT/2.0;\n    for (float i = 0.0; i < 10.0 * AMT; i += 1.0) {\n        float sliceY = random2d(vec2(time , 2345.0 + float(i)));\n        float sliceH = random2d(vec2(time , 9035.0 + float(i))) * 0.25;\n        float hOffset = randomRange(vec2(time , 9625.0 + float(i)), -maxOffset, maxOffset);\n        vec2 uvOff = vUv;\n        uvOff.x += hOffset;\n        if (insideRange(vUv.y, sliceY, fract(sliceY+sliceH)) == 1.0 ){\n            outCol = texture(tDiffuse, uvOff).rgb;\n        }\n    }\n    \n    //do slight offset on one entire channel\n    float maxColOffset = AMT/6.0;\n    float rnd = random2d(vec2(time , 9545.0));\n    vec2 colOffset = vec2(randomRange(vec2(time , 9545.0),-maxColOffset,maxColOffset), \n                        randomRange(vec2(time , 7205.0),-maxColOffset,maxColOffset));\n    if (rnd < 0.33){\n        outCol.r = texture(tDiffuse, vUv + colOffset).r;\n        \n    }else if (rnd < 0.66){\n        outCol.g = texture(tDiffuse, vUv + colOffset).g;\n        \n    } else{\n        outCol.b = texture(tDiffuse, vUv + colOffset).b;  \n    }\n    \n    float alpha = texture(tDiffuse, vUv).a;\n\n    gl_FragColor = vec4(outCol, alpha);\n}"}),define("pikimov/classes/effects/shaders/shader-halftone",["exports"],function(e){Object.defineProperty(e,"__esModule",{value:!0}),e._halftone_fragmentShader=void 0
e._halftone_fragmentShader="\n#define SQRT2_MINUS_ONE 0.41421356\n#define SQRT2_HALF_MINUS_ONE 0.20710678\n#define PI2 6.28318531\n#define SHAPE_DOT 1\n#define SHAPE_ELLIPSE 2\n#define SHAPE_LINE 3\n#define SHAPE_SQUARE 4\n#define BLENDING_LINEAR 1\n#define BLENDING_MULTIPLY 2\n#define BLENDING_ADD 3\n#define BLENDING_LIGHTER 4\n#define BLENDING_DARKER 5\nuniform sampler2D tDiffuse;\nuniform float radius;\nuniform float rotateR;\nuniform float rotateG;\nuniform float rotateB;\nuniform float scatter;\nuniform float width;\nuniform float height;\nuniform int shape;\nuniform bool disable;\nuniform float blending;\nuniform int blendingMode;\nvarying vec2 vUV;\nuniform bool greyscale;\nconst int samples = 8;\n\nfloat blend( float a, float b, float t ) {\n\n    // linear blend\n    return a * ( 1.0 - t ) + b * t;\n}\n\nfloat hypot( float x, float y ) {\n\n    // vector magnitude\n    return sqrt( x * x + y * y );\n}\n\nfloat rand( vec2 seed ){\n\n    // get pseudo-random number\n    return fract( sin( dot( seed.xy, vec2( 12.9898, 78.233 ) ) ) * 43758.5453 );\n}\n\nfloat distanceToDotRadius( float channel, vec2 coord, vec2 normal, vec2 p, float angle, float rad_max ) {\n\n    // apply shape-specific transforms\n    float dist = hypot( coord.x - p.x, coord.y - p.y );\n    float rad = channel;\n\n    if ( shape == SHAPE_DOT ) {\n\n        rad = pow( abs( rad ), 1.125 ) * rad_max;\n\n    } else if ( shape == SHAPE_ELLIPSE ) {\n\n        rad = pow( abs( rad ), 1.125 ) * rad_max;\n\n        if ( dist != 0.0 ) {\n            float dot_p = abs( ( p.x - coord.x ) / dist * normal.x + ( p.y - coord.y ) / dist * normal.y );\n            dist = ( dist * ( 1.0 - SQRT2_HALF_MINUS_ONE ) ) + dot_p * dist * SQRT2_MINUS_ONE;\n        }\n\n    } else if ( shape == SHAPE_LINE ) {\n\n        rad = pow( abs( rad ), 1.5) * rad_max;\n        float dot_p = ( p.x - coord.x ) * normal.x + ( p.y - coord.y ) * normal.y;\n        dist = hypot( normal.x * dot_p, normal.y * dot_p );\n\n    } else if ( shape == SHAPE_SQUARE ) {\n\n        float theta = atan( p.y - coord.y, p.x - coord.x ) - angle;\n        float sin_t = abs( sin( theta ) );\n        float cos_t = abs( cos( theta ) );\n        rad = pow( abs( rad ), 1.4 );\n        rad = rad_max * ( rad + ( ( sin_t > cos_t ) ? rad - sin_t * rad : rad - cos_t * rad ) );\n\n    }\n\n    return rad - dist;\n}\n\nstruct Cell {\n\n    // grid sample positions\n    vec2 normal;\n    vec2 p1;\n    vec2 p2;\n    vec2 p3;\n    vec2 p4;\n    float samp2;\n    float samp1;\n    float samp3;\n    float samp4;\n};\n\nvec4 getSample( vec2 point ) {\n\n    // multi-sampled point\n    vec4 tex = texture2D( tDiffuse, vec2( point.x / width, point.y / height ) );\n    float base = rand( vec2( floor( point.x ), floor( point.y ) ) ) * PI2;\n    float step = PI2 / float( samples );\n    float dist = radius * 0.66;\n\n    for ( int i = 0; i < samples; ++i ) {\n\n        float r = base + step * float( i );\n        vec2 coord = point + vec2( cos( r ) * dist, sin( r ) * dist );\n        tex += texture2D( tDiffuse, vec2( coord.x / width, coord.y / height ) );\n    }\n\n    tex /= float( samples ) + 1.0;\n    return tex;\n}\n\nfloat getDotColour( Cell c, vec2 p, int channel, float angle, float aa ) {\n\n    // get colour for given point\n    float dist_c_1, dist_c_2, dist_c_3, dist_c_4, res;\n\n    if ( channel == 0 ) {\n\n        c.samp1 = getSample( c.p1 ).r;\n        c.samp2 = getSample( c.p2 ).r;\n        c.samp3 = getSample( c.p3 ).r;\n        c.samp4 = getSample( c.p4 ).r;\n\n    } else if (channel == 1) {\n\n        c.samp1 = getSample( c.p1 ).g;\n        c.samp2 = getSample( c.p2 ).g;\n        c.samp3 = getSample( c.p3 ).g;\n        c.samp4 = getSample( c.p4 ).g;\n\n    } else {\n\n        c.samp1 = getSample( c.p1 ).b;\n        c.samp3 = getSample( c.p3 ).b;\n        c.samp2 = getSample( c.p2 ).b;\n        c.samp4 = getSample( c.p4 ).b;\n\n    }\n\n    dist_c_1 = distanceToDotRadius( c.samp1, c.p1, c.normal, p, angle, radius );\n    dist_c_2 = distanceToDotRadius( c.samp2, c.p2, c.normal, p, angle, radius );\n    dist_c_3 = distanceToDotRadius( c.samp3, c.p3, c.normal, p, angle, radius );\n    dist_c_4 = distanceToDotRadius( c.samp4, c.p4, c.normal, p, angle, radius );\n    res = ( dist_c_1 > 0.0 ) ? clamp( dist_c_1 / aa, 0.0, 1.0 ) : 0.0;\n    res += ( dist_c_2 > 0.0 ) ? clamp( dist_c_2 / aa, 0.0, 1.0 ) : 0.0;\n    res += ( dist_c_3 > 0.0 ) ? clamp( dist_c_3 / aa, 0.0, 1.0 ) : 0.0;\n    res += ( dist_c_4 > 0.0 ) ? clamp( dist_c_4 / aa, 0.0, 1.0 ) : 0.0;\n    res = clamp( res, 0.0, 1.0 );\n\n    return res;\n}\n\nCell getReferenceCell( vec2 p, vec2 origin, float grid_angle, float step ) {\n\n// get containing cell\n    Cell c;\n\n// calc grid\n    vec2 n = vec2( cos( grid_angle ), sin( grid_angle ) );\n    float threshold = step * 0.5;\n    float dot_normal = n.x * ( p.x - origin.x ) + n.y * ( p.y - origin.y );\n    float dot_line = -n.y * ( p.x - origin.x ) + n.x * ( p.y - origin.y );\n    vec2 offset = vec2( n.x * dot_normal, n.y * dot_normal );\n    float offset_normal = mod( hypot( offset.x, offset.y ), step );\n    float normal_dir = ( dot_normal < 0.0 ) ? 1.0 : -1.0;\n    float normal_scale = ( ( offset_normal < threshold ) ? -offset_normal : step - offset_normal ) * normal_dir;\n    float offset_line = mod( hypot( ( p.x - offset.x ) - origin.x, ( p.y - offset.y ) - origin.y ), step );\n    float line_dir = ( dot_line < 0.0 ) ? 1.0 : -1.0;\n    float line_scale = ( ( offset_line < threshold ) ? -offset_line : step - offset_line ) * line_dir;\n\n// get closest corner\n    c.normal = n;\n    c.p1.x = p.x - n.x * normal_scale + n.y * line_scale;\n    c.p1.y = p.y - n.y * normal_scale - n.x * line_scale;\n\n// scatter\n    if ( scatter != 0.0 ) {\n\n        float off_mag = scatter * threshold * 0.5;\n        float off_angle = rand( vec2( floor( c.p1.x ), floor( c.p1.y ) ) ) * PI2;\n        c.p1.x += cos( off_angle ) * off_mag;\n        c.p1.y += sin( off_angle ) * off_mag;\n\n    }\n\n// find corners\n    float normal_step = normal_dir * ( ( offset_normal < threshold ) ? step : -step );\n    float line_step = line_dir * ( ( offset_line < threshold ) ? step : -step );\n    c.p2.x = c.p1.x - n.x * normal_step;\n    c.p2.y = c.p1.y - n.y * normal_step;\n    c.p3.x = c.p1.x + n.y * line_step;\n    c.p3.y = c.p1.y - n.x * line_step;\n    c.p4.x = c.p1.x - n.x * normal_step + n.y * line_step;\n    c.p4.y = c.p1.y - n.y * normal_step - n.x * line_step;\n\n    return c;\n}\n\nfloat blendColour( float a, float b, float t ) {\n\n// blend colours\n    if ( blendingMode == BLENDING_LINEAR ) {\n        return blend( a, b, 1.0 - t );\n    } else if ( blendingMode == BLENDING_ADD ) {\n        return blend( a, min( 1.0, a + b ), t );\n    } else if ( blendingMode == BLENDING_MULTIPLY ) {\n        return blend( a, max( 0.0, a * b ), t );\n    } else if ( blendingMode == BLENDING_LIGHTER ) {\n        return blend( a, max( a, b ), t );\n    } else if ( blendingMode == BLENDING_DARKER ) {\n        return blend( a, min( a, b ), t );\n    } else {\n        return blend( a, b, 1.0 - t );\n    }\n}\n\nvoid main(){\n\n    if ( ! disable ) {\n\n// setup\n        vec2 p = vec2( vUV.x * width, vUV.y * height );\n        vec2 origin = vec2( 0, 0 );\n        float aa = ( radius < 2.5 ) ? radius * 0.5 : 1.25;\n\n// get channel samples\n        Cell cell_r = getReferenceCell( p, origin, rotateR, radius );\n        Cell cell_g = getReferenceCell( p, origin, rotateG, radius );\n        Cell cell_b = getReferenceCell( p, origin, rotateB, radius );\n        float r = getDotColour( cell_r, p, 0, rotateR, aa );\n        float g = getDotColour( cell_g, p, 1, rotateG, aa );\n        float b = getDotColour( cell_b, p, 2, rotateB, aa );\n\n// blend with original\n        vec4 colour = texture2D( tDiffuse, vUV );\n        r = blendColour( r, colour.r, blending );\n        g = blendColour( g, colour.g, blending );\n        b = blendColour( b, colour.b, blending );\n\n        if ( greyscale ) {\n            r = g = b = (r + b + g) / 3.0;\n        }\n\n        //no alpha\n        //gl_FragColor = vec4( r, g, b, 1.0 );\n\n        //to avoid alpha issues - kill any pixel less than 5% alpha\n        if(colour.a < 0.05) discard;\n\n        //not so great, see nana hairs\n        gl_FragColor = vec4( r, g, b, colour.a );\n\n    } else {\n\n        gl_FragColor = texture2D( tDiffuse, vUV );\n    }\n}"}),define("pikimov/classes/effects/shaders/shader-invert",["exports","pikimov/classes/shaders/shaders-common"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e._invert_fragmentShader=void 0
var o="varying vec2 vUv;\nuniform sampler2D tDiffuse;\n"+t._correctByAlpha+"\nvoid main()\n{\n    mediump vec4 tColorOut = texture(tDiffuse, vUv);\n\n    tColorOut = correctByAlpha(tColorOut);\n    \n    tColorOut.rgb = 1.0 - tColorOut.rgb;\n\n    gl_FragColor = tColorOut;\n}"
e._invert_fragmentShader=o}),define("pikimov/classes/effects/shaders/shader-kaleidoscope",["exports"],function(e){Object.defineProperty(e,"__esModule",{value:!0}),e._kaleidoscope_fragmentShader=void 0
e._kaleidoscope_fragmentShader="precision mediump float;\nvarying vec2 vUv;\nconst float PI = 3.14159265359;\nuniform sampler2D tDiffuse;\nuniform vec4 resolution;\nuniform float uSegments;\nuniform vec2 uOffset;\nuniform float uRotation;\nuniform float uOffsetAmount;\nuniform float uRotationAmount;\nuniform float uScaleFactor;\nuniform float uImageAspect;\n\nvec2 adjustUV(vec2 uv, vec2 offset, float rotation) {\n    vec2 uvOffset = uv + offset * uOffsetAmount;\n    float cosRot = cos(rotation * uRotationAmount);\n    float sinRot = sin(rotation * uRotationAmount);\n    mat2 rotMat = mat2(cosRot, -sinRot, sinRot, cosRot);\n    return rotMat * (uvOffset - vec2(0.5)) + vec2(0.5);\n}\n\nvoid main(){\n    vec2 newUV = (vUv - vec2(0.5)) * resolution.zw + vec2(0.5);\n\n    vec2 uv = newUV * 2.0 - 1.0;\n\n    float angle = atan(uv.y, uv.x);\n    float radius = length(uv);\n    float segment = PI * 2.0 / uSegments;\n    angle = mod(angle, segment);\n    angle = segment - abs(segment / 2.0 - angle);\n    uv = radius * vec2(cos(angle), sin(angle));\n    float scale = 1.0 / uScaleFactor;\n\n    vec2 adjustedUV = adjustUV(uv * scale + scale, uOffset, uRotation);\n    vec2 aspectCorrectedUV = vec2(adjustedUV.x, adjustedUV.y * uImageAspect);\n    vec2 tileIndex = floor(aspectCorrectedUV);\n    vec2 oddTile = mod(tileIndex, 2.0);\n    vec2 mirroredUV = mix(fract(aspectCorrectedUV), 1.0 - fract(aspectCorrectedUV), oddTile);\n    \n    vec4 color = texture2D(tDiffuse, mirroredUV);\n\n    gl_FragColor = color;\n}\n"}),define("pikimov/classes/effects/shaders/shader-luma-key",["exports"],function(e){Object.defineProperty(e,"__esModule",{value:!0}),e._lumaKey_fragmentShader=void 0
e._lumaKey_fragmentShader="varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform lowp int u_type;\nuniform mediump float u_threshold;\nuniform mediump float u_tolerance;\n\nfloat getLuminance(vec3 color) {\n    //return dot(color, vec3(0.2126, 0.7152, 0.0722));\n\n    //this one = After Effects\n    return (color.r + color.g + color.b )/3.0;\n}\n\nvoid main()\n{\n    mediump vec4 tColorIn = texture(tDiffuse, vUv);\n\n    //seems good, but should better multiply by the material opacity.\n    //good for edges of image !!!\n\n    //luminance\n    mediump float luminance = getLuminance(tColorIn.rgb);\n\n    float a = 1.0;\n\n    //should have a precision of 255?\n    \n    if (u_type == 1)\n    {\n        //brighter\n        if (luminance > u_threshold)a = 0.0;\n    }\n    if (u_type == 2)\n    {\n        //darker\n        if (luminance < u_threshold)a = 0.0;\n    }\n    if (u_type == 3)\n    {\n        //similar\n        if (abs(luminance - u_threshold) <= u_tolerance)a = 0.0;\n    }\n    if (u_type == 4)\n    {\n        //dissimilar\n        if (abs(luminance - u_threshold) >= u_tolerance)a = 0.0;\n    }\n\n    //cap to 0 -> 1\n    //a = min(a, 1.0);\n\n    //do this after or before luminance calculation?\n    //multiply color by alpha to recorrect them\n    tColorIn.rgb /= tColorIn.a;\n\n    //consider original alpha\n    a *= tColorIn.a;\n    \n    //to avoid alpha issues - kill any pixel less than 5% alpha\n    if(a < 0.05) discard;\n\n    gl_FragColor = vec4(tColorIn.rgb, a);\n}"}),define("pikimov/classes/effects/shaders/shader-magnifying-lens",[],function(){}),define("pikimov/classes/effects/shaders/shader-mosaic",["exports"],function(e){Object.defineProperty(e,"__esModule",{value:!0}),e._mosaic_fragmentShader=void 0
e._mosaic_fragmentShader="uniform sampler2D tDiffuse;\nuniform float horizontalBlocks;\nuniform float verticalBlocks;\n\nvarying vec2 vUv;\n\nvoid main(){\n    // Compute tile size in UV space\n    float tileX = 1.0 / horizontalBlocks;\n    float tileY = 1.0 / verticalBlocks;\n    \n    // Snap UV coordinates to nearest tile center\n    vec2 blockUV = vec2(floor(vUv.x / tileX) * tileX, floor(vUv.y / tileY) * tileY);\n\n    // Sample the texture at the snapped UV coordinate\n    // vec4 color = texture2D(tDiffuse, blockUV);\n\n    //centered\n    vec2 blockCenter = blockUV + vec2(tileX, tileY) * 0.5;\n    vec4 color = texture2D(tDiffuse, blockCenter);\n\n    gl_FragColor = color;\n}"}),define("pikimov/classes/effects/shaders/shader-noise",["exports"],function(e){Object.defineProperty(e,"__esModule",{value:!0}),e._noise_fragmentShader=void 0
e._noise_fragmentShader="uniform float time;\nuniform sampler2D tDiffuse;\nuniform float noiseStrength;\nvarying vec2 vUv;\n\n// Simple random noise generator\nfloat random(vec2 p) {\n    return fract(sin(dot(p, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main(){\n    vec4 texColor = texture2D(tDiffuse, vUv);\n    \n    // Generate random noise based on texture coordinates and time\n    float noise = random(vUv + time * 0.1);\n    \n    // Scale the noise to range between -1 and 1, then multiply by the noise strength\n    noise = (noise - 0.5) * noiseStrength;\n    \n    // Apply the noise to the RGB channels of the texture\n    vec3 finalColor = texColor.rgb + noise;\n    \n    gl_FragColor = vec4(finalColor, texColor.a);\n}"}),define("pikimov/classes/effects/shaders/shader-outline",["exports"],function(e){Object.defineProperty(e,"__esModule",{value:!0}),e._outline_fragmentShader=void 0
e._outline_fragmentShader="varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform float u_size;\nuniform float u_opacity;\nuniform mediump vec3 u_color;\n\nvoid main()\n{\n    const float TAU = 6.28318530;\n\tconst float steps = 32.0;\n    \n\tfloat radius = u_size;//5.0;\n    vec2 uv = vec2(vUv.x, vUv.y);\n\n    vec4 outlineColor = vec4(u_color.r, u_color.g, u_color.b, u_opacity);\n    \n    // Correct aspect ratio\n    vec2 aspect = 1.0 / vec2(textureSize(tDiffuse, 0));\n\n    //this keeps it black\n    vec4 fragColor = vec4(0.0);\n\n\tfor (float i = 0.0; i < TAU; i += TAU / steps) {\n\t\t// Sample image in a circular pattern\n        vec2 offset = vec2(sin(i), cos(i)) * aspect * radius;\n\t\tvec4 col = texture(tDiffuse, uv + offset);\n\t\t\n\t\t// Mix outline with background\n\t\tfloat alpha = col.a;\n\n        //kill small details with very low alpha\n        if (alpha < 0.05)alpha = 0.0;\n\n        fragColor = mix(fragColor, outlineColor, alpha);\n\t}\n\t\n    // Overlay original texture\n\tvec4 mat = texture(tDiffuse, uv);\n\n\tfloat factor = mat.a;\n\n    //less dark outline around nana edges\n    //small cheat\n    if (factor > 0.05 && factor < 0.95)factor /= 2.0;\n\n    //factor = smoothstep(0.5, 0.7, mat.a);\n\tfragColor = mix(fragColor, mat, factor);\n\n    //BETTER WITH THIS\n    //multiply color by alpha to recorrect them\n    fragColor.rgb /= fragColor.a;\n\n    //force alpha 1.0 around original image to avoid outline around nana edges\n    if (mat.a > 0.1 && mat.a < u_opacity)fragColor.a = u_opacity;\n\n    gl_FragColor = fragColor;\n}"}),define("pikimov/classes/effects/shaders/shader-petzval-lens",["exports"],function(e){Object.defineProperty(e,"__esModule",{value:!0}),e._petzvalLens_fragmentShader=void 0
e._petzvalLens_fragmentShader="uniform sampler2D tDiffuse;\nuniform vec2 resolution;\nuniform float curvature;\nuniform float vignetteStrength;\nuniform float aberration;\nuniform vec2 u_center;\nuniform float u_vignetteRadius;\nvarying vec2 vUv;\n\nvec2 lensCoord(vec2 uv) {\n    //return (uv - .5) * vec2(resolution.x / resolution.y, 1.0);//use default screen center\n    return (uv - u_center) * vec2(resolution.x / resolution.y, 1.0);\n}\n\nvec4 safeSample(sampler2D tex, vec2 uv) {\n    // Clamp UVs to avoid texture edges\n    uv = clamp(uv, vec2(0.001), vec2(0.999));\n    return texture2D(tex, uv);\n}\n\nvoid main(){\n    vec2 lc = lensCoord(vUv);\n    float r2 = dot(lc, lc);\n\n    // Softly limit maximum radius to avoid edge artifacts\n    float maxRadius = 1.5;\n    float k = smoothstep(0.0, maxRadius, maxRadius - r2);\n\n    vec2 curvedUV = vUv + lc * curvature * r2 * k;\n\n    // Fade aberration near edges\n    float ca = aberration * r2 * k;\n\n    // Sample color channels separately with offset\n    vec4 col;\n    col.r = safeSample(tDiffuse, curvedUV + ca * .5).r;\n    col.ga = safeSample(tDiffuse, curvedUV).ga;\n    col.b = safeSample(tDiffuse, curvedUV - ca * .5).b;\n\n    // Vignette falloff\n    float dist = distance(vUv, u_center) / u_vignetteRadius;\n    float vig = smoothstep(0.0, 1.0, 1.0 - dist * vignetteStrength);\n\n    //not considering object center\n    //float vig = smoothstep(0.0, 1.0, 1.0 - r2 * vignetteStrength);\n\n    gl_FragColor = vec4(col.rgb * vig, col.a);\n}"}),define("pikimov/classes/effects/shaders/shader-posterize",["exports"],function(e){Object.defineProperty(e,"__esModule",{value:!0}),e._posterize_fragmentShader=void 0
e._posterize_fragmentShader="varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform float u_levels;\n\nvec3 applyContrast(vec3 color, float contrast) {\n    return (color - 0.5) * contrast + 0.5;\n}\n\nvoid main(){\n\n    vec4 color = texture2D(tDiffuse, vUv);\n\n    // Posterize effect with enhanced contrast\n    vec3 posterizedColor = floor(color.rgb * u_levels) / u_levels;\n    posterizedColor += 0.5 / u_levels; // Shift to the midpoint of each level for better contrast\n\n    //perfect with contrast 2.0\n    posterizedColor = applyContrast(posterizedColor, 2.0);\n\n    gl_FragColor = vec4(posterizedColor, color.a);\n}"}),define("pikimov/classes/effects/shaders/shader-radial-blur",["exports"],function(e){Object.defineProperty(e,"__esModule",{value:!0}),e._radialBlur_fragmentShader=void 0
e._radialBlur_fragmentShader="varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform vec2 resolution;\nuniform vec2 center;\nuniform float strength;\n\nvoid main(){\n    vec2 toCenter = center - vUv * resolution;\n    float offset = strength / 100.0;\n\n    vec4 color = vec4(0.0);\n    float total = 0.0;\n\n    for (float t = 0.0; t <= 30.0; t++) {\n        float percent = t / 30.0;\n        float weight = 4.0 * (percent - percent * percent);\n        vec2 sampleCoord = vUv + toCenter * percent * offset;\n        color += texture2D(tDiffuse, sampleCoord) * weight;\n        total += weight;\n    }\n\n    vec4 fragColor = color / total;\n\n    //BETTER WITH THIS\n    //multiply color by alpha to recorrect them\n    fragColor.rgb /= fragColor.a;\n    \n    gl_FragColor = fragColor;\n}"}),define("pikimov/classes/effects/shaders/shader-shadow",["exports"],function(e){Object.defineProperty(e,"__esModule",{value:!0}),e._shadow_blur_fragmentShader=void 0
e._shadow_blur_fragmentShader="#define PI2 6.28318530718\n\nvarying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform vec2 resolution;\nuniform mediump float blur_radius;\nuniform mediump float u_opacity;\n\nfloat biDimenions_alpha(float tColorIn_a)\n{\n    float Directions = 16.0;\n    float Quality = 4.0;\n\n    //more quality when more blur radius\n    if (blur_radius > 10.0)\n    {\n        Directions = 24.0;\n        Quality = 5.0;\n    }\n\n    vec2 Radius = blur_radius/resolution.xy;\n\n    // Blur calculations\n    for( float d=0.0; d<PI2; d+=PI2/Directions)\n    {\n        for(float i=1.0/Quality; i<=1.001; i+=1.0/Quality)\n        {\n            tColorIn_a += texture( tDiffuse, vUv+vec2(cos(d),sin(d))*Radius*i).a;\n        }\n    }\n\n    tColorIn_a /= Quality * Directions +1.0;//- 15.0;\n\n    return tColorIn_a;\n}\n\nvoid main()\n{\n    vec4 tColorIn = texture(tDiffuse, vUv);\n\n    //horizontal + vertical\n    tColorIn.a = biDimenions_alpha(tColorIn.a);\n\n    //make it black\n    tColorIn.r = tColorIn.g = tColorIn.b = 0.0;\n\n    //apply opacity fx param\n    tColorIn.a *= u_opacity;\n\n    //if(tColorIn.a < 0.05) discard;//to avoid alpha issues\n\n    gl_FragColor = tColorIn;\n}"}),define("pikimov/classes/effects/shaders/shader-tint",["exports"],function(e){Object.defineProperty(e,"__esModule",{value:!0}),e._tint_fragmentShader=void 0
e._tint_fragmentShader="varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform mediump vec3 u_color1;\nuniform mediump vec3 u_color2;\nuniform mediump float u_amount;\n\nvoid main(){\n\n    vec4 tColorIn = texture2D(tDiffuse, vUv);\n\n    mediump float lum = (tColorIn.r + tColorIn.g + tColorIn.b )/3.0;\n\n    //mix between color1 and color2 based on luminance\n    vec3 tintedColor = mix(u_color1, u_color2, lum);\n\n    //mix between tinted and original color\n    tColorIn.rgb = mix(tColorIn.rgb, tintedColor, u_amount);\n\n    gl_FragColor = vec4(tColorIn.rgb, tColorIn.a);\n}"}),define("pikimov/classes/effects/shaders/shader-turbulent-displace",["exports"],function(e){Object.defineProperty(e,"__esModule",{value:!0}),e._turbulentDisplace_fragmentShader=void 0
e._turbulentDisplace_fragmentShader="uniform sampler2D tDiffuse;\nvarying vec2 vUv;\nuniform float time;\nuniform float strength;\nuniform float frequency;\nuniform float speed;\n\nvec2 hash(vec2 p) {\n    p = vec2(dot(p, vec2(127.1, 311.7)),\n             dot(p, vec2(269.5, 183.3)));\n    return -1.0 + 2.0 * fract(sin(p) * 43758.5453123);\n}\n\nfloat perlinNoise(vec2 p) {\n    vec2 i = floor(p);\n    vec2 f = fract(p);\n\n    vec2 u = f * f * (3.0 - 2.0 * f);\n\n    return mix(mix(dot(hash(i + vec2(0.0, 0.0)), f - vec2(0.0, 0.0)),\n                   dot(hash(i + vec2(1.0, 0.0)), f - vec2(1.0, 0.0)), u.x),\n               mix(dot(hash(i + vec2(0.0, 1.0)), f - vec2(0.0, 1.0)),\n                   dot(hash(i + vec2(1.0, 1.0)), f - vec2(1.0, 1.0)), u.x), u.y);\n}\n\nvoid main(){\n    vec2 uv = vUv;\n\n    // Generate a fractal noise-based displacement\n    float displacement = perlinNoise(uv * frequency + time * speed);\n    \n    // Offset UV coordinates based on noise\n    uv.x += (displacement - 0.5) * strength;\n    uv.y += (displacement - 0.5) * strength;\n\n    // Sample the displaced texture\n    vec4 colorOut = texture2D(tDiffuse, uv);\n\n    //BETTER WITH THIS\n    //multiply color by alpha to recorrect them\n    colorOut.rgb /= colorOut.a;\n\n    gl_FragColor = colorOut;\n}"}),define("pikimov/classes/effects/shaders/shader-vignette",["exports"],function(e){Object.defineProperty(e,"__esModule",{value:!0}),e._vignette_fragmentShader=void 0
e._vignette_fragmentShader="varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform vec2 vignetteCenter;\nuniform float vignetteRadius;\nuniform float uVignetteStrength;\nuniform float u_amount;\nuniform float u_angle;\n\nvoid main(){\n    vec4 tColorIn = texture2D(tDiffuse, vUv);\n    vec4 tColorVignette = texture(tDiffuse, vUv);\n\n    // Calculate distance from vignette center\n    float dist = distance(vUv, vignetteCenter) / vignetteRadius;\n\n    dist *= (u_angle / 15.0);\n\n    // Apply vignette\n\n    //interpolates between 0 and 1 smoothly, depending on the value of c relative to a and b.\n    float edge0 = 1.0 + (1.0 - u_amount);\n    float vignette = smoothstep(edge0, uVignetteStrength, dist);\n\n    vignette = min(vignette, 1.0);//cap to 1.0\n\n    tColorVignette.rgb = tColorIn.rgb * vignette;\n\n    gl_FragColor = mix(tColorIn, tColorVignette, u_amount);\n}"}),define("pikimov/classes/effects/shaders/shader-wave-warp",["exports"],function(e){Object.defineProperty(e,"__esModule",{value:!0}),e._waveWarp_fragmentShader=void 0
e._waveWarp_fragmentShader="uniform sampler2D tDiffuse;\nvarying vec2 vUv;\nuniform float velocity;\nuniform float amp;\nuniform float freq;\nuniform float u_time;\nuniform vec2 objcenter;\n\nvoid main(){\n    vec2 uv = vUv;\n\n    // Convert to coordinates relative to vignetteCenter\n    vec2 centeredUV = uv - objcenter;\n\n    // Apply the sine wave based on distance from center\n    float time = u_time / 100.0;\n    float wave = sin(centeredUV.y * freq + time * velocity) * amp;\n\n    // Apply the wave distortion in X direction (or modify for Y as well)\n    vec2 warpedUV = vec2(uv.x + wave, uv.y);\n\n    // Sample the texture at the new warped coordinates\n    vec4 color = texture2D(tDiffuse, warpedUV);\n\n    gl_FragColor = color;\n}"}),define("pikimov/classes/effects/shadow",["exports","pikimov/classes/effects/c_effect","pikimov/classes/shaders/shaders-common","pikimov/classes/effects/shaders/shader-shadow","pikimov/classes/effects/TwoPassShaderEffect"],function(e,t,o,r,n){function i(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{constructor(e){super(e),i(this,"passesRenderTarget",null),i(this,"shaderMaterial_1",null),i(this,"shaderMaterial_2",null)
var t=this,a=t.getSize()
t.passesRenderTarget=new THREE.WebGLRenderTarget(a.width,a.height,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat})
var l=o._commonVertexShader
t.shaderMaterial_1=new THREE.ShaderMaterial({uniforms:{tDiffuse:{value:null},resolution:{},blur_radius:{},dimension:{value:0},u_opacity:{}},vertexShader:l,fragmentShader:r._shadow_blur_fragmentShader}),t.shaderMaterial_1.transparent=!0,t.shaderMaterial_2=new THREE.ShaderMaterial({uniforms:{tDiffuse:{value:null},tIn2:{value:null},u_x:{},u_y:{}},vertexShader:l,fragmentShader:"varying vec2 vUv;\nuniform sampler2D tDiffuse;  //input wihout first pass applied\nuniform sampler2D tIn2;     //texture from previous pass\n\n//position delta\nuniform mediump float u_x;\nuniform mediump float u_y;\n\n//color1 is bg, color 2 is what to blit\nvec4 doBlendNormal( vec4 color1, vec4 color2 )\n{\n    //if blitting on alpha 0 , nothing to do\n    if (color1.a == 0.0)return color2;\n\n    //if blit color is alpha 0 , nothing to do\n    if (color2.a == 0.0)return color1;\n\n    // Compute the resulting alpha by combining the alphas of color1 and color2\n    float alphaOut = color2.a + color1.a * (1.0 - color2.a);\n\n    // Blend the RGB values, normalized by the resulting alpha\n    vec3 rgbOut = (color2.rgb * color2.a + color1.rgb * color1.a * (1.0 - color2.a)) / alphaOut;\n\n    // Return the blended color with the computed alpha\n    return vec4(rgbOut, alphaOut);\n}\n\nvoid main(){\n\n    vec4 color1 = texture2D(tDiffuse, vUv);//original\n    //use x / y position delta\n    vec4 color2 = texture( tIn2, vUv+vec2(u_x, u_y));//blurred\n\n    //ok, copied from blend normal pass\n    vec4 colorOut = doBlendNormal(color2, color1);\n\n    //BETTER WITH THIS\n    //multiply color by alpha to recorrect them\n    colorOut.rgb /= colorOut.a;\n\n    gl_FragColor = colorOut;\n}"}),t.shaderMaterial_2.transparent=!0,t.shaderPass=new n.default(t.shaderMaterial_1,t.shaderMaterial_2,t.passesRenderTarget),t.shaderPass.name="FX "+t.filterData.type+" pass"}updateUniforms(){var e=this,t=e.getZoom(),o=e.getSize(),r=e.currentValues[0]*t,n=e.currentValues[1]*t
r=r/o.width*-1,n/=o.height
var i=Math.round(e.currentValues[3]*t)
e.passesRenderTarget.setSize(o.width,o.height),e.shaderMaterial_1.uniforms.resolution.value={x:o.width,y:o.height},e.shaderMaterial_1.uniforms.u_opacity.value=e.currentValues[2]/100,e.shaderMaterial_1.uniforms.blur_radius.value=i,e.shaderMaterial_2.uniforms.u_x.value=r,e.shaderMaterial_2.uniforms.u_y.value=n}}e.default=a})
define("pikimov/classes/effects/shake",["exports","pikimov/classes/effects/c_effect"],function(e,t){function o(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{constructor(e){super(e),o(this,"frameIndexOfLastUpdate",-1),o(this,"offsetTarget",null),o(this,"offset",{x:0,y:0})
this.setCommonProperties(),this.shader=null}updateRandomValues(e){this.offsetTarget={x:(Math.random()-.5)*e[0],y:(Math.random()-.5)*e[1]}}updateUniforms(e){var t=this,o=t.sceneItem
if(o.threejsObj){var r=1*t.currentValues[2]
t.frameIndexOfLastUpdate!=e&&(t.offsetTarget&&e%r!=0||(t.updateRandomValues(t.currentValues),t.frameIndexOfLastUpdate=e)),t.offset={x:t.offset.x+(t.offsetTarget.x-t.offset.x)/r,y:t.offset.y+(t.offsetTarget.y-t.offset.y)/r}
var n=o.threejsHook.position
n.x+=t.offset.x,n.y+=t.offset.y,o.threejsHook.updateMatrixWorld(!0)}}}e.default=r}),define("pikimov/classes/effects/skew",["exports","pikimov/classes/effects/c_effect"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class o extends t.default{constructor(e){super(e)
this.setCommonProperties(),this.shader=null}updateUniforms(){var e=this,t=e.sceneItem
if(t.threejsObj){var o="x"
1==e.currentValues[0]&&(o="y")
var r=1*e.currentValues[1],n=r,i=1*e.currentValues[2]
if(0!=i){var a=Math.tan(THREE.MathUtils.degToRad(i))
t.threejsObj.traverse(t=>{if(t.geometry){var i=t.geometry.clone()
e.applySkew(i,o,a,r,n),t.geometry.dispose(),t.geometry=i}})}}}applySkew(e,t,o,r,n){e.computeBoundingBox()
const i=e.boundingBox,a=i.max.x-(i.max.x-i.min.x)*r/100,l=i.max.y-(i.max.y-i.min.y)*n/100,s=e.attributes.position
for(let c=0;c<s.count;c++){const e=(new THREE.Vector3).fromBufferAttribute(s,c)
e.x-=a,e.y-=l,"x"==t&&(e.x+=e.y*o),"y"==t&&(e.y+=e.x*o),e.x+=a,e.y+=l,s.setXYZ(c,e.x,e.y,e.z)}s.needsUpdate=!0}destroy(){this.sceneItem.applyBackUpGeometry()}}e.default=o}),define("pikimov/classes/effects/tint",["exports","pikimov/classes/effects/c_effect","pikimov/classes/effects/shaders/shader-tint"],function(e,t,o){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{constructor(e){super(e)
var t=this
t.shader.fragmentShader=o._tint_fragmentShader,t.shader.uniforms={tDiffuse:{value:null},u_color1:{},u_color2:{},u_amount:{}},t.shaderPass=new ShaderPass(t.shader),t.setCommonProperties()}updateUniforms(){var e=this,t=valueToSRGB(e.currentValues[0]),o=valueToSRGB(e.currentValues[1]),r=e.shaderPass.uniforms
r.u_color1.value=t,r.u_color2.value=o,r.u_amount.value=e.currentValues[2]/100}}e.default=r}),define("pikimov/classes/effects/turbulent-displace",["exports","pikimov/classes/effects/c_effect","pikimov/classes/effects/shaders/shader-turbulent-displace"],function(e,t,o){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{constructor(e){super(e)
var t=this
t.shader.fragmentShader=o._turbulentDisplace_fragmentShader,t.shader.uniforms={tDiffuse:{value:null},time:{},strength:{},frequency:{},speed:{}},t.shaderPass=new ShaderPass(t.shader),t.setCommonProperties()}updateUniforms(e){var t=this,o=t.shaderPass.uniforms
o.time.value=e/100,o.strength.value=t.currentValues[0]/100,o.frequency.value=t.currentValues[1]/2,o.speed.value=t.currentValues[2]/2}}e.default=r}),define("pikimov/classes/effects/typewriter",["exports","pikimov/classes/effects/c_effect"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class o extends t.default{constructor(e){super(e),this.setCommonProperties()}updateUniforms(){var e=this,t=e.sceneItem
if(t.threejsObj){var o=t.threejsObj.children
if(0!=o.length){var r=1*e.currentValues[0],n=1*e.currentValues[1]
if(r>n){var i=n
n=r,r=i}var a=1*e.currentValues[2],l=1*e.currentValues[3],s=o.length-1,c=Math.round(s*(r+a)/100),u=Math.round(s*(n+a)/100)
0==l&&o.forEach(function(e,t){var o=!0
t>=c&&t<u&&(o=!1),e.visible=o}),1==l&&o.forEach(function(e,t){var o=!1
t>=c&&t<u&&(o=!0),e.visible=o}),o[s].visible=!0}}}destroy(){var e=this
e.sceneItem.threejsObj&&e.sceneItem.threejsObj.children.forEach(function(e){e.visible=!0}),e.sceneItem.applyBackUpGeometry(),e.shader=null}}e.default=o}),define("pikimov/classes/effects/vignette",["exports","pikimov/classes/effects/c_effect","pikimov/classes/effects/shaders/shader-vignette"],function(e,t,o){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{constructor(e){super(e)
var t=this
t.shader.fragmentShader=o._vignette_fragmentShader,t.shader.uniforms={tDiffuse:{value:null},vignetteCenter:{},vignetteRadius:{},uVignetteStrength:{value:.1},u_amount:{},u_angle:{}},t.shaderPass=new ShaderPass(t.shader),t.setCommonProperties()}updateUniforms(){var e=this,t=e.currentValues[0]/100
if(0==t)return void(e.shaderPass.enabled=!1)
e.shaderPass.enabled=!0
const{center:o,radius:r}=e.getScreenSpaceInfo()
var n=e.shaderPass.uniforms
n.vignetteCenter.value=o,n.vignetteRadius.value=r,n.u_amount.value=t,n.u_angle.value=e.currentValues[1]}}e.default=r}),define("pikimov/classes/effects/wave-warp",["exports","pikimov/classes/effects/c_effect","pikimov/classes/effects/shaders/shader-wave-warp"],function(e,t,o){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{constructor(e){super(e)
var t=this
t.shader.fragmentShader=o._waveWarp_fragmentShader,t.shader.uniforms={tDiffuse:{value:null},velocity:{},amp:{},freq:{},u_time:{},objcenter:{}},t.shaderPass=new ShaderPass(t.shader),t.setCommonProperties()}updateUniforms(e){var t=this,o=t.currentValues[0]/100
if(0==o)return void(t.shaderPass.enabled=!1)
t.shaderPass.enabled=!0
const{center:r}=t.getScreenSpaceInfo()
var n=t.shaderPass.uniforms
n.amp.value=o,n.freq.value=4*t.currentValues[1],n.velocity.value=1*t.currentValues[2],n.u_time.value=e,n.objcenter.value=r}}e.default=r}),define("pikimov/classes/export/export-audio-item",["exports"],function(e){function t(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=class{constructor(e,o,r){t(this,"sceneItem",null),t(this,"activeComposition",null),t(this,"frameRate",null),t(this,"timeIn",0),t(this,"depthLevel",0),t(this,"sub_compositionManager",null),t(this,"sceneCompItem",null),t(this,"audioBuffer",null)
var n=this
n.sceneItem=e,n.activeComposition=o,n.frameRate=r,n.depthLevel=n.sceneItem.compositionManager.depthLevel,n.depthLevel>0&&(console.log("-- SUB comp audio item: ",n.sceneItem.name),n.sceneCompItem=n.sceneItem.compositionManager.sceneItemComposition,n.sub_compositionManager=n.sceneCompItem.sub_compositionManager)}getAudioBuffer(){var e=this,t=e.sceneItem,o=t.itemData,r=new AudioContext,n=t.audioBuffer,i=0,a=1*o.time.in,l=1*o.time.out,s=1*o.time.trackIn
s||(s=0)
var c=l/e.frameRate,u=a/e.frameRate
if(e.depthLevel>0){var m=e.sceneCompItem.itemData.time,p=e.sub_compositionManager.frameRate,d=1*m.in,f=1*m.out,v=1*m.trackIn,h=f/p
i=d/p,u=a/e.frameRate}var g=c-i
if(s>0){var y=s
e.depthLevel>0&&v>y&&(y=v),n=e.trimTrackIn(n,a,l,y,e.frameRate,r)}if(u<0){var b=-1*u,x=b+g
n=e.trimAudioBuffer(r,n,b,x)}u>0&&(n=e.prependSilenceToAudioBuffer(r,n,u)),l>e.activeComposition.time.end&&(l=e.activeComposition.time.end)
var w=l/e.frameRate,k=(e.activeComposition.time.end-0)/e.frameRate
0-w>k&&(w=k-0),e.depthLevel>0&&h<w&&(w=h)
var C=e.trimAudioBuffer(r,n,0,w)
e.adjustVolume(C)
var S=k-C.duration
return e.audioBuffer=e.appendSilenceToAudioBuffer(r,C,S),n=null,C=null,r=null,e.audioBuffer}trimTrackIn(e,t,o,r,n,i){var a=r/n,l=a+(o-t)/n
return console.log("cut beginning trackIn: cut ",a,"s"),this.trimAudioBuffer(i,e,a,l)}prependSilenceToAudioBuffer(e,t,o){const r=t.numberOfChannels,n=t.sampleRate,i=Math.round(n*o),a=e.createBuffer(r,i,n)
for(let s=0;s<r;s++){const e=a.getChannelData(s)
for(let t=0;t<i;t++)e[t]=0}const l=e.createBuffer(r,t.length+i,n)
for(let s=0;s<r;s++){const e=a.getChannelData(s)
l.getChannelData(s).set(e,0)}for(let s=0;s<r;s++){const e=t.getChannelData(s)
l.getChannelData(s).set(e,i)}return l}appendSilenceToAudioBuffer(e,t,o){const r=t.numberOfChannels,n=t.sampleRate,i=t.length,a=Math.round(n*o)
if(!a)return t
const l=e.createBuffer(r,a,n)
for(let c=0;c<r;c++){const e=l.getChannelData(c)
for(let t=0;t<a;t++)e[t]=0}const s=e.createBuffer(r,t.length+a,n)
for(let c=0;c<r;c++){const e=t.getChannelData(c)
s.getChannelData(c).set(e,0)}for(let c=0;c<r;c++){const e=l.getChannelData(c)
s.getChannelData(c).set(e,i)}return s}trimAudioBuffer(e,t,o,r){const n=t.sampleRate,i=Math.floor(o*n),a=Math.floor(r*n),l=t.numberOfChannels
var s
try{s=e.createBuffer(l,a-i,n)
for(let e=0;e<l;e++){const o=t.getChannelData(e).subarray(i,a)
s.getChannelData(e).set(o)}}catch(c){console.error(c),gaEvent({event:"error - export audio TRIM"}),alert("error while trimming audio track")}return s}adjustVolume(e){var t=this,o=t.activeComposition.time.end-t.activeComposition.time.start+1,r=1,n=e.numberOfChannels
const i=e.sampleRate
for(let a=0;a<o;a++){if(1==(r=t.sceneItem.getParamValueAt(a,"volume")/100))continue
const o=a/t.frameRate*i,l=(a+1)/t.frameRate*i
for(let t=0;t<n;t++){const n=e.getChannelData(t).subarray(o,l)
for(let e=0;e<n.length;e++)n[e]*=r}}}convertToAudioData(e){const t=e.numberOfChannels,o=e.length,r=new Float32Array(t*o)
for(let n=0;n<t;n++){const t=e.getChannelData(n)
r.set(t,n*o)}return new AudioData({format:"f32-planar",sampleRate:e.sampleRate,numberOfFrames:o,numberOfChannels:e.numberOfChannels,timestamp:0,data:r})}}}),define("pikimov/classes/export/export-images",["exports"],function(e){function t(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=class{constructor(e,o,r){t(this,"controller",null),t(this,"activeComposition",null),t(this,"compositionManager",null),t(this,"size",100),t(this,"progress",{value:0}),t(this,"canvas",document.getElementById("compositionCanvas")),t(this,"resizedCanvas",document.createElement("canvas")),t(this,"start_time",null),t(this,"isAborted",!1),t(this,"frames",[]),t(this,"nbImages",0),t(this,"width",1),t(this,"height",1),t(this,"originalCompZoom",100),this.controller=e,this.activeComposition=o,this.size=r,this.compositionManager=this.controller.compositionManager,this.nbImages=0}async exportImages(){var e=this
console.log("* * * export images * * *"),e.controller.contextLostDuringExport=!1,gaEvent({event:"export png - start"})
var t=e.compositionManager,o=t.sceneItems
t.isExporting=!0,t.renderEngine.setActiveCamera("camera"),e.controller.stopRender(),o.forEach(function(e){"composition"!=e.type||e.isMissing||e.sub_compositionManager.disableRendering()}),e.controller.selectionUtils.clearItemsSelection(),e.originalCompZoom=e.controller.compositionDisplayZoom,t.resizeForExport(e.originalCompZoom,e.size),t.enableRendering()
var r=Math.floor(e.activeComposition.dimensions.width/100*e.size),n=Math.floor(e.activeComposition.dimensions.height/100*e.size)
r%2!=0&&(r-=1),n%2!=0&&(n-=1),r<2&&(r=2),n<2&&(n=2),e.width=r,e.height=n
try{e.directoryHandle=await window.showDirectoryPicker()}catch(i){return console.log(i.name),console.error("Catch error selecting directory:",i),void e.abort()}setTimeout(()=>{e.clearVideosCache(),e.setVideosExportSize()},300),setTimeout(()=>{e.isAborted||e.controller.mustAbortJobs||(e.nbImages=0,e.controller.currentFrame=-1,e.start_time=new Date,o.forEach(function(e){"composition"!=e.type||e.isMissing||e.sub_compositionManager.enableRendering()}),requestAnimationFrame(function(){console.log("-- start export --",e.activeComposition.time.end,"frames"),e.nextFrame()}))},1e3)}setVideosExportSize(){(function e(t){t&&t.sceneItems.forEach(function(t){"video"==t.type&&t.setExportSize(),"composition"==t.type&&e(t.sub_compositionManager)})})(this.compositionManager)}clearVideosCache(){(function e(t){t.sceneItems.forEach(function(t){"video"==t.type&&t.clearCache(!1),"composition"==t.type&&t.sub_compositionManager&&e(t.sub_compositionManager)})})(this.compositionManager)}abort(){var e=this
console.log("-- abort export --",e.compositionManager.currentFrame,"/",e.activeComposition.time.end)
var t=+new Date,o=parseInt((t-e.start_time)/1e3)
console.log("totalTime",o,"s"),e.clearVideosCache()
for(const r of e.frames)r.close()
e.frames=[],e.isAborted=!0,e.compositionManager.isExporting=!1,e.controller.setCompositionDisplayZoom(e.originalCompZoom),e.controller.closeExport()}async nextFrame(){var e=this
e.compositionManager.renderNextFrame(async function(){e.progress.value++
var t=e.compositionManager.currentFrame,o=""
t<1e3&&(o+="0"),t<100&&(o+="0"),t<10&&(o+="0"),t=o+t
var r=e.compositionManager.compositionData.name+"_"+t+".png"
try{var n=await e.directoryHandle.getFileHandle(r,{create:!0})}catch(i){return console.log(i.name),console.error("Catch error getFileHandle:",i),i&&"NotAllowedError"==i.name&&openModal({h2:"Denied",p:"Saving files has been denied"}),void e.abort()}(function(e,t,o,r){return t.width=o,t.height=r,t.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,o,r),t})(e.canvas,e.resizedCanvas,e.width,e.height).toBlob(t=>{n.createWritable().then(o=>{o.write(t),o.close().then(()=>{requestAnimationFrame(function(){e.onFrameDone()})})})},"image/png")})}onFrameDone(){var e=this
if(!e.controller.mustAbortJobs&&(e.nbImages++,e.compositionManager.sceneItems.forEach(function(e){a(e)}),!e.isAborted)){var t=1*e.activeComposition.time.end+1,o=new Date,r=Math.floor(o-e.start_time),n=document.querySelector("#exportProgress"),i=new CustomEvent("exportMessage",{detail:{progress:Math.floor(e.progress.value/t*100),totalTimeMs:r}})
n.dispatchEvent(i),e.progress.value/t<1?e.nextFrame():e.done()}function a(e){if(e.itemData.time&&"audio"!=e.type&&!e.isDestroyed){"composition"==e.type&&e.sub_compositionManager&&e.sub_compositionManager.sceneItems.forEach(function(e){a(e)})
var t=e.compositionManager.currentFrame
1*e.itemData.time.out==t-1&&e.destroy()}}}done(){var e=this
gaEvent({event:"export png - done"}),_exportedVideo=null,_exportedSequence={folder:e.directoryHandle.name,nbImages:e.nbImages,width:e.width,height:e.height}
var t=+new Date,o=parseInt((t-e.start_time)/1e3)
console.log("* * seq export done in",o,"s"),stopLoading(),e.controller.setCompositionDisplayZoom(e.originalCompZoom),e.controller.onExportCompleted("images")}}}),define("pikimov/classes/export/export-video_a",["exports"],function(e){function t(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=class{constructor(e,o){t(this,"p_controller",null),t(this,"activeComposition",null),t(this,"compositionManager",null),t(this,"progress",{value:0}),t(this,"canvas",document.getElementById("compositionCanvas")),t(this,"worker",new Worker("/js/ffmpeg_plan_a/ffmpeg-worker-mp4.js")),t(this,"images",[]),t(this,"audios",[]),t(this,"start_time",null),t(this,"isAborted",!1),t(this,"width",1),t(this,"height",1),t(this,"format","mp4"),this.p_controller=e,this.activeComposition=o,this.compositionManager=this.p_controller.compositionManager}exportVideo(){var e=this
console.log("export video A"),e.p_controller.contextLostDuringExport=!1,e.compositionManager.isExporting=!0,e.compositionManager.renderEngine.setActiveCamera("camera"),e.p_controller.stopRender(),e.p_controller.selectionUtils.clearItemsSelection(),e.start_time=+new Date,e.width=1*e.activeComposition.dimensions.width,e.height=1*e.activeComposition.dimensions.height,e.isAborted=!1,e.compositionManager.enableRendering(),e.compositionManager.updateBgColorAndGrid(),e.nextFrame()}abort(){var e=this
e.isAborted=!0,e.p_controller.compositionManager.isExporting=!1,e.p_controller.closeExport()}nextFrame(){var e=this
e.p_controller.compositionManager.renderNextFrame(),e.progress.value++
const t=e.canvas.toDataURL("image/jpeg",1),o=e.convertDataURIToBinary(t)
e.images.push({name:`img${e.pad(e.images.length,3)}.jpeg`,data:o})
var r=setInterval(function(){clearInterval(r),r=null,e.onFrameDone()},20)}onFrameDone(){var e=this
if(!e.p_controller.mustAbortJobs&&!e.isAborted){var t=e.activeComposition.time.end,o=document.querySelector("#exportProgress"),r=new CustomEvent("exportMessage",{detail:{step:"rendering",progress:Math.floor(e.progress.value/t*100)}})
o.dispatchEvent(r),e.progress.value/t<1?requestAnimationFrame(function(){e.nextFrame()}):requestAnimationFrame(function(){e.finalizeVideo()})}}convertDataURIToBinary(e){var t,o=e.replace(/^data[^,]+,/,""),r=window.atob(o),n=r.length,i=new Uint8Array(new ArrayBuffer(n))
for(t=0;t<n;t++)i[t]=r.charCodeAt(t)
return i}pad(e,t,o){return o=o||"0",(e+="").length>=t?e:new Array(t-e.length+1).join(o)+e}finalizeVideo(){var e=this,t=document.querySelector("#exportProgress"),o=new CustomEvent("exportMessage",{detail:{step:"encoding",progress:0}})
t.dispatchEvent(o)
var r=e.width,n=e.height
const i=$("ffmsg")
let a=""
var l=e.worker
l.onmessage=function(t){var o=t.data
switch(o.type){case"stdout":console.log("export ___"),console.log(o),a+=o.data+"\n"
break
case"stderr":console.log("export error ___"),console.log(o),a+=o.data+"\n"
break
case"exit":console.log("Process exited with code "+o.data)
break
case"done":const t=new Blob([o.data.MEMFS[0].data],{type:"video/mp4"})
e.done(t)}i.innerHTML=a}
var s=["-r","30","-i","img%03d.jpeg","-c:v","libx264","-c:a","aac","-strict","experimental","-crf","9","-vf","scale="+r+":"+n,"-pix_fmt","yuv420p","-b:v","20M","out.mp4"]
e.p_controller.compositionManager.sceneItems.forEach(function(t){if("audio_____"==t.type){console.log("export A - add audio"),console.log(t.itemData.file)
var o=t.domElement.src
console.log(o),console.log(t.buffer)
new Uint8Array(t.buffer)
var r=t.buffer
const n=r.numberOfChannels,i=r.length,a=[]
for(let e=0;e<n;e++)a[e]=r.getChannelData(e)
const l=new Float32Array(n*i)
for(let e=0;e<n;e++){const t=a[e]
for(let o=0;o<i;o++)l[o*n+e]=t[o]}const s=l.buffer
e.images.push({name:"audio.mp3",arrayBuffer:s})}}),l.postMessage({type:"run",TOTAL_MEMORY:268435456,arguments:s,MEMFS:e.images})}done(e){var t=this
const o=webkitURL.createObjectURL(e)
_exportedVideo={format:t.format,src:o,width:t.width,height:t.height,frameRate:t.frameRate},_exportedSequence=null
var r=+new Date,n=parseInt((r-t.start_time)/1e3)
console.log("* * export done A in",n,"s"),stopLoading(),t.p_controller.onExportCompleted("a")}}}),define("pikimov/classes/export/export-video_b12",["exports"],function(e){function t(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=class{constructor(e,o,r){t(this,"p_controller",null),t(this,"activeComposition",null),t(this,"compositionManager",null),t(this,"originalCompZoom",100),t(this,"size",100),t(this,"ffmpeg",null),t(this,"progress",{value:0}),t(this,"canvas",document.getElementById("compositionCanvas")),t(this,"images",[]),t(this,"start_time",null),t(this,"isAborted",!1),t(this,"width",1),t(this,"height",1),t(this,"frameRate",1),t(this,"quality",10),t(this,"videoBitrate",0),t(this,"useAlpha",!1),t(this,"audioData",null),t(this,"format","mp4"),t(this,"videoCodec",null),this.p_controller=e,this.activeComposition=o,this.size=r,this.compositionManager=this.p_controller.compositionManager,this.format="mov",this.videoCodec="png"}exportVideo(e,t){var o=this
console.log("* * * export video B * * *",o.size,"%"),console.log("ffmpeg v0.12.06"),o.p_controller.contextLostDuringExport=!1,o.useAlpha=e,o.videoBitrate=t,o.compositionManager.isExporting=!0,o.compositionManager.renderEngine.setActiveCamera("camera"),o.p_controller.stopRender(),o.compositionManager.sceneItems.forEach(function(e){"composition"!=e.type||e.isMissing||e.sub_compositionManager.disableRendering()}),o.p_controller.selectionUtils.clearItemsSelection(),o.originalCompZoom=o.p_controller.compositionDisplayZoom,o.compositionManager.resizeForExport(o.originalCompZoom,o.size),o.compositionManager.enableRendering(),o.compositionManager.updateBgColorAndGrid(),o.width=1*o.activeComposition.dimensions.width,o.height=1*o.activeComposition.dimensions.height,o.frameRate=1*o.activeComposition.frameRate,o.loadFFMPEG()}async loadFFMPEG(){console.log("load FFMPEG"),startLoading()
var e=this
const{FFmpeg:t}=FFmpegWASM
var o="https://unpkg.com/@ffmpeg/core@0.12.6/dist/umd"
e.ffmpeg=new t({log:!0,memfs:!0,memory:536870912}),e.ffmpeg.on("log",({message:e})=>{console.log(e)}),e.ffmpeg.on("progress",({progress:e,time:t})=>{var o=document.querySelector("#exportProgress"),r=new CustomEvent("exportMessage",{detail:{progress:Math.floor(100*e),message:"encode video"}})
o.dispatchEvent(r)}),await e.ffmpeg.load({coreURL:`${o}/ffmpeg-core.js`,wasmURL:`${o}/ffmpeg-core.wasm`,workerURL:`${o}/ffmpeg-core.worker.js`}),stopLoading(),e.startExport()}startExport(){var e=this
e.start_time=new Date
var t=e.compositionManager.sceneItems
setTimeout(()=>{e.clearVideosCache(),e.setVideosExportSize()},300),setTimeout(()=>{e.isAborted||(e.p_controller.currentFrame=-1,e.start_time=new Date,t.forEach(function(e){"composition"!=e.type||e.isMissing||e.sub_compositionManager.enableRendering()}),requestAnimationFrame(function(){console.log("-- start export --",e.format),e.nextFrame()}))},1e3)}setVideosExportSize(){(function e(t){t&&t.sceneItems.forEach(function(t){"video"==t.type&&t.setExportSize(),"composition"==t.type&&e(t.sub_compositionManager)})})(this.compositionManager)}clearVideosCache(){(function e(t){t.sceneItems.forEach(function(t){"video"==t.type&&t.clearCache(!1),"composition"==t.type&&t.sub_compositionManager&&e(t.sub_compositionManager)})})(this.compositionManager)}abort(){var e=this
e.isAborted=!0,e.compositionManager.isExporting=!1,e.p_controller.closeExport()}convertDataURIToBinary(e){var t,o=e.replace(/^data[^,]+,/,""),r=window.atob(o),n=r.length,i=new Uint8Array(new ArrayBuffer(n))
for(t=0;t<n;t++)i[t]=r.charCodeAt(t)
return i}pad(e,t,o){return o=o||"0",(e+="").length>=t?e:new Array(t-e.length+1).join(o)+e}async nextFrame(){var e=this
e.compositionManager.renderNextFrame(async function(){e.progress.value++
const t=e.canvas.toDataURL("image/png"),o=e.convertDataURIToBinary(t)
e.images.push(o),e.onFrameDone()})}onFrameDone(){var e=this
if(!e.p_controller.mustAbortJobs){var t=e.compositionManager.currentFrame
if(e.compositionManager.sceneItems.forEach(function(e){e.itemData.time&&1*e.itemData.time.out==t-1&&("video"==e.type&&e.destroy(),"composition"==e.type&&e.destroy())}),!e.isAborted){var o=1*e.activeComposition.time.end+1,r=new Date,n=Math.floor(r-e.start_time),i=document.querySelector("#exportProgress"),a=new CustomEvent("exportMessage",{detail:{progress:Math.floor(e.progress.value/o*100),totalTimeMs:n}})
i.dispatchEvent(a),e.progress.value/o<1?e.nextFrame():setTimeout(()=>{e.addAudio()},100)}}}addAudio(){var e=this
e.audioAddded()}audioAddded(){var e=this
requestAnimationFrame(function(){e.finalizeVideo()})}async finalizeVideo_bad(){var e=this
const t=await LibAV.LibAV({noworker:!0})
console.log(t)
t.encodeImages(e.images,{video:{codec:"libx264",bitrate:1e3,width:1e3,height:700,framerate:25},audio:!1})
const o=await t.createCodec({codec:"libvpx",pixelFormat:"yuva420p",width:1e3,height:700,frameRate:25}),r=e.images
for(const i of r)await o.encodeFrame(i)
await o.finalize()
const n=await o.getVideoBlob()
e.done(n)}finalizeVideo_boffy(){var e=this,t=document.querySelector("#exportProgress"),o=new CustomEvent("exportMessage",{detail:{step:"encoding",progress:0}})
t.dispatchEvent(o)
var r=1*e.activeComposition.time.end+1;(async()=>{for(let o=0;o<r;o+=1){const t=`000${o}`.slice(-4)
await e.ffmpeg.writeFile(`tmp.${t}.png`,e.images[o]),e.images[o]=void 0}e.images=[]
var t=["-framerate",""+e.frameRate,"-pattern_type","glob","-i","*.png","-crf",""+e.quality,"-shortest","-c:v","libx264","-pix_fmt","yuv420p","out.mp4"]
if("webm"==e.format)t=["-framerate",""+e.frameRate,"-i","tmp.%04d.png","-crf",""+e.quality,"-c:v","vp9","-pix_fmt","yuva420p","out.webm"]
if("mov"==e.format)t=["-framerate",""+e.frameRate,"-i","tmp.%04d.png","-c:v","qtrle","out.mov"]
if("mkv"==e.format)t=["-framerate",""+e.frameRate,"-i","tmp.%04d.png","-c:v","ffv1","-pix_fmt","yuva420p","out.mkv"]
if(await e.ffmpeg.exec(t),"mp4"==e.format){const t=await e.ffmpeg.readFile("out.mp4"),o=new Blob([t.buffer],{type:"video/mp4"})
e.done(o)}if("webm"==e.format){const t=await e.ffmpeg.readFile("out.webm"),o=new Blob([t.buffer],{type:"video/webm"})
e.done(o)}if("mov"==e.format){const t=await e.ffmpeg.readFile("out.mov"),o=new Blob([t.buffer],{type:"video/mov"})
e.done(o)}if("mkv"==e.format){const t=await e.ffmpeg.readFile("out.mkv"),o=new Blob([t.buffer],{type:"video/mkv"})
e.done(o)}})()}done(e){var t=this
t.ffmpeg.terminate()
var o=Math.floor(e.size/1024)
_exportedVideo={format:t.format,blob:e,fileSize:o,width:t.width,height:t.height,frameRate:t.frameRate,quality:t.quality,videoCodec:t.videoCodec},_exportedSequence=null
var r=+new Date,n=parseInt((r-t.start_time)/1e3)
console.log("* * export done B in",n,"s"),stopLoading(),t.p_controller.setCompositionDisplayZoom(t.originalCompZoom),t.p_controller.onExportCompleted("b")}}}),define("pikimov/classes/export/export-video_c",["exports","@sentry/ember","pikimov/classes/export/export-audio-item"],function(e,t,o){function r(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=class{constructor(e,t,o){r(this,"controller",null),r(this,"activeComposition",null),r(this,"compositionManager",null),r(this,"originalCompZoom",100),r(this,"size",100),r(this,"domExportProgress",null),r(this,"progress",{value:0}),r(this,"canvas",document.getElementById("compositionCanvas")),r(this,"start_time",null),r(this,"isAborted",!1),r(this,"videoBitrate",0),r(this,"useAlpha",!1),r(this,"format","mp4"),r(this,"imageBitmap",null),r(this,"muxerVideoCodec","avc"),r(this,"videoCodec","avc1.4d002a"),r(this,"muxer",null),r(this,"width",1),r(this,"height",1),r(this,"frameRate",1),r(this,"timePerFrame",0),r(this,"duration",0),r(this,"videoEncoder",null),r(this,"audioEncoder",null),r(this,"audioEncoderConfiguration",null),r(this,"audioMuxerConfiguration",null),r(this,"audioCodecExport",null),r(this,"audioBuffer",null),r(this,"audioTrack",null),r(this,"audioChunks",null)
r(this,"audioData",null),r(this,"nbAudioChannels",2),r(this,"maxEncoderQueue",100),r(this,"sampleRate",48e3),r(this,"needAudio",!1),this.controller=e,this.activeComposition=t,this.size=o,this.compositionManager=this.controller.compositionManager}displayMessage(e){var t=new CustomEvent("exportMessage",{detail:{message:e}})
this.domExportProgress.dispatchEvent(t)}async exportVideo(e,o){var r=this
console.log("* * * export video C * * *",r.size,"%"),r.controller.contextLostDuringExport=!1,gaEvent({event:"export mp4 - start"}),r.useAlpha=e,r.videoBitrate=o
var n=Math.floor(r.activeComposition.dimensions.width/100*r.size),i=Math.floor(r.activeComposition.dimensions.height/100*r.size)
r.maxEncoderQueue=100,n*i>2073600&&(r.maxEncoderQueue=50),void 0!==_config.maxEncoderQueue&&(r.maxEncoderQueue=_config.maxEncoderQueue),console.log("max Encoder Q",r.maxEncoderQueue),r.useAlpha?(r.format="webm",r.muxerVideoCodec="V_VP9",r.videoCodec="vp09.00.10.08"):(r.format="mp4",r.muxerVideoCodec="avc",r.videoCodec="avc1.4d002a",n*i>2073600&&(console.log("4K codec"),r.videoCodec="avc1.640033"))
var a=r.compositionManager,l=a.sceneItems
a.isExporting=!0,a.renderEngine.setActiveCamera("camera"),r.controller.stopRender(),l.forEach(function(e){"composition"!=e.type||e.isMissing||e.sub_compositionManager.disableRendering()}),r.controller.selectionUtils.clearItemsSelection(),r.originalCompZoom=r.controller.compositionDisplayZoom,a.resizeForExport(r.originalCompZoom,r.size),a.enableRendering(),a.updateBgColorAndGrid(),n%2!=0&&(n-=1),i%2!=0&&(i-=1),n<2&&(n=2),i<2&&(i=2),r.width=n,r.height=i,r.frameRate=1*r.activeComposition.frameRate,r.timePerFrame=1e6/r.frameRate,r.duration=r.activeComposition.time.end/r.frameRate,r.audioData=null
var s=!1
if(l.forEach(function(e){e.itemData.hidden||e.isMissing||("audio"==e.type&&(s=!0),"composition"==e.type&&e.hasAudio&&(e.itemData.muted||(s=!0)))}),r.needAudio=s,console.log("need audio:",r.needAudio),r.needAudio){if(!("AudioEncoder"in window)||!AudioEncoder.isConfigSupported)return alert("audio encoder not supported\nare you on Safari?"),void r.abort()
if(await r.setupAudioConfiguration(),!r.audioMuxerConfiguration)return gaEvent({event:"error - export no audio config supported"}),alert("no audio configuration supported\nIt is not possible to export video with audio\n\nRemove all audio items from the composition"),void r.abort()
console.log("export: audio codec:",r.audioMuxerConfiguration.codec)}"mp4"==r.format&&(r.muxer=new Mp4Muxer.Muxer({target:new Mp4Muxer.ArrayBufferTarget,video:{codec:r.muxerVideoCodec,width:r.width,height:r.height},audio:r.audioMuxerConfiguration,firstTimestampBehavior:"offset",fastStart:!1})),"webm"==r.format&&(r.muxer=new WebMMuxer.Muxer({target:new WebMMuxer.ArrayBufferTarget,video:{codec:r.muxerVideoCodec,width:r.width,height:r.height,alpha:r.useAlpha},audio:r.audioMuxerConfiguration,firstTimestampBehavior:"offset"})),r.isAborted=!1,_config.isDebug&&(console.log("videoCodec",r.videoCodec),console.log("videoBitrate",r.videoBitrate))
let c={codec:r.videoCodec,width:r.width,height:r.height,bitrate:r.videoBitrate,framerate:r.frameRate,latencyMode:"quality"}
r.useAlpha&&(c.alpha="keep"),console.log("video config"),console.log(c),r.videoEncoder=new VideoEncoder({output(e,t){r.muxer.addVideoChunk(e,t)},error:function(e){console.log("ERROR VideoEncoder"),console.error(e),console.error(e.name),r.abort()
var o="error - export vEncoder"
e&&e.name&&(o+=" "+e.name),_config.sentry&&t.captureMessage(o,{extra:{error:e,config:c,width:r.width,height:r.height}}),gaEvent({event:o}),alert("VideoEncoder error:\n"+e)}}),await r.videoEncoder.configure(c),setTimeout(()=>{r.clearVideosCache(),r.setVideosExportSize()},300),setTimeout(()=>{r.isAborted||r.controller.mustAbortJobs||(r.controller.currentFrame=-1,r.start_time=new Date,l.forEach(function(e){"composition"!=e.type||e.isMissing||e.sub_compositionManager.enableRendering()}),requestAnimationFrame(function(){console.log("-- start export --",r.activeComposition.time.end,"frames"),r.domExportProgress=document.querySelector("#exportProgress"),r.nextFrame()}))},1e3)}async setupAudioConfiguration(){var e=this,t={codec:null,numberOfChannels:e.nbAudioChannels,sampleRate:e.sampleRate,bitrate:128e3},o="aac",r="mp4a.40.2"
t.codec=r
var n=await AudioEncoder.isConfigSupported(t)
if(console.log("config",o,"supported",n.supported),!n.supported){o="opus",r="opus",t.codec=r,_config.isDebug&&console.log(t)
n=await AudioEncoder.isConfigSupported(t)
if(console.log("config",o,"supported",n.supported),!n.supported)return}e.audioMuxerConfiguration={codec:o,numberOfChannels:e.nbAudioChannels,sampleRate:e.sampleRate},e.audioEncoderConfiguration={codec:r,numberOfChannels:e.nbAudioChannels,sampleRate:e.sampleRate,bitrate:128e3}}setVideosExportSize(){(function e(t){t&&t.sceneItems.forEach(function(t){"video"==t.type&&t.setExportSize(),"composition"==t.type&&e(t.sub_compositionManager)})})(this.compositionManager)}clearVideosCache(){(function e(t){t.sceneItems.forEach(function(t){"video"==t.type&&t.clearCache(!1),"composition"==t.type&&t.sub_compositionManager&&e(t.sub_compositionManager)})})(this.compositionManager)}abort(){var e=this
console.log("-- abort export --",e.compositionManager.currentFrame,"/",e.activeComposition.time.end)
var t=+new Date,o=parseInt((t-e.start_time)/1e3)
console.log("totalTime",o,"s"),e.videoEncoder&&console.log("v Encoder state:",e.videoEncoder.state),e.audioEncoder&&console.log("a Encoder state:",e.audioEncoder.state),e.clearVideosCache(),e.videoEncoder&&"closed"!=e.videoEncoder.state&&e.videoEncoder.close(),e.audioEncoder&&"closed"!=e.audioEncoder.state&&e.audioEncoder.close(),e.isAborted=!0,e.compositionManager.isExporting=!1,e.controller.setCompositionDisplayZoom(e.originalCompZoom),e.controller.closeExport()}ran(){return new Promise(e=>requestAnimationFrame(e))}async nextFrame(){var e=this
e.compositionManager.renderNextFrame(async function(){e.progress.value++
var o=e.compositionManager.currentFrame,r=o*e.timePerFrame
e.imageBitmap=await createImageBitmap(e.canvas)
const n=new VideoFrame(e.imageBitmap,{timestamp:r,duration:Math.floor(e.timePerFrame),displayWidth:e.width,displayHeight:e.height,codedWidth:e.width,codedHeight:e.height})
if(await e.videoEncoder.encode(n,{}),n.close(),e.imageBitmap.close(),5==o&&await e.ran(),e.videoEncoder.encodeQueueSize>=e.maxEncoderQueue)return console.log("#"+o+" => flush encoder q",e.videoEncoder.encodeQueueSize),void e.videoEncoder.flush().then(()=>{e.onFrameDone()}).catch(o=>{if(console.error("Error v encoder flush q:",o),"closed"!=e.videoEncoder.state){gaEvent({event:"error - export flush q"})
var r="A flush error happended\n\n"
r+="frame: "+e.compositionManager.currentFrame+"/"+e.activeComposition.time.end+"\n",r+="Encoder queue: "+e.videoEncoder.encodeQueueSize+"\n",openModal({h2:"Error Flush",p:r,callbackYes:function(){e.abort()}}),_config.sentry&&t.captureMessage("error - export flush q",{extra:{frameIndex:e.compositionManager.currentFrame,width:e.width,height:e.height}})}})
e.onFrameDone()})}onFrameDone(){var e=this
if(!e.controller.mustAbortJobs){e.compositionManager.sceneItems.forEach(function(e){a(e)})
var t=new Date,o=Math.floor(t-e.start_time),r=1*e.activeComposition.time.end+1
if(e.controller.contextLostDuringExport){var n="A WebGL error happended\n\n"
return n+="frame: "+e.compositionManager.currentFrame+"/"+e.activeComposition.time.end+" | Time: "+Math.round(o/1e3)+"s\n",n+="Encoder queue: "+e.videoEncoder.encodeQueueSize+"\n",gaEvent({event:"error - export context lost"}),void openModal({h2:"Error webGL",p:n,callbackYes:function(){e.abort()}})}if(!e.isAborted){var i=new CustomEvent("exportMessage",{detail:{progress:Math.floor(e.progress.value/r*100),totalTimeMs:o}})
e.domExportProgress.dispatchEvent(i),e.progress.value/r<1?e.nextFrame():e.onRenderingCompleted()}}function a(e){if(!e.isDestroyed&&e.itemData.time&&"audio"!=e.type&&("composition"==e.type&&e.sub_compositionManager&&e.sub_compositionManager.sceneItems.forEach(function(e){a(e)}),"composition"!=e.type)){var t=e.compositionManager.currentFrame
1*e.itemData.time.out==t-1&&e.destroy()}}}onRenderingCompleted(){var e=this
e.clearVideosCache(),e.displayMessage("Flushing video encoder"),console.log("==> completed, flush v encoder",e.videoEncoder.encodeQueueSize),e.videoEncoder.flush().then(()=>{setTimeout(()=>{e.addAudio()},200)}).catch(e=>{console.error("Error v encoder flush:",e)})}addAudio(){var e=this
if(e.needAudio){console.log("add audio ---")
var t=[]
for(const t of e.compositionManager.sceneItems)n(t)
if(t.length){e.displayMessage("Add audio track")
var r=e.mergeAudioBuffers(t)
e.displayMessage("Convert audio data"),e.audioData=e.convertToAudioData(r),e.encodeAudio()}else e.onAudioEncoded()}else e.onAudioEncoded()
function n(r){if(!r.itemData.hidden&&!r.isMissing){if("audio"==r.type){if(1*r.itemData.time.out<1)return
if(r.audioBuffer){var i=new o.default(r,e.activeComposition,e.frameRate)
t.push(i.getAudioBuffer())}}"composition"!=r.type||r.itemData.muted||r.sub_compositionManager.sceneItems.forEach(function(e){n(e)})}}}mergeAudioBuffers(e){const t=new AudioContext
var o=e[0],r=o.length,n=e.length
for(c=0;c<n;c++){if(e[c].length!==r)return console.error("Buffer lengths do not match."),gaEvent({event:"error - export audio buffer length"}),alert("error export audio - buffer.length"),null
if(2!==e[c].numberOfChannels&&1!=e[c].numberOfChannels)return console.error("number of channels do not match",2,e[c].numberOfChannels),gaEvent({event:"error - export audio numberOfChannels"}),alert("error export audio - numberOfChannels must be 2 but is "+e[c].numberOfChannels),null}const i=t.createBuffer(2,o.length,this.sampleRate),a=new Float32Array(o.length)
var l,s,c
for(l=0;l<2;l++){var u=[]
for(s=0;s<n;s++)1==e[s].numberOfChannels?u[s]=e[s].getChannelData(0):u[s]=e[s].getChannelData(l)
for(c=0;c<o.length;c++){var m=0
for(s=0;s<n;s++)m+=u[s][c]
a[c]=m}i.copyToChannel(a,l)}return i}convertToAudioData(e){const t=e.numberOfChannels,o=e.length,r=new Float32Array(t*o)
for(let n=0;n<t;n++){const t=e.getChannelData(n)
r.set(t,n*o)}return new AudioData({format:"f32-planar",sampleRate:e.sampleRate,numberOfFrames:o,numberOfChannels:e.numberOfChannels,timestamp:0,data:r})}encodeAudio(){var e=this
e.displayMessage("Encode audio track"),console.log("==> audio added => now encode audio"),e.audioEncoder=new AudioEncoder({output:(t,o)=>e.muxer.addAudioChunk(t,o),error:t=>{console.error(t),e.displayMessage("Error audio configuration B")}})
try{e.audioEncoder.configure(e.audioEncoderConfiguration)}catch(t){console.log("ERROR: audioEncoder configuration"),console.log(t),e.displayMessage("Error audio configuration A")}e.audioEncoder.addEventListener("dequeue",t=>{0==e.audioEncoder.encodeQueueSize&&e.audioEncoder.flush().then(()=>{console.log("==> audio encoded"),e.displayMessage("Audio track encoded"),e.onAudioEncoded()})}),e.audioEncoder.encode(e.audioData)}async onAudioEncoded(){var e=this
"mp4"==e.format&&e.createMP4File(),"webm"==e.format&&e.createWebmFile()}createMP4File(){var e=this
e.displayMessage("Create video file"),e.muxer.finalize()
let{buffer:t}=e.muxer.target
var o=new Blob([t],{type:"video/mp4"})
setTimeout(()=>{e.done(o)},100)}createWebmFile(){var e=this
e.displayMessage("Create video file"),e.muxer.finalize()
let{buffer:t}=e.muxer.target
var o=new Blob([t],{type:"video/webm"})
setTimeout(()=>{e.done(o)},100)}done(e){var t=this
gaEvent({event:"export mp4 - done"}),t.videoEncoder.close(),t.audioEncoder&&t.audioEncoder.close()
var o=Math.floor(e.size/1024)
_exportedVideo={format:t.format,blob:e,fileSize:o,width:t.width,height:t.height,frameRate:t.frameRate,videoBitrate:t.videoBitrate,muxerVideoCodec:t.muxerVideoCodec,videoCodec:t.videoCodec},_exportedSequence=null,t.audioEncoderConfiguration&&(_exportedVideo.muxerAudioCodec=t.audioMuxerConfiguration.codec,_exportedVideo.audioCodec=t.audioEncoderConfiguration.codec)
var r=new Date,n=parseInt((r-t.start_time)/1e3)
console.log("* * export done in",n,"s"),stopLoading(),t.controller.setCompositionDisplayZoom(t.originalCompZoom),t.controller.onExportCompleted("c")}}}),define("pikimov/classes/expression-engine",["exports","@ember/object","@sentry/ember"],function(e,t,o){function r(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=class{constructor(e,t){r(this,"controller",null),r(this,"sceneItem",null),r(this,"cache",[])
this.controller=e,this.sceneItem=t}getTransform(e){var t,o,r,n,i=this,a=i.sceneItem.itemData,l=i.sceneItem.getTransformEnabledAxes()
a.position.useExpression&&(e.position=structuredClone(e.position),a.position.expression.separated?(!1!==(t=i.getValue(a.position,0,e.position.x))&&(e.position.x=t),!1!==(o=i.getValue(a.position,1,e.position.y))&&(e.position.y=o),l.position.z&&!1!==(r=i.getValue(a.position,2,e.position.z))&&(e.position.z=r)):!1!==(n=i.getValueArray(a.position,e.position))&&(!1!==n[0]&&(e.position.x=n[0]),!1!==n[1]&&(e.position.y=n[1]),l.position.z&&!1!==n[2]&&(e.position.z=n[2])))
a.rotation.useExpression&&(e.rotation=structuredClone(e.rotation),l.rotation.x||l.rotation.y||!l.rotation.z?a.rotation.expression.separated?(!1!==(t=i.getValue(a.rotation,0,e.rotation.x))&&(e.rotation.x=t),!1!==(o=i.getValue(a.rotation,1,e.rotation.y))&&(e.rotation.y=o),!1!==(r=i.getValue(a.rotation,2,e.rotation.z))&&(e.rotation.z=r)):!1!==(n=i.getValueArray(a.rotation,e.rotation))&&(l.scale.x&&!1!==n[0]&&(e.rotation.x=n[0]),l.scale.y&&!1!==n[1]&&(e.rotation.y=n[1]),l.scale.z&&!1!==n[2]&&(e.rotation.z=n[2])):!1!==(r=i.getValue(a.rotation,0,e.rotation.z))&&(e.rotation.z=r))
a.scale.useExpression&&(e.scale=structuredClone(e.scale),a.scale.expression.separated?(!1!==(t=i.getValue(a.scale,0,e.scale.x))&&(e.scale.x=t),!1!==(o=i.getValue(a.scale,1,e.scale.y))&&(e.scale.y=o),!1!==(r=i.getValue(a.scale,2,e.scale.z))&&(e.scale.z=r)):!1!==(n=i.getValueArray(a.scale,e.scale))&&(!1!==n[0]&&(e.scale.x=n[0]),!1!==n[1]&&(e.scale.y=n[1]),l.scale.z&&!1!==n[2]&&(e.scale.z=n[2])))
return e}evaluate(e){const t=_moduleExpressions.ccall("evaluate","string",["string"],[e])
if("emsc"==t)return{error:!0}
var r=JSON.parse(t)
return r||0===r||(_config.sentry&&o.captureMessage("error evaluate - obj is null",{extra:{exp:e}}),console.warn("error evaluate - obj is null",this.sceneItem.name),console.log(e)),r&&r.error&&(console.warn("error evaluate - obj.error",this.sceneItem.name),_config.isDebug&&(console.log(e),console.log(r))),r}posterizeTime(e,t){return Math.floor(t*e)/e}getTime(e){var t=this,o=t.sceneItem.frameIndex/t.sceneItem.compositionData.frameRate
if(e.includes("posterizeTime(")){const n=e.match(/posterizeTime\(([^)]+)\)/)
var r=n?n[1]:null
r&&(o=t.posterizeTime(1*r,o))}return o}injectVars(e,t,o){var r=this,n=r.sceneItem,i=n.compositionData,a=1*i.time.end,l=1*i.frameRate,s=roundValue((a+1)/l,2),c=n.frameIndex/l,u=n.getJsonData(),m=(1*i.time.end-1)/l
n.itemData.time&&(m=(n.itemData.time.out-1)/l),"text"==e.type&&(o=`"${o}"`),t=`var frameRate=${l};\n`+(t=`var time=${c};\n`+t),t=`var outPoint=${m};\n`+(t=`var value=${o};\n`+(t=`var itemIndex=${n.compIndex};\n`+t))
var p={name:i.name,width:1*i.dimensions.width,height:1*i.dimensions.height,displayStartTime:0,duration:s,frameDuration:1/l}
return t=(t=`var thisComp = ${JSON.stringify(p)};\n`+t).replace(/posterizeTime\(([^)]+)\);/g,(t,o)=>{var i=r.posterizeTime(o,c)*l
i=Math.round(i)
var a=null
e==u.position&&(a=n.getTransformAt(i,{ignoreExpression:!0}).position,a=r.convertObjToArray(a))
e==u.rotation&&(a=n.getTransformAt(i,{ignoreExpression:!0}).rotation,a=r.convertObjToArray(a))
e==u.scale&&(a=n.getTransformAt(i,{ignoreExpression:!0}).scale,a=r.convertObjToArray(a))
if("number"==e.type){var s=e.name
a=n.getParamValueAt(i,s,{ignoreExpression:!0})}return`posterizeTime(${o});value = ${a=JSON.stringify(a)};`})}getValue(e,o,r){var n=this,i=e.expression.strings[o]
if(!i||""==i)return!1
var a=n.getTime(i),l=n.getFromCache(e,a)
if(l){if(l.time==a&&l.expressionString==i)return l.value
l.expressionString!=i&&n.deleteFromCache(e)}var s=n.injectVars(e,i,r),c=n.evaluate(s)
return requestAnimationFrame(function(){e.error!=c.error&&(0,t.set)(e,"error",c.error)}),!c.error&&("text"==e.type||!1!==c&&(c=roundValue(c,2),e.min&&c<e.min&&(c=e.min),e.max&&c>e.max&&(c=e.max),n.saveToCache(e,a,i,c)),c)}getValueArray(e,o){var r=this,n=r.convertObjToArray(o),i=JSON.stringify(n),a=e.expression.strings[0]
if(!a||""==a)return!1
var l=r.getTime(a),s=r.getFromCache(e,l)
if(s){if(s.time==l&&s.expressionString==a)return s.value
s.expressionString!=a&&r.deleteFromCache(e)}var c=r.injectVars(e,a,i),u=r.evaluate(c)
return requestAnimationFrame(function(){e.error!=u.error&&(0,t.set)(e,"error",u.error)}),!u.error&&(!!Array.isArray(u)&&(u[0]=roundValue(u[0],2),u[1]=roundValue(u[1],2),null!=u[2]&&(u[2]=roundValue(u[2],2)),u&&r.saveToCache(e,l,a,u),u))}convertObjToArray(e){var t=[1*e.x,1*e.y]
return void 0!==e.z&&t.push(1*e.z),t}getFromCache(e){var t=null
return this.cache.forEach(function(o){o.property==e&&(t=o)}),t||null}saveToCache(e,t,o,r){var n=!1
this.cache.forEach(function(o){o.property==e&&(n=!0,o.time!=t&&(o.value=r,o.time=t))}),n||this.cache.push({property:e,expressionString:o,value:r,time:t})}deleteFromCache(e){var t=this
for(let o=0;o<t.cache.length;o++)t.cache[o].property===e&&(t.cache.splice(o,1),o--)}}}),define("pikimov/classes/highlight-box",["exports"],function(e){function t(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=class{constructor(e){t(this,"sceneItem",null),t(this,"highlightBox",null),t(this,"matLine",null)
var o=this
o.sceneItem=e,o.matLine=new LineMaterial({color:valueToSRGB(48614),linewidth:2,alphaToCoverage:!0}),o.matLine.name="matLine"}addBox(){var e=this
if(e.highlightBox)return
var t=e.sceneItem
if(!t.threejsObj)return
var o,r=t.type
if("text"!=r&&(o=t.boundingBox),"text"==r){var n=t.getTextBoundingSize();(o=new THREE.Box3).min.x=n.width/-2,o.max.x=n.width/2
var i=t.getParamValueAt(0,"text align")
"left"==i&&(o.min.x=0,o.max.x=n.width),"right"==i&&(o.min.x=-1*n.width,o.max.x=0),"justify"==i&&(o.min.x=0,o.max.x=n.width),o.max.y=n.height/2,o.min.y=n.height/-2,0!=n.width&&0!=n.height||(o.min.x=-50,o.min.y=-50,o.max.x=50,o.max.y=50)}var a,l=[],s=0
"model"==r&&(s=(o.min.z+o.max.z)/2),"gaussianSplat"==r&&(l=e.getGaussianBox(o)),0==l.length&&(a={x:o.min.x,y:o.max.y,z:s},l.push(a.x,a.y,a.z),a={x:o.max.x,y:o.max.y,z:s},l.push(a.x,a.y,a.z),a={x:o.max.x,y:o.min.y,z:s},l.push(a.x,a.y,a.z),a={x:o.min.x,y:o.min.y,z:s},l.push(a.x,a.y,a.z),a={x:o.min.x,y:o.max.y,z:s},l.push(a.x,a.y,a.z))
const c=new LineGeometry
c.setPositions(l),e.highlightBox=new Line2(c,e.matLine),e.highlightBox.computeLineDistances(),e.highlightBox.name="line box",e.highlightBox.userData.isHelper=!0,t.threejsHook.add(e.highlightBox)
var u=t.controller.currentFrame
e.updateVisibility(u)}getGaussianBox(e){var t,o,r,n=[]
return r=e.min.z,t={x:e.min.x,y:e.max.y,z:r},n.push(t.x,t.y,t.z),t={x:e.max.x,y:e.max.y,z:r},n.push(t.x,t.y,t.z),t={x:e.max.x,y:e.min.y,z:r},n.push(t.x,t.y,t.z),t={x:e.min.x,y:e.min.y,z:r},n.push(t.x,t.y,t.z),t={x:e.min.x,y:e.max.y,z:r},n.push(t.x,t.y,t.z),r=e.max.z,t={x:e.min.x,y:e.max.y,z:r},n.push(t.x,t.y,t.z),t={x:e.max.x,y:e.max.y,z:r},n.push(t.x,t.y,t.z),t={x:e.max.x,y:e.min.y,z:r},n.push(t.x,t.y,t.z),t={x:e.min.x,y:e.min.y,z:r},n.push(t.x,t.y,t.z),t={x:e.min.x,y:e.max.y,z:r},n.push(t.x,t.y,t.z),o=e.max.y,t={x:e.min.x,y:o,z:e.max.z},n.push(t.x,t.y,t.z),t={x:e.max.x,y:o,z:e.max.z},n.push(t.x,t.y,t.z),t={x:e.max.x,y:o,z:e.min.z},n.push(t.x,t.y,t.z),t={x:e.min.x,y:o,z:e.min.z},n.push(t.x,t.y,t.z),t={x:e.min.x,y:o,z:e.max.z},n.push(t.x,t.y,t.z),o=e.min.y,t={x:e.min.x,y:o,z:e.max.z},n.push(t.x,t.y,t.z),t={x:e.max.x,y:o,z:e.max.z},n.push(t.x,t.y,t.z),t={x:e.max.x,y:o,z:e.min.z},n.push(t.x,t.y,t.z),t={x:e.min.x,y:o,z:e.min.z},n.push(t.x,t.y,t.z),t={x:e.min.x,y:o,z:e.max.z},n.push(t.x,t.y,t.z),n}update(e){var t=this
t.highlightBox&&(t.updateVisibility(e),t.highlightBox.visible&&("shape"!=t.sceneItem.type&&"text"!=t.sceneItem.type||(t.sceneItem.refreshBoundingBox(),t.remove(),t.addBox())))}updateVisibility(e){var t=this
if(t.highlightBox){var o=t.sceneItem,r=!1,n=o.itemData.hidden,i=o.isTimeInFrame(e),a=o.isSelected
!n&&i&&a&&(r=!0),"gaussianSplat"==o.type&&!n&&i&&(r=!0,t.matLine.color=a?valueToSRGB(48614):valueToSRGB(16777215)),t.highlightBox.visible=r}}remove(){var e=this
if(e.highlightBox){var t=e.highlightBox.parent
t&&t.remove(e.highlightBox),e.highlightBox.geometry.dispose(),e.highlightBox=null}}destroy(){var e=this
e.remove(),e.matLine&&(e.matLine.dispose(),e.matLine=null)}}}),define("pikimov/classes/items/audio-item",["exports","pikimov/classes/items/scene-item"],function(e,t){function o(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{constructor(e,t,r){super(e,t,r),o(this,"duration",0),o(this,"gainNode",null),o(this,"audioBuffer",null),o(this,"bufferSource",null),o(this,"sampleRate",null),o(this,"isAudioPlaying",!1)
var n=this,i=n.compositionManager.audioContext
n.gainNode=i.createGain(),n.gainNode.connect(i.destination)}buildItem(){var e=this
e.duration=1e3*e.libManagerItem.duration,e.updateMaxFrames(),e.doAudioBuffer()}doAudioBuffer(){var e=this,t=e.getFileData(),o=new AudioContext({sampleRate:48e3})
new Response(t).arrayBuffer().then(function(t){o.decodeAudioData(t,function(t){e.audioBuffer=t,e.sampleRate=t.sampleRate,o.close(),e.onReady()},function(t){console.error("ERROR audio buffer"),console.log(t),alert("Warning: Audio buffer error \nMissing audio track?"),e.isMissing=!0,o.close(),e.onReady()})})}connectAudio(){var e=this,t=e.bufferSource
t.buffer=e.audioBuffer,t.connect(e.gainNode)}updateAudio(){var e=this,t=e.compositionManager
if(!t.isExporting&&e.controller.playbackUtils.isPlaying){var o=t.audioContext,r=e.frameIndex,n=0,i=e.isVisibleInframe(r)
if(e.getAbsoluteStripeInfos().muted&&(i=!1),i||!e.isAudioPlaying){if(i||e.isAudioPlaying){var a=e.itemData.time,l=1*a.in,s=1*a.out,c=1*e.compositionData.time.end
if(s>c&&(s=c),i&&!e.isAudioPlaying&&(l==r&&(n=(0+1*a.trackIn)/t.frameRate,e.isAudioPlaying=!0),l<r&&s>r&&(n=(r-l+1*a.trackIn)/t.frameRate,e.isAudioPlaying=!0),e.isAudioPlaying&&(e.bufferSource=o.createBufferSource(),e.connectAudio(),e.bufferSource.start(o.currentTime,n))),i&&e.isAudioPlaying){var u=e.getParamValueAt(r,"volume")
e.gainNode.gain.value=u/100}if(s==r&&e.isAudioPlaying)e.stopAudio()
else if(t.depthLevel>0){var m=e.controller.currentFrame,p=e.getAbsoluteStripeInfos()
p.in+p.duration==m&&e.isAudioPlaying&&e.stopAudio()}}}else e.stopAudio()}}getAbsoluteStripeInfos(){var e=this,t=!1,o=1*e.itemData.time.out-1*e.itemData.time.in,r=e.compositionManager,n=r.sceneItemComposition
if(!n)return{muted:!1}
for(;r.sceneItemComposition;){var i,a;(i=r.sceneItemComposition.getCompItem()).muted&&(t=!0),(a=1*i.time.out-1*i.time.in)<o&&(o=a),r=(n=r.sceneItemComposition).compositionManager}return(i=n.getCompItem()).muted&&(t=!0),(a=1*i.time.out-1*i.time.in)<o&&(o=a),{in:1*i.time.in,out:1*i.time.out,trackIn:1*i.time.trackIn,duration:o,muted:t}}stopAudio(){var e=this
if(e.isAudioPlaying){var t=e.bufferSource
t&&(t.stop(),e.isAudioPlaying=!1)}}restartAudioFrameZero(){var e=this,t=e.bufferSource
t&&(t.onended=()=>{e.isAudioPlaying=!1},t.stop())}buildWaveForm(){var e=this
if(!e.audioBuffer)return
var t=e.audioBuffer,o=e.itemData.time.out-e.itemData.time.in
if(o<=0)return
var r=o/e.compositionManager.frameRate,n=r/t.duration*100,i=Math.round(100*r)
i>8e3&&(i=8e3)
const a=t.getChannelData(0),l=Math.round(a.length/i*n/100)
var s=e.itemData.time.trackIn/e.compositionManager.frameRate,c=Math.round(s*e.sampleRate)
const u=[]
for(let d=0;d<i;d++){let e=l*d,t=0
for(let o=0;o<l;o++)t+=Math.abs(a[c+e+o])
isNaN(t)||u.push(t/l)}const m=Math.pow(Math.max(...u),-1),p=u.map(e=>e*m)
e.renderWaveForm(p,p.length)}renderWaveForm(e,t){var o=document.querySelector('.stripe[data-compuid="'+this.compUid+'"] canvas')
o.width=t,o.height=20
const r=o.width/t,n=o.getContext("2d")
n.beginPath()
let i=0
for(let l=0;l<t;l++){var a=20*e[l]
n.moveTo(i+.5,20),n.lineTo(i+.5,20-a),i+=r}n.strokeStyle="rgb(80, 80, 80)",n.lineWidth=1,n.stroke()}destroyItemAudio(){var e=this
e.bufferSource&&(e.bufferSource.stop(),e.bufferSource.disconnect(),e.bufferSource=null),e.gainNode=null,e.audioBuffer=null}}e.default=r}),define("pikimov/classes/items/camera-item",["exports","pikimov/classes/items/scene-item"],function(e,t){function o(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{constructor(e,t,r){super(e,t,r),o(this,"gizmoMaterial",null),o(this,"gizmo",null),this.gizmoMaterial=new THREE.LineBasicMaterial({linewidth:3})}buildItem(){var e=this
e.doMeshCamera(),e.addToScene(),e.onReady()}doMeshCamera(){var e=this
if(e.threejsObj?e.gizmo&&(e.gizmo.geometry.dispose(),e.threejsObj.remove(e.gizmo)):e.threejsObj=new THREE.Group,!e.needGizmo)return
var t=e.compositionManager.getDimensions(),o=t.width/t.height
const r=37.5
var n=new THREE.CylinderGeometry(50,120,75,4,1,!0)
n.rotateX(Math.PI/2),n.rotateZ(Math.PI/4),n.translate(0,0,-18.75),n.scale(1,1/o,1)
var i=new THREE.CylinderGeometry(50,50,r,4,1,!0)
i.rotateX(Math.PI/2),i.rotateZ(Math.PI/4),i.translate(0,0,r),i.scale(1,1/o,1)
var a=[n,i]
const l=BufferGeometryUtils.mergeGeometries(a)
l.computeBoundingSphere()
const s=new THREE.EdgesGeometry(l,1)
e.gizmo=new THREE.LineSegments(s,e.gizmoMaterial),e.gizmo.name="camera gizmo",e.gizmo.userData.isGizmo=!0,e.threejsObj.add(e.gizmo),e.gizmo.position.set(0,0,-37.5)}applyFrameToCamera(e){var t=this,o=t.compositionManager.camera,r=t.threejsObj
o.fov=t.getParamValueAt(e,"fov"),o.zoom=t.getParamValueAt(e,"zoom"),o.updateProjectionMatrix()
var n=new THREE.Vector3
if(r.getWorldPosition(n),o.position.copy(n),t.updateGizmoColor(),!t.itemData.target.enabled){var i=t.getTransformAt(e).rotation,a=THREE.MathUtils.degToRad(i.x),l=THREE.MathUtils.degToRad(i.y),s=THREE.MathUtils.degToRad(-1*i.z)
r.rotation.set(a,l,s),o.rotation.copy(r.rotation)
const n=new THREE.Quaternion
r.getWorldQuaternion(n)
const c=(new THREE.Euler).setFromQuaternion(n,r.rotation.order)
o.rotation.copy(c)}if(t.itemData.target.enabled){var c=t.getters.getSceneItemByCompUid(t.compositionManager,t.itemData.target.compUid)
if(!c)return console.log("error - no camera target found"),alert("warning - no camera target found"),void(t.itemData.target.enabled=!1)
var u=c.getTransformAt(e),m=t.normalizePosition(u.position)
o.lookAt(m.x,m.y,m.z),r.lookAt(m.x,m.y,m.z),r.rotateY(Math.PI),c.buildDashedLine(t,e)}}onToggleEnableTarget(){var e=this,t=e.itemData.target.enabled
!e.getters.getAllCompositionSceneItems(e.compositionManager,"cameraTarget")[0]&&t&&e.compositionManager.addCameraTarget(e.compUid),e.compositionManager.buildCompositionThenSelect(null)}setupFog(){}}e.default=r}),define("pikimov/classes/items/camera-target-item",["exports","pikimov/classes/items/scene-item"],function(e,t){function o(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{constructor(e,t,r){super(e,t,r),o(this,"itemCamera",null),o(this,"dashedLines",[]),o(this,"lineMaterial",null),o(this,"gizmoMaterial",null),o(this,"gizmo",null)
var n=this
n.itemCamera=n.getters.getAllCompositionItems(n.compositionManager.compositionData,"camera")[0]
var i=n.itemCamera.target.enabled
"2D"==n.cameraType&&(i=!1),n.itemData.disabled=!i,n.gizmoMaterial=new LineMaterial({linewidth:4,alphaToCoverage:!0,side:THREE.DoubleSide}),n.lineMaterial=new THREE.LineDashedMaterial({linewidth:1,dashSize:20,gapSize:20})}buildItem(){var e=this
e.doMeshCameraTarget(),e.addToScene(),e.onReady()}doMeshCameraTarget(){var e=this
if(e.threejsObj||(e.threejsObj=new THREE.Group),!e.needGizmo)return
var t=20
"3D"==e.cameraType&&(t=30)
var o=[-1*t,0,0,t,0,0],r=[0,-1*t,0,0,t,0],n=[0,0,-1*t,0,0,t],i=e.gizmoMaterial
const a=new LineGeometry
a.setPositions(o)
var l=new Line2(a,i)
l.userData.isGizmo=!0
const s=new LineGeometry
s.setPositions(r)
var c=new Line2(s,i)
c.userData.isGizmo=!0
const u=new LineGeometry
u.setPositions(n)
var m=new Line2(u,i)
m.userData.isGizmo=!0,e.gizmo=new THREE.Group,e.gizmo.name="group gizmo",e.gizmo.add(l,c,m),e.threejsObj.add(e.gizmo)}buildDashedLine(e,t){var o=this
if(o.needGizmo&&!o.compositionManager.isExporting){o.applyFrame(t),o.destroyLine()
var r=new THREE.Vector3
e.threejsObj.getWorldPosition(r)
var n=new THREE.Vector3
o.threejsObj.getWorldPosition(n)
var i=[n,r],a=(new THREE.BufferGeometry).setFromPoints(i),l=new THREE.Line(a,o.lineMaterial)
l.computeLineDistances(),l.name="dashed line",o.dashedLines.push(l),o.compositionManager.scene.add(l)}}destroyLine(){this.dashedLines.forEach(function(e){e.parent&&e.parent.remove(e),e.geometry.dispose()}),this.dashedLines=[]}destroyItemCameraTarget(){var e=this
e.destroyLine(),e.dashedLines=void 0,e.lineMaterial.dispose()}}e.default=r}),define("pikimov/classes/items/cloud/audio-item-cloud",["exports","pikimov/classes/items/audio-item"],function(e,t){function o(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{constructor(e,t,r){super(e,t,r),o(this,"isFromCloud",!0),o(this,"cloudworkerFile","worker-audio-cloud.js"),o(this,"worker",null),o(this,"decodedBuffers",[]),o(this,"requestedTimesAlreadyFetched",[])}initWorker(){var e=this
e.worker=new Worker("js/workers/"+e.cloudworkerFile),e.worker.addEventListener("message",function(t){e.onMessageFromWorker(t)})
var t={compUid:e.compUid,cacheConfig:_videoCacheConfig,videoURL:e.libManagerItem.itemData.url,filesize:e.libManagerItem.itemData.filesize,secondsToFetch:2,what:"start"}
e.postMessageToWorker(t)}updateInOutFrames(){}onDecoderReady(){this.onReady()}applyFrame(e){var t=this
if(t.frameIndex=e,!t.isMissing&&!t.isIgnored){t.updateAudio()
t.requestFrame(e,null)}}requestFrame(e,t=null){var o=this,r=o.itemData.time,n=(e-r.in+r.trackIn)/o.compositionManager.frameRate,i=!1,a=0,l=2*Math.floor(n/2)
if(o.requestedTimesAlreadyFetched[l]||(a=l,i=!0),!i){var s=2*Math.floor((n+1)/2)
o.requestedTimesAlreadyFetched[s]||(a=s,i=!0)}if(i){var c={what:"requestTime",requestedTime:a,mustRender:!0}
o.postMessageToWorker(c)}}postMessageToWorker(e,t=null){this.isMissing||this.worker.postMessage(e,t)}onMessageFromWorker(e){var t=this
if(!t.isDestroyed){var o=e.data,r=o.what
if("onReady"==r){t.videoProperties=o.videoProperties,t.duration=t.videoProperties.duration,t.updateMaxFrames(),t.updateInOutFrames(!1)
var n={what:"doStarterCache",videoFrameIn:t.videoFrameIn,videoFrameOut:t.videoFrameOut,videoFrameMin:t.videoFrameMin,videoFrameMax:t.videoFrameMax}
t.postMessageToWorker(n)}if("onStarterCacheReady"==r&&t.onDecoderReady(),"audioData"==r&&t.onAudioDataReceived(e.data),"decoderFlushed"==r)return t.requestedTimesAlreadyFetched[o.requestedTime]=!0,void t.merge_A()
"decoderError"==r&&(openModal({h2:"audio decoder error",p:o.error+"\n"+o.codec}),t.controller.set("isIgnored",!0))}}onAudioDataReceived(e){var t=e,o=t.audioData
const r=this.audioDataToAudioBuffer(o)
this.decodedBuffers.push({buffer:r,timestamp:o.timestamp,duration:o.duration,cts:t.cts}),o.close(),o=null}mergeAudioDataQueue(){var e=this
var t,o=[]
for(t=0;t<e.decodedBuffers.length;t++)o.push(e.decodedBuffers[t].buffer)
var r=function(e,t){if(!t.length)return null
const o=t[0].numberOfChannels,r=t[0].sampleRate,n=t.reduce((e,t)=>e+t.length,0),i=e.createBuffer(o,n,r)
let a=0
for(const l of t){for(let e=0;e<o;e++)i.getChannelData(e).set(l.getChannelData(e),a)
a+=l.length}return i}(e.compositionManager.audioContext,o),n=e.decodedBuffers[0].timestamp
return e.decodedBuffers=[],{buffer:r,timestamp:n}}merge_A(){var e=this
if(console.log("--- merge --- x",e.decodedBuffers.length),!e.decodedBuffers.length)return
const t=e.decodedBuffers[0].buffer.sampleRate,o=e.decodedBuffers[0].buffer.numberOfChannels
if(!e.audioBuffer){var r=e.duration/1e3
const n=Math.round(r*t)
e.audioBuffer=new AudioBuffer({length:n,sampleRate:t,numberOfChannels:o})}function n(e,t){return Math.round(e/1e6*t)}for(const{buffer:i,timestamp:a}of e.decodedBuffers){const r=n(a,t)
if(r+i.length>e.audioBuffer.length)break
for(let t=0;t<o;t++)e.audioBuffer.getChannelData(t).set(i.getChannelData(t),r)}e.decodedBuffers.forEach(function(e){e.buffer=null}),e.decodedBuffers=[],e.buildWaveForm()}merge_B(e){return}playAudioDebug(){}audioDataToAudioBuffer(e){const t=e.numberOfChannels,o=e.numberOfFrames,r=e.sampleRate,n=new AudioBuffer({length:o,numberOfChannels:t,sampleRate:r})
for(let i=0;i<t;i++){const t=new Float32Array(o)
e.copyTo(t,{planeIndex:i}),n.copyToChannel(t,i)}return n}buildItem(){var e=this
e.duration=1e3*e.libManagerItem.duration,e.updateMaxFrames(),e.initWorker()}destroyItemAudio(){var e=this
if(console.log("destroy item audio CLOUD"),e.gainNode=null,e.bufferSource=null,e.audioBuffer=null,e.decodedBuffers=null,e.worker){console.log("destroy audio worker",e.name)
e.postMessageToWorker({what:"destroy"}),e.worker.terminate(),e.worker=void 0}}}e.default=r}),define("pikimov/classes/items/cloud/video-item-cloud",["exports","pikimov/classes/items/video-item"],function(e,t){function o(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{constructor(e,t,r){super(e,t,r),o(this,"isFromCloud",!0),o(this,"cloudworkerFile","worker-video-cloud.js"),this.maxCachedFramesExport=250}initWorker(){var e=this
e.worker=new Worker("js/workers/"+e.cloudworkerFile),e.worker.addEventListener("message",function(t){e.onMessageFromWorker(t)})
var t=e.getDimensionsAt(),o=t.width,r=t.height,n=1
_config.videos.lowHD&&(o*r>921600&&(n=2),o*r>=8294400&&(n=4)),e.resDivider=n
var i={compUid:e.compUid,resolutionDivider:n,cacheConfig:_videoCacheConfig,videoURL:e.libManagerItem.itemData.url,what:"start"}
e.postMessageToWorker(i)}onExportQueueCompleted(){var e=this
if(!e.isDestroyed){console.log("CLOUD export q completed, pick from cache",e.videoFrameIndex)
var t=e.getFrameFromCacheByTimestamp(e.videoFrameIndex)
if(!t){var o=e.videoFrameIndex/e.frameRate,r=Math.round(1e3*o*1e3)
console.warn("export error A on frame ",e.videoFrameIndex,": not in cache | t",o,"s",r),e.cachedFrames.forEach(function(e){Math.abs(e.timestamp-r)<2&&(t=e,console.log("2nd chance: found in item CACHE by timestamp",e.timestamp))})}if(!t)return console.log("wait 500ms"),void setTimeout(()=>{if((t=e.getFrameFromCacheByIndex(e.videoFrameIndex))&&console.error("OK B on frame ",e.videoFrameIndex),!t)return console.error("export error B on frame ",e.videoFrameIndex),e.clearCache(),void setTimeout(()=>{console.log("try to unstuck by requesting more data"),e.waitingForBitmap=!0
e.postMessageToWorker({what:"fetchMore"})},200)
e.updateBitmapTexture(t),e.onDrawnCallback.call(e,e.itemData)},500)
e.updateBitmapTexture(t),e.onDrawnCallback.call(e,e.itemData)}}getFrameFromCacheByTimestamp(e){var t=this,o=1e3*(e/t.frameRate)*1e3,r=t.getFrameFromCacheByIndex(e)
if(!r)return null
var n=Math.abs(o-r.timestamp),i=null
return t.cachedFrames.forEach(function(e){var t=Math.abs(o-e.timestamp)
t<n&&(n=t,i=e)}),i}}e.default=r}),define("pikimov/classes/items/composition-item",["exports","pikimov/classes/items/scene-item","pikimov/classes/managers/composition-manager"],function(e,t,o){function r(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class n extends t.default{constructor(e,t,n){super(e,t,n),r(this,"controller",null),r(this,"itemCompositionData",null),r(this,"canvas",null),r(this,"sub_compositionManager",null),r(this,"canvasTexture",null),r(this,"duration",0),r(this,"ignored",!1),r(this,"lastRenderFrameIndex",-1),r(this,"useRenderTarget",!1),r(this,"dataTexture",null),r(this,"hasAudio",!1),r(this,"currentSize",{})
var i=this
i.controller=i.compositionManager.controller
var a=i.controller.projectData
if(i.itemCompositionData=i.getters.getCompositionByUid(a,i.itemData.compositionUid),!i.itemCompositionData)return console.error("WARNING: compositionItem -> comp not found"),void(i.isMissing=!0)
if(i.itemData.hidden&&i.compositionManager.depthLevel>0)return console.log("IGNORED: hidden depth comp LVL",i.compositionManager.depthLevel),void(i.ignored=!0)
var l=i.compositionManager.depthLevel+1
i.sub_compositionManager=new o.default(i.controller,i.itemCompositionData,l),i.sub_compositionManager.sceneItemComposition=i}checkHasAudio(){var e=!1
function t(o){e||(o.itemData.hidden||o.isMissing||("audio"==o.type&&(e=!0),"composition"!=o.type||o.itemData.muted||o.sub_compositionManager.sceneItems.forEach(function(e){t(e)})))}this.sub_compositionManager.sceneItems.forEach(function(e){t(e)}),this.hasAudio=e}buildItem(){var e=this
if(e.ignored)e.onReady()
else{e.materials[0]=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,transparent:!0,alphaTest:.02})
var t=1*e.itemCompositionData.time.end-1*e.itemCompositionData.time.start+1
e.duration=t/e.itemCompositionData.frameRate*1e3,e.updateMaxFrames()
var o=1*e.itemCompositionData.dimensions.width,r=1*e.itemCompositionData.dimensions.height
e.canvas=new OffscreenCanvas(o,r),e.sub_compositionManager.load(e.canvas),e.createCanvasTexture(),e.sub_compositionManager.buildComposition(function(){e.checkHasAudio(),e.doMesh(),e.addToScene(),e.onReady()})}}createCanvasTexture(){var e=this
e.canvasTexture&&(e.canvasTexture.dispose(),e.canvasTexture=null),e.canvasTexture=new THREE.CanvasTexture(e.canvas),e.canvasTexture.needsUpdate=!0,e.materials[0].map=e.canvasTexture,e.materials[0].needsUpdate=!0}createDataTexture(e,t){var o=this
console.log("++ create data texture",e,t)
new Uint8Array(4*(e*t))
o.dataTexture=new THREE.FramebufferTexture(e,t),o.materials[0].map=o.dataTexture,o.materials[0].needsUpdate=!0}copyRenderToTexture(e,t,o){console.log("copyRenderToTexture",this.name),console.log(t,o)
var r=this
r.dataTexture||r.createDataTexture(t,o),e.copyFramebufferToTexture(r.dataTexture,new THREE.Vector2(0,0)),r.dataTexture.needsUpdate=!0}doTextureFromRenderTarget(e,t,o){}resizeCompositionItemCanvas(){var e=this
if(e.isMissing)return
if(e.ignored)return
if(e.isDestroyed)return
if(e.lastRenderFrameIndex=-1,e.sub_compositionManager.resizeCanvas(),_config.useRenderersManager)return
const t=e.sub_compositionManager.renderEngine.getRenderSize()
var o=t.width,r=t.height
if(e.currentSize.width!=o||e.currentSize.height!=r)if(e.currentSize.width=o,e.currentSize.height=r,e.useRenderTarget)e.renderTarget.setSize(o,r)
else{if(e.canvas.width=o,e.canvas.height=r,_config.useDataTexture)return void e.createDataTexture(o,r)
e.createCanvasTexture()}}getReadyToRender(e){var t=this
t.sub_compositionManager.renderEngine.renderer||(console.log("requestRender BUT there is no R"),t.sub_compositionManager.renderEngine.createRendererForSub(),t.sub_compositionManager.resizeCanvas()),t.refreshItemComposition(e,function(){t.onReadyTorender()})}refreshItemComposition(e,t=null){var o=this
if(!o.isMissing){var r=o.itemData.time,n=e-r.in+r.trackIn,i=o.compositionManager.frameRate,a=o.sub_compositionManager.frameRate
n=Math.floor(n*a/i)
var l,s=0,c=r.in-r.trackIn
for(l=c;l<e;l++)s+=o.getParamValueAt(l,"speed")
var u=0
if(u=e-c!=0?s/(e-c):o.getParamValueAt(e,"speed"),n=Math.floor(n*u/100),o.itemData.repeat&&o.itemData.repeat.enabled){var m=1*o.itemData.repeat.end-1
n>m&&(n%=m+1)}if(o.lastRenderFrameIndex!=n){o.lastRenderFrameIndex=n,n<0&&(n=0),o.sub_compositionManager.refreshComposition(n)
o.sub_compositionManager.getReadyToRender(function(){if(o.useRenderTarget){console.warn("LOG RENDER B")
var e=o.renderTarget,r=o.sub_compositionManager.renderEngine
window._canvasDebugY=800,r.addToCanvasDebug("target B",0,e),o.renderTarget.texture.needsUpdate=!0,r.renderer.setRenderTarget(null)}else o.canvasTexture.needsUpdate=!0
t.call(this,o.itemData)})}else t.call(this,o.itemData)}}updateInOutFrames(e=!0){}cacheComposition(){console.log("CACHE COMP",this.name)}destroyItemComposition(){var e=this
e.canvas&&(e.canvas=null),e.canvasTexture&&(e.canvasTexture.dispose(),e.canvasTexture=void 0),e.sub_compositionManager&&(e.sub_compositionManager.close(),e.sub_compositionManager=void 0)}}e.default=n}),define("pikimov/classes/items/free-shape-item",["exports","pikimov/classes/items/scene-item"],function(e,t){function o(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{constructor(e,t,r){super(e,t,r),o(this,"svgString",null),o(this,"svgHandles",null),o(this,"SVGLoader",null),o(this,"comParent",null),o(this,"domSVG",null),o(this,"domHandlesLines",[]),o(this,"domGhost",null),o(this,"points",[]),o(this,"maxPoints",50),o(this,"mouseStart",{}),o(this,"mouse",{}),o(this,"startPointPosition",{}),o(this,"startH1Position",{}),o(this,"startH2Position",{}),o(this,"isDraggingPoint",!1),o(this,"isDraggingHandle1",!1),o(this,"isDraggingHandle2",!1),o(this,"draggedIndex",0),o(this,"pathMaxDistance",8)
var n=this
if(n.currentBuildParams={},n.materials[0]=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,transparent:!0}),n.SVGLoader=new SVGLoader,n.itemData.params[2])n.points=n.getCurrentPointsValues()
else{n.points=[{p:[-100,-100],h1:[-120,-50],h2:[-50,-120]},{p:[100,-100],h1:[50,-120],h2:[120,-50]},{p:[100,100],h1:[120,50],h2:[50,120]},{p:[-100,100],h1:[-50,120],h2:[-120,50]}],n.itemData.params[2]={name:"points"},n.saveToJson()}"3D"!=n.cameraType&&n.controlsHandles&&n.setupEditor(n.controlsHandles.domHandles)}setupEditor(e){var t=this
console.log("shape - setup editor:",t.name),t.domParent=e,t.addEventHandlers()}rebuildShape(){var e=this
e.points=e.getCurrentPointsValues(),e.svgHandles&&(e.svgHandles.remove(),e.svgHandles=null,e.domSVG.remove(),e.domSVG=null),e.updateSVGHandles(),e.doMeshAndAddToHook(),e.compositionManager.requestRender()}updateMesh(){var e=this
e.isDraggingPoint||e.isDraggingHandle1||e.isDraggingHandle2||(e.points=e.getCurrentPointsValues(),e.doMeshAndAddToHook())}buildItem(){var e=this
e.doMesh(),e.addToScene(),e.onReady()}getCurrentPointsValues(){var e=this.getParamValueAt(this.frameIndex,"points")
return structuredClone(e)}updateShapeParams(){var e=!1
return this.threejsObj||(e=!0),e}doMesh(){var e=this
e.destroyObj()
var t=e.pointsToSVG(e.points,1).g
t=t.replace('fill="rgba(0,0,0,0)"',""),e.svgString="<svg>"+t+"</svg>"
var o=e.SVGToMesh(e.svgString)
o.children[0].material=e.materials[0],e.threejsObj=o,e.saveGeometry()}pointsToSVG(e,t){var o=0,r=`M ${e[o].p[0]*t} ${e[o].p[1]*t}`
for(r+=this.onePointToSVG(e,0,t),o=1;o<e.length;o++){r+=this.onePointToSVG(e,o,t)}return{g:`<g><path d="${r}" fill="rgba(0,0,0,0)" stroke="#ff33cc" stroke-width="0" /></g>`,d:r}}onePointToSVG(e,t,o){var r=e[t],n=e[t+1]
n||(n=e[0])
var i=r.p[0],a=r.p[1],l=n.p[0],s=n.p[1],c=r.h2,u=n.h1
if(!r.h2)c=[i,a]
if(!n.h1)u=[l,s]
return` C ${c[0]*o} ${c[1]*o}, ${u[0]*o} ${u[1]*o}, ${l*=o} ${s*=o}`}SVGToMesh(e){const t=(new DOMParser).parseFromString(e,"image/svg+xml").querySelectorAll("g")
if(0==t.length)return new THREE.Object3D
var o,r,n,i=new THREE.Group
for(o=0;o<t.length;o++){var a=t[o].outerHTML
const e=this.SVGLoader.parse(a).paths
for(r=0;r<e.length;r++){const t=SVGLoader.createShapes(e[r])
for(n=0;n<t.length;n++){const e=new THREE.ShapeGeometry(t[n],32)
e.deleteAttribute("uv"),e.deleteAttribute("normal"),e.rotateX(Math.PI)
const o=new THREE.Mesh(e,this.materials[0])
i.add(o)}}}return i}createSVGHandles(){var e=this,t=e.domParent,o=document.querySelector("#overCanvas")
e.svgHandles=document.createElement("div"),e.svgHandles.className="SVGHandles",e.svgHandles.setAttribute("data-compuid",e.compUid),e.points.forEach(function(t,r){var n=document.createElement("div")
n.className="divShapePointHandle h1",e.svgHandles.appendChild(n)
var i=document.createElement("div")
i.className="divShapePointHandle h2",e.svgHandles.appendChild(i)
var a=document.createElement("div")
a.className="divShapePoint",e.svgHandles.appendChild(a),$(a).on("mousedown",function(t){if("convertPoint"!=e.controller.toolbarUtils.currentTool){if("removePoint"!=e.controller.toolbarUtils.currentTool){var n=$(o).offset()
e.mouseStart={x:t.clientX-o.scrollLeft-n.left,y:t.clientY-o.scrollTop-n.top},e.isDraggingPoint=!0,e.draggedIndex=r
var i=e.getCurrentPointsValues()[r]
return e.startPointPosition={x:i.p[0],y:i.p[1]},i.h1&&(e.startH1Position={x:i.h1[0],y:i.h1[1]}),i.h2&&(e.startH2Position={x:i.h2[0],y:i.h2[1]}),!1}e.removePoint(r)}else e.convertPoint(r)}),$(n).on("mousedown",function(t){var n=$(o).offset()
e.mouseStart={x:t.clientX-o.scrollLeft-n.left,y:t.clientY-o.scrollTop-n.top},e.isDraggingHandle1=!0,e.draggedIndex=r
var i=e.getCurrentPointsValues()[r]
return e.startH1Position={x:i.h1[0],y:i.h1[1]},!1}),$(i).on("mousedown",function(t){var n=$(o).offset()
e.mouseStart={x:t.clientX-o.scrollLeft-n.left,y:t.clientY-o.scrollTop-n.top},e.isDraggingHandle2=!0,e.draggedIndex=r
var i=e.getCurrentPointsValues()[r]
return e.startH2Position={x:i.h2[0],y:i.h2[1]},!1})}),t.appendChild(e.svgHandles),e.domSVG=document.createElementNS("http://www.w3.org/2000/svg","svg"),e.domSVG.setAttribute("class","itemPath"),t.appendChild(e.domSVG),e.domGhost=document.createElement("span"),e.domGhost.className="freeShape_ghost",e.svgHandles.appendChild(e.domGhost)}updateSVGHandles(){var e=this
e.svgHandles||e.createSVGHandles()
var t=e.getParamByName("points")
t.useKeyframes&&(t.keyframes.some(function(t){return t.frame==e.frameIndex})?$(e.svgHandles).show():$(e.svgHandles).hide())
var o=e.getZoomfactor(),r=e.getTransformAt(e.frameIndex),n=Math.abs(r.scale.x/100),i=Math.abs(r.scale.y/100)
e.svgHandles.querySelectorAll(".divShapePoint").forEach(function(t,r){var a=e.points[r]
a||(console.log("error free shape point is undefined",r),console.log(e.points),console.log("isDestroyed",e.isDestroyed),console.log("isReady",e.isReady),console.log(e.cameraType)),t.style.left=a.p[0]*o*n+"px",t.style.top=a.p[1]*o*i+"px"}),e.svgHandles.querySelectorAll(".divShapePointHandle.h1").forEach(function(t,r){var a=e.points[r]
a.h1?(t.style.left=a.h1[0]*o*n+"px",t.style.top=a.h1[1]*o*i+"px"):t.style.display="none"}),e.svgHandles.querySelectorAll(".divShapePointHandle.h2").forEach(function(t,r){var a=e.points[r]
a.h2?(t.style.left=a.h2[0]*o*n+"px",t.style.top=a.h2[1]*o*i+"px"):t.style.display="none"})
var a=structuredClone(e.points)
a.forEach(function(e){e.p[0]*=n,e.p[1]*=i,e.h1&&(e.h1[0]*=n,e.h1[1]*=i),e.h2&&(e.h2[0]*=n,e.h2[1]*=i)})
var l=e.domSVG,s=e.pointsToSVG(a,o),c=s.g
c=c.replace('stroke-width="0"','stroke-width="1"')
var u=s.g
u=(u=u.replace('stroke-width="0"','stroke-width="18"')).replace('stroke="#ff33cc"','stroke="transparent"')
var m=l.querySelectorAll("path")[0],p=l.querySelectorAll("path")[1]
if(m){var d=s.d
d=d.replace('stroke-width="0"','stroke-width="1"')
var f=s.d
f=(f=f.replace('stroke-width="0"','stroke-width="18"')).replace('stroke="#ff33cc"','stroke="transparent"'),m.setAttribute("d",s.d),p.setAttribute("d",f)}else{l.innerHTML=c+u
p=l.querySelectorAll("path")[1]
"3D"==e.cameraType&&(p.style.fill="rgba(200, 200, 200, .4)"),p.addEventListener("click",t=>{e.onPathClick(t)})}function v(t,o,r){e.domHandlesLines[t]&&(e.domHandlesLines[t].remove(),e.domHandlesLines[t]=null),e.domHandlesLines[t]=document.createElement("div")
var n=e.domHandlesLines[t]
n.className="line"
const i=r.x-o.x,a=r.y-o.y,l=Math.sqrt(i*i+a*a),s=180*Math.atan2(a,i)/Math.PI
n.style.width=l+"px",n.style.transform=`translate(${o.x}px, ${o.y}px) rotate(${s}deg)`,e.svgHandles.appendChild(n)}a.forEach(function(e,t){var r=e.p[0]*o,n=e.p[1]*o
e.h1&&v(2*t,{x:r,y:n},{x:e.h1[0]*o,y:e.h1[1]*o})
e.h2&&v(2*t+1,{x:r,y:n},{x:e.h2[0]*o,y:e.h2[1]*o})})}addEventHandlers(){this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}onMouseMove(e){var t=this,o=e.clientX,r=e.clientY
if("addPoint"==t.controller.toolbarUtils.currentTool&&t.isSelected&&t.domSVG){var n=t.getPointAndDistance(o,r),i=n.svgPoint,a=$(t.domGhost)
if(n.minDistance<t.pathMaxDistance){var l=t.getTransformAt(t.frameIndex),s={x:Math.round(i.x/l.scale.x*100),y:Math.round(i.y/l.scale.y*100)}
"3D"==t.cameraType&&(s.x=Math.round(i.x),s.y=Math.round(i.y)),a.css({left:s.x+"px",top:s.y+"px"}),a.show()}else a.hide()}if(t.isDraggingPoint||t.isDraggingHandle1||t.isDraggingHandle2){var c=document.querySelector("#overCanvas"),u=$(c).offset()
t.mouse={x:o-c.scrollLeft-u.left,y:r-c.scrollTop-u.top}
var m=new geoUtils(t.controller,t),p=m.getLocalMouseDelta(t.mouseStart,t.mouse)
if(m=null,"3D"==t.cameraType){l=t.getTransformAt(t.frameIndex);(p={x:t.mouse.x-t.mouseStart.x,y:-1*(t.mouse.y-t.mouseStart.y)}).x*=100/l.scale.x,p.y*=100/l.scale.y}var d=t.points[t.draggedIndex]
return t.isDraggingPoint&&(d.p=[Math.round(t.startPointPosition.x+p.x),Math.round(t.startPointPosition.y-p.y)]),d.h1&&(t.isDraggingPoint||t.isDraggingHandle1)&&(d.h1=[Math.round(t.startH1Position.x+p.x),Math.round(t.startH1Position.y-p.y)]),d.h2&&(t.isDraggingPoint||t.isDraggingHandle2)&&(d.h2=[Math.round(t.startH2Position.x+p.x),Math.round(t.startH2Position.y-p.y)]),t.updateSVGHandles(),t.doMeshAndAddToHook(),t.compositionManager.requestRender(),!1}}onMouseUp(e){var t=this
return!!(t.isDraggingPoint||t.isDraggingHandle1||t.isDraggingHandle2)&&(t.isDraggingPoint=!1,t.isDraggingHandle1=!1,t.isDraggingHandle2=!1,t.saveToJson(),t.controller.addToHistory("item","edit shape point",{needRebuild:!0}),!1)}onPathClick(e){var t=this
if("addPoint"==t.controller.toolbarUtils.currentTool){var o=e.clientX,r=e.clientY,n=t.getPointAndDistance(o,r),i=n.svgPoint,a=n.minDistance,l=n.closestSegment.index
if(a<t.pathMaxDistance){var s=t.getZoomfactor(),c=t.getTransformAt(t.frameIndex),u={x:Math.round(i.x/s/c.scale.x*100),y:Math.round(i.y/s/c.scale.y*100)}
t.addPoint(u,l)}}}addPoint(e,t){var o=this
if(!(o.points.length>=o.maxPoints)){var r=o.getParamByName("points"),n={p:[e.x,e.y]}
r.value.splice(t,0,n),o.createHandles(r.value,t)
var i=r.keyframes
i&&i.forEach(function(r){var n={p:[e.x,e.y]}
r.values.p.splice(t,0,n),o.createHandles(r.values.p,t)}),o.rebuildShape(),o.controller.addToHistory("item","add shape point",{needRebuild:!0})}}createHandles(e,t){var o=e[t],r=e[t-1]
r||(r=e[e.length-1])
var n=e[t+1]
n||(n=e[0])
var i=Math.round((.6*r.p[0]+1.4*o.p[0])/2),a=Math.round((.6*r.p[1]+1.4*o.p[1])/2)
o.h1=[i,a]
i=Math.round((.6*n.p[0]+1.4*o.p[0])/2),a=Math.round((.6*n.p[1]+1.4*o.p[1])/2)
o.h2=[i,a]}removePoint(e){var t=this
if(!(t.points.length<=3)){var o=t.getParamByName("points")
o.value.splice(e,1)
var r=o.keyframes
r&&r.forEach(function(t){t.values.p.splice(e,1)}),t.rebuildShape(),t.controller.addToHistory("item","delete shape point",{needRebuild:!0})}}convertPoint(e){var t=this
console.log("convert point #",e)
var o=t.getParamByName("points")
function r(e,o){var r=e[o]
r.h1?(delete r.h1,delete r.h2):t.createHandles(e,o)}r(o.value,e)
var n=o.keyframes
n&&n.forEach(function(t){r(t.values.p,e)}),t.rebuildShape(),t.controller.addToHistory("item","convert shape point",{needRebuild:!0})}getZoomfactor(){var e=this.controller.compositionDisplayZoom/100
return"3D"==this.cameraType&&(e=1),e}getPointAndDistance(e,t){var o=this.domSVG
const r=o.createSVGPoint()
function n(e,t,o){const r=o.x-t.x,n=o.y-t.y
if(0===r&&0===n)return Math.hypot(e.x-t.x,e.y-t.y)
const i=((e.x-t.x)*r+(e.y-t.y)*n)/(r*r+n*n),a=Math.max(0,Math.min(1,i)),l={x:t.x+a*r,y:t.y+a*n}
return{distance:Math.hypot(e.x-l.x,e.y-l.y),closestPoint:l}}r.x=e,r.y=t
var i=function(e){const t=[],o=e.match(/[a-zA-Z]|-?\d*\.?\d+(?:e[-+]?\d+)?/g)
if(!o)return[]
let r=0,n={x:0,y:0},i={x:0,y:0}
function a(){return parseFloat(o[r++])}for(;r<o.length;){let e=o[r++]
const l=e===e.toLowerCase()
e=e.toUpperCase()
let s=[]
for(;r<o.length&&!isNaN(parseFloat(o[r]));)s.push(a())
let c=0
for(;c<s.length;){const o={type:e}
switch(e){case"M":{const t=s[c++],r=s[c++]
n=l?{x:n.x+t,y:n.y+r}:{x:t,y:r},o.x=n.x,o.y=n.y,i={...n},e="L"
break}case"L":{const e=s[c++],t=s[c++]
n=l?{x:n.x+e,y:n.y+t}:{x:e,y:t},o.x=n.x,o.y=n.y
break}case"C":{const e=s[c++],t=s[c++],r=s[c++],i=s[c++],a=s[c++],u=s[c++]
o.cp1=l?{x:n.x+e,y:n.y+t}:{x:e,y:t},o.cp2=l?{x:n.x+r,y:n.y+i}:{x:r,y:i},n=l?{x:n.x+a,y:n.y+u}:{x:a,y:u},o.x=n.x,o.y=n.y
break}case"Z":o.x=i.x,o.y=i.y,n={...i}
break
default:console.warn(`Unsupported command: ${e}`),c=s.length
continue}t.push(o)}}return t}(o.querySelector("path").getAttribute("d")),a=r.matrixTransform(o.getScreenCTM().inverse())
let l=1/0,s=null,c=null
return i.forEach((e,t)=>{if("M"===e.type)c={x:e.x,y:e.y}
else if("L"===e.type){const o=c,r={x:e.x,y:e.y},i=n(a,o,r)
i.distance<l&&(l=i.distance,s={type:"L",from:o,to:r,index:t}),c=r}else if("C"===e.type){const o=function(e,t,o,r,n=20){const i=[]
for(let a=0;a<=1;a+=1/n){const n=Math.pow(1-a,3)*e.x+3*Math.pow(1-a,2)*a*t.x+3*(1-a)*a*a*o.x+a*a*a*r.x,l=Math.pow(1-a,3)*e.y+3*Math.pow(1-a,2)*a*t.y+3*(1-a)*a*a*o.y+a*a*a*r.y
i.push({x:n,y:l})}return i}(c,e.cp1,e.cp2,{x:e.x,y:e.y},20)
for(let r=0;r<o.length-1;r++){const i=o[r],u=o[r+1],m=n(a,i,u)
m.distance<l&&(l=m.distance,s={type:"C",from:c,to:{x:e.x,y:e.y},cp1:e.cp1,cp2:e.cp2,index:t})}c={x:e.x,y:e.y}}}),{svgPoint:a,minDistance:l,closestSegment:s}}saveToJson(){var e=this,t=e.getParamByName("points"),o=structuredClone(e.points)
if(t.useKeyframes){var r=null
t.keyframes.forEach(function(t){t.frame==e.frameIndex&&(r=t)}),r?r.values.p=o:console.error("ERROR NO KEY")}else t.value=o}destroyItemFreeShape(){var e=this
document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp),e.svgHandles&&(e.svgHandles.remove(),e.svgHandles=null),e.domSVG&&(e.domSVG.remove(),e.domSVG=null),e.domGhost&&(e.domGhost.remove(),e.domGhost=null),e.domHandlesLines.length&&e.domHandlesLines.forEach(function(e){e.remove(),e=null}),e.controller.emberSet(e.controller,"isFreeShapeEditorOpen",!1)}}e.default=r}),define("pikimov/classes/items/group-item",["exports","pikimov/classes/items/scene-item"],function(e,t){function o(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{constructor(e,t,r){super(e,t,r),o(this,"gizmoMaterial",null),o(this,"gizmo",null)
this.gizmoMaterial=new LineMaterial({linewidth:3,alphaToCoverage:!0,side:THREE.DoubleSide})}buildItem(){var e=this
e.doMeshGroup(),e.addToScene(),e.onReady()}doMeshGroup(){var e=this
e.threejsObj||(e.threejsObj=new THREE.Group),e.needGizmo&&(e.doGizmo(),e.threejsObj.add(e.gizmo))}doGizmo(){var e=this,t=20
"3D"==e.cameraType&&(t=30)
var o=[-1*t,0,0,t,0,0],r=[0,-1*t,0,0,t,0],n=[0,0,-1*t,0,0,t],i=e.gizmoMaterial
const a=new LineGeometry
a.setPositions(o)
var l=new Line2(a,i)
l.userData.isGizmo=!0
const s=new LineGeometry
s.setPositions(r)
var c=new Line2(s,i)
c.userData.isGizmo=!0
const u=new LineGeometry
u.setPositions(n)
var m=new Line2(u,i)
m.userData.isGizmo=!0,e.gizmo=new THREE.Group,e.gizmo.name="group gizmo",e.gizmo.add(l,c,m)}getBlackAlphaMat(){var e=this
return e.blackAlphaMat||(e.blackAlphaMat=new LineMaterial({color:0,linewidth:3,alphaToCoverage:!0,transparent:!0})),e.blackAlphaMat}doMeshGroup_bad(){}destroyItemGroup(){var e=this
e.gizmo&&(e.gizmo.children[0].geometry.dispose(),e.gizmo.children[1].geometry.dispose(),e.gizmo.children[2].geometry.dispose())}}e.default=r}),define("pikimov/classes/items/image-item",["exports","pikimov/classes/items/scene-item"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class o extends t.default{constructor(e,t,o){super(e,t,o)}async buildItem(){var e=this
e.materials[0]=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,transparent:!0,alphaTest:.02}),e.texture=e.libManagerItem.texture,e.materials[0].map=e.texture,e.doMesh(),e.addToScene(),e.onReady()}}e.default=o}),define("pikimov/classes/items/image-sequence-item",["exports","pikimov/classes/items/scene-item"],function(e,t){function o(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{constructor(e,t,r){super(e,t,r),o(this,"nbFrames",0)
var n=this
n.nbFrames=n.libManagerItem.itemData.nbFiles,n.updateMaxFrames()}buildItem(){var e=this
e.materials[0]=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,transparent:!0,alphaTest:.02})
var t=e.getFileData()
e.texture=new THREE.Texture(t[0]),e.materials[0].map=e.texture,e.doMesh(),e.addToScene(),e.onReady()}getReadyToRender(e){var t=this
if(t.itemData.repeat&&t.itemData.repeat.enabled){var o=1*t.itemData.repeat.end-1
e>o&&(e%=o+1)}t.requestFrame(e),t.updateTexture(),t.onReadyTorender()}requestFrame(e){var t=this,o=t.getFileData(),r=t.getSequenceFrameIndex(e)
r>o.length?console.log("seq out of time"):(t.texture.image=o[r],t.texture.needsUpdate=!0)}getSequenceFrameIndex(e){var t,o=this,r=o.itemData.time,n=o.compositionData.frameRate,i=(e-r.in+r.trackIn)/n*n,a=0,l=r.in-r.trackIn
for(t=l;t<e;t++)a+=o.getParamValueAt(t,"speed")
var s=0
return s=e-l!=0?a/(e-l):o.getParamValueAt(e,"speed"),(i=Math.floor(i*s/100))<0&&(i=0),i}updateTexture(){}}e.default=r}),define("pikimov/classes/items/light-item",["exports","pikimov/classes/items/scene-item"],function(e,t){function o(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{constructor(e,t,r){super(e,t,r),o(this,"gizmoMaterial",null),o(this,"gizmo",null),o(this,"lightType",null),o(this,"lightHelper",null),o(this,"lightTargetObject",null)
var n=this
n.lightType=n.getParamValueAt(0,"light type"),n.gizmoMaterial=new THREE.MeshBasicMaterial}buildItem(){this.doMeshLight(),this.onReady()}doMeshLight(){var e=this
if(!e.threejsObj){if("point"==e.lightType&&(e.threejsObj=new THREE.PointLight),"spot"==e.lightType&&(e.threejsObj=new THREE.SpotLight),"sun"==e.lightType&&(e.threejsObj=new THREE.DirectionalLight),e.itemData.shadows&&e.itemData.shadows.enabled){var t=e.compositionManager.renderEngine.renderer
t.shadowMap.enabled=!0,t.shadowMap.type=THREE.PCFSoftShadowMap,(n=e.threejsObj).castShadow=!0,n.shadow.mapSize.width=1024,n.shadow.mapSize.height=1024,n.shadow.camera.near=.05,n.shadow.camera.far=1e3}e.addToScene()}if(e.needGizmo){var o=new THREE.OctahedronGeometry(20)
if(e.gizmo=new THREE.Mesh(o,e.gizmoMaterial),e.gizmo.name="light gizmo",e.gizmo.userData.isGizmo=!0,e.threejsObj.add(e.gizmo),"spot"==e.lightType){var r=new THREE.Group
r.name="light target group",r.userData.isGizmo=!0,e.threejsObj.add(r),r.position.set(0,-50,0),e.lightTargetObject=r,e.threejsObj.target=e.lightTargetObject}var n=e.threejsObj
e.lightHelper&&e.destroyLightHelper(),"point"==e.lightType&&(e.lightHelper=new THREE.PointLightHelper(n,.1)),"spot"==e.lightType&&(e.lightHelper=new THREE.SpotLightHelper(n,.1)),"sun"==e.lightType&&(e.lightHelper=new THREE.DirectionalLightHelper(n,.1)),e.lightHelper.name="LightHelper",e.compositionManager.scene.add(e.lightHelper),e.lightHelper.update()}}updateLightType(){var e=this,t=e.getParamValueAt(0,"light type")
e.lightType=t
var o=e.getParamByName("angle")
"point"==e.lightType&&(o.hidden=!0,e.itemData.rotation.hidden=!0),"spot"==e.lightType&&(o.hidden=void 0,e.itemData.rotation.hidden=void 0),"sun"==e.lightType&&(o.hidden=!0,e.itemData.rotation.hidden=!0)}updateLight(){var e=this,t=e.frameIndex,o=e.getParamValueAt(t,"intensity")
if("point"==e.lightType&&(o*=1e3),"spot"==e.lightType&&(o*=1e3),e.threejsObj.intensity=1*o,e.threejsObj.distance=0,"spot"==e.lightType){o=e.getParamValueAt(t,"angle")
e.threejsObj.angle=THREE.MathUtils.degToRad(o)}o=e.getParamValueAt(t,"color")
var r=valueToSRGB(o)
e.threejsObj.color=r,e.gizmoMaterial.color=r,e.lightHelper&&(e.lightHelper.color=r,e.lightHelper.update())}setGizmoVisibility(e){var t=this
t.gizmo&&(t.gizmo.visible=e,t.lightHelper.visible=e)}destroyLightHelper(){var e=this
e.lightHelper.parent.remove(e.lightHelper),e.lightHelper.dispose(),e.lightHelper=null}enableAllLayers(){this.threejsObj.layers.enableAll()}}e.default=r}),define("pikimov/classes/items/model-item",["exports","pikimov/classes/items/scene-item","@sentry/ember"],function(e,t,o){function r(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class n extends t.default{constructor(e,t,o){super(e,t,o),r(this,"gltfObject",null)}buildItem(){var e=this,t=new GLTFLoader,r=e.libManagerItem.dracoLoader,n=e.libManagerItem.ktx2Loader
t.setCrossOrigin("anonymous").setDRACOLoader(r).setKTX2Loader(n).setMeshoptDecoder(MeshoptDecoder)
var i=e.getFileData()
try{t.parse(i,"./",function(r){e.gltfObject=r.scene,e.gltfObject||o.captureMessage("error model no gltfObject",{extra:{compUid:e.compUid,name:e.name,isReady:e.isReady,isMissing:e.isMissing,libManagerItem:e.libManagerItem}}),e.isReady?(e.doMesh(),e.controller.refreshAndRender()):e.onModelLoaded(),t=null},function(e){})}catch(a){console.log(a),o.captureMessage("error happened while loading 3D model",{extra:{name:e.name,error:a,libManagerItem:e.libManagerItem}}),alert("An error happened while loading 3D model")}}onModelLoaded(){var e=this
e.doMesh(),e.addToScene(),e.onReady()}doMesh(){var e=this
e.destroyObj()
var t=e.libManagerItem.itemData.preScale
e.gltfObject.scale.set(t,t,t),e.threejsObj=e.gltfObject,e.threejsObj||o.captureMessage("error model no threejsObj",{extra:{compUid:e.compUid,name:e.name,isReady:e.isReady,isMissing:e.isMissing,cameraType:e.cameraType,libManagerItem:e.libManagerItem}}),e.saveGeometry()}updateModel(){}convertToBasicMaterials(){this.threejsObj.traverse(e=>{if(e.isMesh&&e.material){const t=(Array.isArray(e.material)?e.material:[e.material]).map(e=>{const t=new THREE.MeshBasicMaterial
return e.map&&(t.map=e.map),e.alphaMap&&(t.alphaMap=e.alphaMap),e.aoMap&&(t.aoMap=e.aoMap),e.emissiveMap&&(t.emissiveMap=e.emissiveMap),e.lightMap&&(t.lightMap=e.lightMap),e.specularMap&&(t.specularMap=e.specularMap),e.envMap&&(t.envMap=e.envMap),t.color.copy(e.color),t.transparent=e.transparent,t.opacity=e.opacity,t.side=e.side,t})
e.material=Array.isArray(e.material)?t:t[0]}})}revertMaterials(){this.buildItem()}getObjectClone(){var e=this
return e.objectClone||(e.objectClone=e.threejsObj.clone()),e.objectClone}getBlackAlphaMat(){var e=this
if(!e.blackAlphaMat){function t(e){var t=e.clone()
return t.aoMap=null,t.emissiveMap=null,t.normalMap=null,t.envMap=null,void 0!==t.emissive&&t.emissive.set(0,0,0),t.color&&t.color.set(0,0,0),t.transparent=!0,t}e.blackAlphaMat=[],e.threejsObj.traverse(function(o){if(o.isMesh)if(Array.isArray(o.material))o.material.forEach(function(o){var r=t(o)
e.blackAlphaMat.push(r)})
else{var r=t(o.material)
e.blackAlphaMat.push(r)}})}return e.blackAlphaMat}destroyItemModel(){this.gltfObject&&(this.gltfObject=void 0)}}e.default=n}),define("pikimov/classes/items/scene-item",["exports","pikimov/classes/managers/effect-manager","pikimov/classes/controls-handles","pikimov/classes/highlight-box","pikimov/classes/expression-engine","@ember/object","@sentry/ember"],function(e,t,o,r,n,i,a){function l(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=class{constructor(e,i,a){l(this,"controller",null),l(this,"compositionManager",null),l(this,"compositionData",null),l(this,"getters",null),l(this,"libManagerItem",null),l(this,"type",null),l(this,"name",null),l(this,"itemData",null),l(this,"compUid",null),l(this,"compIndex",0),l(this,"frameRate",0),l(this,"parentCompUid",null),l(this,"isAdded",!1),l(this,"isReady",!1),l(this,"isIgnored",!1),l(this,"isMissing",!1),l(this,"isDestroyed",!1),l(this,"loaded",!1),l(this,"texture",null),l(this,"materials",[]),l(this,"threejsHook",null),l(this,"threejsObj",null),l(this,"thumbnail",null),l(this,"frameIndex",0),l(this,"currentTransform",{}),l(this,"effectManager",null),l(this,"maxFramesInComposition",0),l(this,"controlsHandles",null),l(this,"blendPass",null),l(this,"stackIndex",0)
l(this,"cameraType",null),l(this,"highlightBox",null),l(this,"isSelected",!1),l(this,"needGizmo",!0),l(this,"curvesUtils",null),l(this,"backUpGeometry",null),l(this,"boundingBox",null),l(this,"expressionEngine",null)
var s=this
s.controller=e.controller,s.compositionManager=e,s.compositionData=s.compositionManager.compositionData,s.getters=s.controller.getters,s.itemData=i,s.name=i.name,s.compUid=i.compUid,s.type=i.type
var c=s.getters.getJsonItemParentByCompUid(s.compositionData,s.compUid)
c&&(s.parentCompUid=c.compUid),s.compIndex=a,s.layerIndex=0,s.cameraType=s.compositionManager.cameraType,s.libManagerItem=s.getters.getLibraryManagerItemByLibUid(s.itemData.libUid),s.libManagerItem&&s.libManagerItem.isMissing&&(s.isMissing=!0)
var u=s.type
if("audio"!=u&&s.libManagerItem&&s.libManagerItem.thumbnail&&(s.thumbnail=s.libManagerItem.thumbnail),s.isMissing||"camera"!=u&&"audio"!=u&&(s.effectManager=new t.default(s.compositionManager,s)),s.threejsHook=new THREE.Group,s.threejsHook.name="hook "+u+" | "+s.name,!s.isMissing&&s.compositionManager.isActive){if("2D"==s.cameraType){var m=!0
"audio"!=u&&"camera"!=u&&"cameraTarget"!=u||(m=!1),"player"==s.controller.routeName&&(m=!1),m&&(s.controlsHandles=new o.default(s.controller,s))}if("3D"==s.cameraType){var p=!0
"audio"!=u&&"group"!=u&&"camera"!=u&&"cameraTarget"!=u||(p=!1),"light"==u&&(p=!1),p&&(s.highlightBox=new r.default(s))}}s.compositionManager.isActive||(s.needGizmo=!1),s.curvesUtils=new c_curvesUtils,_config.features.expressions&&(s.expressionEngine=new n.default(s.controller,s))}refreshItemData(e){var t=this
t.itemData=e,t.effectManager&&t.effectManager.redoReferences(t),t.controlsHandles&&(t.controlsHandles.compItem=e)}updateMaxFrames(){var e=this
"video"!=e.type&&"audio"!=e.type&&"composition"!=e.type||(e.maxFramesInComposition=Math.floor(e.duration/1e3*e.compositionData.frameRate)),"imageSequence"==e.type&&(e.maxFramesInComposition=e.nbFrames)}getStripeMaxFrames(){var e=this
if("audio"==e.type)return e.maxFramesInComposition-1
var t,o=e.maxFramesInComposition,r=e.itemData.time,n=0,i=r.in-r.trackIn,a=i+20*o
for(t=i;t<a&&!((n+=e.getParamValueAt(t,"speed")/100)>o);t++);var l=t-r.in+r.trackIn-1
return l<0&&(l=0),l}getFileData(){var e=this
return e.libManagerItem?e.libManagerItem.isMissing?(console.log("error getFileData() - libItem is missing"),null):e.libManagerItem.getFileData():(console.log("error getFileData() - no libManagerItem"),null)}getCompItem(){var e=this
return e.getters.getCompItemByCompUid(e.compositionData,e.compUid)}getJsonData(){return this.itemData}getDimensionsAt(e=null){var t=this,o=t.type,r=null,n=null
if(("image"!=o&&"video"!=o&&"imageSequence"!=o&&"svg"!=o||(r=t.libManagerItem.width,n=t.libManagerItem.height),"shape"==o)&&(r=t.getParamValueAt(e,"width"),n=t.getParamValueAt(e,"height"),1==t.getParamValueAt(0,"stroke"))){var i=t.getParamValueAt(e,"stroke width")
r+=2*i,n+=2*i}if("freeShape"==o)return{width:100,height:100}
if("composition"==o&&(r=1*t.itemCompositionData.dimensions.width,n=1*t.itemCompositionData.dimensions.height),"text"==o){var a=t.getTextBoundingSize()
r=a.width,n=a.height}if("model"==o){var l=t.boundingBox
return{width:r=l.max.x-l.min.x,height:n=l.max.y-l.min.y,depth:l.max.z-l.min.z}}return"widget"==o&&(r=t.getParamValueAt(e,"width"),n=t.getParamValueAt(e,"height")),{width:r,height:n}}doMesh(){var e=this
e.destroyObj()
var t=e.getDimensionsAt(e.frameIndex),o=t.width,r=t.height
if("video"==e.type&&e.videoProperties.rotated){var n=r
r=o,o=n}var i=0
e.getParamByName("corners")&&(i=e.getParamValueAt(e.frameIndex,"corners"))
var a=new shapeItemMesh(e.itemData)
e.threejsObj=a.getMesh({width:o,height:r,corners:i,needSubdivisions:e.needSubdivisions}),"video"==e.type&&e.flipGeometry(),e.threejsObj.material=e.materials[0],e.saveGeometry()}doMeshAndAddToHook(){this.doMesh(),this.addObjToHook()}saveGeometry(){var e=this
e.boundingBox||e.refreshBoundingBox(),e.disposeBackUpGeometry(),e.backUpGeometry=[],e.threejsObj.traverse(t=>{if(t.geometry){const o=t.geometry.clone()
e.backUpGeometry.push(o)}})}applyBackUpGeometry(){var e=this
if(e.threejsObj){var t=0
e.threejsObj.traverse(o=>{o.geometry&&(o.geometry.dispose(),o.geometry=e.backUpGeometry[t],t++)})}}disposeBackUpGeometry(){var e=this
e.backUpGeometry&&(e.backUpGeometry.forEach(function(e){e.dispose()}),e.backUpGeometry=null)}refreshBoundingBox(){var e=this,t=e.threejsObj.clone(!0)
t.position.set(0,0,0),t.rotation.set(0,0,0),t.scale.set(1,1,1),"model"==e.type&&t.children[0].scale.setScalar(e.libManagerItem.itemData.preScale),e.boundingBox=(new THREE.Box3).setFromObject(t),t.traverse(e=>{e.geometry&&e.geometry.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach(e=>e.dispose()):e.material.dispose())}),t=null}addToScene(){var e=this
if(!e.isAdded){var t=e.compositionManager.scene
if(e.parentCompUid)t=e.getParent().threejsHook
e.threejsObj&&e.addObjToHook(),t.add(e.threejsHook),e.isAdded=!0}}addObjToHook(){var e=this
e.threejsObj.name=e.name,e.threejsObj.userData.compUid=e.compUid,e.threejsObj.parent!=e.threejsHook&&e.threejsHook.add(e.threejsObj)}setLayer(e){var t=this
t.threejsObj&&(t.layerIndex=e,t.threejsObj.traverse(function(e){e.layers.set(t.layerIndex)}))}disableAllLayers(){this.threejsObj&&this.threejsObj.traverse(function(e){e.layers.disableAll()})}addEffect(e){var t=this
t.effectManager.resetEffects()
var o=[...t.itemData.effects,e];(0,i.set)(t.itemData,"effects",o),t.effectManager.createEffectsArray(),"model"!=t.type&&"text"!=t.type&&"widget"!=t.type&&"group"!=t.type&&t.doMeshAndAddToHook(),t.controller.addToHistory("item","add effect",{needRebuild:!0})}removeEffect(e){var t=this
t.effectManager.removeEffect(e),t.effectManager.createEffectsArray(),t.controller.refreshAndRender(),t.controller.addToHistory("effect","remove effect",{needRebuild:!0})}doMeshAndSetReady(){var e=this
e.doMesh(),e.addToScene(),e.isReady=!0}onReady(){var e=this
e.isReady=!0,e.compositionManager||(console.log("*error* sentry item onReady, no c.compositionManager"),console.log("name",e.name,"type",e.type),console.log("isDestroyed",e.isDestroyed),console.log("isCompositionReady",e.controller.isCompositionReady)),e.compositionManager.compositionBuilder.onOneItemReady(e.compUid)}onSelected(){var e=this
if((0,i.set)(e,"isSelected",!0),e.controlsHandles&&e.controlsHandles.selectItem(),"shape"==e.type&&e.setGizmoVisibility(!0),"3D"==e.cameraType){if(e.highlightBox){e.highlightBox.addBox()
var t=e.controller.currentFrame
e.highlightBox.update(t)}"group"==e.type&&e.updateGizmoColor(),"camera"==e.type&&e.updateGizmoColor(),"cameraTarget"==e.type&&e.updateGizmoColor()}}onDeselected(){var e=this
if((0,i.set)(e,"isSelected",!1),e.controlsHandles&&e.controlsHandles.deselectItem(),"shape"==e.type&&e.setGizmoVisibility(!1),"3D"==e.cameraType){if(e.highlightBox){var t=e.controller.currentFrame
e.highlightBox.updateVisibility(t)}"group"==e.type&&e.updateGizmoColor(),"camera"==e.type&&e.updateGizmoColor(),"cameraTarget"==e.type&&e.updateGizmoColor()}}rebuild(){var e=this,t=e.type
if("group"!=t&&"light"!=t)if("text"!=t)"freeShape"==t&&e.updateColor(),"widget"!=t?"shape"!=t&&"image"!=t&&"video"!=t&&"imageSequence"!=t&&"composition"!=t&&"model"!=t?(console.log("OBS - do mesh ",e.type,e.name),e.doMeshAndSetReady()):e.doMeshAndAddToHook():e.doMeshWidget()
else if(e.updateColor(),_config.troikaText)e.doMeshText(),setTimeout(()=>{e.compositionManager.getReadyToRender()},20)
else{var o=e.getFontValue()
e.loadFont(function(){e.doMeshText(),e.compositionManager.getReadyToRender()},o)}}getReadyToRender(e){this.onReadyTorender()}onReadyTorender(){this.compositionManager.onOneItemReadyToRender(this)}get needSubdivisions(){var e=!1
return this.itemData.effects.forEach(function(t){_effects.forEach(function(o){o.type==t.type&&o.needSubdivisions&&(e=!0)})}),e}updateColor(){var e=this
if("text"==e.type){var t=e.getParamValueAt(e.frameIndex,"color")
e.materials[0].color=valueToSRGB(t)}if("freeShape"==e.type){t=e.getParamValueAt(e.frameIndex,"color")
e.materials[0].color=valueToSRGB(t)}}updateGizmoColor(){var e=this,t=16777215
e.isSelected&&(t=48614)
var o=valueToSRGB(t)
e.materials[0]&&(e.materials[0].color=o),e.gizmoMaterial&&(e.gizmoMaterial.color=o)}getWhiteAlphaMat(){var e=this
if(!e.whiteAlphaMat){var t=e.materials[0].clone()
t.aoMap=null,t.emissiveMap=null,t.normalMap=null,t.envMap=null,t.onBeforeCompile=e=>{e.fragmentShader=e.fragmentShader.replace("#include <alphatest_fragment>","if(diffuseColor.a < 0.02)discard;diffuseColor = vec4(1.0,1.0,1.0,diffuseColor.a);")},void 0!==t.emissive&&t.emissive.set(1,1,1),e.whiteAlphaMat=t}return e.whiteAlphaMat}getBlackAlphaMat(){var e=this
if(!e.blackAlphaMat){var t=e.materials[0].clone()
t.aoMap=null,t.emissiveMap=null,t.normalMap=null,t.envMap=null,void 0!==t.emissive&&t.emissive.set(0,0,0),t.color&&t.color.set(0,0,0),e.blackAlphaMat=t}return e.blackAlphaMat}applyFrame(e){var t=this
if(t.frameIndex=e,!t.isMissing&&!t.isIgnored){var o=t.type
if("audio"!=o){"camera"==o&&(t.threejsObj.visible=!1),t.backUpGeometry&&t.applyBackUpGeometry(),t.currentTransform=t.getTransformAt(e)
var r=t.threejsHook,n=t.currentTransform.position,i=structuredClone(n)
if("2D"==t.cameraType)if("light"!=o){if(i.z=0-t.compIndex,_config.sentry&&!t.threejsObj){var l=null
t.compositionData&&(l=t.compositionData.name),a.captureMessage("error applyFrame no threejsObj 2D",{level:"error",stacktrace:!0,extra:{compUid:t.compUid,itemData:t.itemData,type:t.type,name:t.name,isReady:t.isReady,isMissing:t.isMissing,isPlaying:t.controller.playbackUtils.isPlaying,isCompositionReady:t.controller.isCompositionReady,compName:l}})}var s=1e3-t.compIndex
t.threejsObj&&(t.threejsObj.renderOrder=s)}else i.z=-1*i.z
if(i=t.normalizePosition(i),r.position.copy(i),t.itemData.anchorPoint){var c=t.itemData.anchorPoint.values,u=t.getDimensionsAt(e),m={x:(.5-c.x/100)*u.width,y:(.5-c.y/100)*u.height}
t.threejsObj&&t.threejsObj.position.set(m.x,-1*m.y,0)}if("camera"!=o){var p=t.normalizeRotation(t.currentTransform.rotation)
if(r.rotation.set(p.x,p.y,p.z),t.currentTransform.scale){var d=t.normalizeScale(t.currentTransform.scale)
r.scale.copy(d)}}"shape"==o&&(t.doMaterialShape(),t.updateGeometry()),"freeShape"==o&&(t.updateMesh(),t.updateColor()),"text"==o&&(t.updateColor(),t.updateCloneTransform()),"light"==o&&t.updateLight(),"model"==o&&t.updateModel(),"camera"==o&&"3D"==t.cameraType&&t.applyFrameToCamera(e),"widget"==o&&(t.rebuild(),t.applyOpacity(e)),"widgetImage"==o&&t.updateConfig(),t.effectManager&&t.effectManager.applyEffects(e)}else t.updateAudio()}}getEasing(e){var t=TWEEN.Easing.Quadratic.InOut
if("Linear"==e.easing&&(t=TWEEN.Easing.Linear.None),"Cubic.In"==e.easing&&(t=TWEEN.Easing.Cubic.In),"Cubic.Out"==e.easing&&(t=TWEEN.Easing.Cubic.Out),"Elastic.Out"==e.easing&&(t=TWEEN.Easing.Elastic.Out),"Static"==e.easing){function o(){return 0}t=o}return t}getTransformAt(e,t={}){var o=this
if(o.isMissing)return null
if("audio"==o.type)return null
var r=!1
!0===t&&(r=!0,t={})
var n=o.itemData,i={}
function a(e,t,r){var n=t[r],a=t[r+1]
THREE.MathUtils.degToRad(1*n.values.x),THREE.MathUtils.degToRad(1*n.values.y),THREE.MathUtils.degToRad(1*n.values.z),THREE.MathUtils.degToRad(1*a.values.x),THREE.MathUtils.degToRad(1*a.values.y),THREE.MathUtils.degToRad(1*a.values.z)
const l={t:0}
var s=a.frame-n.frame
e-=n.frame
var c=new TWEEN.Tween(l).to({t:1},s).onUpdate(()=>{var e=l.t
i.rotation={x:n.values.x+(a.values.x-n.values.x)*e,y:n.values.y+(a.values.y-n.values.y)*e,z:n.values.z+(a.values.z-n.values.z)*e}})
c.easing(o.getEasing(n)).start(0).update(e),c=null}i.position=n.position.values,i.rotation=n.rotation.values,i.scale=n.scale.values
var l=n.position.keyframes,s=n.position.useKeyframes
if(r&&(s=!0),s&&l&&l.length){i.position=l[0].values,l.forEach(function(t,r){if(e!=t.frame){if(!(r>=l.length-1)&&e>t.frame&&e<l[r+1].frame)if("Custom"==t.easing){var a=o.curvesUtils.getValueAt(n.position,"x",e),s=o.curvesUtils.getValueAt(n.position,"y",e),c=o.curvesUtils.getValueAt(n.position,"z",e)
i.position={x:a,y:s,z:c}}else(function(e,t,r){var n=t[r],a=t[r+1],l={x:n.values.x,y:n.values.y,z:n.values.z},s={x:a.values.x,y:a.values.y,z:a.values.z}
if("2D"==o.cameraType&&"light"!=o.type){var c=o.localIndex
l.z=0-c,s.z=0-c}var u=a.frame-n.frame
e-=n.frame
var m=new TWEEN.Tween({x:l.x,y:l.y,z:l.z}).to({x:s.x,y:s.y,z:s.z},u).onUpdate(function(e){i.position={x:e.x,y:e.y,z:e.z}})
m.easing(o.getEasing(n)).start(0).update(e),m=null})(e,l,r)}else i.position=t.values})
var c=l[l.length-1]
e>c.frame&&(i.position=c.values)}l=n.rotation.keyframes,s=n.rotation.useKeyframes
if(r&&(s=!0),s&&l&&l.length){i.rotation=l[0].values,l.forEach(function(t,r){if(e!=t.frame){if(!(r>=l.length-1)&&e>t.frame&&e<l[r+1].frame){var s=o.cameraType
if("2D"==s)if("model"!=o.type)if("Custom"==t.easing){var c=o.curvesUtils.getValueAt(n.rotation,"x",e),u=o.curvesUtils.getValueAt(n.rotation,"y",e),m=o.curvesUtils.getValueAt(n.rotation,"z",e)
i.rotation={x:c,y:u,z:m}}else(function(e,t,r){var n=t[r],a=t[r+1],l={z:n.values.z},s={z:a.values.z},c=a.frame-n.frame
e-=n.frame
var u=new TWEEN.Tween({z:l.z}).to({z:s.z},c).onUpdate(function(e){i.rotation={x:0,y:0,z:e.z}})
u.easing(o.getEasing(n)).start(0).update(e),u=null})(e,l,r)
else a(e,l,r)
"3D"==s&&a(e,l,r)}}else i.rotation=t.values})
c=l[l.length-1]
e>c.frame&&(i.rotation=c.values)}l=n.scale.keyframes,s=n.scale.useKeyframes
if(r&&(s=!0),s&&l&&l.length){i.scale=l[0].values,l.forEach(function(t,r){if(e!=t.frame){if(!(r>=l.length-1)&&e>t.frame&&e<l[r+1].frame)if("Custom"==t.easing){var a=o.curvesUtils.getValueAt(n.scale,"x",e),s=o.curvesUtils.getValueAt(n.scale,"y",e),c=o.curvesUtils.getValueAt(n.scale,"z",e)
i.scale={x:a,y:s,z:c}}else(function(e,t,r){var n=t[r],a=t[r+1],l={x:n.values.x,y:n.values.y,z:n.values.z},s={x:a.values.x,y:a.values.y,z:a.values.z},c=a.frame-n.frame
e-=n.frame
var u=new TWEEN.Tween({x:l.x,y:l.y,z:l.z}).to({x:s.x,y:s.y,z:s.z},c).onUpdate(function(e){i.scale={x:e.x,y:e.y,z:e.z}})
u.easing(o.getEasing(n)).start(0).update(e),u=null})(e,l,r)}else i.scale=t.values})
c=l[l.length-1]
e>c.frame&&(i.scale=c.values)}return!0!==t.ignoreExpression&&(n.position.useExpression||n.rotation.useExpression||n.scale.useExpression)&&(i=o.expressionEngine.getTransform(i)),i.position.x*=1,i.position.y*=1,i.position.z*=1,i.rotation.x*=1,i.rotation.y*=1,i.rotation.z*=1,i.scale.x*=1,i.scale.y*=1,i.scale.z*=1,i}getParamByName(e){var t=null
return this.itemData.params.forEach(function(o){t||(o.name==e&&(t=o),o.params&&o.params.forEach(function(o){o.name==e&&(t=o)}))}),t}getParamValueAt(e,t,o={}){var r=this,n=r.getParamByName(t)
if(!n&&"opacity"==t)return 100
if(n){var i=n.type,a=n.value,l=n.keyframes
if(n.useKeyframes&&l&&l.length){function d(e,t,o){var n=t[o],l=n.frame,s=t[o+1].frame-l
e-=l
var c={value:n.values.p},u={value:t[o+1].values.p}
c=JSON.parse(JSON.stringify(c)),"number"==i&&(c.value*=1,u.value*=1),"color"==i&&(c.value=hexToRgb(c.value),u.value=hexToRgb(u.value))
var m=new TWEEN.Tween({value:c.value}).to({value:u.value},s).onUpdate(function(e){var t=e.value
"number"==i&&(a=Math.abs(t)<10?roundValue(t,2):roundValue(t,1)),"color"==i&&(a=rgbToHex(t)),"text"==i&&(a=c.value),i||(a=t)})
m.easing(r.getEasing(n)).start(0).update(e),m=null}a=l[0].values.p,l.forEach(function(t,o){e!=t.frame?o>=l.length-1||e>t.frame&&e<l[o+1].frame&&("Custom"==l[o].easing?(a=r.curvesUtils.getValueAt(n,"p",e),"number"==i&&(a=Math.abs(a)<10?roundValue(a,2):roundValue(a,1))):d(e,l,o)):a=t.values.p})
var s=l[l.length-1]
e>s.frame&&(a=s.values.p)}if("opacity"==t){var c=r.getParent()
if(c){var u=c.getParamValueAt(e,"opacity")
a=a*u/100}}if("number"==i&&(a*=1),!0!==o.ignoreExpression&&n.useExpression){var m=a,p=r.expressionEngine.getValue(n,0,m)
!1!==p&&(a=p)}return a}console.log("ERROR getting param value: ",t,"on",r.name,r.type)}isVisibleInframe(e){var t=this
if(t.isDestroyed)return!1
if(t.itemData.disabled)return!1
if("camera"==t.type||"cameraTarget"==t.type)return!0
if(!t.isTimeInFrame(e))return!1
if(t.itemData.hidden)return!1
var o=t.getParent()
return!(o&&!o.isVisibleInframe(e))}isTimeInFrame(e){var t=this.itemData.time
return!t||1*t.in<=e&&1*t.out>=e}isMask(){return!(!this.itemData.mask||!this.itemData.mask.enabled)}isMasked(){return this.getMasks().length>0}isPassStackable(e){var t=this
if("normal"!=t.itemData.blendMode)return!1
var o=!0
return t.itemData.effects.forEach(function(e){e.enabled&&(o=!1)}),t.getParamValueAt(e,"opacity")<100&&(o=!1),o}get localIndex(){var e=this,t=0,o=null
e.parentCompUid?(e.getters||console.warn("destroyed ??? : ",e.name),o=e.getters.getJsonItemParentByCompUid(e.compositionData,e.compUid).items):o=e.compositionData.items
return o.forEach(function(o,r){o.compUid==e.compUid&&(t=r)}),t}get depthLevel(){for(var e=0,t=this;t.getParent()&&(e++,t=t.getParent()););return e}isAnimated(){var e=this.itemData,t=!1
return!(!e.position||!e.position.useKeyframes)||(!(!e.rotation||!e.rotation.useKeyframes)||(!(!e.scale||!e.scale.useKeyframes)||(e.params.forEach(function(e){e.useKeyframes&&(t=!0),e.params&&e.params.forEach(function(e){e.useKeyframes&&(t=!0)})}),e.effects.forEach(function(e){e.useKeyframes&&(t=!0),e.params&&e.params.forEach(function(e){e.useKeyframes&&(t=!0)})}),t)))}getParent(){var e=this
if(e.isDestroyed)return null
var t=null,o=e.getters.getJsonItemParentByCompUid(e.compositionData,e.compUid)
return o&&(t=e.getters.getSceneItemByCompUid(e.compositionManager,o.compUid)),t}getParents(){var e=[]
for((t=this.getParent())&&e.push(t);t;){var t;(t=t.getParent())&&e.push(t)}return e}getMasks(){var e=this,t=[],o=e.compositionManager.sceneItems
return function r(n){var i=n.compUid,a=0
if(o.forEach(function(e,t){e.compUid==i&&(a=t)}),0!=a){var l=o[a-1]
if("camera"==l.type){if(1==a)return
l=o[a-2]}l.itemData.mask&&l.itemData.mask.enabled&&l.depthLevel<=e.depthLevel&&t.push(l)
var s=n.getParent()
s&&r(s)}}(e),t}getMasked(){var e=this
if(e.compositionManager){var t=e.compositionManager.sceneItems,o=t[e.compIndex+1]
return o&&("camera"!=o.type||(o=t[e.compIndex+2]))?"audio"==o.type?null:o:null}}getChildren(){var e=this,t=[]
return e.compositionManager.sceneItems.forEach(function(o){var r=o.getParent()
r&&r.compUid==e.compUid&&t.push(o)}),t}getParentThreejsObj(){var e=this.getParent()
return e?e.threejsObj:null}getTransformEnabledAxes(){var e=this,t=e.type,o=e.cameraType,r={x:!0,y:!0,z:!1}
"light"==t&&(r.z=!0),"3D"==o&&(r.z=!0)
var n={x:!1,y:!1,z:!0}
"camera"==t?n=e.itemData.target.enabled?null:{x:!0,y:!0,z:!0}:("model"==t&&(n={x:!0,y:!0,z:!0}),"3D"==o&&(n={x:!0,y:!0,z:!0})),e.itemData.rotation&&e.itemData.rotation.hidden&&(n=null)
var i={x:!0,y:!0,z:!1}
return"model"==t&&(i.z=!0),"group"==t&&"3D"==o&&(i.z=!0),{position:r,rotation:n,scale:i}}setPositionTo(e,t=!0){var o=this,r=o.itemData,n=o.controller,i=n.currentFrame,a=r.position
if(a.useKeyframes){var l=null,s=a.keyframes
if(s.forEach(function(e){e.frame==i&&(l=e)}),l)l.values=e,n.keyframesUtils.checkStaticKeys(s)
else{var c={values:e,frame:i}
n.keyframesUtils.addKey(s,c,"position")}}else o.updateItemPosition(e)
n.triggerRefreshInputsValues(),t&&o.applyFrame(i)}setRotationTo(e){var t=this,o=t.itemData,r=t.controller,n=r.currentFrame,i=o.rotation
if(i.useKeyframes){var a=null,l=i.keyframes
if(l.forEach(function(e){e.frame==n&&(a=e)}),a)a.values=e,r.keyframesUtils.checkStaticKeys(l)
else{var s={values:e,frame:n}
r.keyframesUtils.addKey(l,s,"rotation")}}else t.updateItemRotation(e)
r.triggerRefreshInputsValues(),t.applyFrame(n)}setScaleTo(e){var t=this,o=t.itemData,r=t.controller,n=r.currentFrame,i=o.scale
if(i.useKeyframes){var a=null,l=i.keyframes
if(l.forEach(function(e){e.frame==n&&(a=e)}),a)a.values=e,r.keyframesUtils.checkStaticKeys(l)
else{var s={values:e,frame:n}
r.keyframesUtils.addKey(l,s,"scale")}}else t.updateItemScale(e)
r.triggerRefreshInputsValues(),t.applyFrame(n)}updateItemPosition(e){(0,i.set)(this.itemData.position,"values",e)}updateItemRotation(e){(0,i.set)(this.itemData.rotation,"values",e)}updateItemScale(e){(0,i.set)(this.itemData.scale,"values",e)}normalizePosition(e){var t=this,o=1*e.x,r=1*e.y,n=1*e.z,i=t.cameraType
if(t.getParent())"2D"==i&&(r*=-1),"3D"==i&&(n=-1*e.z)
else{if("3D"==i)return{x:o,y:r,z:-1*n}
var a=t.compositionData.dimensions
o-=a.width/2,r=a.height-r-a.height/2}return{x:o,y:r,z:n}}denormalizePosition(e,t=void 0){var o=this,r=o.cameraType,n=1*e.x,i=1*e.y,a=1*e.z
if(void 0===t&&(t=o.getParent()),t)"2D"==r&&(i=-1*e.y),"3D"==r&&(a=-1*e.z)
else{if("3D"==r)return{x:n=roundValue(n,1),y:i=roundValue(i,1),z:-1*(a=roundValue(a,1))}
var l=o.controller.compositionDisplayZoom/100
n/=l,i/=l
var s=o.compositionData.dimensions
n=e.x+s.width/2,i=s.height-s.height/2-e.y}return{x:n=roundValue(n,1),y:i=roundValue(i,1),z:a=roundValue(a,1)}}normalizeRotation(e){return{x:THREE.MathUtils.degToRad(e.x),y:THREE.MathUtils.degToRad(e.y),z:THREE.MathUtils.degToRad(-1*e.z)}}denormalizeRotation(e){var t=THREE.MathUtils.radToDeg(e.x),o=THREE.MathUtils.radToDeg(e.y),r=THREE.MathUtils.radToDeg(-1*e.z)
return{x:Math.round(10*t)/10,y:Math.round(10*o)/10,z:Math.round(10*r)/10}}normalizeScale(e){return{x:e.x/100,y:e.y/100,z:e.z/100}}denormalizeScale(e){return{x:Math.round(1e3*e.x)/10,y:Math.round(1e3*e.y)/10,z:Math.round(1e3*e.z)/10}}changeParent(e){var t=this
if(console.log("change parent of",t.name),"audio"!=t.type){var o=t.getters.getJsonItemParentByCompUid(t.compositionData,t.compUid),r=t.getJsonData(),n=null
if(o||e){e&&(n=t.getters.getHookByCompUid(t.compositionManager,e.compUid),e.groupOpen=!0)
var i=n,a=t.getNewLocalTransform(0,i),l=t.denormalizePosition(a.position,i)
t.updateItemPosition(l),r.position.keyframes&&r.position.keyframes.forEach(function(e){var o=t.getNewLocalTransform(e.frame,i,!0),r=t.denormalizePosition(o.position,i)
e.values=r})
var s=t.denormalizeRotation(a.rotation,i)
t.updateItemRotation(s),r.rotation.keyframes&&r.rotation.keyframes.forEach(function(e){var o=t.getNewLocalTransform(e.frame,i,!0),r=t.denormalizeRotation(o.rotation,i)
e.values=r})
var c=t.denormalizeScale(a.scale,i)
t.updateItemScale(c),r.scale.keyframes&&r.scale.keyframes.forEach(function(e){var o=t.getNewLocalTransform(e.frame,i,!0),r=t.denormalizeScale(o.scale,i)
e.values=r})}else console.log("root => root, nothing to do")}}getNewLocalTransform(e,t,o=!1){var r=this,n=new THREE.Vector3,i=new THREE.Euler,a=new THREE.Vector3,l=new THREE.Object3D,s=new THREE.Object3D
r.threejsHook.parent.add(l)
var c=new THREE.Vector3,u=r.getTransformAt(e,o),m=r.normalizePosition(u.position),p=r.normalizeRotation(u.rotation),d=r.normalizeScale(u.scale)
if(l.position.copy(m),l.rotation.set(p.x,p.y,p.z),l.scale.copy(d),t){const e=new THREE.Matrix4
l.updateMatrixWorld(!0),e.copy(l.matrixWorld)
const o=new THREE.Matrix4
t.updateMatrixWorld(!0),o.copy(t.matrixWorld).invert()
const r=new THREE.Matrix4
r.multiplyMatrices(o,e)
const c=new THREE.Vector3,u=new THREE.Quaternion,m=new THREE.Vector3
r.decompose(c,u,m),t.add(s),s.position.copy(c),s.quaternion.copy(u),s.scale.copy(m),n.copy(s.position),i.copy(s.rotation),a.copy(s.scale)}else{l.getWorldPosition(c)
var f=new THREE.Quaternion
l.getWorldQuaternion(f)
var v=(new THREE.Euler).setFromQuaternion(f),h=new THREE.Vector3
l.getWorldScale(h),n=c,i=v,a=h}return s=null,l=null,{position:n,rotation:i,scale:a}}toggleAnchorPointTool(e){var t=this
e&&(t.itemData.anchorPoint||t.addAnchorPointData()),t.controlsHandles.toggleAnchorPointTool(e)}addAnchorPointData(){console.error("ERROR missing AnchorPoint Data - ",this.name),alert("error no anchor point data",this.name)}disposeGeometry(){this.threejsObj.traverse(function(e){e.geometry&&e.geometry.dispose()})}remove(e){var t=this
if(123!=e&&(console.warn("OBS remove"),_config.isDebug&&alert("remove()"+t.name)),"video"==t.type&&t.clearCache(!0),"audio"==t.type&&t.stopAudio(),t.isAdded){t.isReady||console.error("remove() - WAS NOT READY: ",t.name),t.threejsObj&&t.destroyObj(),"audio"==t.type&&(t.bufferSource=null,t.audioBuffer=null)
var o=t.threejsHook.parent
o&&o.remove(t.threejsHook),t.isReady=!1,t.isAdded=!1}}destroyObj(){var e=this
e.lightHelper&&e.destroyLightHelper(),e.threejsObj&&(e.threejsObj.parent&&e.threejsObj.parent.remove(e.threejsObj),e.disposeGeometry(),e.threejsObj=void 0)}destroy(){var e=this
if(!e.isDestroyed){console.log("%c X "+e.name+" ","background: #333333; color: #ff9200"),e.effectManager&&(e.effectManager.destroy(),e.effectManager=null),e.remove(123)
var t=e.type
"video"==t&&e.clearCache(!1),e.isDestroyed=!0,e.blendPass&&(e.blendPass.dispose(),e.blendPass=null),e.controlsHandles&&(e.controlsHandles.destroy(),e.controlsHandles=null),e.highlightBox&&(e.highlightBox.destroy(),e.highlightBox=null),"shape"==t&&e.disposeShapeItemMaterials(),e.materials&&(e.materials[0]&&(e.materials[0].dispose(),e.materials[0]=null),e.materials[1]&&(e.materials[1].dispose(),e.materials[1]=null),e.materials=null),e.whiteAlphaMat&&(Array.isArray(e.whiteAlphaMat)||e.whiteAlphaMat.dispose(),e.whiteAlphaMat=null),e.blackAlphaMat&&(Array.isArray(e.blackAlphaMat)||e.blackAlphaMat.dispose(),e.blackAlphaMat=null),e.gizmoMaterial&&(e.gizmoMaterial.dispose(),e.gizmoMaterial=null),e.texture&&(e.texture.dispose(),e.texture=void 0),e.isMissing||("composition"==t&&e.destroyItemComposition(),"model"==t&&e.destroyItemModel(),"video"==t&&e.destroyItemVideo(),"text"==t&&e.destroyItemText(),"audio"==t&&e.destroyItemAudio(),"cameraTarget"==t&&e.destroyItemCameraTarget(),"group"==t&&e.destroyItemGroup(),"freeShape"==t&&e.destroyItemFreeShape()),e.gizmo&&e.gizmo.geometry&&e.gizmo.geometry.dispose(),e.threejsHook=null,e.disposeBackUpGeometry(),e.compositionManager=void 0,e.curvesUtils=null}}}}),define("pikimov/classes/items/shape-item",["exports","@ember/object","pikimov/classes/items/scene-item","pikimov/classes/shaders/shaders-common"],function(e,t,o,r){function n(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class i extends o.default{constructor(e,t,o){super(e,t,o),n(this,"material1Color",null),n(this,"material2Colors",null),n(this,"material4Colors",null)
var i=this
i.currentBuildParams={},i.gizmoMaterial=new LineMaterial({linewidth:4,alphaToCoverage:!0,color:3158064}),i.material1Color=new THREE.MeshBasicMaterial({side:THREE.DoubleSide})
var a=r._commonVertexShader
i.material2Colors=new THREE.ShaderMaterial({uniforms:{color1:{value:new THREE.Color},color2:{value:new THREE.Color},angle:{value:0},u_isRadial:{value:!0}},vertexShader:a,fragmentShader:"uniform vec3 color1;\nuniform vec3 color2;\nuniform float angle;\nuniform bool u_isRadial;\nvarying vec2 vUv;\nvoid main(){\n    vec2 direction = vec2(cos(angle), sin(angle));\n    vec2 centeredUv = vUv - 0.5;\n    float gradientFactor;// = dot(centeredUv, direction) + 0.5;\n\n    if (u_isRadial) {\n        // Radial gradient based on distance from center\n        gradientFactor = length(centeredUv) * 2.0; // *2.0 so it fills\n    } else {\n        // Linear gradient\n        vec2 direction = vec2(cos(angle), sin(angle));\n        gradientFactor = dot(centeredUv, direction) + 0.5;\n    }\n\n    gradientFactor = clamp(gradientFactor, 0.0, 1.0);\n    vec3 color = mix(color1, color2, gradientFactor);\n    gl_FragColor = vec4(color, 1.0);\n}",side:THREE.DoubleSide}),i.material4Colors=new THREE.ShaderMaterial({uniforms:{color1:{value:new THREE.Color},color2:{value:new THREE.Color},color3:{value:new THREE.Color},color4:{value:new THREE.Color},center1:{},center2:{},center3:{},center4:{},blendRadius:{value:1}},vertexShader:a,fragmentShader:"precision mediump float;\nuniform vec3 color1;\nuniform vec3 color2;\nuniform vec3 color3;\nuniform vec3 color4;\nuniform vec2 center1;\nuniform vec2 center2;\nuniform vec2 center3;\nuniform vec2 center4;\nuniform float blendRadius;// Control the blending radius\nvarying vec2 vUv;\n\nvoid main(){\n    // distances from the fragment to each color center\n    float dist1 = distance(vUv, center1) / blendRadius;\n    float dist2 = distance(vUv, center2) / blendRadius;\n    float dist3 = distance(vUv, center3) / blendRadius;\n    float dist4 = distance(vUv, center4) / blendRadius;\n    \n    // weights (inverted distances, smoothed)\n    float weight1 = smoothstep(1.0, 0.0, dist1);\n    float weight2 = smoothstep(1.0, 0.0, dist2);\n    float weight3 = smoothstep(1.0, 0.0, dist3);\n    float weight4 = smoothstep(1.0, 0.0, dist4);\n\n    // Normalize weights to keep brightness in range\n    float totalWeight = weight1 + weight2 + weight3 + weight4;\n    weight1 /= totalWeight;\n    weight2 /= totalWeight;\n    weight3 /= totalWeight;\n    weight4 /= totalWeight;\n\n    // Blend colors based on weights\n    vec3 blendedColor = \n        color1 * weight1 +\n        color2 * weight2 +\n        color3 * weight3 +\n        color4 * weight4;\n    \n    gl_FragColor = vec4(blendedColor, 1.0);\n}",side:THREE.DoubleSide})}buildItem(){var e=this
e.doMaterialShape(),e.doMesh(),e.addToScene(),e.onReady()}updateShapeParams(){var e=this,t=e.itemData,o=e.frameIndex,r=0,n=0,i=e.getParamValueAt(0,"stroke"),a=e.getParamValueAt(0,"fill")
"rectangle"==t.shape&&(r=e.getParamValueAt(o,"corners"),1==i&&(n=e.getParamValueAt(o,"stroke width"))),"circle"==t.shape&&(t.segments=128,1==i&&(n=e.getParamValueAt(o,"stroke width")))
var l=1*e.getParamValueAt(o,"width"),s=1*e.getParamValueAt(o,"height"),c=!1
return e.threejsObj||(c=!0),e.currentBuildParams.width!=l&&(c=!0),e.currentBuildParams.height!=s&&(c=!0),e.currentBuildParams.corners!=r&&(c=!0),e.currentBuildParams.fill!=a&&(c=!0),e.currentBuildParams.strokeWidth!=n&&(c=!0),e.currentBuildParams.needSubdivisions!=e.needSubdivisions&&(c=!0),e.currentBuildParams={width:l,height:s,corners:r,fill:a,strokeWidth:n,needSubdivisions:e.needSubdivisions},c}doMesh(){var e=this
if(e.updateShapeParams()){e.removeGizmos(),e.destroyObj()
var t=new shapeItemMesh(e.itemData),o=t.getMesh(e.currentBuildParams)
t=null,o&&(o.material=[e.materials[0],e.materials[1]],e.threejsObj=o,e.saveGeometry(),e.applyFrame(e.frameIndex))}}updateGeometry(){var e=this
if(e.updateShapeParams()){var t=new shapeItemMesh(e.itemData),o=t.getGeometry(e.currentBuildParams)
t=null,e.threejsObj.geometry.dispose(),e.threejsObj.geometry=o,e.saveGeometry()}}addGizmos(){var e=this
if(e.needGizmo&&e.threejsObj){var t=e.frameIndex
if(e.gizmo)for(var o=e.gizmo;o.children.length>0;)o.remove(o.children[0])
if("4 colors"==e.getParamValueAt(t,"fill type")){e.gizmo||(e.gizmo=new THREE.Group,e.gizmo.name="4 colors gizmo",e.gizmo.visible=e.isSelected,e.threejsObj.add(e.gizmo),e.gizmo.position.set(0,0,10))
var r=e.getTransformAt(t),n=16/((r.scale.x+r.scale.y)/2/100),i=e.getDimensionsAt(t),a=i.width,l=i.height,s=e.gizmoMaterial,c=0
for(c=0;c<4;c++){var u=e.getParamValueAt(t,"point "+(c+1)),m=u.x/100*a-a/2,p=(1-u.y/100)*l-l/2,d=[-1*n+m,0+p,0,n+m,0+p,0],f=[0+m,-1*n+p,0,0+m,n+p,0],v=new LineGeometry
v.setPositions(d)
var h=new Line2(v,s),g=new LineGeometry
g.setPositions(f)
var y=new Line2(g,s)
e.gizmo.add(h,y)}}}}removeGizmos(){var e=this
if(e.gizmo){for(var t=e.gizmo;t.children.length>0;)t.remove(t.children[0]);(t=e.gizmo.parent)&&t.remove(e.gizmo)}}setGizmoVisibility(e){var t=this
t.gizmo&&(t.gizmo.visible=e,t.compositionManager.renderSameFrame())}doMaterialShape(){var e=this,t=e.frameIndex,o=e.getParamValueAt(0,"fill"),r=e.getParamValueAt(0,"stroke")
if(o){var n=e.getParamValueAt(0,"fill type")
if("1 color"==n){e.materials[0]=e.material1Color
var i=e.getParamValueAt(t,"fill color")
e.materials[0].color.set(i).convertLinearToSRGB()}if("2 colors"==n){e.materials[0]=e.material2Colors
var a=e.getParamValueAt(t,"color 1"),l=e.getParamValueAt(t,"color 2"),s=e.getParamValueAt(t,"angle");(u=e.materials[0].uniforms).color1.value.set(a).convertLinearToSRGB(),u.color2.value.set(l).convertLinearToSRGB(),u.angle.value=-1*THREE.MathUtils.degToRad(s)
var c=!1
"radial"==e.getParamValueAt(0,"gradient type")&&(c=!0),u.u_isRadial.value=c}if("4 colors"==n){e.materials[0]=e.material4Colors
a=e.getParamValueAt(t,"color 1"),l=e.getParamValueAt(t,"color 2")
var u,m=e.getParamValueAt(t,"color 3"),p=e.getParamValueAt(t,"color 4");(u=e.materials[0].uniforms).color1.value.set(a).convertLinearToSRGB(),u.color2.value.set(l).convertLinearToSRGB(),u.color3.value.set(m).convertLinearToSRGB(),u.color4.value.set(p).convertLinearToSRGB()
var d=e.getParamValueAt(t,"point 1")
u.center1.value={x:d.x/100,y:1-d.y/100}
var f=e.getParamValueAt(t,"point 2")
u.center2.value={x:f.x/100,y:1-f.y/100}
var v=e.getParamValueAt(t,"point 3")
u.center3.value={x:v.x/100,y:1-v.y/100}
var h=e.getParamValueAt(t,"point 4")
u.center4.value={x:h.x/100,y:1-h.y/100}
var g=e.getParamValueAt(t,"blend")
u.blendRadius.value=g/100}}if(e.addGizmos(),e.materials[1]||(e.materials[1]=new THREE.MeshBasicMaterial({side:THREE.DoubleSide})),e.materials[0]||(e.materials[0]=new THREE.MeshBasicMaterial({side:THREE.DoubleSide})),r){var y=e.getParamValueAt(t,"stroke color"),b=valueToSRGB(y)
o?e.materials[1].color=b:e.materials[0].color=b}e.threejsObj&&(e.threejsObj.material=[e.materials[0],e.materials[1]])}setFillType(e){var o=this,r=o.getParamByName("fill"),n=r.params
if("2 colors"!=e&&"4 colors"!=e||o.getParamByName("color 1")||n.push({name:"color 1",type:"color",value:"#ffffff"},{name:"color 2",type:"color",value:"#505050"}),"2 colors"==e&&(o.getParamByName("angle")||n.push({name:"angle",type:"number",min:0,max:180,value:0})),"4 colors"==e&&(o.getParamByName("color 3")||n.push({name:"color 3",type:"color",value:"#fb2a13"},{name:"color 4",type:"color",value:"#e0aa10"},{name:"point 1",type:"vector2",value:{x:0,y:0},min:0,max:100,unit:"%",disabled:!0},{name:"point 2",type:"vector2",value:{x:100,y:0},min:0,max:100,unit:"%",static:!0},{name:"point 3",type:"vector2",value:{x:100,y:100},min:0,max:100,unit:"%",static:!0},{name:"point 4",type:"vector2",value:{x:0,y:100},min:0,max:100,unit:"%",static:!0},{name:"blend",type:"number",min:80,max:200,value:100})),n.forEach(function(e){var o=e.name
"fill color"==o&&(0,t.set)(e,"disabled",!0),"color 1"==o&&(0,t.set)(e,"disabled",!0),"color 2"==o&&(0,t.set)(e,"disabled",!0),"color 3"==o&&(0,t.set)(e,"disabled",!0),"color 4"==o&&(0,t.set)(e,"disabled",!0),"point 1"==o&&(0,t.set)(e,"disabled",!0),"point 2"==o&&(0,t.set)(e,"disabled",!0),"point 3"==o&&(0,t.set)(e,"disabled",!0),"point 4"==o&&(0,t.set)(e,"disabled",!0),"angle"==o&&(0,t.set)(e,"disabled",!0),"blend"==o&&(0,t.set)(e,"disabled",!0),"gradient type"==o&&(0,t.set)(e,"disabled",!0)}),n.forEach(function(o){var r=o.name,n=!1
"1 color"==e&&"fill color"==r&&(n=!0),"2 colors"==e&&("color 1"==r&&(n=!0),"color 2"==r&&(n=!0),"angle"==r&&(n=!0),"gradient type"==r&&(n=!0)),"4 colors"==e&&("color 1"==r&&(n=!0),"color 2"==r&&(n=!0),"color 3"==r&&(n=!0),"color 4"==r&&(n=!0),"point 1"==r&&(n=!0),"point 2"==r&&(n=!0),"point 3"==r&&(n=!0),"point 4"==r&&(n=!0),"blend"==r&&(n=!0)),n&&(0,t.set)(o,"disabled",void 0)}),"2 colors"==e){var i=o.getParamValueAt(0,"gradient type")
o.setGradientType(i)}r.params=null,(0,t.set)(r,"params",n),o.addGizmos()}setGradientType(e){var o=this,r=o.getParamByName("fill").params
if("2 colors"==o.getParamValueAt(0,"fill type")){e=o.getParamValueAt(0,"gradient type")
r.forEach(function(o){if("angle"==o.name){var r=!1
"linear"==e&&(r=!0),(0,t.set)(o,"disabled",!r)}})}}disposeShapeItemMaterials(){var e=this
e.material1Color&&(e.material1Color.dispose(),e.material1Color=null),e.material2Colors&&(e.material2Colors.dispose(),e.material2Colors=null),e.material4Colors&&(e.material4Colors.dispose(),e.material4Colors=null)}}e.default=i}),define("pikimov/classes/items/svg-item",["exports","pikimov/classes/items/scene-item"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class o extends t.default{constructor(e,t,o){super(e,t,o)}buildItemSVG(){}onModelLoaded(e){this.doMeshSVG(e),this.onReady()}doMeshSVG(e){}}e.default=o}),define("pikimov/classes/items/text-item",["exports","pikimov/classes/items/scene-item"],function(e,t){function o(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{constructor(e,t,r){super(e,t,r),o(this,"textObj",null),o(this,"loadedFont",null),o(this,"hookClone",null),o(this,"currentSettings",{}),o(this,"rayCastPlane",null),o(this,"fontFileData",null),o(this,"fontOpenTypeData",null),o(this,"SVGLoader",null),this.SVGLoader=new SVGLoader}buildItem(){var e=this
e.materials[0]=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,transparent:!0}),e.materials[1]=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,visible:!1}),e.updateColor(),e.nextStepText()}async nextStepText(){var e=this
if(_config.troikaText)e.doMeshText_troika()
else{var t=e.getFontValue()
e.loadFont(async function(){e.doMeshText(),e.addToScene(),e.onMeshReady()},t)}}doMeshText(e=!1){var t=this,o=t.frameIndex,r=t.getParamValueAt(o,"text"),n=t.itemData.font,i=t.getParamValueAt(o,"font size"),a=t.getParamValueAt(o,"letter spacing")/100,l=t.getParamValueAt(o,"line height")/100,s=t.getParamValueAt(0,"text align")
r=""+r,n||(n="Roboto")
var c=0
t.itemData.box&&t.itemData.box.enabled&&(c=1*t.itemData.box.width)
var u=!1
if(t.currentSettings.text!=r&&(u=!0),t.currentSettings.fontValue!=n&&(u=!0),t.currentSettings.fontSize!=i&&(u=!0),t.currentSettings.letterSpacing!=a&&(u=!0),t.currentSettings.lineHeight!=l&&(u=!0),t.currentSettings.textAlign!=s&&(u=!0),t.currentSettings.boxWidth!=c&&(u=!0),e&&(u=!0),u){t.loadedFont!=n&&console.log("error loaded font != font to use"),t.currentSettings={text:r,fontValue:n,fontSize:i,letterSpacing:a,lineHeight:l,textAlign:s,boxWidth:c}
var m=t.doOpentypeSVG(t.currentSettings),p=t.SVGToMesh(m,r)
t.threejsObj?(t.threejsObj.parent.remove(t.threejsObj),t.disposeGeometry(),t.threejsObj=void 0,t.threejsObj=p,t.threejsHook.add(t.threejsObj)):t.threejsObj=p,t.threejsObj.userData.compUid=t.compUid,t.refreshBoundingBox(),t.saveGeometry()}}doMeshText_troika(){}async updateText_troika(){}async onMeshReady(){this.onReady()}getReadyToRender(e){this.updateText()}updateText(){var e=this
e.doMeshText(),e.applyFrame(e.frameIndex),"3D"==e.cameraType&&e.updateClone(),e.onReadyTorender(e)}updateClone(){var e=this
e.hookClone&&(e.hookClone=null)
var t=e.threejsHook.clone()
t.name="CLONE OP "+t.name,e.hookClone=t}updateCloneTransform(){var e=this
e.hookClone&&(e.hookClone.position.copy(e.threejsHook.position),e.hookClone.rotation.copy(e.threejsHook.rotation),e.hookClone.scale.copy(e.threejsHook.scale))}getTextBoundingSize(){var e=new THREE.Vector3
return this.boundingBox.getSize(e),{width:Math.round(e.x),height:Math.round(e.y)}}doOpentypeSVG(e){var t=this
let o={string:e.text,fontSize:e.fontSize,letterSpacing:e.letterSpacing,lineHeight:e.lineHeight,textAlign:e.textAlign,decimals:1,singleGlyphs:!1}
function r(e,t){const o=e.charToGlyph(t)
return 0===o.index||".notdef"===o.name}var n=t.fontOpenTypeData,i=o.fontSize
let a=n.unitsPerEm,l=i/a
var s=o.textAlign,c=!1
t.itemData.box&&t.itemData.box.enabled&&(c=!0)
let u=n.charToGlyph("l").yMax
n.charToGlyph("g").yMin
const m=o.fontSize*o.lineHeight
if(""==o.string)return"<svg></svg>"
var p="",d=null,f=o.string+""
const v=o.letterSpacing*o.fontSize,h=o.fontSize/n.unitsPerEm
let g=0
if(c){var y=1*t.itemData.box.width
d=t.breakTextIntoLines(n,f,h,y)}else d=f.split("\n")
var b=d.length,x=0,w=0,k=[]
d.forEach((e,o)=>{x=0,g=0
for(let l=0;l<e.length;l++){var i=e[l]
r(n,i)&&console.log("missing_"+i+"_ on",t.name)
var a=n.charToGlyph(i).advanceWidth*h
g+=a+v,x=g}x-=v,(x=Math.abs(x))>w&&(w=x),k.push(x)})
var C,S=w
c&&(S=1*t.itemData.box.width),d.forEach((e,t)=>{g=0,C=0
var r=k[t]
"right"==s&&(g=S-r),"center"==s&&(g=(S-r)/2),"justify"==s&&(C=(S-r)/(e.length-1),b>1&&t==b-1&&(C=0))
for(let s=0;s<e.length;s++){var i=e[s]
const r=0+t*m,c=n.charToGlyph(i)
var a=c.getPath(g,r,o.fontSize).toSVG(o.decimals)
p+="<g>"+a+"</g>"
var l=c.advanceWidth*h
g+=l+v,g+=C}})
var T=0-u/a*100/100*o.fontSize,D=o.fontSize*b
D+=(b-1)*(m-o.fontSize)
var P=w
return c&&(P=1*t.itemData.box.width),"<svg>"+p+`<g><rect x="0" y="${T}" width="${P}" height="${D}" /></g>`+"</svg>"}breakTextIntoLines(e,t,o,r){const n=[]
let i="",a=0
var l=[]
const s=e.stringToGlyphs(t,{features:{liga:!1,dlig:!1}})
s.forEach((e,o)=>{const r=t[o]
e.canBreakAfter=!1,32!==e.unicode&&"-"!==r||(e.canBreakAfter=!0),"\n"===r&&(e.canBreakAfter=!0)})
for(var c=0,u=0;c<s.length;){const e=s[c],p=t[c],d=e.advanceWidth*o
if(++u>=1e3){console.log("reached max txt -> ",1e3)
break}if(a+d>r&&p.trim()||"\n"==p){var m=l.length-1
if("\n"!=p)for(m=l.length-1;m>0&&!l[m].canBreakAfter;m--);0==m&&(m=l.length-1),c-=l.length-m-1,i=i.slice(0,m+1),n.push(i),i=t[c],a=d,l=[s[c]]}else i+=p,a+=d,l.push(e)
c++}return i&&n.push(i),n.forEach(function(e,t){n[t]=e.trimStart().trimEnd()}),n}getFontValue(){var e=this.itemData.font
return e||(e="Roboto"),e}loadFont(e,t){var o=this,r=!1
if(o.loadedFont!=t){if(_fonts.forEach(function(n){n.value==t&&(r=!0,loadFont(t,function(r){o.loadedFont=t,o.createFontData(r),e.call(o)}))}),!r){var n=t
if(n){o.libManagerItem=o.getters.getLibraryManagerItemByLibUid(n)
var i=o.getFileData()
if(!i){console.error("missing font data -> use Roboto")
t="Roboto"
return void loadFont(t,function(r){o.loadedFont=t,o.createFontData(r),e.call(o)})}o.createFontData(i),o.loadedFont=t,e.call(o)}}}else e.call(o)}createFontData(e){this.fontFileData=e,this.fontOpenTypeData=opentype.parse(e)}SVGToMesh(e,t){var o=this
const r=(new DOMParser).parseFromString(e,"image/svg+xml").querySelectorAll("g")
if(0==r.length)return new THREE.Object3D
var n=new THREE.Group,i=r[r.length-1],a=o.SVGLoader.parse(i.outerHTML),l=a.paths[0]
try{var s=SVGLoader.createShapes(l)}catch(k){console.log("ERROR on text createShapes"),console.log(k),console.log(l),console.log(a),console.log(o.isReady,o.isMissing,o.isDestroyed)}var c=new THREE.ShapeGeometry(s[0]),u={split:!0,uvSmooth:!1,preserveEdges:!1,flatOnly:!0,maxTriangles:25e3},m=LoopSubdivision.modify(c,u.iterations,u)
m.rotateX(Math.PI),m.deleteAttribute("uv"),m.deleteAttribute("normal"),m.computeBoundingBox()
var p=m.boundingBox,d=new THREE.Vector3
p.getSize(d)
var f={x:0,y:0},v=o.getParamValueAt(0,"text align")
"center"==v&&(f.x=-1*d.x/2-p.min.x),"right"==v&&(f.x=-1*d.x/1-p.min.x),o.itemData.anchorPoint&&(f.x=-1*d.x/2-p.min.x),f.y=-1*d.y/2-p.min.y
var h,g,y
for(h=0;h<r.length-1;h++){var b=r[h].outerHTML
const e=o.SVGLoader.parse(b).paths
var x=new THREE.Group
for(x.name=t[h],g=0;g<e.length;g++){const t=SVGLoader.createShapes(e[g])
for(y=0;y<t.length;y++){const e=new THREE.ShapeGeometry(t[y],12)
e.deleteAttribute("uv"),e.deleteAttribute("normal"),e.rotateX(Math.PI),e.translate(f.x,f.y,0)
const r=new THREE.Mesh(e,o.materials[0])
x.add(r)}}n.add(x)}m.translate(f.x,f.y,0)
const w=new THREE.Mesh(m,o.materials[1])
return w.name="text bg",n.add(w),n}destroyItemText(){var e=this
e.threejsObj&&(e.threejsObj.dispose(),e.threejsObj=null),e.hookClone&&(_config.troikaText&&e.hookClone.children[0].dispose(),e.hookClone=null)}}e.default=r})
define("pikimov/classes/items/video-item",["exports","pikimov/classes/items/scene-item","@ember/object","@sentry/ember"],function(e,t,o,r){function n(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class i extends t.default{constructor(e,t,o){super(e,t,o),n(this,"worker",null),n(this,"videoProperties",null),n(this,"onDrawnCallback",null),n(this,"duration",0),n(this,"videoFrameIn",0),n(this,"videoFrameOut",0),n(this,"videoFrameMin",0),n(this,"videoFrameMax",0),n(this,"usedVideoFrames",null),n(this,"isCacheCleared",!1),n(this,"resDivider",1),n(this,"videoFrameIndex",0),n(this,"starterCachedFrames",[]),n(this,"cachedFrames",[]),n(this,"waitingForBitmap",!1),n(this,"textureFrameIndex",-1),n(this,"maxCachedFrames",180),n(this,"maxCachedFramesExport",40)}buildItem(){this.materials[0]=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,transparent:!0}),this.initWorker()}flipGeometry(){var e=this,t=e.threejsObj
e.videoProperties.rotated&&(console.log("V video- rotate geometry - -",e.videoProperties.rotation),t.rotateZ(Math.PI/2),t.updateMatrix(),t.geometry.applyMatrix4(t.matrix),t.rotation.set(0,0,0),t.updateMatrix()),t.rotateX(-1*Math.PI),t.updateMatrix(),t.geometry.applyMatrix4(t.matrix),t.rotation.set(0,0,0),t.updateMatrix()}initWorker(){var e=this
e.worker=new Worker("js/workers/"+_config.wv),e.worker.addEventListener("message",function(t){e.onMessageFromWorker(t)})
var t=e.getFileData(),o=e.getDimensionsAt(),r=o.width*o.height,n=1
_config.videos.lowHD&&(r>921600&&(n=2),r>=8294400&&(n=4)),e.resDivider=n,e.frameRate=e.libManagerItem.itemData.frameRate
var i=_videoCacheConfig,a={compUid:e.compUid,durationMs:e.libManagerItem.durationMs,nbSamples:e.libManagerItem.itemData.nbFrames,frameRate:e.frameRate}
e.compositionManager.isActive||(e.updateInOutFrames(!1),a.maxFrame=e.videoFrameMax)
var l={blob:t,resolutionDivider:n,cacheConfig:i,infos:a,what:"start"}
e.postMessageToWorker(l)}onStarterCacheReady(){var e=this
e.texture=new THREE.Texture,e.materials[0].map=e.texture,e.doMesh(),e.addToScene(),e.onReady()}postMessageToWorker(e,t=null){this.isMissing||this.isDestroyed||this.worker.postMessage(e,t)}onMessageFromWorker(e){var t=this,o=t.controller.compositionManager.isExporting,n=e.data,i=n.what
if("onReady"!=i){if("configurationError"==i)return alert("Video codec or resolution not supported\n\nitem: "+t.name+"\ncodec: "+n.codec),t.isMissing=!0,void t.onReady()
if("onStarterCacheReady"==i)return t.onStarterCacheReady(),void requestAnimationFrame(function(){t.drawCacheViewer()})
if("starterImageBitmap"==i){var a={image:n.image,frameIndex:n.frameIndex}
t.addToStarterCache(a)}if("exportQueueCompleted"==i&&o&&(t.onExportQueueCompleted(),n.usedSecondChance&&(t.controller.usedExportSecondChance=!0)),"imageBitmap"==i){var l=n
if(o&&t.isFromCloud){a={image:l.image,timestamp:l.timestamp,frameIndex:l.frameIndex}
return void t.addToCache(a)}if(t.waitingForBitmap)if(t.videoFrameIndex==l.frameIndex)t.waitingForBitmap=!1,t.updateBitmapTexture(l),t.onDrawnCallback.call(t,t.itemData)
else{var s=t.getFrameFromCacheByIndex(t.videoFrameIndex)
s&&(t.waitingForBitmap=!1,t.updateBitmapTexture(s),t.onDrawnCallback.call(t,t.itemData))}a={image:l.image,timestamp:l.timestamp,frameIndex:l.frameIndex}
t.addToCache(a)}if("onDecodeCompleted"!=i)if("decoderError"!=i)"maxedOut"==i&&(console.log("decoder maxed out on",n.frameIndex,", update out value"),t.updateInOutFrames(),t.waitingForBitmap&&(console.log("REALLY GIVE UP"),t.skipFrame(e.data))),"updateInOut"==i&&t.updateInOutFrames(),"drawCacheViewer"==i&&t.drawCacheViewer()
else{t.controller.playbackUtils.pause()
var c=""
t.videoProperties&&t.videoProperties.config&&(c=t.videoProperties.config.codec)
var u=n.error
if(gaEvent({event:"error - dec - "+u}),!n.silentError){var m=t.libManagerItem.filename
_config.sentry&&r.captureMessage("Video decoderError",{extra:{error:n.error,codec:c,videoProperties:t.videoProperties,videoFrameIndex:t.videoFrameIndex}}),alert(m+" #"+t.videoFrameIndex+"\n\nVideo decoderError \n\n"+u+"\n\ncodec: "+c)}}else if(o&&(console.log("something bad happenned while exporting"),console.log("data.skipped",n.skipped)),n.skipped){if(!t.waitingForBitmap)return
t.skipFrame(e.data)}else t.onDrawnCallback&&t.onDrawnCallback.call(t,t.itemData)}else{t.videoProperties=n.videoProperties,t.duration=t.videoProperties.duration,t.updateMaxFrames(),t.updateInOutFrames(!1)
var p={what:"doStarterCache",videoFrameIn:t.videoFrameIn,videoFrameOut:t.videoFrameOut,videoFrameMin:t.videoFrameMin,videoFrameMax:t.videoFrameMax}
t.postMessageToWorker(p)}}onExportQueueCompleted(){var e=this
if(!e.isDestroyed){var t=e.getFrameFromCacheByIndex(e.videoFrameIndex)
if(!t)return console.log("no frame :/",e.videoFrameIndex),void setTimeout(function(){if(!e.isDestroyed){if(!(t=e.getFrameFromCacheByIndex(e.videoFrameIndex)))return console.log("export q: STILL no frame #",e.videoFrameIndex),console.log(e.videoProperties),console.log("cachedFrames x",e.cachedFrames.length),_config.isDebug&&(console.log(e.starterCachedFrames),console.log(e.cachedFrames)),alert("error onExportQueueCompleted: no frame"),void e.onDrawnCallback.call(e,e.itemData)
e.updateBitmapTexture(t),e.onDrawnCallback.call(e,e.itemData)}},2e3)
e.updateBitmapTexture(t),e.onDrawnCallback.call(e,e.itemData)}}getVideoFrameIndex(e){var t=this,o=t.itemData.time
0==t.frameRate&&console.warn("warning, getVideoFrameIndex - framerate zero")
var r,n=(e-o.in+o.trackIn)/t.compositionData.frameRate*t.frameRate,i=0,a=o.in-o.trackIn,l=t.getParamByName("speed")
if(l.useKeyframes){var s
for(s=a;s<e;s++)i+=t.getParamValueAt(s,"speed")
r=e-a!=0?i/(e-a):t.getParamValueAt(e,"speed")}else r=l.value
return(n=Math.round(n*r/100))<0&&(n=0),n}updateBitmapTexture(e){var t=this
t.textureFrameIndex=e.frameIndex,t.texture.image=e.image,t.texture.needsUpdate=!0}getFrameFromCacheByIndex(e){var t=!1,o=null
return this.starterCachedFrames.forEach(function(r){t||r.frameIndex==e&&(o=r,t=!0)}),o||(this.cachedFrames.forEach(function(r){t||r.frameIndex==e&&(o=r,t=!0)}),o)}addToStarterCache(e){this.starterCachedFrames.push(e)}addToCache(e){var t,o=this
o.cachedFrames.push(e)
var r=e.frameIndex
for(t=0;t<o.cachedFrames.length;t++){if(o.cachedFrames[t].frameIndex==r)if(e.timestamp!=o.cachedFrames[t].timestamp)if(console.warn("duplicate added to cache for #"+r),console.warn("new",e.timestamp,"old",o.cachedFrames[t].timestamp),o.getFrameFromCacheByIndex(r+1))console.error("no solution for #"+r)
else{console.log("fixing frameIndex value ->",r+1)
var n=o.cachedFrames[t]
e.timestamp>n.timestamp?e.frameIndex++:n.frameIndex++,console.log("new values",e.timestamp,e.frameIndex,"|",n.timestamp,n.frameIndex)}}var i=o.maxCachedFrames
o.controller.compositionManager.isExporting&&(i=o.maxCachedFramesExport),o.cachedFrames.length>i&&(o.cachedFrames[0].image&&o.cachedFrames[0].image.close(),o.cachedFrames.shift()),o.drawCacheViewer()}getReadyToRender(e){var t=this
if(t.itemData.repeat&&t.itemData.repeat.enabled){var o=1*t.itemData.repeat.end-1
e>o&&(e%=o+1)}t.requestFrame(e,function(){t.onReadyTorender()})}requestFrame(e,t=null){var o=this
o.isCacheCleared=!1,o.waitingForBitmap=!1,t&&(o.onDrawnCallback=t)
var r=o.getVideoFrameIndex(e)
o.videoFrameIndex=r
var n=o.libManagerItem.itemData.nbFrames
o.videoFrameIndex>=n&&(console.warn("cap framesIndex to nbFrames"),o.videoFrameIndex=n-1)
var i=o.controller.playbackUtils.isPlaying,a=o.controller.compositionManager.isExporting,l=o.getFrameFromCacheByIndex(r)
if(a&&o.isFromCloud)l=o.getFrameFromCacheByTimestamp(r)
if(a){if(l)return o.updateBitmapTexture(l),void o.onDrawnCallback.call(o,o.itemData)
var s={what:"requestFrameExport",frameIndex:r}
o.postMessageToWorker(s)}else{var c=!1
if(l&&(c=!0,o.updateBitmapTexture(l),o.onDrawnCallback.call(o,o.itemData)),i||!c){c||(o.waitingForBitmap=!0)
var u=!0
if(c&&(u=!1),i&&(u=!1),i&&o.waitingForBitmap){var m=null,p=!0
if(o.cachedFrames.length||(p=!1),p){var d,f=0,v=1e3
for(d=0;d<o.cachedFrames.length;d++)if(o.cachedFrames[d].frameIndex<r){var h=Math.abs(r-o.cachedFrames[d].frameIndex)
h<v&&(v=h,f=d)}v<100&&(m=o.cachedFrames[f],o.textureFrameIndex==m.frameIndex&&(p=!1))}m||(p=!1),p&&o.updateBitmapTexture(m),o.skipFrame()}s={what:"requestFrame",frameIndex:r,foundInCache:c,mustRender:u}
o.postMessageToWorker(s)}}}skipFrame(e={}){var t=this
t.waitingForBitmap=!1,console.log("* * decoding skipped",t.videoFrameIndex),t.compositionManager.isActive&&!e.sameFrame&&(0,o.set)(t.controller,"skippedWorkersFrames",t.controller.skippedWorkersFrames+1),t.onDrawnCallback&&t.onDrawnCallback.call(this,t.itemData)}setExportSize(){var e=this
if(!e.isMissing&&!e.isIgnored){e.texture&&(e.texture.dispose(),e.texture=void 0),e.texture=new THREE.Texture,e.materials[0].map=e.texture
var t={what:"setRenderSize",displayWidth:e.libManagerItem.width,displayHeight:e.libManagerItem.height}
e.postMessageToWorker(t)}}updateRequestedFrameIndex(e){var t={what:"updateRequestedFrameIndex",frameIndex:this.getVideoFrameIndex(e)}
this.postMessageToWorker(t)}updateInOutFrames(e=!0){var t=this,o=t.itemData.time.in
o<0&&(o=0)
var r,n=t.itemData.time.out
for(n>t.compositionData.time.end&&(n=t.compositionData.time.end),t.videoFrameIn=t.getVideoFrameIndex(o),t.videoFrameOut=t.getVideoFrameIndex(n),t.usedVideoFrames=[],r=o;r<=n;r++)t.usedVideoFrames.push(t.getVideoFrameIndex(r))
var i=t.usedVideoFrames.reduce(([e,t],o)=>[Math.min(e,o),Math.max(t,o)],[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY])
if(t.videoFrameMin=i[0],t.videoFrameMax=i[1],e){var a={what:"updateInOutFrames",videoFrameIn:t.videoFrameIn,videoFrameOut:t.videoFrameOut,videoFrameMin:t.videoFrameMin,videoFrameMax:t.videoFrameMax}
t.postMessageToWorker(a)}}drawCacheViewer(){var e=this
if(!_config.isDebug)return
if(e.isDestroyed)return
if(!e.compositionManager)return
if(!e.compositionManager.isActive)return
if(!e.controller.keyframesUtils)return
var t="cacheViewer_"+e.compUid,o=document.getElementById(t)
if(!o){var r=document.getElementById("timeBar")
if(!r)return;(o=document.createElement("canvas")).id=t,o.height=10,o.width=r.clientWidth,o.style.position="absolute",o.style.top="0px",o.style.left="0px",r.appendChild(o)}const n=o.getContext("2d")
n.clearRect(0,0,o.width,o.height),n.beginPath()
var i=e.controller.keyframesUtils.timelineZoom,a=e.compositionData.frameRate/e.frameRate,l=Math.floor(i)-1
l<1&&(l=1)
var s,c,u=1*e.itemData.time.in
e.starterCachedFrames.forEach(function(e){s=e.frameIndex*a+u,c=Math.floor(s*i),n.moveTo(c,10),n.lineTo(c,0)}),e.cachedFrames.forEach(function(e,t){s=e.frameIndex*a+u,c=Math.floor(s*i),n.moveTo(c,10),n.lineTo(c,0)}),n.strokeStyle="rgb(80, 220, 80)",n.lineWidth=l,n.stroke()}checkIfCacheCanBeCleared(e){var t=this
if(!t.isCacheCleared&&!t.isTimeInFrame(e)){var o=t.itemData.time,r=!1
1*o.in-500>e&&(r=!0),1*o.out+500<e&&(r=!0),r&&t.clearCache(!0)}}clearCache(e=!1){var t=this
!e&&t.starterCachedFrames.length&&(t.starterCachedFrames.length&&t.starterCachedFrames.forEach(function(e){e.image.close(),e.image=void 0,e=void 0}),t.starterCachedFrames=[]),t.cachedFrames.length&&(t.cachedFrames.forEach(function(e){e.image&&e.image.close(),e.image=void 0,e=void 0}),t.cachedFrames=[])
var o={what:"clearCaches",keepStarterCache:e}
t.worker&&t.postMessageToWorker(o),t.isCacheCleared=!0,t.drawCacheViewer()}destroyItemVideo(){var e=this
if(e.worker){e.postMessageToWorker({what:"destroy"}),e.worker.terminate(),e.worker=void 0}}}e.default=i}),define("pikimov/classes/managers/composition-manager",["exports","pikimov/classes/renderers/render-engine-2d","pikimov/classes/renderers/render-engine-3d","pikimov/classes/composition-builder","@ember/object"],function(e,t,o,r,n){function i(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=class{constructor(e,t,o){i(this,"controller",null),i(this,"compositionData",null),i(this,"getters",null),i(this,"isActive",!1),i(this,"depthLevel",0),i(this,"cameraType",null),i(this,"currentFrame",0),i(this,"frameRate",1),i(this,"oneFrameMs",0),i(this,"canvas",null),i(this,"camera",null),i(this,"scene",null),i(this,"renderEngine",null),i(this,"ambientLight",null),i(this,"sceneItemComposition",null),i(this,"sceneItems",[]),i(this,"isRenderingDisabled",!1),i(this,"isReady",!1),i(this,"isRendering",!1),i(this,"isExporting",!1),i(this,"composerBg",null),i(this,"shaderBg",null),i(this,"shaderBgPass",null),i(this,"callbackOnReady",null),i(this,"startingTime",0),i(this,"lastTime",0),i(this,"skipFPSTime",!0),i(this,"statsBox",null),i(this,"timers",{startTimeGetReady:0,timeGetReady:0,startTimeRender:0,timeRender:0}),i(this,"renderTimeout",null)
i(this,"audioContext",null),i(this,"compositionBuilder",null),i(this,"isPreparing",!1),i(this,"nbItemsReadyToRender",0),i(this,"callbackRender",null)
var r=this;(r.controller=e,r.compositionData=t,r.getters=r.controller.getters,r.depthLevel=o,r.cameraType=r.compositionData.cameraType,r.frameRate=r.compositionData.frameRate,r.oneFrameMs=parseInt(1e3/r.frameRate),r.audioContext=new AudioContext,"3D"==r.cameraType)&&(0==r.getters.getAllCompositionItems(r.compositionData,"camera").length&&r.addCamera3D(),r.getters.getAllCompositionItems(r.compositionData,"camera")[0].target||console.log("ERROR: camera item not found"))}load(e){var r=this
if(console.log("%c // OPEN COMP "+r.compositionData.name+" // "+r.isActive+" ","background: #206020; color: #ffe433"),r.canvas=e,r.composerBg=null,r.scene)for(var n=r.scene;n.children.length>0;)n.remove(n.children[0])
else r.scene=new THREE.Scene,r.scene.name="scene one"
r.ambientLight=new THREE.AmbientLight,r.ambientLight.name="ambientLight",r.updateAmientLight(),r.scene.add(r.ambientLight),r.ambientLight.layers.enableAll(),"2D"==r.cameraType&&(r.renderEngine=new t.default(r.controller,this,r.compositionData,r.scene)),"3D"==r.cameraType&&(r.renderEngine=new o.default(r.controller,this,r.compositionData,r.scene)),r.camera=r.renderEngine.activeCamera,r.isActive&&(window._renderer=r.renderEngine.renderer,window._scene=r.scene),r.canvas.addEventListener("webglcontextlost",function(e){console.error("CTX LOST ",_nbContexts,r.compositionData.name),r.isExporting&&(r.controller.contextLostDuringExport=!0)},!1),r.canvas.addEventListener("webglcontextrestored",function(e){console.error("CTX RESTORED ",_nbContexts,r.compositionData.name),r.isExporting&&console.log("this is bad, must relink context")},!1),r.isActive&&r.setCSSSize(),(_config.isDebug||_config.stats)&&r.isActive&&r.createStatsBox()}createStatsBox(){var e=this,t="statsBox",o=document.getElementById(t)
o&&o.remove(),e.statsBox=document.createElement("div"),e.statsBox.id=t
var r=Math.floor(1e3/e.compositionData.frameRate)
e.statsBox.style.height=r+"px",document.querySelector("#middleColumn").appendChild(e.statsBox)}get nbItems(){return this.sceneItems.length}getItems(){return this.compositionData.items}getDimensions(){return{width:1*this.compositionData.dimensions.width,height:1*this.compositionData.dimensions.height}}updateDimensions(){this.resizeCanvas()}resizeCanvas(){var e=this
e.isReady&&(e.renderEngine.resize(),e.isActive&&(e.setCSSSize(),e.controller.controlsUtils.updateControlsSize(),e.sceneItems.forEach(function(e){e.controlsHandles&&e.controlsHandles.update(),e.effectManager&&e.effectManager.updateUI()})),e.sceneItems.forEach(function(e){"composition"==e.type&&e.resizeCompositionItemCanvas(),"camera"==e.type&&e.doMeshCamera()}),e.controller.playbackUtils.isPlaying||e.requestRender(!1))}setCSSSize(){var e=this,t=e.renderEngine.getCSSSize()
e.canvas.style.width=t.width+"px",e.canvas.style.height=t.height+"px",e.renderEngine.renderEngineCSS3&&e.renderEngine.renderEngineCSS3.resize()}resizeForExport(e,t){var o=this
o.controller.setCompositionDisplayZoom(t)
var r=o.getDimensions(),n=r.width*e/100,i=r.height*e/100
o.canvas.style.width=n+"px",o.canvas.style.height=i+"px"}getZoom(){if(this.isActive){var e=this.controller.compositionDisplayZoom
return e>100&&(e=100),e}return 100}setView(e){this.renderEngine.setActiveCamera(e),this.controller.controlsUtils.createTransformControls()}pause(){var e=this
e.stopAllAudios(),e.isRendering=!1,e.sceneItems.forEach(function(e){"composition"!=e.type||e.isMissing||e.sub_compositionManager&&e.sub_compositionManager.pause()})}close(){var e=this
if(console.log("%c // CLOSE COMP "+e.compositionData.name+" // ","background: #602020; color: #ffe433"),e.isReady=!1,e.disableRendering(),e.callbackOnReady=null,e.sceneItems.forEach(function(e){e.destroy(),e=void 0}),e.sceneItems=[],e.renderEngine&&(e.renderEngine.destroy(),e.renderEngine=void 0),e.scene)for(;e.scene.children.length>0;)e.scene.remove(e.scene.children[0])
e.camera=null,e.scene=null,e.ambientLight.dispose(),e.ambientLight=null,e.canvas=void 0,e.composerBg&&(console.log("CHOP -------- composerBg"),e.composerBg.passes.forEach(function(e){e.dispose(),e=void 0}),e.composerBg.dispose(),e.composerBg=void 0),e.audioContext&&e.audioContext.close(),e.compositionBuilder=null,e.controller.keyframesUtils&&e.controller.keyframesUtils.closeContextMenus()}updateBgColorAndGrid(){var e=this
"2D"==e.cameraType&&e.renderEngine.doBackGroundShader(),e.cameraType}updateAmientLight(){var e=this
e.ambientLight.intensity=1*e.compositionData.ambientLight.intensity
var t=e.compositionData.ambientLight.color
e.ambientLight.color=valueToSRGB(t)}buildCompositionThenSelect(e=null){var t=this
t.controller.selectionUtils.saveHoldItems(e)
t.buildComposition(function(){t.controller.refreshAndSelect()})}buildComposition(e=null){var t=this
t.isReady=!1,t.callbackOnReady=null,e&&(t.callbackOnReady=e),t.isActive&&t.controller.setCompositionReadyFlag(!1),"2D"==t.cameraType&&t.renderEngine.disposeFinalComposer(),t.disableRendering(),t.sceneItems.forEach(function(e){e.destroy(),e=void 0}),t.sceneItems=[],t.compositionBuilder=new r.default(t),t.compositionBuilder.buildComposition(t.sceneItems)}onItemsReady(){var e=this,t=e.controller
console.log("on items ready :",e.compositionData.name),e.isReady=!0,e.enableRendering(),e.renderEngine.setup(e.sceneItems),e.callbackOnReady&&(e.callbackOnReady.call(e),e.callbackOnReady=null),e.isActive&&(t.setCompositionReadyFlag(!0),requestAnimationFrame(function(){t.uiManager&&(t.uiManager.resizeHandler(),t.uiManager.keyboardFocus())
var o=new compositionsUtils(t,e.compositionData)
o.rebuildSoft(),o=null}))}addToComposition(e){console.log("OBS: CM + add to comp")
var t=new compositionsUtils(this.controller,this.compositionData),o=t.addToComposition(e)
return t=null,o}removeItemByCompUid(e,t=null){var o=this
null===t&&(t=o.getItems()),o.sceneItems.forEach(function(t,r){t.compUid==e&&(t.destroy(),t=null,o.sceneItems.splice(r,1))})
var r=new compositionsUtils(o.controller,o.compositionData)
r.removeItemByCompUid(e),r=null}isItemsLimitReached(e=1){return this.getters.getAllCompositionItems(this.compositionData).length+e>_config.compositions.maxItems&&(alert("Cannot add more items, limit reached ("+_config.compositions.maxItems+")"),!0)}splitItem(e,t){var o=this
if(!(e.time.in>=t||e.time.out<=t)){var r=o.getters.getJsonItemParentByCompUid(o.compositionData,e.compUid)
r||(r=o.compositionData)
var i=0
r.items.forEach(function(t,o){t.compUid==e.compUid&&(i=o)})
var a=structuredClone(e);(0,n.set)(e.time,"out",t-1)
var l=e.type
if("video"==l||"audio"==l||"composition"==l||"imageSequence"==l){var s=t-a.time.in+a.time.trackIn,c=s-a.time.trackIn
a.time.trackIn=s,a.time.in+=c}else a.time.in=t
var u=new compositionsUtils(o.controller,o.compositionData),m=u.addToComposition({itemData:a,index:i,eventName:"split item",parentCompUid:r.compUid})
return u=null,m}}refreshComposition(e){var t=this
t.controller.isCompositionReady&&(t.currentFrame=e,t.sceneItems.forEach(function(t){var o=t.isVisibleInframe(e)
o&&t.applyFrame(e),t.highlightBox&&t.highlightBox.update(e),"audio"==t.type&&!o&&t.isAudioPlaying&&t.stopAudio(),"video"==t.type&&t.checkIfCacheCanBeCleared(e)}),"3D"==t.cameraType&&t.isActive&&t.controller.controlsUtils.updateSelection())}enableRendering(){this.isRenderingDisabled=!1}disableRendering(){this.isRenderingDisabled=!0,this.isRendering=!1}setFrame(e){this.controller.setFrame(e)}renderSameFrame(){this.requestRender(!0)}requestRenderWhilePlaying(e){this.refreshComposition(e),this.getReadyToRender(null)}requestRender(e=!1){var t=this
t.isRenderingDisabled||t.renderTimeout||(t.renderTimeout=setTimeout(function(){var o=t.getReadyToRender(null,e)
t.renderTimeout=null,o||(t.renderTimeout=setTimeout(function(){t.getReadyToRender(null,e),t.renderTimeout=null},20))},20))}getReadyToRender(e=null,t=!1){var o=this
if(o.statsBox&&(o.timers.startTimeGetReady=new Date),!o.isReady)return!1
if(!o.controller.isCompositionReady)return!1
if(o.isRenderingDisabled)return!1
var r=o.controller.compositionManager.isExporting
if(o.isActive&&!r&&(o.skipFPSTime=!o.skipFPSTime,!o.skipFPSTime)){var i=(new Date).getTime()
if(o.lastTime){var a=i-o.lastTime,l=Math.round(1e3/a*2),s=Math.round(1*o.frameRate)
l>s&&(l=s),o.controller.currentFPS!=l&&(0,n.set)(o.controller,"currentFPS",l),o.lastTime=i}else o.lastTime=i}return o.nbItemsReadyToRender=0,o.callbackRender=e,0==o.nbItems?(o.doRender(),e&&e.call(this),!0):t?(o.doRender(),!0):(o.isPreparing=!0,o.sceneItems.forEach(function(e){e.isMissing||e.isDestroyed||!e.isVisibleInframe(o.currentFrame)?o.onOneItemReadyToRender(e):e.getReadyToRender(o.currentFrame)}),!0)}onOneItemReadyToRender(e){var t=this,o=t.nbItems
if(t.nbItemsReadyToRender++,t.nbItemsReadyToRender>o&&(console.error("ERROR too much items ready |",t.compositionData.name,"#",t.currentFrame,t.nbItemsReadyToRender,"/",o),t.isExporting&&(console.log("isExporting -> will get stuck?"),gaEvent({event:"error export nbItems ready"}))),t.nbItemsReadyToRender==o){if(t.isPreparing=!1,t.isRenderingDisabled)return console.log("R - aborted -",t.compositionData.name),t.isRendering=!1,void(t.callbackRender&&t.callbackRender.call(this))
t.doRender(),t.callbackRender&&t.callbackRender.call(this)}}doRender(){var e=this
if(e.statsBox&&(e.timers.timeGetReady=new Date-e.timers.startTimeGetReady,e.timers.startTimeRender=new Date),e.isRendering=!0,e.renderEngine.render(e.currentFrame),e.isRendering=!1,e.statsBox){e.timers.timeRender=new Date-e.timers.startTimeRender
var t=e.timers.timeGetReady,o=e.timers.timeRender
e.statsBox.innerHTML=`<div style="height:${t}px;"></div><div style="bottom:${t}px;height:${o}px;"></div>`}e.isActive&&"2D"==e.cameraType&&e.sceneItems.forEach(function(e){e.controlsHandles&&e.controlsHandles.update()})}renderNextFrame(e,t=1){var o=this
o.controller.currentFrame+=t,o.refreshComposition(o.controller.currentFrame),o.getReadyToRender(e)}increaseSkippedFramesCounter(e){var t=this.controller;(0,n.set)(t,"skippedFrames",t.skippedFrames+e)}saveFrame(){var e=this
console.log("save Frame"),e.isExporting=!0,e.controller.setCompositionDisplayZoom(100),"3D"==e.cameraType&&"editor"==e.renderEngine.activeView&&e.setView("camera"),setTimeout(function(){requestAnimationFrame(function(){e.isExporting=!1
var t=e.controller.currentFrame,o=""
t<1e3&&(o+="0"),t<100&&(o+="0"),t<10&&(o+="0")
var r="frame_"+o+t+".png";(async function(e,t){try{const o=await new Promise(t=>e.toBlob(t,"image/png")),r=await window.showSaveFilePicker({suggestedName:t,types:[{description:"PNG Image",accept:{"image/png":[".png"]}}]}),n=await r.createWritable()
await n.write(o),await n.close()}catch(o){console.error("Catch error save as frame:",o)}})(e.canvas,r)})},100)}stopAllAudios(){this.sceneItems.forEach(function(e){"audio"==e.type&&e.stopAudio()})}restartAudiosFrameZero(){var e=this
function t(o){o.isMissing||o.ignored||("audio"==o.type&&o.restartAudioFrameZero(),"composition"==o.type&&(o.sub_compositionManager||(console.log("warning - sub_compositionManager null"),console.log("item",o.name,o.type),console.log(e.isActive),console.log(e.compositionData.name),console.log("- - - ")),o.sub_compositionManager.sceneItems.forEach(function(e){t(e)})))}this.sceneItems.forEach(function(e){t(e)})}addCamera3D(){var e=this,t=e.getDimensions().height,o={x:0,y:0,z:Math.round(-1e3*t/1080)},r={type:"camera",name:"Camera",position:{values:{x:o.x,y:o.y,z:o.z}},rotation:{values:{x:0,y:0,z:0}},scale:{values:{x:100,y:100,z:100},hidden:!0},target:{enabled:!1},params:[{name:"fov",type:"number",min:30,max:90,value:55,unit:""},{name:"zoom",type:"number",min:1,max:10,value:1,unit:""}],effects:[]},n=new compositionsUtils(e.controller,e.compositionData)
r.compUid=n.generateCompItemUid(),n=null,e.getItems().unshift(r)}addCameraTarget(e){var t=this,o={type:"cameraTarget",name:"Camera target",position:{values:{x:0,y:0,z:0}},rotation:{values:{x:0,y:0,z:0},hidden:!0},scale:{values:{x:100,y:100,z:100},hidden:!0},params:[],effects:[]},r=new compositionsUtils(t.controller,t.compositionData)
o.compUid=r.generateCompItemUid(),r=null,t.getters.getCompItemByCompUid(t.compositionData,e).target.compUid=o.compUid,t.compositionData.items.splice(1,0,o)}}}),define("pikimov/classes/managers/curves-editor-manager",["exports"],function(e){function t(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=class{constructor(e,o){t(this,"controller",null),t(this,"isDragging",!1),t(this,"activeHandle",null),t(this,"compositionData",null),t(this,"propertyJson",null),t(this,"propertyValues",[]),t(this,"scaleX",2),t(this,"scaleY",2),t(this,"minValue",0),t(this,"maxValue",0),t(this,"width",100),t(this,"height",100),t(this,"valueName",null),t(this,"availableHeight",100),t(this,"boundOnMouseUp",null),t(this,"strokeColor","white"),t(this,"handlesColor","#ffb000")
var r=this
r.controller=e,r.scaleX=o,r.compositionData=r.controller.activeCompositionData,r.boundOnMouseUp=r.onMouseUp.bind(r),$(document.body).on("mouseup",r.boundOnMouseUp)}destroy(){$(document.body).off("mouseup",this.boundOnMouseUp)}onMouseUp(){var e=this
if(e.isDragging){var t=e.activeHandle.parent().parent().attr("data-valuename")
e.doProperty(e.propertyJson,t),e.isDragging=!1,e.controller.addToHistory("key","edit easing curve")}}onZoomChanged(e){this.scaleX=e,this.build()}setConfig(e){this.propertyJson=e.property,this.propertyValues=e.propertyValues,$("#curvesEditor .propertyName").text(e.itemName+"\n"+e.propertyName)}build(){var e=this
if(!e.isDragging){e.updateMinMax(e.propertyJson),e.availableHeight=e.controller.uiManager.timelineHeight-55-18,e.availableHeight-=20
var t=e.controller.uiManager.getAppWidth()-350-14
t-=20,e.width=t/e.scaleX,e.scaleY=e.availableHeight/e.height,e.createSVG(),e.propertyValues.forEach(function(t){e.doProperty(e.propertyJson,t)}),requestAnimationFrame(function(){e.addClickEvents()})}}updateMinMax(e){var t=this
t.minValue=0,t.maxValue=10,e.keyframes.forEach(function(e){Object.keys(e.values).forEach(function(o){var r=t.getKeyframeValue(e,o)
r<t.minValue&&(t.minValue=r),r>t.maxValue&&(t.maxValue=r)})}),t.height=t.maxValue-t.minValue}createSVG(){var e=this,t=document.querySelector("#curvesEditor")
if(t){var o=document.querySelector("#propertyCurve")
o&&o.remove()
var r=Math.round(e.width*e.scaleX),n=Math.round(e.height*e.scaleY),i=document.createElementNS("http://www.w3.org/2000/svg","svg")
i.id="propertyCurve",i.setAttribute("width",r),i.setAttribute("height",n),e.domSVG=i,t.appendChild(e.domSVG)}}doProperty(e,t){var o=this,r="white"
"x"==t&&(r="color-mix(in srgb, white 50%, red 50%)"),"y"==t&&(r="color-mix(in srgb, white 50%, green 50%)"),"z"==t&&(r="color-mix(in srgb, white 50%, blue 50%)")
var n=o.domSVG
if(n){(c=$(n).find('g[data-valuename="'+t+'"]')[0])&&c.remove(),n.innerHTML+=`<g data-valuename="${t}"><g class="paths"></g><g class="bars"></g><g class="keys"></g><g class="handles"></g></g>`
var i=e.keyframes[0]
if(i.frame>0){var a=o.getKeyframeValue(i,t),l=i.frame*o.scaleX,s=(o.height-a+o.minValue)*o.scaleY,c=$(n).find('g[data-valuename="'+t+'"] .paths')[0],u=`<path class="intro" d="M 0 ${s} L ${l} ${s}" stroke="${r}" stroke-width="1"/>`
c.innerHTML+=u}e.keyframes.forEach(function(n,i){var a=null
e.keyframes[i+1]&&(a=e.keyframes[i+1]),o.buildOneKeyframe(n,a,t,r,i)})
var m=e.keyframes[e.keyframes.length-1],p=1*o.compositionData.time.end
if(m.frame<p){a=o.getKeyframeValue(m,t)
var d=m.frame*o.scaleX
l=p*o.scaleX,s=(o.height-a+o.minValue)*o.scaleY,c=$(n).find('g[data-valuename="'+t+'"] .paths')[0],u=`<path class="outro" d="M ${d} ${s} L ${l} ${s}" stroke="${r}" stroke-width="1"/>`
c.innerHTML+=u}}else console.log("no domSVG, did undo?")}addClickEvents(){var e=this,t=$(e.domSVG),o=null
t.on("mousedown",function(t){var r=$(t.target)
if(r.is(".handle1")||r.is(".handle2")){e.activeHandle=r
var n=r.parent().parent()
o=n.attr("data-valuename"),e.isDragging=!0}}),t.on("mousemove",function(r){if(e.isDragging){var n=1*e.activeHandle.attr("data-key"),i=e.propertyJson.keyframes[n],a=e.propertyJson.keyframes[n+1],l=a.frame-i.frame,s=t.offset(),c=r.pageX-s.left,u=r.pageY-s.top
c/=e.scaleX,u/=e.scaleY,c<i.frame&&(c=i.frame),c>a.frame&&(c=a.frame),u<0&&(u=0),u>e.height&&(u=e.height)
var m=e.getKeyframeValue(i,o),p=e.getKeyframeValue(a,o),d=e.height-m+e.minValue,f=e.height-p+e.minValue
if("Custom"!=i.easing)e.convertKeyToCustom(n)
else{var v=(c-i.frame)/l*100
e.activeHandle.is(".handle1")&&(i.handles[o][0]={x:v,y:u-d}),e.activeHandle.is(".handle2")&&(i.handles[o][1]={x:v,y:u-f})}e.updatePath(n,o),e.controller.refreshAndRender(),e.controller.triggerRefreshInputsValues()}})}convertKeyToCustom(e){var t=this,o=t.propertyJson.keyframes[e],r=t.propertyJson.keyframes[e+1],n=r.frame-o.frame
console.log("CONVERT v",o.easing,"=> Custom"),o.handles||(o.handles={}),Object.keys(o.values).forEach(function(i){var a=t.getKeyframeValue(o,i),l=t.getKeyframeValue(r,i),s=t.height-a,c=t.height-l,u=t.getHandlesPositionByKeyIndex(t.propertyJson,i,e),m=(u.handle1x-o.frame)/n*100,p=(u.handle2x-o.frame)/n*100,d=u.handle1y-s,f=u.handle2y-c
o.handles[i]=[{x:m,y:d},{x:p,y:f}]}),o.easing="Custom",console.log("converted : "),console.log(o)}buildOneKeyframe(e,t,o,r,n){var i=this,a=$(i.domSVG).find('g[data-valuename="'+o+'"]'),l=i.getKeyframeValue(e,o),s=`<circle class="keyframe" cx="${e.frame*i.scaleX}" cy="${(i.height-l+i.minValue)*i.scaleY}" r="5" fill="#e0e0e0"/>`
if(a.find(".keys")[0].innerHTML+=s,t){var c=i.handlesColor,u=`<path data-key="${n}" d="" stroke="${r}" fill="transparent" stroke-width="1"/>`
a.find(".paths")[0].innerHTML+=u
var m=`<line class="bar1" data-key="${n}" x1="0" x2="0" y1="0" y2="0" stroke="${c}" stroke-width="1"/>`
m+=`<line class="bar2" data-key="${n}" x1="0" x2="0" y1="0" y2="0" stroke="${c}" stroke-width="1"/>`,a.find(".bars")[0].innerHTML+=m
var p=`<rect class="handle1" data-key="${n}" x="0" y="0" width="8" height="8" fill="${c}"/>`
p+=`<rect class="handle2" data-key="${n}" x="0" y="0" width="8" height="8" fill="${c}"/>`,a.find(".handles")[0].innerHTML+=p,i.updatePath(n,o)}}updatePath(e,t){var o=this,r=o.propertyJson.keyframes,n=o.scaleX,i=o.scaleY,a=r[e],l=r[e+1]
if(l){var s="",c=o.getKeyframeValue(a,t),u=o.getKeyframeValue(l,t),m=a.frame*n,p=(o.height-c+o.minValue)*i,d=l.frame*n,f=(o.height-u+o.minValue)*i,v=d-m,h=m,g=p,y=d,b=f,x=a.easing
if(x||(x="Quadratic.InOut"),"Quadratic.InOut"==x&&(h=m+45*v/100,g=p,y=m+55*v/100,b=f),"Linear"==x){var w=f-p
h=m+20*v/100,g=p+20*w/100,y=m+80*v/100,b=p+80*w/100}if("Cubic.In"==x&&(h=m+32*v/100,g=p,y=m+67*v/100,b=p),"Cubic.Out"==x&&(h=m+33*v/100,g=f,y=m+68*v/100,b=f),"Static"==x){var k=f
h=m,g=f=p,y=m,b=f
s=`M ${m} ${p} L ${d} ${p} L ${d} ${k}`}if("Custom"==x){var C=a.handles[t][0],S=a.handles[t][1]
h=m+v*C.x/100,g=p+C.y*i,y=m+v*S.x/100,b=f+S.y*i}var T=$(o.domSVG).find('g[data-valuename="'+t+'"]'),D=T.find('path[data-key="'+e+'"]'),P=T.find('.handle1[data-key="'+e+'"]'),M=T.find('.handle2[data-key="'+e+'"]'),j=T.find('.bar1[data-key="'+e+'"]'),E=T.find('.bar2[data-key="'+e+'"]')
"Static"!=x&&(s=`M ${m} ${p} C ${h} ${g}, ${y} ${b}, ${d} ${f}`),D.attr("d",s),P.attr("x",h-4).attr("y",g-4),M.attr("x",y-4).attr("y",b-4),j.attr("x1",m).attr("x2",h).attr("y1",p).attr("y2",g),E.attr("x1",d).attr("x2",y).attr("y1",f).attr("y2",b)}else console.log("last key")}getKeyframeValue(e,t){return e.values[t]}getHandlesPositionByKeyIndex(e,t,o){var r,n,i,a,l=this,s=e.keyframes[o],c=e.keyframes[o+1],u=l.getKeyframeValue(s,t),m=l.getKeyframeValue(c,t),p=s.frame,d=l.height-u,f=c.frame,v=l.height-m,h=f-p,g=s.easing
if(g||(g="Quadratic.InOut"),"Quadratic.InOut"==g&&(r=p+45*h/100,n=d,i=p+55*h/100,a=v),"Linear"==g){var y=v-d
r=p+20*h/100,n=d+20*y/100,i=p+80*h/100,a=d+80*y/100}if("Cubic.In"==g&&(r=p+32*h/100,n=d,i=p+67*h/100,a=d),"Cubic.Out"==g&&(r=p+33*h/100,n=v,i=p+68*h/100,a=v),"Static"==g&&(r=p,n=v,i=p,a=v),"Custom"==g){var b=s.handles[t][0],x=s.handles[t][1]
r=p+h*b.x/100,n=u-b.y,i=p+h*x.x/100,a=m-x.y,n=l.height-n,a=l.height-a}return{handle1x:r,handle1y:n,handle2x:i,handle2y:a}}getValueAt(e,t,o){var r,n=this,i=0
for(r=0;r<e.keyframes.length;r++)if(e.keyframes[r].frame>o){i=r-1
break}var a=e.keyframes[i],l=e.keyframes[i+1],s=n.getKeyframeValue(a,t),c=n.getKeyframeValue(l,t),u=a.frame,m=n.height-s,p=l.frame,d=n.height-c,f=n.getHandlesPositionByKeyIndex(e,t,i),v={x:u,y:m},h={x:f.handle1x,y:f.handle1y},g={x:f.handle2x,y:f.handle2y},y={x:p,y:d},b=n.getYatX(v,h,g,y,o)
return n.height-b}getYatX(e,t,o,r,n){function i(e,t,o,r,n){return(1-e)**3*t.x+3*(1-e)**2*e*o.x+3*(1-e)*e**2*r.x+e**3*n.x}const a=function(e,t,o,r,n){let a=function(e,t,o,r,n,a=1e-4){let l=0,s=1,c=.5
for(;s-l>a;)c=(l+s)/2,i(c,t,o,r,n)<e?l=c:s=c
return c}(e,t,o,r,n)
return function(e,t,o,r,n){return(1-e)**3*t.y+3*(1-e)**2*e*o.y+3*(1-e)*e**2*r.y+e**3*n.y}(a,t,o,r,n)}(n,e,t,o,r)
return a}}}),define("pikimov/classes/managers/effect-manager",["exports","pikimov/classes/effects/grayscale","pikimov/classes/effects/blur","pikimov/classes/effects/coloroverlay","pikimov/classes/effects/chroma-key","pikimov/classes/effects/chromatic-aberration","pikimov/classes/effects/brightness-contrast","pikimov/classes/effects/levels","pikimov/classes/effects/color-balance","pikimov/classes/effects/shadow","pikimov/classes/effects/glitch","pikimov/classes/effects/bloom","pikimov/classes/effects/outline","pikimov/classes/effects/invert","pikimov/classes/effects/radial-blur","pikimov/classes/effects/luma-key","pikimov/classes/effects/posterize","pikimov/classes/effects/tint","pikimov/classes/effects/film-grain","pikimov/classes/effects/halftone","pikimov/classes/effects/motion-tile","pikimov/classes/effects/magnifying-lens","pikimov/classes/effects/vignette","pikimov/classes/effects/bend","pikimov/classes/effects/skew","pikimov/classes/effects/ffd","pikimov/classes/effects/typewriter","pikimov/classes/effects/wave-warp","pikimov/classes/effects/turbulent-displace","pikimov/classes/effects/mosaic","pikimov/classes/effects/noise","pikimov/classes/effects/shake","pikimov/classes/effects/fisheye","pikimov/classes/effects/leave-color","pikimov/classes/effects/fluted-glass","pikimov/classes/effects/petzval-lens","pikimov/classes/effects/crop-edges","pikimov/classes/effects/displace","pikimov/classes/effects/kaleidoscope","pikimov/classes/effects/glsl-shader","pikimov/classes/shaders/shaders-common","pikimov/classes/shaders/shaders-masks"],function(e,t,o,r,n,i,a,l,s,c,u,m,p,d,f,v,h,g,y,b,x,w,k,C,S,T,D,P,M,j,E,I,O,_,R,z,F,A,U,B,V,L){function H(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=class{constructor(e,t){H(this,"compositionManager",null),H(this,"sceneItem",null),H(this,"itemData",null),H(this,"effects",[]),H(this,"composer",null),H(this,"cameraType",null),H(this,"renderEngine",null),H(this,"renderTargetIn",null),H(this,"renderTargetOut",null),H(this,"renderPass",null),H(this,"shaderOpacity",null),H(this,"opacityPass",null),H(this,"copyPass",null),H(this,"shaderMask",[]),H(this,"shaderMaskPass",[]),H(this,"maskPassConvertLuma",null),H(this,"maskPass1",null),H(this,"maskPass2",null)
var o=this
o.compositionManager=e,o.sceneItem=t,o.itemData=t.itemData,o.cameraType=o.compositionManager.cameraType
var r=4,n=o.compositionManager.getDimensions()
n.width*n.height>2073600&&(r=2),o.renderEngine=o.compositionManager.renderEngine,o.renderPass=new RenderPass(o.compositionManager.scene,o.renderEngine.activeCamera),o.renderPass.name="render pass",_config.stencil&&(o.renderPass.clearStencil=!0)
const i={samples:r}
_config.stencil&&(i.stencilBuffer=!0)
const a=o.renderEngine.getRenderSize()
"3D"==o.cameraType&&(o.renderTargetIn=new THREE.WebGLRenderTarget(a.width,a.height,i)),o.renderTargetOut=new THREE.WebGLRenderTarget(a.width,a.height,i),o.createComposer()}addEffect(e,V){var L=this
if(L.composer){var H=e.type,N={effectData:e,compositionManager:L.compositionManager,sceneItem:L.sceneItem,index:V}
if("grayscale"==H&&(L.effects[V]=new t.default(N)),"colorOverlay"==H&&(L.effects[V]=new r.default(N)),"chromaKey"==H&&(L.effects[V]=new n.default(N)),"chromaticAberration"==H&&(L.effects[V]=new i.default(N)),"blur"==H&&(L.effects[V]=new o.default(N)),"brightness contrast"==H&&(L.effects[V]=new a.default(N)),"levels"==H&&(L.effects[V]=new l.default(N)),"colorBalance"==H&&(L.effects[V]=new s.default(N)),"shadow"==H&&(L.effects[V]=new c.default(N)),"glitch"==H&&(L.effects[V]=new u.default(N)),"bloom"==H&&(L.effects[V]=new m.default(N)),"outline"==H&&(L.effects[V]=new p.default(N)),"invert"==H&&(L.effects[V]=new d.default(N)),"radialBlur"==H&&(L.effects[V]=new f.default(N)),"lumaKey"==H&&(L.effects[V]=new v.default(N)),"posterize"==H&&(L.effects[V]=new h.default(N)),"tint"==H&&(L.effects[V]=new g.default(N)),"filmGrain"==H&&(L.effects[V]=new y.default(N)),"halftone"==H&&(L.effects[V]=new b.default(N)),"motionTile"==H&&(L.effects[V]=new x.default(N)),"magnifyingLens"==H&&(L.effects[V]=new w.default(N)),"bend"==H&&(L.effects[V]=new C.default(N)),"skew"==H&&(L.effects[V]=new S.default(N)),"cornerPin"==H&&(L.effects[V]=new T.default(N)),"turbulentDisplace"==H&&(L.effects[V]=new M.default(N)),"typewriter"==H&&(L.effects[V]=new D.default(N)),"vignette"==H&&(L.effects[V]=new k.default(N)),"waveWarp"==H&&(L.effects[V]=new P.default(N)),"mosaic"==H&&(L.effects[V]=new j.default(N)),"noise"==H&&(L.effects[V]=new E.default(N)),"shake"==H&&(L.effects[V]=new I.default(N)),"fisheye"==H&&(L.effects[V]=new O.default(N)),"leaveColor"==H&&(L.effects[V]=new _.default(N)),"flutedGlass"==H&&(L.effects[V]=new R.default(N)),"petzvalLens"==H&&(L.effects[V]=new z.default(N)),"cropEdges"==H&&(L.effects[V]=new F.default(N)),"displace"==H&&(L.effects[V]=new A.default(N)),"kaleidoscope"==H&&(L.effects[V]=new U.default(N)),"glslShader"==H&&(L.effects[V]=new B.default(N)),L.effects[V]){var K=L.composer,G=L.effects[V].shaderPass
function $(e){e&&(K.passes.splice(K.passes.indexOf(e),1),K.addPass(e))}G&&K.addPass(G),$(L.maskPassConvertLuma),$(L.maskPass1),$(L.maskPass2)}else console.error("error - FX not found : ",H)}else console.warn("|W| no composer for ",L.sceneItem.compositionData.name,"/",L.sceneItem.name)}createComposer(){var e=this
e.renderEngine.renderer&&(e.composer=new EffectComposer(e.renderEngine.renderer,e.renderTargetOut),e.composer.renderToScreen=!1,_config.stencil&&(e.composer.stencilBuffer=!0),"2D"==e.cameraType&&e.add2DPasses(),"3D"==e.cameraType&&e.add3DPasses(),"2D"==e.cameraType&&e.sceneItem.isMask()&&e.addMaskPasses())}add2DPasses(){this.composer.addPass(this.renderPass)}addMaskPasses(){var e=this,t="alpha"
"luma"==e.itemData.mask.type&&(t="luma")
var o=new THREE.Vector2
if(e.renderEngine.renderer.getSize(o),"luma"==t){var r={}
r.vertexShader=V._commonVertexShader,r.fragmentShader=L._shaderMaskConvert,r.uniforms={tDiffuse:{value:null}},e.maskPassConvertLuma=new ShaderPass(r),e.maskPassConvertLuma.name="mask pass convert",e.composer.addPass(e.maskPassConvertLuma)}var n={}
n.vertexShader=V._commonVertexShader,n.fragmentShader=L._shaderMaskBlur,n.uniforms={tDiffuse:{value:null},resolution:{value:{x:o.x,y:o.y}},u_feather:{value:null}},e.maskPass1=new ShaderPass(n),e.maskPass1.name="mask pass 1",e.composer.addPass(e.maskPass1)
var i={}
i.vertexShader=V._commonVertexShader,i.fragmentShader=L._shaderMaskExpand,i.uniforms={tDiffuse:{value:null},resolution:{value:{x:o.x,y:o.y}},texelSize:{value:{x:1/o.x,y:1/o.y}},u_expansion:{value:null}},e.maskPass2=new ShaderPass(i),e.maskPass2.name="mask pass 2",e.composer.addPass(e.maskPass2)}add3DPasses(){const e=new TexturePass(this.renderTargetIn.texture)
e.name="texturePass",e.clear=!0,this.composer.addPass(e)}updateDimensions(e){var t=this
t.renderTargetOut.setSize(e.width,e.height),"3D"==t.cameraType&&t.renderTargetIn.setSize(e.width,e.height),t.rebuild()}redoReferences(e){var t=this
t.sceneItem=e,t.itemData=e.itemData,t.rebuild()}rebuild(){var e=this
e.resetEffects()
var t=e.compositionManager.currentFrame
e.applyEffects(t)}createEffectsArray(){var e=this,t=e.itemData.effects
t.length&&t.forEach(function(t,o){e.effects[o]||e.addEffect(t,o)})}applyEffects(e){var t=this
if(t.composer){var o=t.itemData.effects
o.length&&(t.createEffectsArray(),o.forEach(function(o,r){t.effects[r].shaderPass&&(t.effects[r].shaderPass.enabled=o.enabled),o.enabled&&t.effects[r].applyFrame(e)}))}else console.warn("|W| BIS no composer for ",t.sceneItem.compositionData.name,"/",t.sceneItem.name)}disposeShaders(){var e=this
e.opacityPass&&(e.composer.removePass(e.opacityPass),e.opacityPass.material.dispose(),e.opacityPass.dispose(),e.opacityPass=void 0,e.shaderOpacity=null),e.copyPass&&(e.composer.removePass(e.copyPass),e.copyPass.dispose(),e.copyPass=void 0),e.maskPassConvertLuma&&(e.composer.removePass(e.maskPassConvertLuma),e.maskPassConvertLuma.dispose(),e.maskPassConvertLuma=void 0),e.maskPass1&&(e.composer.removePass(e.maskPass1),e.maskPass1.dispose(),e.maskPass1=void 0),e.maskPass2&&(e.composer.removePass(e.maskPass2),e.maskPass2.dispose(),e.maskPass2=void 0),e.shaderMaskPass.length&&(e.shaderMaskPass.forEach(function(t,o){e.composer.removePass(t),t.dispose(),e.shaderMask[o]=null}),e.shaderMask=[],e.shaderMaskPass=[])}removeEffect(e){var t=this,o=[...t.itemData.effects.slice(0,e),...t.itemData.effects.slice(e+1)]
if(t.compositionManager.controller.emberSet(t.itemData,"effects",o),t.effects[e]){var r=t.effects[e].shaderPass
t.composer.removePass(r),t.effects[e].destroy(),t.effects.splice(e,1)}t.resetEffects()}toggleEnabled(e,t){this.effects[e].toggleEnabled(t)}resetEffects(e=!0){var t=this
t.disposeShaders(),t.composer&&(t.composer.passes.forEach(function(e){e.dispose(),e=null}),t.composer.dispose()),e&&t.createComposer(),t.effects.forEach(function(e){e.destroy()}),t.effects=[]}renderClassic(){this.renderComposer()}renderMask(){var e=this
var t=0
e.itemData.mask.feather&&(t=1*e.itemData.mask.feather.value)
var o=0
if(e.itemData.mask.expansion&&(o=1*e.itemData.mask.expansion.value),e.maskPass1.enabled=!1,e.maskPass2.enabled=!1,0!=t&&(e.maskPass1.enabled=!0,e.maskPass1.uniforms.u_feather.value=t),0!=o){e.maskPass2.enabled=!0
var r=function(){var t=e.compositionManager,o=t.getZoom()/100,r=t.controller.minRenderZoom
if(o<r&&(o=r),o>1&&(o=1),!t.isActive){var n=t.controller.compositionManager.getZoom()/100
n<r&&(n=r),n>1&&(n=1),o=n}return o}()
e.maskPass2.uniforms.u_expansion.value=o*r/2}e.renderComposer(),e.renderToRed()}renderMasked(e,t,o){var r=this,n=!1
if(t.itemData.mask.invert&&(n=!0),!r.shaderMask[o]){r.shaderMask[o]={vertexShader:V._commonVertexShader,uniforms:{tDiffuse:{value:null},tMask:{value:null},u_invert:{value:n},u_opacityMask:{value:null}}},r.shaderMask[o].fragmentShader=L._shaderAlphaMask,r.shaderMaskPass[o]=new ShaderPass(r.shaderMask[o])
var i=r.shaderMaskPass[o]
i.name="mask pass "+o,i.material.transparent=!0,i.clear=!0
var a=t.effectManager.redTarget.texture
i.uniforms.tMask.value=a,r.composer.addPass(i)}var l=t.getParamValueAt(e,"opacity")
r.shaderMaskPass[o].uniforms.u_opacityMask.value=l/100,r.renderComposer(),r.sceneItem.isMask()&&r.renderToRed()}renderToRed(){var e=this
if(!e.redTarget){const o=e.renderEngine.getRenderSize()
e.redTarget=new THREE.WebGLRenderTarget(o.width,o.height,{format:THREE.RedFormat,internalFormat:"R8"})
var t={}
t.vertexShader=V._commonVertexShader,t.fragmentShader="varying vec2 vUv;uniform sampler2D tDiffuse;void main(){gl_FragColor=vec4(texture(tDiffuse,vUv).a,0.0,0.0,1.0);}",t.uniforms={tDiffuse:{value:null}},e.redPass=new ShaderPass(t),e.redPass.name="redPass",e.redPass.uniforms.tDiffuse.value=e.renderTargetOut.texture}var o=e.renderEngine.renderer
const r={texture:e.renderTargetOut.texture}
o.setRenderTarget(e.redTarget),e.redPass.render(o,e.redTarget,r,0),o.setRenderTarget(null)}renderComposer(){var e=this
if(!e.copyPass){const t={uniforms:{tDiffuse:{value:null}},vertexShader:V._commonVertexShader,fragmentShader:"uniform sampler2D tDiffuse;varying vec2 vUv;void main(){gl_FragColor=texture2D(tDiffuse,vUv);}"}
e.copyPass=new ShaderPass(t),_config.stencil&&(e.copyPass.material.stencilWrite=!0,e.copyPass.material.stencilRef=1,e.copyPass.material.stencilFunc=THREE.EqualStencilFunc),e.copyPass.renderToScreen=!1,e.copyPass.name="copyPass",e.composer.addPass(e.copyPass)}e.composer.render()}getEasing(e){var t=TWEEN.Easing.Quadratic.InOut
if("Linear"==e.easing&&(t=TWEEN.Easing.Linear.None),"Cubic.In"==e.easing&&(t=TWEEN.Easing.Cubic.In),"Cubic.Out"==e.easing&&(t=TWEEN.Easing.Cubic.Out),"Elastic.Out"==e.easing&&(t=TWEEN.Easing.Elastic.Out),"Static"==e.easing){function o(){return 0}t=o}return t}getEffectParamValue(e,t,o){var r=this,n=e.params[t],i=n.type,a=n.value,l=n.keyframes
if(n.useKeyframes&&l&&l.length){function c(e,t,o){var n=t[o],l=n.frame,s=t[o+1].frame-l
e-=l
var c={value:n.values.p},u={value:t[o+1].values.p}
c=JSON.parse(JSON.stringify(c)),"number"==i&&(c.value*=1,u.value*=1),"color"==i&&(c.value=hexToRgb(c.value),u.value=hexToRgb(u.value))
var m=new TWEEN.Tween({value:c.value}).to({value:u.value},s).onUpdate(function(e){var t=e.value
"number"==i&&(a=Math.abs(t)<10?roundValue(t,2):roundValue(t,1)),"color"==i&&(a=rgbToHex(t)),i||(a=t)})
m.easing(r.getEasing(n)).start(0).update(e),m.stop(),m=null}a=l[0].values.p,l.forEach(function(e,t){o!=e.frame?t>=l.length-1||o>e.frame&&o<l[t+1].frame&&c(o,l,t):a=e.values.p})
var s=l[l.length-1]
o>s.frame&&(a=s.values.p)}return"number"==i&&(a*=1),a}updateUI(){this.effects.forEach(function(e){e.updateUI()})}destroy(){var e=this
e.resetEffects(!1),e.renderTargetIn&&(e.renderTargetIn.dispose(),e.renderTargetIn=void 0),e.renderTargetOut&&(e.renderTargetOut.dispose(),e.renderTargetOut=void 0),e.redTarget&&(e.redTarget.dispose(),e.redTarget=void 0),e.disposeShaders(),e.composer&&(e.composer.passes.forEach(function(e){e.dispose(),e=void 0}),e.composer.dispose(),e.composer=void 0)}}}),define("pikimov/classes/managers/library-manager",["exports","pikimov/classes/c_library-item","@ember/object"],function(e,t,o){function r(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=class{constructor(e){r(this,"controller",null),r(this,"directoryHandle",null),r(this,"isLibraryLoaded",!1),r(this,"libraryItems",[]),r(this,"filesQueue",[]),r(this,"newSelection",[]),r(this,"libraryLoadedPercent",0)
this.controller=e,this.libraryItems=[]}loadProjectLibrary(){var e=this
e.isLibraryLoaded=!1,e.directoryHandle=null,e.libraryItems=[],e.libraryLoadedPercent=0
var t=e.controller.projectData
if(t.library.length){var r=[]
t.library.forEach(function(e){r.push(e.libUid)})
const e=e=>new Set(e).size<e.length
e(r)&&(console.warn("- - ERROR - duplicate libUid in library - -"),gaEvent({event:"error - duplicate libUid "+t.id}))}(0,o.set)(e.controller,"isFilesSelectorOpen",!0),t.library.length?e.createItems():e.onLibraryLoaded()}loadNextLocalFile(){var e=this
startLoading()
var t=!1
e.libraryItems.forEach(function(o,r){t||o.isLoaded||o.isLoading||o.localFileNotFound||(e.libraryItems[r].getLocalFile(),t=!0)}),t||(stopLoading(),e.directoryHandle=null)}createItems(){var e=this
stopLoading()
var o,r=e.controller.projectData,n=[]
for(o=0;o<r.library.length;o++){var i=r.library[o]
if(e.libraryItems.push(new t.default(e,i)),i.online&&n.push(e.libraryItems[e.libraryItems.length-1]),i.fromCloud&&n.push(e.libraryItems[e.libraryItems.length-1]),i.compositionPropertiesFile){var a=e.libraryItems[e.libraryItems.length-1],l=i.compositionPropertiesFile
a.callbackOnLoaded=a.onLocalFileLoaded,a.getLocalFileCallback(l,null)}}var s=0
function c(){e.controller.mustAbortJobs?console.log("onlineFileLoaded -> mustAbortJobs"):!e.isLibraryLoaded&&e.checkIfLibraryLoaded()?e.onLibraryLoaded():(s++,n[s]&&u(s))}function u(e){n[e].loadFile(c)}n[0]&&u(0)}checkIfLibraryLoaded(){var e=this,t=!0,o=0
return e.libraryItems.forEach(function(e){e.isLoaded?o++:t=!1}),e.libraryItems.length&&(e.libraryLoadedPercent=Math.round(o/e.libraryItems.length*100),$("#libraryProgressBar .filler").css({width:e.libraryLoadedPercent+"%"})),t}onLibraryLoaded(){console.log("* * on library loaded * *")
var e=this
e.directoryHandle=null,e.controller.mustAbortJobs?console.log("onLibraryLoaded -> mustAbortJobs"):(e.isLibraryLoaded=!0,(0,o.set)(e.controller,"isFilesSelectorOpen",!1),e.controller.setActiveComposition(0))}setLibraryItem(e,r,n){var i=this,a=i.controller.projectData,l=a.library,s=!1
i.libraryItems[n]?e.libUid=i.libraryItems[n].libUid:(e.libUid=generateItemLibUid(a),s=!0)
return i.libraryItems[n]=new t.default(i,e),i.libraryItems[n].setFileData(r),i.libraryItems[n].loadFile(function(){stopLoading()
var t=i.libraryItems[n]
e.name=t.name,null!==t.width&&(e.width=t.width),null!==t.height&&(e.height=t.height),null!==t.duration&&(e.duration=t.duration)
var r=structuredClone(l)
r.splice(n,1,e),(0,o.set)(i.controller.projectData,"library",r),s?"font"!=e.type?i.addLibItemToComposition(e):i.importNextQueueFile():i.controller.compositionManager.buildCompositionThenSelect(null)}),e.libUid}openLocalFolderDialog(e,t){var o=this
o.directoryHandle?o.getFileFromDirectory(t,e):o.selectLocalFolder(t,e)}async selectLocalFolder(e,t){try{this.directoryHandle=await window.showDirectoryPicker(),this.getFileFromDirectory(e,t)}catch(o){if("AbortError"==o.name)return void console.log("selectLocalFolder: Directory picker was aborted by the user")
console.error("Catch error selecting directory:",o)}}async getFileFromDirectory(e,t){var o=!1,r=null,n=null
async function i(t){try{const i=await t.getFileHandle(e)
n=await i.getFile(),r=t.name,o=!0}catch(i){"NotFoundError"!=i.name&&console.error(i)}}if(await i(this.directoryHandle),!o)for await(let a of this.directoryHandle.values())o||"directory"==a.kind&&await i(a)
o?t.call(this,n,r):t.call(this,null,null)}dropFiles(e){var t=e.dataTransfer.items,o=t.length
if(!o)return
if("string"===t[0].kind)return
const r=e.dataTransfer.items[0].webkitGetAsEntry()
if(r){if(r.isDirectory)return void gaEvent({event:"import (folder)"})}else console.log("Unable to determine if file or folder.")
for(var n=[],i=0;i<o;i++)if("file"===t[i].kind){if(n.length>=20)continue
var a=t[i].getAsFile()
n.unshift(a)}n.length?this.importFiles(n):console.log("no files dropped, dropped comp?")}importFiles(e){console.log("import files x",e.length)
var t=this
if(e.length){t.controller.setCompositionReadyFlag(!1),t.filesQueue=e
var o="* * * *\n"
t.filesQueue.forEach(function(e,t){o+=t+". "+e.name+" - "+roundValue(e.size/1024/1024,1)+" MB",o+="\n"}),o+="* * * *",console.log(o),t.newSelection=[],t.importNextQueueFile()}}importNextQueueFile(){var e=this
if(console.log("import next q file"),e.controller.mustAbortJobs)console.log("onLibraryLoaded -> mustAbortJobs")
else if(e.filesQueue.length){if(e.controller.projectData.library.length>=_config.maxLibraryItems)return alert("Cannot add more files to the library\n(max "+_config.maxLibraryItems+" files)"),void e.onFilesImportsCompleted()
e.importOneFile(e.filesQueue[0],!0,null),e.filesQueue.shift()}else e.onFilesImportsCompleted()}importFromCloud(e,o){var r=this,n=o.url
const i=new URL(n).pathname,a=i.substring(i.lastIndexOf("/")+1)
var l=a.split(".").slice(0,-1).join("."),s={filename:a,type:"video",name:l,url:n,fromCloud:!0}
r.libraryItems.push(new t.default(r,s))
var c=r.controller.projectData.library.length+1,u=s
r.setLibraryItem(u,null,c)}onFilesImportsCompleted(){console.log("on files Imports Completed"),this.controller.compositionManager.compositionBuilder.processQueue(),stopLoading()}onImportFailed(e){var t=this
function o(){t.filesQueue.shift(),t.importNextQueueFile()}console.log("- on import failed -"),e?openModal({h2:e.h2,p:e.p,callbackYes:function(){o()}}):o()}importOneFile(e,t,r){var n=this,i=n.controller
if(e){var a=getFileExtension(e.name)
if(a)if("pikimov"!=a){gaEvent({event:"import file "+a})
var l=!1
if(Object.values(_filesTypes).flat().includes(a)&&(l=!0),l){var s=e.type,c=e.type
if("image/svg+xml"==c&&(c="svg"),c=c.split("/")[0],console.log("fileType _"+s+"_"),"glb"!=a||c||(c="model"),"woff"==a&&"application/font-woff"==s&&(c="font"),"spz"!=a||c||(c="gaussianSplat"),"ply"!=a||c||(c="gaussianSplat"),"splat"!=a||c||(c="gaussianSplat"),c||"ttf"!=a||(c="font"),c||"ogg"!=a||"safari"==_browser.name&&(c="audio"),c||"mov"!=a||(c="video"),!c)return alert("error: no mimeType"),void n.onImportFailed()
var u=c
if(t)r=n.libraryItems.length
else{var m=n.libraryItems[r].type
if(u!=m){f={h2:"Error",p:`cannot replace a item of type '${m}' by an item of type '${u}'`}
return void n.onImportFailed(f)}}startLoading()
var p=new FileReader,d={name:null,type:u,libUid:null,filename:e.name,filesize:e.size}
if("image"==d.type)return p.onload=function(t){var o=t.target.result,i=6e3
if("tga"!=a){var l=new Image
l.onload=function(e){var t=1*l.width,a=1*l.height
if(t>i||a>i){stopLoading()
var s={h2:"This image is too large ("+t+" x "+a+")",p:"The maximum size is 6000 x 6000 pixels."}
n.onImportFailed(s)}else l=null,n.setLibraryItem(d,o,r)},l.onerror=function(){var t={h2:"Error importing image file",p:e.name}
n.onImportFailed(t)},l.src=o}else dataURLToArrayBuffer(o).then(e=>{const t=new DataView(e)
var a=t.getUint16(12,!0),l=t.getUint16(14,!0)
if(a>i||l>i){stopLoading()
var s={h2:"This image is too large ("+a+" x "+l+")",p:"The maximum size is 6000 x 6000 pixels."}
n.onImportFailed(s)}else n.setLibraryItem(d,o,r)})},void p.readAsDataURL(e)
if("svg"==d.type)return p.onload=function(e){var t=e.target.result
n.setLibraryItem(d,t,r)},void p.readAsDataURL(e)
if("video"==d.type)return p.onload=function(e){var t=e.target.result
n.setLibraryItem(d,t,r)},void p.readAsArrayBuffer(e)
if("audio"==d.type)return p.onload=function(e){var t=e.target.result
n.setLibraryItem(d,t,r)},void p.readAsArrayBuffer(e)
if("model"==d.type)return p.onload=function(e){var t=e.target.result
n.setLibraryItem(d,t,r)},void p.readAsArrayBuffer(e)
if("font"==d.type)return p.onload=function(e){var t=e.target.result,a=n.setLibraryItem(d,t,r)
if(1==i.selectionUtils.getNbItemsSelected()){var l=i.selectionUtils.getSelectedCompUid(),s=i.activeCompositionData,c=i.getters.getCompItemByCompUid(s,l);(0,o.set)(c,"font",a)
var u=i.selectionUtils.getSelectedSceneItem()
u&&u.rebuild()}i.triggerSelectionItemsUpdater()},void p.readAsArrayBuffer(e)
if(_filesTypes.gaussianSplat&&"gaussianSplat"==d.type)return p.onload=function(e){var t=e.target.result
n.setLibraryItem(d,t,r)},void p.readAsDataURL(e)
stopLoading(),alert("Error mimetype\n\nthe file could not be imported\nPlease report the bug."),n.onImportFailed()}else{var f={h2:"This is not a supported file format: ."+a}
n.onImportFailed(f)}}else i.projectUtils.openProjectFromDrop(e)
else{gaEvent({event:"import file (no extension)"})
var f={h2:"This is not a supported file format",p:"(no file extension)"}
n.onImportFailed(f)}}else n.onImportFailed()}matchCompToVideoDialog(e){var t=this,r=t.controller.activeCompositionData
openModal({h2:"Match composition to video file?",p:"Set composition properties to match \nthe dimensions, framerate, and duration of the video file?",buttons:!0,yesButton:"yes",noButton:"no",callbackYes:function(){(0,o.set)(r,"frameRate",e.frameRate)
var n=Math.floor(e.duration*e.frameRate)-1,i=Math.floor(_config.compositions.maxDuration*e.frameRate)
n>i&&(n=i),(0,o.set)(r.time,"end",n),(0,o.set)(r,"dimensions",{width:1*e.width,height:1*e.height}),t.controller.compositionManager.updateDimensions(),t.controller.uiManager.setBestGrid(),startLoading(),t.addLibItemToComposition(e,!0)},callbackNo:function(){startLoading(),t.addLibItemToComposition(e,!0)}})}addLibItemToComposition(e,t=!1){var o=this,r={name:"volume",type:"number",min:0,max:200,minRangeInput:0,maxRangeInput:100,value:100,unit:"%"},n=o.controller,i=n.compositionManager,a=n.activeCompositionData
if(i.isItemsLimitReached())o.importNextQueueFile()
else{var l=e.type
if("video"==l){var s=(v=new fileInfosUtils).checkVideoProperties(e.width,e.height,!0)
if(v.dispose(),v=null,!s)return void o.importNextQueueFile()}if(t||"video"!=l||0!=i.getItems().length){var c=a.frameRate,u=e.name
u.length>22&&(u=u.substr(0,22))
var m={name:u,libUid:e.libUid,type:l,params:[],effects:[],blendMode:"normal",time:{in:0,out:a.time.end}}
e.fromCloud&&(m.fromCloud=!0)
var p={name:"corners",type:"number",unit:"px",min:0,max:100,value:0,static:!0}
if(m.online&&(e.online=!0),"audio"!=e.type)(v=new compositionsUtils(n,a)).setInitialTransform(m,a),v=null,m.params.push({name:"opacity",type:"number",unit:"%",min:0,max:100,value:100})
if("image"==l&&m.params.push(structuredClone(p)),"video"==l&&(m.params.push({name:"speed",type:"number",unit:"%",min:-1e3,max:1e3,minRangeInput:-100,maxRangeInput:400,value:100}),m.params.push(structuredClone(p)),m.time.trackIn=0,m.time.out=Math.floor(e.duration*c)-1),"audio"==l&&(m.params.push(structuredClone(r)),delete m.blendMode,m.time.trackIn=0,m.time.out=Math.floor(e.duration*c)-1),"composition"==l)m=(v=new compositionsUtils(n,a)).generateCompItemFromComposition(e,a),v=null
if("imageSequence"==l&&(m.params.push(structuredClone(p)),m.params.push({name:"speed",type:"number",unit:"%",min:-1e3,max:1e3,minRangeInput:-100,maxRangeInput:400,value:100}),m.time.out=e.nbFiles-1,m.time.trackIn=0),e.audioTracks){console.log("+ adding video audio track as compItem")
var d=structuredClone(m)
d.type="audio",d.name+=" (audio track)",delete d.blendMode,delete d.position,delete d.rotation,delete d.scale,d.params=[],d.params.push(structuredClone(r))
var f=(v=new compositionsUtils(n,a)).addToComposition({itemData:d,parentCompUid:null})
v=null,o.addItemToBuilder(f),f&&o.newSelection.push(f)}var v
f=(v=new compositionsUtils(n,a)).addToComposition({itemData:m,parentCompUid:null})
v=null,o.addItemToBuilder(f),f&&o.newSelection.push(f),o.importNextQueueFile()}else o.matchCompToVideoDialog(e)}}addItemToBuilder(e){if(e){var t=this.controller,o=t.getters.getCompItemByCompUid(t.activeCompositionData,e),r={itemData:o}
t.compositionManager.compositionBuilder.addToQueue(r),t.selectionUtils.addToHoldSelection(o.compUid)}}importSequence(e){var t=Array.from(e),o=t[0],r=o.type
if("image"!=(r=r.split("/")[0]))return void console.log("error: not an image sequence",r)
var n=getFileExtension(o.name)
n||(n="no ext"),gaEvent({event:"import sequence: "+n})
const i=t.sort((e,t)=>{const o=e.name.toUpperCase(),r=t.name.toUpperCase()
return o<r?-1:o>r?1:0})
var a=i.length,l=i[0].name,s=i[a-1].name
console.log(l,"=>",s)
var c={type:"imageSequence",filename:l,first:l,last:s,nbFiles:a},u=i,m=this.libraryItems.length
this.setLibraryItem(c,u,m)}destroyItems(){this.libraryItems.forEach(function(e){e.destroy(),e=null}),this.libraryItems=[]}removeItem(e,t){var r=this
console.log("remove lib item",e.libUid,"x",t)
var n=r.controller,i=e.libUid,a=n.projectData
const l=a.library.indexOf(e);-1!==l&&a.library.splice(l,1)
var s=structuredClone(a.library);(0,o.set)(a,"library",s),r.libraryItems.forEach(function(e,t){e.libUid==i&&(e.destroy(),e=null,r.libraryItems.splice(t,1))}),a.compositions.forEach(function(e){n.getters.getAllCompositionItems(e).forEach(function(t){if(t.libUid==i){var o=new compositionsUtils(n,e)
o.removeItemByCompUid(t.compUid),o=null}})}),t&&n.compositionManager.buildCompositionThenSelect([])}}}),define("pikimov/classes/managers/raycast-manager",["exports"],function(e){function t(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=class{constructor(e){t(this,"controller",null),t(this,"getters",null),t(this,"raycaster",null),t(this,"eventsAdded",!1)
var o=this
o.controller=e,o.getters=o.controller.getters,o.createRaycaster()}createRaycaster(){this.raycaster=new THREE.Raycaster,this.raycaster.layers.enableAll()}addCanvasMouseEvents(e){var t=this
t.eventsAdded||(t.eventsAdded=!0,e.addEventListener("pointerup",t.onDocumentMouseUp(t)))}onDocumentMouseUp(e){return function(t){if(2!==t.button){if((new Date).getTime()>=_keyboardUtils.clickStartTime+400)return!1
var o=document.activeElement
o&&"textarea"==o.nodeName.toLowerCase()||e.rayCast(t)}}}rayCast(e){var t=this,o=t.controller,r=t.raycaster,n=o.compositionManager,i=n.renderEngine,a=n.canvas,l=i.activeCamera,s=n.cameraType,c=o.activeCompositionData
if(e.target==a){var u=new THREE.Vector2,m=$(a).offset()
m.left-=window.scrollX,u.x=(e.clientX-m.left)/a.clientWidth*2-1,u.y=-(e.clientY-m.top)/a.clientHeight*2+1,l.updateProjectionMatrix(),r.setFromCamera(u,l)
var p=[]
if("2D"==s&&n.scene.traverseVisible(function(e){!C(e)&&e.isMesh&&"Line"!=e.type&&p.push(e)}),"3D"==s){var d=i.scene,f=i.activeView,v=t.getters.getAllCompositionSceneItems(n,"camera")[0]
v.threejsObj.visible="editor"==f,d.traverseVisible(function(e){C(e)||e.isMesh&&"Line"!=e.type&&"TransformControlsPlane"!=e.type&&!e.userData.isHelper&&p.push(e)})}var h=r.intersectObjects(p,!0)
if(!h.length)return _config.isDebug&&console.log("nothing in rcast"),void o.selectionUtils.clearItemsSelection()
var g=h[0].object,y=g.userData.compUid,b=!1
if(g.userData.FFDControl)return console.log("FFDControl clicked"),void g.userData.selectControl()
y&&(b=!0),g.traverseAncestors(function(e){!y&&e.userData.compUid&&(y=e.userData.compUid,b=!0)})
var x=o.selectionUtils.getSelectedCompItem()
if(x&&x.compItem&&x.compItem.compUid==y&&h.length>1){var w=h[1].object
w.compUid&&(y=w.compUid,b=!0)}if(b){var k=t.getters.getCompItemByCompUid(c,y)
_keyboardUtils.controlKey?o.selectionUtils.toggleItemToSelection(k):o.selectionUtils.selectItem(k)}}function C(e){var o=!1,r=e.userData.compUid
return r?(t.getters.getCompItemByCompUid(c,r).locked&&(o=!0),o):(e.traverseAncestors(function(e){!r&&e.userData.compUid&&(r=e.userData.compUid,t.getters.getCompItemByCompUid(c,r).locked&&(o=!0))}),o)}}}}),define("pikimov/classes/managers/renderers-manager",["exports"],function(e){function t(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=class{constructor(e){t(this,"controller",null),t(this,"maxSubRenderers",10),t(this,"renderersSubs",[])
console.log("NEW renderersManager"),this.controller=e}createSubRenderer(e,t,o,r){console.log("RM - create sub renderer",r)
var n=this
try{var i=new THREE.WebGLRenderer(o)
i.localClippingEnabled=!0,i.autoClear=!1,i.setPixelRatio(1)
i.setSize(r.width,r.height,!1)}catch(c){console.log("ERROR new renderer on ",t.name,"x",_usage.nbRenderers),console.log(c),alert("Error creating webGL renderer\nreload the page")}var a=n.getRenderSize(i),l={name:t.name,compositionUid:t.uid,renderEngine:e,size:a,renderer:i}
if(n.renderersSubs.length>n.maxSubRenderers){var s=n.renderersSubs.length-1
n.destroyRenderer(s),n.renderersSubs.pop()}return n.renderersSubs.unshift(l),n.renderersSubs[0].renderer}getRenderSize(e){const t=e.getDrawingBufferSize(new THREE.Vector2)
return{width:t.width,height:t.height}}destroyRenderer(e){var t=this
console.log("nb R x",t.renderersSubs.length),console.log("RM - destroyRenderer",e),t.renderersSubs[e].renderEngine.renderer=null
var o=t.renderersSubs[e].renderer
o.domElement=null
var r=o.domElement
r&&(r=null),o.setRenderTarget(null),o.clear()
var n=o.getContext().getExtension("WEBGL_lose_context")
n&&n.loseContext(),o.dispose(),o=null}destroyAllRenderers(){console.log("RM - destroyAllrenderers")
var e,t=this
for(e=0;e<t.renderersSubs.length;e++)t.destroyRenderer(e)
t.renderersSubs=[]}destroy(){console.log("DESTROY renderers manager")}}}),define("pikimov/classes/managers/ui-manager",["exports","@ember/object"],function(e,t){function o(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=class{constructor(e){o(this,"controller",null),o(this,"sw",0),o(this,"sh",0),o(this,"cssSw",0),o(this,"projectTop_h",550),o(this,"projectRight_w",792),o(this,"minAppWidth",1180),o(this,"maxAppWidth",2600),o(this,"minAppHeight",700),o(this,"minTopHeight",400),o(this,"draggingFromProject",!1),o(this,"draggingCompItem",!1),o(this,"draggingEffect",!1),o(this,"timelineHeight",100),o(this,"willChangeFullScreenState",!1)
var t=this
t.controller=e,$(window).resize(function(){t.resizeHandler()}).trigger("resize"),t.resizeHandler()
var r=window
r.addEventListener("dragenter",function(e){document.querySelector("#newProjectDialog")||(e.dataTransfer.types.includes("Files")?t.dragFileEnter():t.dragDomEnter())}),r.addEventListener("dragleave",function(e){e.fromElement||t.dragEnd(e)})}getAppWidth(){var e=this,t=window.innerWidth
return t<e.minAppWidth&&(t=e.minAppWidth),t>e.maxAppWidth&&(t=e.maxAppWidth),t}resizeHandler(){var e=this
e.sw=$(window).width(),e.sh=$(window).height(),e.cssSw=window.innerWidth,e.sh<e.minAppHeight&&(e.sh=e.minAppHeight),e.willChangeFullScreenState&&(e.willChangeFullScreenState=!1,e.setBestGrid())
var o=e.projectTop_h
"landscape"==e.controller.workspace?e.resizeTopGrid():e.resizeVGrid(),e.controller.timelineUtils.onResize(e)
var r=e.sh-28-o,n=r-2;(0,t.set)(e,"timelineHeight",n),$("#timeline").css({height:e.timelineHeight+"px"})
var i=r-25-20-10-2
$("#timeCursor .bar").css({height:i+"px"})}setBestGrid(){var e=this,t=e.controller
if(t.compositionManager)if("portrait"!=t.workspace){var o=t.compositionManager.getDimensions(),r=t.compositionDisplayZoom,n=550
e.sh>800&&(n=600)
var i=o.height*r/100
i<300&&(i=300),i+40<n&&(n=i+40),n<e.minTopHeight&&(n=e.minTopHeight),n<e.sh/2&&(n=Math.floor(e.sh/2)),e.projectTop_h=n}else e.projectTop_h=450}resizeTopGrid(){var e=this
$("#projectTop").css({height:e.projectTop_h+"px"}),requestAnimationFrame(function(){e.resizeCanvas()})}resizeVGrid(){var e=this
$("#projectRight").css({width:e.projectRight_w+"px"}),requestAnimationFrame(function(){e.resizeCanvas()})}resizeCanvas(){var e=this.controller.compositionManager
e&&"3D"==e.cameraType&&e.resizeCanvas()}setInitialZoom(){var e=this,o=e.controller.activeComposition.dimensions,r=100
e.sw<1500&&e.sh<800?((o.width>=1e3||o.height>=500)&&(r=50),(o.width>=1920||o.height>=1080)&&(r=25),(o.width>=3840||o.height>=2160)&&(r=12.5)):((o.width>=1280||o.height>=720)&&(r=50),(o.width>=3840||o.height>=2160)&&(r=25)),(0,t.set)(e.controller,"compositionDisplayZoom",r)}zoomInOrOut(e){var t=this.controller
if("editor"!=t.compositionManager.renderEngine.activeView){var o=0,r=t.compositionDisplayZoom
12.5==r&&(o=1),25==r&&(o=2),50==r&&(o=3),100==r&&(o=4),200==r&&(o=5),400==r&&(o=6),(o+=e)<1&&(o=1),o>6&&(o=6),1==o&&(r=12.5),2==o&&(r=25),3==o&&(r=50),4==o&&(r=100),5==o&&(r=200),6==o&&(r=400),t.setCompositionDisplayZoom(r)}}setupResizerBar(){var e,t,o,r,n=this,i=n.controller.workspace,a=document.querySelector(".resizer");("portrait"==i&&(a=document.querySelector(".resizer-v")),a)&&a.addEventListener("mousedown",function(a){if(n.controller.closeAllmenus(),o=a.clientX,e=a.clientY,"landscape"==i){var c=document.querySelector("#projectTop")
t=parseInt(document.defaultView.getComputedStyle(c).height,10)}else{c=document.querySelector("#projectRight")
r=parseInt(document.defaultView.getComputedStyle(c).width,10)}document.documentElement.addEventListener("mousemove",l,!1),document.documentElement.addEventListener("mouseup",s,!1)},!1)
function l(a){if("landscape"==i){var l=t+a.clientY-e
l>(s=n.sh-120)&&(l=s),l<n.minTopHeight&&(l=n.minTopHeight),n.projectTop_h=l}else{var s,c=r+(o-a.clientX)
c<792&&(c=792),c>(s=n.sw-380)&&(c=s),n.projectRight_w=c}n.resizeHandler()}function s(){document.documentElement.removeEventListener("mousemove",l,!1),document.documentElement.removeEventListener("mouseup",s,!1)}}dragFileEnter(){$("#project").addClass("isFileDragover")}dragDomEnter(){var e=this
e.draggingCompItem||e.draggingEffect||(e.draggingFromProject||$("#projectFiles").addClass("isDragover"),$("#overItemsInputs").addClass("isDragover"))}dragEnd(e){var t=this
t.draggingFromProject=!1,t.draggingCompItem=!1,t.draggingEffect=!1,e&&(e.preventDefault(),e.stopPropagation()),$("#projectFiles, #overItemsInputs").removeClass("isDragover"),$("#project").removeClass("isFileDragover")}keyboardFocus(){isModalOpen()||document.querySelector("#composition").focus()}}}),define("pikimov/classes/passes/alpha-correction-pass",["exports","pikimov/classes/shaders/shaders-common","pikimov/classes/shaders/shader-alpha-correction-pass"],function(e,t,o){function r(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=class{constructor(){r(this,"shader",null),r(this,"pass",null)
var e=this
e.shader={},e.shader.vertexShader=t._commonVertexShader,e.shader.fragmentShader=o._alphaCorrectionPass_fragmentShader,e.shader.uniforms={tDiffuse:{value:null}},e.pass=new ShaderPass(e.shader),e.pass.name="alphaCorrectionPass",e.pass.clear=!0,e.pass.material.transparent=!0}dispose(){var e=this
e.pass.material.dispose(),e.pass.dispose(),e.pass=void 0}}}),define("pikimov/classes/passes/background-last-pass",["exports","pikimov/classes/shaders/shaders-common"],function(e,t){function o(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=class{constructor(){o(this,"shader",null),o(this,"pass",null)
var e=this
e.shader={},e.shader.vertexShader=t._commonVertexShader,e.shader.fragmentShader="varying vec2 vUv;\nuniform sampler2D tDiffuse;//read buffer, previous render\nuniform mediump vec3 u_color;//project background color\n\nvoid main()\n{\n    mediump vec4 tColorDiffuse = texture(tDiffuse, vUv);\n    mediump vec4 tColorOut;\n\n    float factorMix = tColorDiffuse.a;\n    tColorOut.rgb = mix(u_color.rgb, tColorDiffuse.rgb, factorMix);\n\n    gl_FragColor = vec4(tColorOut.rgb, 1.0);\n}",e.shader.uniforms={tDiffuse:{value:null},u_color:{value:null}},e.pass=new ShaderPass(e.shader),e.pass.name="BackgroundLastPass"}}}),define("pikimov/classes/passes/blend-pass",["exports","pikimov/classes/shaders/shaders-common","pikimov/classes/shaders/shader-blend-pass"],function(e,t,o){function r(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=class{constructor(e,n){r(this,"blendMode",0),r(this,"depthLevel",0),r(this,"shader",null),r(this,"pass",null)
var i=this
i.depthLevel=n,i.shader={},i.shader.vertexShader=t._commonVertexShader,i.shader.fragmentShader=o._blendPass_fragmentShader,i.shader.uniforms={tDiffuse:{value:null},tTexture:{value:null},u_depthLevel:{value:i.depthLevel},u_opacity:{value:1},u_background:{value:null},u_blendMode:{value:0}},i.pass=new ShaderPass(i.shader),i.pass.name="blendPass",i.pass.clear=!0,i.pass.material.transparent=!0,_config.stencil&&(i.pass.material.stencilWrite=!0,i.pass.material.stencilRef=1,i.pass.material.stencilFunc=THREE.EqualStencilFunc),i.pass.uniforms.tTexture.value=e}setUniforms(e,t,o){var r=this
e>100&&(e=100),e<0&&(e=0),r.pass.uniforms.u_opacity.value=e/100,r.pass.uniforms.u_background.value=t
var n=0
"additive"==o&&(n=1),"multiply"==o&&(n=2),"screen"==o&&(n=3),"difference"==o&&(n=4),"overlay"==o&&(n=5),r.blendMode!=n&&(r.blendMode=n,r.pass.uniforms.u_blendMode.value=n)}dispose(){var e=this
e.pass.material.dispose(),e.pass.dispose(),e.pass=void 0}}}),define("pikimov/classes/passes/stack-pass-multi",["exports","pikimov/classes/shaders/shaders-common"],function(e,t){function o(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=class{constructor(){o(this,"shader",null),o(this,"pass",null)
var e=this
e.shader={},e.shader.vertexShader=t._commonVertexShader,e.shader.fragmentShader="varying vec2 vUv;\nuniform sampler2D tDiffuse;\n\n#define MAX_TEXTURES 6\n\nuniform sampler2D u_colorTextures[MAX_TEXTURES];\nuniform sampler2D u_alphaTextures[MAX_TEXTURES];\nuniform float u_stackOpacity[MAX_TEXTURES];\nuniform int u_nbStacks;\n\n//avoid dark outlines: divide color by alpha to recorrect them\nvec4 correctByAlpha(vec4 color)\n{\n    float alpha = color.a;\n    if(alpha > 0.0 && alpha < 1.0)color.rgb /= alpha;\n    return color;\n}\n\nvoid main()\n{\n    //ok working, cut half of screen, BUT NOT background\n    //if (vUv.x > 0.5)discard;\n\n    //from previous pass - background\n    mediump vec4 tColorDiffuse = texture(tDiffuse, vUv);//read buffer, previous render\n\n    //recorrect color from previous pass\n    tColorDiffuse = correctByAlpha(tColorDiffuse);\n\n    //assign previous pass result as a base for the final output,\n    mediump vec4 tColorOut_final = vec4(tColorDiffuse.rgba);\n\n    //use current alpha as total alpha\n    float totalAlpha = tColorDiffuse.a;\n\n    int i;\n    mediump vec4 tColorTexture;\n    float alphaTexture;\n\n    for (i=0;i<u_nbStacks;i++)\n    {\n        switch (i) {\n            case 0: tColorTexture = texture(u_colorTextures[0], vUv);\n                    alphaTexture = texture(u_alphaTextures[0], vUv).r; \n                    break;\n            case 1: tColorTexture = texture(u_colorTextures[1], vUv);\n                    alphaTexture = texture(u_alphaTextures[1], vUv).r; \n                    break;\n            case 2: tColorTexture = texture(u_colorTextures[2], vUv);\n                    alphaTexture = texture(u_alphaTextures[2], vUv).r; \n                    break;\n            case 3: tColorTexture = texture(u_colorTextures[3], vUv);\n                    alphaTexture = texture(u_alphaTextures[3], vUv).r; \n                    break;\n            case 4: tColorTexture = texture(u_colorTextures[4], vUv);\n                    alphaTexture = texture(u_alphaTextures[4], vUv).r; \n                    break;\n            case 5: tColorTexture = texture(u_colorTextures[5], vUv);\n                    alphaTexture = texture(u_alphaTextures[5], vUv).r; \n                    break;\n        }\n\n        //consider alpha of (stack render: color OR alpha) AND alpha of compitem\n\n        //DONT x tColorTexture.a\n        //float alphaStack = alphaTexture * u_stackOpacity[i] * tColorTexture.a;\n\n        //better\n        //use lowest value between color alpha and red alpha, needed for blur effect\n        float alphaMultiplier = min(alphaTexture, tColorTexture.a);\n        float alphaStack = u_stackOpacity[i] * alphaMultiplier;\n\n        //for better perfs\n        if (alphaStack == 0.0)continue;\n\n        //recorrect color from stack BETTER\n        tColorTexture = correctByAlpha(tColorTexture);\n\n        float alphaBefore = totalAlpha;\n\n        //total of alphas, capped to 1.0\n        totalAlpha = min(alphaBefore + alphaStack, 1.0);\n\n        //0.0 == all pixels from first pass\n        float maxAlpha = alphaStack + alphaBefore;\n        float factorMix = (alphaStack / maxAlpha);//here : possible division by zero?\n        \n        //hot fix : avoid division by zero\n        //if (maxAlpha == 0.0)factorMix = alphaStack;\n\n        // mix tColorTexture - with - tColorOut_final\n        tColorOut_final.rgb = mix(tColorOut_final.rgb, tColorTexture.rgb, factorMix);\n    }\n\n    tColorOut_final.a = totalAlpha;\n\n    //needed\n    tColorOut_final = correctByAlpha(tColorOut_final);\n\n    gl_FragColor = tColorOut_final.rgba;\n}",e.shader.uniforms={tDiffuse:{value:null},u_colorTextures:{value:null},u_alphaTextures:{value:null},u_stackOpacity:{value:null},u_nbStacks:{value:null}},e.pass=new ShaderPass(e.shader),e.pass.material.transparent=!0,e.pass.clear=!0,e.pass.name="StackPass"}dispose(){var e=this
e.pass.material.dispose(),e.pass.dispose(),e.pass=void 0}}}),define("pikimov/classes/passes/stack-pass",["exports","pikimov/classes/shaders/shaders-common"],function(e,t){function o(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=class{constructor(){o(this,"shader",null),o(this,"pass",null)
var e=this
e.shader={},e.shader.vertexShader=t._commonVertexShader,e.shader.fragmentShader="varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform sampler2D tColor;\nuniform sampler2D tAlpha;\nuniform float stackOpacity;\n\n//avoid dark outlines: divide color by alpha to recorrect them\nvec4 correctByAlpha(vec4 color)\n{\n    float alpha = color.a;\n    if(alpha > 0.0 && alpha < 1.0)color.rgb /= alpha;\n\n    return color;\n}\n\nvoid main()\n{\n    mediump vec4 tColorDiffuse = texture(tDiffuse, vUv);\n    mediump vec4 tColorTexture = texture(tColor, vUv);\n    float alphaTexture = texture(tAlpha, vUv ).r;\n\n    //consider alpha of texture color render \n    //float alphaStack = stackOpacity * alphaTexture * tColorTexture.a;\n\n    //better changed 2025 07 25\n    //use lowest value between color alpha and red alpha, needed for blur effect\n    float alphaMultiplier = min(alphaTexture, tColorTexture.a);\n    float alphaStack = stackOpacity * alphaMultiplier;\n\n\n//ok working, cut half of screen, BUT NOT background\n//if (vUv.x > 0.5)discard;\n\n    //good to remove dark egdes, but less smooth\n    //recorrect color from previous pass\n    tColorTexture = correctByAlpha(tColorTexture);\n\n    //better for workshop window, but worse for workshop text\n    //recorrect color from previous pass\n    //tColorDiffuse = correctByAlpha(tColorDiffuse);\n\n    //alpha\n\n    float alphaBefore = tColorDiffuse.a;\n\n    //total of alphas, capped to 1.0\n    float totalAlpha = min(alphaBefore + alphaStack, 1.0);\n\n//tested 2025 03 25, seems no change on perfs\n//if(totalAlpha == 0.0) discard;\n\n    //color\n\n    //0.0 == all from first\n    float maxAlpha = alphaStack + alphaBefore;\n    float factorMix = (alphaStack / maxAlpha);\n    \n    //hot fix : avoid division by zero\n    if (maxAlpha == 0.0)factorMix = alphaStack;\n\n    mediump vec4 tColorOut;\n\n    tColorOut.rgb = mix(tColorDiffuse.rgb, tColorTexture.rgb, factorMix);\n    tColorOut.a = totalAlpha;\n\n    //recorrect color\n    //YES needed for first pass\n    tColorOut = correctByAlpha(tColorOut);\n\n    gl_FragColor = vec4(tColorOut.rgb, tColorOut.a);\n}",e.shader.uniforms={tDiffuse:{value:null},tColor:{value:null},tAlpha:{value:null},stackOpacity:{value:null}},e.pass=new ShaderPass(e.shader),e.pass.material.transparent=!0,e.pass.clear=!0,e.pass.name="StackPass"}dispose(){var e=this
e.pass.material.dispose(),e.pass.dispose(),e.pass=void 0}}}),define("pikimov/classes/renderers/render-engine-2d",["exports","pikimov/classes/renderers/render-engine","pikimov/classes/passes/blend-pass","pikimov/classes/shaders/shader-bg-grid","pikimov/classes/shaders/shaders-common"],function(e,t,o,r,n){function i(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{constructor(e,t,o,r){super(e,t,o,r),i(this,"cameraComp",null),i(this,"clearPass",null),i(this,"shaderBgPass",null),i(this,"shaderBg",null)
this.type="2D",this.createCamera()}getCSSSize(){var e=this.compositionManager.getDimensions(),t=this.controller.compositionDisplayZoom/100
return{width:Math.floor(e.width*t),height:Math.floor(e.height*t)}}setup(e){this.sceneItems=e,this.resize()}destroy2D(){var e=this
e.cameraComp=null,e.shaderBgPass&&e.shaderBgPass.dispose(),e.shaderBgPass=null,e.clearPass&&e.clearPass.dispose(),e.clearPass=null,e.shaderBg=null}resize(){var e=this,t=e.compositionManager.getDimensions(),o=e.getZoomMultiplier(),r={width:Math.floor(t.width*o),height:Math.floor(t.height*o)}
if(r.width==e.rendererSize.width&&r.height==e.rendererSize.height)return
if(e.rendererSize={width:r.width,height:r.height},!e.renderer)return
e.renderer.setSize(r.width,r.height,!1),e.resizeCamera(),e.resizeComposer()
const n=e.getRenderSize()
e.sceneItems.forEach(function(e){e.effectManager&&e.effectManager.updateDimensions(n)})}resizeCamera(){var e=this,t=e.compositionManager.getDimensions(),o=t.width,r=t.height
e.cameraComp.left=o/-2,e.cameraComp.right=o/2,e.cameraComp.top=r/2,e.cameraComp.bottom=r/-2,e.cameraComp.updateProjectionMatrix()}resizeComposer(){var e=this
if(e.finalComposer){const t=e.getRenderSize()
e.finalComposer.setSize(t.width,t.height)}e.isActive&&e.doBackGroundShader()}createCamera(){var e=this,t=e.compositionManager.getDimensions(),o=t.width,r=t.height
e.cameraComp=new THREE.OrthographicCamera(o/-2,o/2,r/2,r/-2,1,2e3),e.cameraComp.position.set(0,0,1e3),e.activeCamera=e.cameraComp,e.activeView="camera",$("#middleColumn").attr("data-view",e.activeView),$("#overCanvas").removeClass().addClass(e.activeView)}setActiveCamera(e){}doBackGroundShader(){var e=this,t=e.controller.projectData.transparent
if(void 0===t&&(t=!1),e.shaderBgPass||(e.shaderBg={},e.shaderBg.vertexShader=r._shaderBgGrid.vertexShader,t?(e.shaderBg.fragmentShader="void main(void){gl_FragColor=vec4(0.0,0.0,0.0,0.0);}",e.shaderBg.uniforms={}):(e.shaderBg.fragmentShader=r._shaderBgGrid.fragmentShader,e.shaderBg.uniforms={u_color:{},grid_color:{},u_step:{},u_thickness:{},canvas_size:{}}),e.shaderBgPass=new ShaderPass(e.shaderBg),_config.stencil,e.shaderBgPass.name="shaderBgPass"),!t){var o=e.compositionData.settings.grid.enabled
e.controller.compositionManager.isExporting&&(o=!1)
var n=valueToSRGB(e.controller.projectData.background),i=valueToSRGB(5263440)
o||(i=n)
var a=50,l=e.controller.compositionDisplayZoom
a=a*l/100
var s=e.compositionData.dimensions.width*l/100,c=e.compositionData.dimensions.height*l/100,u=e.shaderBgPass.uniforms
u.u_color.value=n,u.grid_color.value=i,u.u_step.value=a,u.u_thickness.value=1,u.canvas_size.value={x:s,y:c}}}createFinalComposer(){var e,t=this
for(t.compositionManager.isReady||console.log("warning: compositionManager not ready"),t.finalComposer=new EffectComposer(t.renderer),t.isActive?(t.doBackGroundShader(),t.finalComposer.addPass(t.shaderBgPass)):(t.clearPass=new ClearPass,t.clearPass.name="bg clearPass",t.finalComposer.addPass(t.clearPass)),e=t.sceneItems.length-1;e>=0;e--){var r=t.sceneItems[e]
if(r.effectManager){var n=r.effectManager.renderTargetOut.texture
r.blendPass=new o.default(n,t.compositionManager.depthLevel),r.blendPass.pass.name="bl pass "+r.name,r.isMask()&&(r.blendPass.pass.name+=" M"),t.finalComposer.addPass(r.blendPass.pass)}}}render2D(e){var t=this
t.renderer.setClearColor(16777215,0)
var o,r=[]
for(o=0;o<t.sceneItems.length;o++){(c=t.sceneItems[o]).blendPass&&(c.blendPass.pass.enabled=!1),c.disableAllLayers(),t.isItemRendered(c,e)&&r.push(c)}var n=r.length,i=[],a=0,l=null,s=null
for(o=0;o<n;o++){i[a]||(i[a]=[])
var c=r[o]
o>0&&(l=(s=r[o-1]).getParent())
var u=!0
if("light"==c.type&&(u=!1),"model"==c.type&&(u=!1),c.isPassStackable(e)||(u=!1),c.isMask()&&(u=!1),c.isMasked())if(o>0){var m=c.getMasks(),p=s.getMasks()
1==m.length&&1==p.length&&m[0].compUid==p[0].compUid||(u=!1)}else u=!1
else s&&s.isMasked()&&(u=!1)
if(u){var d=c.getParent()
if(null==d&&null!=l&&(u=!1),null!=d&&d!=l&&(u=!1),0==u){i[a].length&&a++,i[a]=[c],c.stackIndex=a
continue}}u?(i[a].push(c),c.stackIndex=a):(i[a].length&&a++,i[a]=[c],c.stackIndex=a,a++)}for(t.setCameraRenderLayer(1),o=0;o<n;o++){"light"==(c=r[o]).type&&c.setLayer(1)}i.forEach(function(t){r.forEach(function(e){e.disableAllLayers(),"light"==e.type&&e.enableAllLayers()}),t.forEach(function(e){e.setLayer(1)})
var o=t[0]
o.isMasked()?o.getMasks().forEach(function(t,r){o.effectManager.renderMasked(e,t,r)}):o.isMask()?o.effectManager.renderMask():o.effectManager.renderClassic()})
var f=new THREE.Color(t.controller.projectData.background)
for(f.convertLinearToSRGB(),o=0;o<n;o++){var v=r[o]
if(!v.isMask()){var h,g=v.blendPass
if(!g)return void console.error("error -- no blend pass for",v.name)
for(h=0;h<i.length;h++)v==i[h][0]&&(g.pass.enabled=!0)
if(g.pass.enabled){var y=v.getParamValueAt(e,"opacity")
g.setUniforms(y,f,v.itemData.blendMode)}}}if(t.renderer.clear(),t.finalComposer.render(),t.isActive)for(o=0;o<n;o++)r[o].setLayer(1)
if(t.isActive,_config.useRenderersManager&&!t.isActive){var b=t.compositionManager.sceneItemComposition,x=t.getRenderSize(),w=x.width,k=x.height
b.doTextureFromRenderTarget(t.renderer,w,k)}}isItemRendered(e,t){if(e.isMissing)return!1
if(!e.isVisibleInframe(t))return!1
if("audio"==e.type)return!1
if("camera"==e.type)return!1
if("cameraTarget"==e.type)return!1
if("group"==e.type&&!this.mustRenderGizmos())return!1
if(e.isMasked()){var o=e.getMasks()[0]
if(!this.isItemRendered(o,t))return!1}return!0}setCameraRenderLayer(e){this.cameraComp.layers.set(e)}}e.default=a}),define("pikimov/classes/renderers/render-engine-3d",["exports","pikimov/classes/renderers/render-engine","pikimov/classes/passes/stack-pass","pikimov/classes/passes/stack-pass-multi","pikimov/classes/passes/background-last-pass","pikimov/classes/shaders/renderer-mix-shader"],function(e,t,o,r,n,i){function a(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class l extends t.default{constructor(e,t,o,r){super(e,t,o,r),a(this,"cameraComp",null),a(this,"cameraEditor",null),a(this,"sceneAlpha",null),a(this,"sceneStack",null),a(this,"sceneGrid",null),a(this,"sceneControls",null),a(this,"clearPassStart",null),a(this,"backgroundLastPass",null),a(this,"renderTargetAlpha",[]),a(this,"renderTargetColor",[]),a(this,"alphaClones",[]),a(this,"gridHelperTop",null),a(this,"fxaaPass",null),a(this,"smaaPass",null),a(this,"orbitControls",null),a(this,"whiteMat",null),a(this,"whiteLineMat",null),a(this,"useWireFrame",!1),a(this,"filteredSceneItems",[]),a(this,"filteredSceneItemsClones",[])
var n=this
n.type="3D",n.createCameras(),n.sceneStack=new THREE.Scene,n.sceneStack.name="sceneStack",window._scene2=n.sceneStack,window._sceneStack=n.sceneStack,n.sceneAlpha=new THREE.Scene,n.sceneAlpha.name="sceneAlpha",window._sceneAlpha=n.sceneAlpha,n.sceneAlpha.background=new THREE.Color(16711680),n.sceneGrid=new THREE.Scene,n.sceneGrid.name="sceneGrid"
n.gridHelperTop=new THREE.GridHelper(2e3,20,9474192,5263440),n.sceneGrid.add(n.gridHelperTop),n.sceneControls=new THREE.Scene,n.sceneControls.name="sceneControls",n.whiteMat=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,transparent:!0}),n.whiteMat.wireframe=n.useWireFrame,n.whiteLineMat=new LineMaterial({linewidth:3}),window.downloadRenderTarget=function(e){n.downloadRenderTarget(e)}}getCSSSize(){var e=this,t=e.compositionManager.getDimensions(),o=e.controller.compositionDisplayZoom/100,r=Math.floor(t.width*o),n=Math.floor(t.height*o)
if(e.isActive&&e.activeCamera!=e.cameraComp){var i=document.querySelector("#composition")
r=i.offsetWidth,n=i.offsetHeight}return{width:r,height:n}}setup(e){var t=this
t.sceneItems=e,t.sceneItems.forEach(function(e){e.setLayer(0)}),t.isActive&&!t.orbitControls&&(t.orbitControls=new OrbitControlsXRPlus(t.cameraEditor,t.renderer.domElement),t.orbitControls.screenSpacePanning=!0,t.orbitControls.addEventListener("change",function(){"camera"!=t.activeView&&t.compositionManager.requestRender()}))}destroy3D(){var e=this
e.sceneStack&&(e.clearScene(e.sceneStack),e.sceneStack=void 0),e.sceneAlpha&&(e.clearScene(e.sceneAlpha),e.sceneAlpha=void 0),e.clearScene(e.sceneControls),e.sceneControls=void 0,e.clearScene(e.sceneGrid),e.sceneGrid=void 0,e.renderTargetColor.forEach(function(e){e.dispose(),e=void 0}),e.renderTargetColor=void 0,e.renderTargetAlpha.forEach(function(e){e.dispose(),e=void 0}),e.renderTargetAlpha=void 0,e.cameraComp=null,e.cameraEditor=null,e.orbitControls&&(e.orbitControls.dispose(),e.orbitControls=null),e.gridHelperTop.dispose(),$("#overCanvas").removeClass()}createCameras(){var e=this,t=e.compositionManager.getDimensions()
const o=t.width,r=t.height
e.cameraComp=new THREE.PerspectiveCamera(45,o/r,1,5500),e.cameraComp.name="camera comp"
e.cameraEditor=new THREE.OrthographicCamera(o/-2,o/2,r/2,r/-2,0,1e4),e.cameraEditor.name="camera editor",e.cameraEditor.rotation.set(0,0,0),e.cameraEditor.position.set(1e3,1e3,1e3),e.cameraEditor.rotation.order="YXZ",e.cameraEditor.rotation.y=-Math.PI/4,e.cameraEditor.rotation.x=Math.atan(-1/Math.sqrt(2)),e.activeView="camera",e.activeCamera=e.cameraComp,$("#middleColumn").attr("data-view",e.activeView),$("#overCanvas").removeClass().addClass(e.activeView)}updateCameraRatio(){var e=this.cameraComp,t=this.compositionManager.getDimensions()
e.aspect=t.width/t.height,e.updateProjectionMatrix()}setActiveCamera(e){var t=this
t.activeView=e,"camera"==t.activeView&&(t.activeCamera=t.cameraComp),"editor"==t.activeView&&(t.activeCamera=t.cameraEditor),t.gridHelperTop.visible="editor"==t.activeView,$("#middleColumn").attr("data-view",t.activeView),$("#overCanvas").removeClass().addClass(t.activeView),t.compositionManager.updateDimensions()}resize(){var e=this,t=e.compositionManager.getDimensions(),o=e.getZoomMultiplier(),r={width:Math.floor(t.width*o),height:Math.floor(t.height*o)},n=e.getRenderSize()
if(e.isActive&&e.activeCamera!=e.cameraComp){var i=document.querySelector("#composition")
r.width=i.offsetWidth,r.height=i.offsetHeight}r.width==n.width&&r.height==n.height||(e.renderer.setSize(r.width,r.height,!1),e.resizeCamera(),e.resizeComposer(),e.sceneItems.forEach(function(e){e.effectManager&&e.effectManager.updateDimensions(r)}))}resizeCamera(){var e=this,t=(n=1*e.compositionData.dimensions.width)/(i=1*e.compositionData.dimensions.height),o=e.getRenderSize(),r=o.width/o.height,n=2e3,i=Math.round(n/r)
e.cameraComp.aspect=t,e.cameraComp.updateProjectionMatrix()
var a=e.cameraEditor
a.left=n/-2,a.right=n/2,a.top=i/2,a.bottom=i/-2,a.updateProjectionMatrix()}resizeComposer(){var e=this,t=e.getRenderSize()
e.finalComposer&&e.finalComposer.setSize(t.width,t.height),e.renderTargetColor.forEach(function(e){e.setSize(t.width,t.height)}),e.renderTargetAlpha.forEach(function(e){e.setSize(t.width,t.height)})}createItemRenderTargets(e){var t=this,o=t.getRenderSize(),r={samples:4,stencilBuffer:!1,format:THREE.RedFormat,internalFormat:"R8"}
t.renderTargetColor[e]=new THREE.WebGLRenderTarget(o.width,o.height,{samples:4,stencilBuffer:!1}),t.renderTargetAlpha[e]=new THREE.WebGLRenderTarget(o.width,o.height,r)}createFinalComposer(){var e=this
e.finalComposer=new EffectComposer(e.renderer),e.clearPassStart=new ClearPass,e.clearPassStart.name="clearPassStart",e.backgroundLastPass=new n.default}cloneItemsToBlack(e){}convertMaterialToBlack(e,t){e.aoMap=null,e.emissiveMap=null,e.normalMap=null,e.envMap=null,void 0!==e.emissive&&e.emissive.set(0,0,0),e.opacity=t,e.color&&e.color.set(0,0,0)}createItemCloneMesh(e){var t=e.threejsHook.clone(!1)
t.name="CLONE "+t.name
var o=e.threejsObj,r=null
if(e.gizmo){if(r=o.clone(!1),this.mustRenderGizmos()){var n=e.gizmo.clone()
r.add(n)}}else r="model__"==e.type?e.getObjectClone():o.clone()
return r.name="CLONE "+r.name,t.add(r),t}paintWithMaterial(e,t){e.traverse(function(e){if(e.isMesh)if(Array.isArray(e.material))e.material.forEach(function(o,r){e.material[r].visible&&(e.material[r]=t)})
else{if(!e.material.visible)return
e.material=t}})}convertMaterialToWhite(e){e.aoMap=null,e.emissiveMap=null,e.normalMap=null,e.envMap=null,e.onBeforeCompile=e=>{e.fragmentShader=e.fragmentShader.replace("#include <alphatest_fragment>","if(diffuseColor.a < 0.02)discard;diffuseColor = vec4(1.0,1.0,1.0,diffuseColor.a);")},void 0!==e.emissive&&e.emissive.set(1,1,1),this.useWireFrame&&(e.wireframe=!0)}addTransformControlsToScene(){var e=this,t=e.controller.controlsUtils.transformControls
if(t){var o=e.controller.controlsUtils.transformGhost
e.sceneControls.add(o),e.sceneControls.add(t.getHelper())}}setWireframe(){var e=this,t=!1
e.isActive&&!e.isExporting&&e.controller.projectData.settings.wireframe&&e.controller.projectData.settings.wireframe.enabled&&(t=!0),t!=e.useWireFrame&&(e.useWireFrame=t,e.whiteMat.wireframe=e.useWireFrame,e.sceneItems.forEach(function(t){t.isMissing||t.isIgnored||t.isDestroyed||"audio"!=t.type&&"camera"!=t.type&&"cameraTarget"!=t.type&&"group"!=t.type&&"light"!=t.type&&t.threejsObj.traverse(function(t){t.isMesh&&(Array.isArray(t.material)?t.material.forEach(function(t){t.wireframe=e.useWireFrame}):t.material.wireframe=e.useWireFrame)})}))}render3D(e){var t=this
t.renderer.setClearColor(0,0),t.clearScene(t.sceneAlpha),t.setWireframe()
var o=t.compositionManager.getDimensions(),r=o.width/o.height,n=t.getRenderSize(),i=n.width,a=n.height,l=Math.round(n.width/4),s=Math.round(l/r),c=t.renderer
c.setScissor(0,0,i,a),c.setViewport(0,0,i,a),c.clear(),t.sceneItems.forEach(function(o){if(o.threejsObj){var r=o.isVisibleInframe(e)
o.threejsHook.visible=r,"light"==o.type&&(r?o.setGizmoVisibility(t.mustRenderGizmos()):o.setGizmoVisibility(!1))}}),!t.isExporting&&t.isActive?("editor"==t.activeView?t.renderEditor():t.renderCameraView(e),t.renderControls(),"editor"==t.activeView&&(c.setScissor(i-l-4,4,l,s),c.setViewport(i-l-4,4,l,s),t.renderCameraView(e))):t.renderCameraView(e)}renderEditor(){var e=this,t=e.renderer
e.scene.add(e.ambientLight),t.setClearColor(3158064,1),t.setRenderTarget(null),t.clear(),e.compositionData.settings.grid.enabled&&t.render(e.sceneGrid,e.cameraEditor)
var o=e.controller.getters.getAllCompositionSceneItems(e.compositionManager,"camera")[0]
o||(console.log("warning - sceneItemCamera is undefined"),console.log(e.compositionData.name),console.log(e.compositionData.cameraType)),o.threejsObj.visible=!0,t.outputColorSpace=THREE.LinearSRGBColorSpace,t.render(e.scene,e.cameraEditor),t.outputColorSpace=THREE.SRGBColorSpace}renderCameraView(e){var t=this
window._canvasDebugY=0
var n,i=t.sceneItems.length,a=t.renderer
for(t.checkFrustum&&t.updateFrustum(),a.setClearColor(16777215,0),t.filteredSceneItems=[],n=0;n<i;n++)t.mustRenderItemInCameraView(t.sceneItems[n],e)&&t.filteredSceneItems.push(t.sceneItems[n])
var l=t.filteredSceneItems.length
t.filteredSceneItems.forEach(function(e,o){t.filteredSceneItemsClones[o]=t.createItemCloneMesh(e)
var r=getWorldTransform(e.threejsHook),n=t.filteredSceneItemsClones[o]
n.position.copy(r.position),n.rotation.set(r.rotation.x,r.rotation.y,r.rotation.z),n.scale.copy(r.scale)})
var s=[],c=[]
for(n=0;n<l;n++)t.filteredSceneItems[n].isPassStackable(e)&&c.push(n)
if(c.length){var u=c[0]
t.renderItemsStack_color(c),s.push({name:t.filteredSceneItems[u].name,opacity:100,renderTargetIndex:u})}for(n=0;n<l;n++){if(!(w=t.filteredSceneItems[n]).isPassStackable(e)){t.renderItemsStack_color([n])
var m=w.getParamValueAt(e,"opacity")
s.push({name:w.name,opacity:m,renderTargetIndex:n})}}if(c.length){u=c[0]
t.renderItemsStack_alpha(c,e)}for(n=0;n<l;n++){(w=t.filteredSceneItems[n]).isPassStackable(e)||t.renderItemsStack_alpha([n],e)}if(a.setRenderTarget(null),a.setClearColor(16777215,0),t.finalComposer.passes=[],t.finalComposer.addPass(t.clearPassStart),s.length>6){for(v=0;v<s.length;v++){var p=s[v],d=t.renderTargetColor[p.renderTargetIndex].texture,f=t.renderTargetAlpha[p.renderTargetIndex].texture
m=p.opacity/100;(h=new o.default).pass.uniforms.tColor.value=d,h.pass.uniforms.tAlpha.value=f,h.pass.uniforms.stackOpacity.value=m,t.finalComposer.addPass(h.pass)}}else{var v,h=new r.default,g=[],y=[],b=[]
for(v=0;v<s.length;v++){p=s[v],d=t.renderTargetColor[p.renderTargetIndex].texture,f=t.renderTargetAlpha[p.renderTargetIndex].texture,m=p.opacity/100
g.push(d),y.push(f),b.push(m)}h.pass.uniforms.u_colorTextures.value=g,h.pass.uniforms.u_alphaTextures.value=y,h.pass.uniforms.u_stackOpacity.value=b,h.pass.uniforms.u_nbStacks.value=s.length,t.finalComposer.addPass(h.pass)}if(t.isActive){var x=valueToSRGB(t.controller.projectData.background)
t.backgroundLastPass.pass.uniforms.u_color.value=x,t.finalComposer.addPass(t.backgroundLastPass.pass)}if(1==t.finalComposer.passes.length)return a.setScissorTest(!0),a.clear(),void a.setScissorTest(!1)
for(t.finalComposer.render(),t.finalComposer.passes.forEach(function(e){"StackPass"==e.name&&(e.dispose(),e.material.dispose())}),t.addToCanvasDebug("final",0,null),n=0;n<t.filteredSceneItems.length;n++){var w
"light"==(w=t.filteredSceneItems[n]).type&&(w.isAdded=!1,w.addToScene(),w.applyFrame(e))}}renderItemsStack(e,t,o){}makeObjectWhite(e,t){var o=this,r=o.whiteMat
if("light"!=e.type)if("shape"!=e.type)if("group"!=e.type)if("text"!=e.type)if("image"!=e.type)t.traverse(function(e){if(e.isMesh)if(Array.isArray(e.material))e.material.forEach(function(t,r){var n=t.clone()
o.convertMaterialToWhite(n),e.material[r]=n})
else{var t=e.material.clone()
o.convertMaterialToWhite(t),e.material=t}})
else{var n=e.getWhiteAlphaMat()
t.children[0].material=n}else if(_config.troikaText){var i=t.children[0]
const e=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,transparent:!0})
i.color=16777215,i.material=e}else o.paintWithMaterial(t,r)
else o.paintWithMaterial(t,o.whiteLineMat)
else o.paintWithMaterial(t,r)
else o.paintWithMaterial(t,r)}makeObjectBlack(e,t,o){var r=this
if("text"==e.type&&_config.troikaText)r.makeTroikaObjectBlack(e,clone,o)
else{var n=t,i=e.getParamValueAt(o,"opacity")/100
if("text"!=e.type)if("shape"!=e.type){var a
if("group"==e.type)return(a=e.getBlackAlphaMat()).opacity=i,void r.paintWithMaterial(n,a)
if("image"==e.type)return(a=e.getBlackAlphaMat()).opacity=i,void(n.children[0].material=a)
if("model"!=e.type)n.traverse(function(e){if(e.isMesh)if(Array.isArray(e.material))e.material.forEach(function(t,o){var n=t.clone()
r.convertMaterialToBlack(n,i),e.material[o]=n})
else{var t=e.material.clone()
r.convertMaterialToBlack(t,i),e.material=t}})
else{var l=e.getBlackAlphaMat(),s=0
n.traverse(function(e){e.isMesh&&(Array.isArray(e.material)?e.material.forEach(function(t,o){e.material[o]=l[o],e.material[o].opacity=i,o++}):(e.material=l[s],e.material.opacity=i,s++))})}}else{c=new THREE.MeshBasicMaterial({color:0,side:THREE.DoubleSide,transparent:!0,opacity:i})
r.paintWithMaterial(n,c)}else{var c=new THREE.MeshBasicMaterial({color:0,side:THREE.DoubleSide,transparent:!0,opacity:i})
r.paintWithMaterial(n,c)}}}renderControls(){var e=this
e.addTransformControlsToScene(),e.renderer.setRenderTarget(null),e.renderer.render(e.sceneControls,e.activeCamera)}mustRenderItemInCameraView(e,t){var o=this,r=o.mustRenderGizmos()
return!e.isMissing&&("camera"!=e.type&&(!("cameraTarget"==e.type&&!r)&&("audio"!=e.type&&(!!e.isVisibleInframe(t)&&!(o.checkFrustum&&"light"!=e.type&&!o.isSceneItemInFrustum(e))))))}downloadRenderTarget(e){}renderItemsStack_color(e){var t,o=this,r=e[0],n=o.sceneStack,i=o.renderer
for(o.renderTargetColor[r]||o.createItemRenderTargets(r),o.clearScene(n),n.add(o.ambientLight),t=0;t<o.filteredSceneItems.length;t++){var a=o.filteredSceneItems[t]
"light"==a.type&&n.attach(a.threejsHook)}var l,s=0
for(l=0;l<e.length;l++){s=e[l],"text"==o.filteredSceneItems[s].type&&_config.troikaText?o.doTroikaCloning():n.add(o.filteredSceneItemsClones[s])}var c=o.filteredSceneItems[r].effectManager
i.setRenderTarget(c.renderTargetIn),i.clear(),i.render(n,o.cameraComp)
var u=c.composer,m=o.renderTargetColor[r]
u.writeBuffer=m,u.readBuffer=m,c.renderClassic(),o.addToCanvasDebug("stack",0,o.renderTargetColor[r])}renderItemsStack_alpha(e,t){var o,r=this,n=e[0],i=r.renderer
for(o=0;o<r.filteredSceneItems.length;o++){var a=r.filteredSceneItemsClones[o],l=r.filteredSceneItems[o]
"light"!=l.type&&(a.parent!=r.sceneAlpha&&r.sceneAlpha.add(a),e.includes(o)?r.makeObjectWhite(l,a):r.makeObjectBlack(l,a,t))}i.setRenderTarget(r.renderTargetAlpha[n]),i.render(r.sceneAlpha,r.cameraComp),r.addToCanvasDebug("stack",0,r.renderTargetAlpha[n])}}e.default=l}),define("pikimov/classes/renderers/render-engine-css3",["exports"],function(e){function t(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=class{constructor(e,o){t(this,"controller",null),t(this,"renderEngine",null),t(this,"camera",null),t(this,"renderer",null),t(this,"compositionData",null),t(this,"scene",null)
var r=this
r.controller=e,r.renderEngine=o,r.compositionData=o.compositionData,r.scene=new THREE.Scene,r.createCamera(),r.createRenderer()}createCamera(){var e=this,t=e.renderEngine.compositionManager.getDimensions(),o=t.width,r=t.height
e.camera=new THREE.OrthographicCamera(o/-2,o/2,r/2,r/-2,1,2e3),e.camera.position.set(0,0,1e3),e.scene.add(e.camera)}createRenderer(){for(var e=document.getElementById("cssR");e.firstChild;)e.removeChild(e.firstChild)
this.renderer=new CSS3DRenderer({element:e}),this.resize()}resize(){var e=this,t=e.renderEngine.compositionManager.getDimensions(),o=e.controller.compositionDisplayZoom/100,r=Math.floor(t.width*o),n=Math.floor(t.height*o)
e.renderer.setSize(r,n)}renderWidgets(e){var t,o=this,r=o.renderEngine.sceneItems,n=0
for(t=0;t<r.length;t++){var i=r[t]
if("widget"==i.type){n++
var a=i.isVisibleInframe(e),l=i.cssObject
if(l.visible=a,!a)continue
l.parent||(console.log("widget not in scene => add it"),o.scene.add(l)),l.position.copy(i.threejsHook.position),l.rotation.copy(i.threejsHook.rotation),l.scale.copy(i.threejsHook.scale)}}n&&o.renderer.render(o.scene,o.camera)}}}),define("pikimov/classes/renderers/render-engine",["exports","@sentry/ember"],function(e,t){function o(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=class{constructor(e,t,r,n){o(this,"type",null),o(this,"controller",null),o(this,"compositionManager",null),o(this,"compositionData",null),o(this,"isActive",!1),o(this,"isExporting",!1),o(this,"renderer",null),o(this,"scene",null),o(this,"ambientLight",null),o(this,"sceneItems",null),o(this,"activeView",null),o(this,"activeCamera",null),o(this,"finalComposer",null),o(this,"rendererSize",{}),o(this,"canvas",null),o(this,"useRecycle",!1),o(this,"useManager",!1),o(this,"checkFrustum",!1),o(this,"frustumMatrix",null),o(this,"renderEngineCSS3",null),o(this,"delayRendererCreation",!1)
var i=this
console.log("new renderEngine",t.cameraType),i.useManager=_config.useRenderersManager,_config.isDebug&&console.log("useManager",i.useManager),i.controller=e,i.compositionManager=t,i.compositionData=r,i.scene=n,i.ambientLight=t.ambientLight,i.isActive=i.compositionManager.isActive,i.isExporting=i.controller.compositionManager.isExporting
var a=i.compositionManager.getDimensions()
if(!i.useRecycle){var l=i.compositionManager.canvas
if(i.delayRendererCreation){var s=!0
if(i.isActive&&(s=!1),"3D"==i.compositionManager.cameraType&&(s=!1),!i.isActive&&i.compositionManager.sceneItemComposition.isVisibleInframe(0)&&(s=!1),s)return void console.log("DELAY RENDERER ",i.compositionManager.sceneItemComposition.name)
i.createWebGLRenderer(l)}else i.createWebGLRenderer(l)
if(!i.renderer)return void console.log("! renderer creation failed !")}var c=i.getZoomMultiplier()
i.rendererSize={width:Math.floor(a.width*c),height:Math.floor(a.height*c)},i.renderer.setSize(i.rendererSize.width,i.rendererSize.height,!1),i.renderer.clear()}createRendererForSub(){var e=this
console.log("%c CREATE delayed sub R for "+e.compositionManager.compositionData.name+" ","background: #336633; color: #33ff33")
var t=e.compositionManager.getDimensions(),o=e.compositionManager.canvas
e.createWebGLRenderer(o)
e.rendererSize={width:Math.floor(1*t.width),height:Math.floor(1*t.height)},console.log("initial R size ---- ",e.rendererSize.width,e.rendererSize.height),e.renderer.setSize(e.rendererSize.width,e.rendererSize.height,!1),e.renderer.clear(),e.compositionManager.sceneItems.forEach(function(e){e.effectManager.composer||e.effectManager.createComposer()})}createWebGLRenderer(e){var o=this,r=!1
o.isActive&&(r=!0)
var n=!1
o.isActive&&"3D"==o.compositionManager.cameraType&&(n=!0)
var i={canvas:e,antialias:n,preserveDrawingBuffer:r,powerPreference:"high-performance"}
if(_config.stencil&&(i.stencil=!0),_usage.nbRenderers>15&&console.error("ALERT - nbRenderers limit reached",_usage.nbRenderers),!o.useManager||o.isActive){try{o.renderer=new THREE.WebGLRenderer(i),o.renderer.localClippingEnabled=!0,o.renderer.autoClear=!1,o.renderer.setPixelRatio(1)}catch(l){return console.log("ERROR new renderer on ",o.compositionData.name,_usage.nbRenderers),console.log("compType",o.type),console.log("_browser.webgl2",_browser.webgl2),console.log(l),console.log(l.name),console.log(_browser),_config.sentry&&t.captureMessage("ERROR new renderer",{extra:{type:o.type,nbRenderers:_usage.nbRenderers,errorName:l.name,errorMessage:l.message,rendererOptions:i}}),alert("Error creating webGL renderer\nPlease reload the app"),void o.controller.backToIndex()}_usage.nbRenderers++,console.log("+ nbRenderers, now x",_usage.nbRenderers),o.controller.countWebGLContexts(1)}else{var a=o.compositionManager.getDimensions()
o.renderer=o.controller.renderersManager.createSubRenderer(o,o.compositionData,i,a)}}getZoomMultiplier(){var e=this.controller.compositionDisplayZoom/100,t=this.controller.minRenderZoom
return e<t&&(e=t),e>1&&(e=1),e}getRenderSize(){var e=this
if("3D"==e.type){if(!e.isActive){var t=e.compositionManager.getDimensions(),o=e.getZoomMultiplier()
return{x:t.width*o,y:t.height*o,width:t.width*o,height:t.height*o}}return e.renderer.getDrawingBufferSize(new THREE.Vector2)}return{x:e.rendererSize.width,y:e.rendererSize.height,width:e.rendererSize.width,height:e.rendererSize.height}}render(e){var t=this
if(!t.compositionManager.isRenderingDisabled&&(void 0===e&&(e=t.compositionManager.currentFrame),t.useManager&&(t.renderer||(t.createWebGLRenderer(void 0),t.finalComposer=null,t.sceneItems.forEach(function(e){e.effectManager&&e.effectManager.resetEffects()}))),t.isExporting=t.controller.compositionManager.isExporting,t.finalComposer||t.createFinalComposer(),"2D"==t.type&&t.render2D(e),"3D"==t.type&&t.render3D(e),_config.useDataTexture&&!t.isActive)){var o=t.getRenderSize(),r=o.width,n=o.height
t.compositionManager.sceneItemComposition.copyRenderToTexture(t.renderer,r,n)}}disposeFinalComposer(){var e=this
e.finalComposer&&(e.finalComposer.passes.forEach(function(e){e.dispose(),e=void 0}),e.finalComposer.renderTarget1.dispose(),e.finalComposer.renderTarget2.dispose(),e.finalComposer.dispose(),e.finalComposer=void 0)}mustRenderGizmos(){return!(this.isExporting||!this.isActive)}updateFrustum(){var e=this
e.frustum||(e.frustum=new THREE.Frustum)
var t=e.cameraComp
t.updateMatrix(),t.updateMatrixWorld(),e.frustumMatrix=(new THREE.Matrix4).multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),e.frustum.setFromProjectionMatrix(e.frustumMatrix)}isSceneItemInFrustum(e){if(!this.frustum)return!0
var t=e.threejsObj
t.parent?.updateMatrixWorld(!0)
const o=new THREE.Box3
return t.traverse(e=>{if(e.isMesh){const t=(new THREE.Box3).setFromObject(e)
o.union(t)}}),this.frustum.intersectsBox(o)}clearScene(e){for(var t=e;t.children.length>0;)t.remove(t.children[0])}addToCanvasDebug(e,t,o){}destroy(){var e=this
"2D"==e.type&&e.destroy2D(),"3D"==e.type&&e.destroy3D(),e.renderer&&(e.renderer.setRenderTarget(null),e.renderer.clear(),e.renderer.dispose(),e.renderer=null),_usage.nbRenderers--,console.log("- nbRenderers",_usage.nbRenderers),e.controller.countWebGLContexts(-1),e.sceneItems=null,e.disposeFinalComposer()}}}),define("pikimov/classes/shaders/renderer-mix-shader",["exports","pikimov/classes/shaders/shaders-common"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e._renderer_mix_shader=void 0
var o={}
o.vertexShader=t._commonVertexShader,o.fragmentShader="\nvarying vec2 vUv;\nuniform sampler2D tAlpha;\nuniform sampler2D tColor;\n\nvoid main()\n{\n    mediump vec4 tColorMask = texture(tAlpha, vUv );//silouette\n    mediump vec4 tColorObj = texture(tColor, vUv );//with colors\n    \n    mediump vec4 tColorOut;\n\n    mediump float alpha = tColorMask.r;\n\n    tColorOut.rgb = tColorObj.rgb;\n    tColorOut.a = alpha;\n\n    //tColorOut.rgb *= alpha;\n\n    //to avoid alpha fuck up\n    gl_FragColor = vec4(tColorOut.rgb, tColorOut.a);\n}"
e._renderer_mix_shader=o}),define("pikimov/classes/shaders/shader-alpha-correction-pass",["exports"],function(e){Object.defineProperty(e,"__esModule",{value:!0}),e._alphaCorrectionPass_fragmentShader=void 0
e._alphaCorrectionPass_fragmentShader="varying vec2 vUv;\nuniform sampler2D tDiffuse;\n\n\nvec4 correctByAlpha(vec4 color)\n{\n    float alpha = color.a;\n\n    //full red, good for testing if result above 1.0 limit\n    color.r = 1.0;\n\n    if(alpha > 0.0 && alpha < 1.0)color.rgb /= alpha;\n\n    return color;\n}\n\n\nvoid main()\n{\n    mediump vec4 tColorIn = texture(tDiffuse, vUv);\n\n    //gl_FragColor = vec4(tColorIn.r * 0.0, tColorIn.g, tColorIn.b, tColorIn.a);\n\n    gl_FragColor = correctByAlpha(tColorIn);\n\n}"}),define("pikimov/classes/shaders/shader-bg-grid",["exports","pikimov/classes/shaders/shaders-common"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e._shaderBgGrid=void 0
var o={}
o.vertexShader=t._commonVertexShader,o.fragmentShader="uniform mediump vec3 u_color;//rgb background\nuniform mediump vec3 grid_color;\nuniform float u_step;\nuniform float u_thickness;\nuniform mediump vec3 canvas_size;\nvarying vec2 vUv;\n\nvoid main()\n{\n    gl_FragColor = vec4(u_color, 1);\n\n    // +1.0 so it does no start on top left corner\n    float x = ((vUv.x * canvas_size.x) + 1.0);\n    float y = (canvas_size.y - (vUv.y * canvas_size.y) + 1.0);\n\n    //every n pixels\n    if (mod(x, u_step) <= u_thickness || mod(y, u_step) <= u_thickness)\n    {\n        gl_FragColor.rgb = grid_color.rgb;\n    }\n}"
e._shaderBgGrid=o}),define("pikimov/classes/shaders/shader-blend-pass",["exports","pikimov/classes/shaders/shaders-common"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e._blendPass_fragmentShader=void 0
var o="varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform sampler2D tTexture;\nuniform mediump vec3 u_background;\nuniform float u_opacity;\nuniform int u_blendMode;\nuniform int u_depthLevel;\n\n"+t._correctByAlpha+"\n//color1 is bg, color 2 is what to blit\nvec4 doBlendNormal( vec4 color1, vec4 color2 )\n{\n    //if blitting on alpha 0, nothing to do\n    if (color1.a == 0.0)return color2;\n\n    //not needed, check done before\n    //if blit color is alpha 0, nothing to do\n    //if (color2.a == 0.0)return color1;\n\n    // Compute the resulting alpha by combining the alphas of color1 and color2\n    float alphaOut = color2.a + color1.a * (1.0 - color2.a);\n\n    /*\n    // If the resulting alpha is zero, return a transparent color to avoid division by zero\n    if (alphaOut == 0.0)return vec4(0.0);\n    */\n\n    // Blend the RGB values, normalized by the resulting alpha\n    vec3 rgbOut = (color2.rgb * color2.a + color1.rgb * color1.a * (1.0 - color2.a)) / alphaOut;\n\n    // Return the blended color with the computed alpha\n    return vec4(rgbOut, alphaOut);\n}\n\n//color1 is bg, color 2 is what to blit\nvec4 doBlendAdd( vec4 color1, vec4 color2 )\n{\n    //add both texture together\n    mediump float a1 = color1.a;\n    mediump float a2 = color2.a;\n    mediump float totalAlpha = min(color2.a + color1.a, 1.0);\n\n    if (a1 > 1.0 - a2)a1 = 1.0 - a2;\n\n    color2.r = color2.r * a2 / 1.0 + color1.r;// * a1 / 1.0;\n    color2.g = color2.g * a2 / 1.0 + color1.g;// * a1 / 1.0;\n    color2.b = color2.b * a2 / 1.0 + color1.b;// * a1 / 1.0;\n\n    color2.a = totalAlpha;\n\n    return color2;\n}\n\n\n\nvec4 doBlendMultiply( vec4 color1, vec4 color2 )\n{\n    //new 2025 05 21 - important\n    //if alpha of bg if < 1, mix it with project color. important for sub comps\n    color1.rgb = mix(u_background.rgb, color1.rgb, color1.a);\n\n    vec4 colorM = vec4(color2.rgb * color1.rgb, color2.a);\n\n    //combine with a normal blend mode to consider both alpha\n    vec4 resultColor = doBlendNormal(color1, colorM);\n\n/*\n    //seemed ok but not used\n    //chat gpt 2025 05 21\n    vec3 blendedColor = color1.rgb * color2.rgb;\n    float outAlpha = color2.a + color1.a * (1.0 - color2.a);\n    vec3 outColor = (color2.a * blendedColor + color1.rgb * color1.a * (1.0 - color2.a)) / max(outAlpha, 0.0001);\n\n    resultColor = vec4(outColor, outAlpha);\n*/\n\n    return resultColor;\n}\n\nvec4 doBlendScreen( vec4 color1, vec4 color2 )\n{\n    //add both texture together\n    mediump float a1 = color1.a;\n    mediump float a2 = color2.a;\n    mediump float totalAlpha = min(a1 + a2, 1.0);\n\n    if (a1 > 1.0 - a2)a1 = 1.0 - a2;\n\n    vec4 resultColor;\n\n    resultColor.r = 1.0 - (1.0 - color1.r) * (1.0 - color2.r);\n    resultColor.g = 1.0 - (1.0 - color1.g) * (1.0 - color2.g);\n    resultColor.b = 1.0 - (1.0 - color1.b) * (1.0 - color2.b);\n    resultColor.a = totalAlpha;\n\n    vec3 finalColor = mix(color1.rgb, resultColor.rgb, a2);\n\n    return vec4(finalColor, totalAlpha);\n    //return resultColor;\n}\n\nvec4 doBlendDifference( vec4 color1, vec4 color2 )\n{\n    mediump float a1 = color1.a;\n    mediump float a2 = color2.a;\n    mediump float totalAlpha = min(a1 + a2, 1.0);\n\n    // Calculate the difference\n    vec4 resultColor = abs(color1 - color2);\n\n    resultColor.a = totalAlpha;\n\n    vec3 finalColor = mix(color1.rgb, resultColor.rgb, a2);\n\n    return vec4(finalColor, totalAlpha);\n    //return resultColor;\n}\n\nvec4 doBlendOverlay(vec4 color1, vec4 color2)\n{\n    mediump float a1 = color1.a;\n    mediump float a2 = color2.a;\n    mediump float totalAlpha = min(a1 + a2, 1.0);\n\n    vec3 blended = mix(2.0 * color1.rgb * color2.rgb, \n        1.0 - 2.0 * (1.0 - color1.rgb) * (1.0 - color2.rgb), \n        step(0.5, color1.rgb));\n\n    vec3 finalColor = mix(color1.rgb, blended, a2);\n\n    return vec4(finalColor, totalAlpha);\n}\n\n\nvoid main()\n{\n    mediump vec4 tColorDiffuse = texture(tDiffuse, vUv);\n    mediump vec4 tColorTexture = texture(tTexture, vUv);\n\n    //good for dark alpha edges\n    //must be done before blitting\n    tColorTexture = correctByAlpha(tColorTexture);\n    tColorDiffuse = correctByAlpha(tColorDiffuse);\n\n    //new 2024 07 16\n    //if blitting against a transparent pixel, like for example, the background of a sub comp\n\n    if (u_depthLevel > 0 && tColorDiffuse.a == 0.0)\n    {\n        //use project background color, not great, but better than nothing\n        tColorDiffuse = vec4(u_background.rgb, 0.0);\n    }\n    \n    //consider opacity ONLY on the texture to blit\n    tColorTexture.a *= u_opacity;\n\n    if (tColorTexture.a == 0.0)\n    {\n        //nothing to do if alpha of texture to blit is zero\n        gl_FragColor = tColorDiffuse;\n    }\n    else\n    {\n        vec4 resultColor;\n\n        //normal\n        if (u_blendMode == 0) resultColor = doBlendNormal(tColorDiffuse, tColorTexture);\n\n        //add\n        if (u_blendMode == 1) resultColor = doBlendAdd(tColorDiffuse, tColorTexture);\n\n        //multiply\n        if (u_blendMode == 2) resultColor = doBlendMultiply(tColorDiffuse, tColorTexture);\n\n        //screen\n        if (u_blendMode == 3) resultColor = doBlendScreen(tColorDiffuse, tColorTexture);\n\n        //difference\n        if (u_blendMode == 4) resultColor = doBlendDifference(tColorDiffuse, tColorTexture);\n\n        //overlay\n        if (u_blendMode == 5) resultColor = doBlendOverlay(tColorDiffuse, tColorTexture);\n\n        //debug: paint half in red\n        //if (vUv.x > 0.5){resultColor.r = 1.0;resultColor.a = 1.0;}\n\n        gl_FragColor = resultColor;\n    }\n}"
e._blendPass_fragmentShader=o}),define("pikimov/classes/shaders/shader-opacity",["pikimov/classes/shaders/shaders-common"],function(e){var t={}
t.vertexShader=e._commonVertexShader,t.fragmentShader="varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform float u_opacity;\n\nvoid main()\n{\n    mediump vec4 tColorIn = texture(tDiffuse, vUv);\n    float alpha = tColorIn.a;\n    tColorIn.a = alpha * u_opacity;\n    tColorIn.rgb *= tColorIn.a;\n\n    gl_FragColor = tColorIn;\n}"}),define("pikimov/classes/shaders/shaders-common",["exports"],function(e){Object.defineProperty(e,"__esModule",{value:!0}),e._correctByAlpha_disabled=e._correctByAlpha=e._commonVertexShader=void 0
e._commonVertexShader="varying vec2 vUv;void main(){vUv = uv;gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);}",e._correctByAlpha="\nvec4 correctByAlpha(vec4 color)\n{\n    float alpha = color.a;\n    if(alpha > 0.0 && alpha < 1.0)color.rgb /= alpha;\n    return color;\n}\n",e._correctByAlpha_disabled="\nvec4 correctByAlpha(vec4 color)\n{\n    return color;\n}\n"}),define("pikimov/classes/shaders/shaders-masks",["exports","pikimov/classes/shaders/shaders-common"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e._shaderMaskExpand=e._shaderMaskConvert=e._shaderMaskBlur=e._shaderAlphaMask=void 0
const o="varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform sampler2D tMask;\nuniform bool u_invert;\nuniform float u_opacityMask;\n\n"+t._correctByAlpha+"\n\nvoid main()\n{\n    //float alphaMask = texture(tMask, vUv ).a;//rgba texture\n    float alphaMask = texture(tMask, vUv ).r;//R8 texture\n\n    if (u_invert)alphaMask = 1.0 - alphaMask;\n    \n    if (alphaMask == 0.0)\n    {\n        gl_FragColor = vec4(0.0);//faster than discard!\n    }\n    else\n    {\n        mediump vec4 tColorIn = texture(tDiffuse, vUv);\n\n        tColorIn = correctByAlpha(tColorIn);\n        tColorIn.a = tColorIn.a * alphaMask * u_opacityMask;\n        gl_FragColor = tColorIn;\n    }\n}",r="varying vec2 vUv;\nuniform sampler2D tDiffuse;\n\n"+t._correctByAlpha+"\n\nvoid main()\n{\n    mediump vec4 tColorIn = texture(tDiffuse, vUv);\n\n    tColorIn = correctByAlpha(tColorIn);\n    mediump float lum = (tColorIn.r + tColorIn.g + tColorIn.b)/3.0;\n\n    float alphaMask = tColorIn.a * lum;//divide alpha by luminance\n\n    gl_FragColor = vec4(0.0, 0.0, 0.0, alphaMask);\n}"
e._shaderMaskConvert=r,e._shaderMaskBlur="#define PI2 6.28318530718\nvarying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform vec2 resolution;\nuniform mediump float u_feather;\n\nvec4 featherBiDimenions(vec4 tColorIn, float blur_radius)\n{\n    float Directions = 16.0;\n    float Quality = 4.0;\n\n    //more quality when more blur radius\n    if (blur_radius >= 20.0)\n    {\n        Directions = 24.0;\n        Quality = 5.0;\n    }\n    if (blur_radius >= 40.0)\n    {\n        Directions = 32.0;\n        Quality = 6.0;\n    }\n\n    vec2 Radius = blur_radius/resolution.xy;\n\n    // Blur calculations\n    for( float d=0.0; d<PI2; d+=PI2/Directions)\n    {\n        for(float i=1.0/Quality; i<=1.001; i+=1.0/Quality)\n        {\n            tColorIn += texture( tDiffuse, vUv+vec2(cos(d),sin(d))*Radius*i);\n        }\n    }\n\n    tColorIn /= Quality * Directions +1.0;\n\n    return tColorIn;\n}\n\nvoid main()\n{\n    mediump vec4 tColorMask = texture(tDiffuse, vUv);\n\n    tColorMask = featherBiDimenions(tColorMask, u_feather);\n\n    float alphaMask = tColorMask.a;\n    \n    gl_FragColor = vec4(0.0, 0.0, 0.0, alphaMask);\n}",e._shaderMaskExpand="varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform vec2 resolution;\nuniform vec2 texelSize;\nuniform mediump float u_expansion;\n\nvoid main()\n{\n    mediump vec4 tColorMask = texture(tDiffuse, vUv);\n\n    float radius = abs(u_expansion);\n\n    float alphaMask;\n    if (u_expansion >= 0.0) {\n        float maxAlpha = 0.0;\n        for (int x = -2; x <= 2; x++) {\n            for (int y = -2; y <= 2; y++) {\n                vec2 offset = vec2(float(x), float(y)) * texelSize * radius;\n                float sampl = texture2D(tDiffuse, vUv + offset).a;\n                maxAlpha = max(maxAlpha, sampl);\n            }\n        }\n        alphaMask = maxAlpha;\n    } else {\n        float minAlpha = 1.0;\n        for (int x = -2; x <= 2; x++) {\n            for (int y = -2; y <= 2; y++) {\n                vec2 offset = vec2(float(x), float(y)) * texelSize * radius;\n                float sampl = texture2D(tDiffuse, vUv + offset).a;\n                minAlpha = min(minAlpha, sampl);\n            }\n        }\n        alphaMask = minAlpha;\n    }\n\n    gl_FragColor = vec4(0.0, 0.0, 0.0, alphaMask);\n}",e._shaderAlphaMask=o}),define("pikimov/classes/stripe-curve",["exports"],function(e){function t(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=class{constructor(e,o){t(this,"sceneItem",null),t(this,"keyframes",null),t(this,"propertyJson",null),t(this,"scaleX",1),t(this,"scaleY",.2),t(this,"minValue",0),t(this,"maxValue",100),t(this,"width",100),t(this,"height",100),t(this,"fillColor","rgba(0,0,0,.2)"),t(this,"paramD","")
var r=this
if(r.sceneItem=e,r.scaleX=o,r.propertyJson=r.getProperty(),r.propertyJson){var n="keyframesUpdate_"+r.sceneItem.compUid
document.addEventListener(n,function(){r.onKeyEvent()},!1),r.build()}}onKeyEvent(){var e=this
requestAnimationFrame(function(){e.build()})}getProperty(){var e=null
return this.sceneItem.itemData.params.forEach(function(t){"opacity"!=t.name&&"volume"!=t.name||(e=t)}),e}onZoomChanged(e){this.scaleX=e,this.build()}build(){var e=this,t="opacityCurve"+e.sceneItem.compUid,o=document.querySelector("#"+t)
o&&o.remove()
var r=e.propertyJson
if(r||(console.error("build stripe opac -> no propertyJson"),console.log(e.sceneItem.name,e.sceneItem.type)),r.useKeyframes&&!r.keyframes&&(console.error("build stripe opac -> no propertyJson.keyframes"),console.log(e.sceneItem.name,e.sceneItem.type)),r.useKeyframes||!(1*e.propertyJson.value>95))if(e.keyframes=r.keyframes,!r.useKeyframes||e.keyframes){var n=e.sceneItem.itemData.time,i=n.out-n.in
if(i+=1,e.width=Math.round(i*e.scaleX),e.createSVG(t),r.useKeyframes&&e.keyframes.length)e.doProperty(e.keyframes,"p")
else{var a=[{frame:0,values:{p:1*r.value},easing:"Static"}]
e.doProperty(a,"p")}}else console.log("animated but no keyframes array")}createSVG(e){var t=this,o=document.querySelector('.stripe[data-compuid="'+t.sceneItem.compUid+'"]')
if(o){var r=Math.round(t.height*t.scaleY),n=document.createElementNS("http://www.w3.org/2000/svg","svg")
n.id=e,n.setAttribute("width",t.width),n.setAttribute("height",r),t.domSVG=n,o.appendChild(t.domSVG)}}doProperty(e,t){var o=this,r=e[0],n=o.getKeyframeValue(r,t),i=o.getKeyframeX(r),a=(o.height-n+o.minValue)*o.scaleY
o.paramD=`M 0 ${a} L ${i} ${a}`,e.forEach(function(r,n){var i=null
e[n+1]&&(i=e[n+1]),o.buildOneKeyframe(i,t,n)})
var l=e[e.length-1]
n=o.getKeyframeValue(l,t),i=o.width,a=(o.height-n+o.minValue)*o.scaleY
o.paramD+=` L ${i} ${a}`,o.paramD+=` L ${o.width} 0 L 0 0 z`,o.domSVG.innerHTML=`<path d="${o.paramD}" fill="${o.fillColor}" stroke-width="0"/>`}buildOneKeyframe(e,t,o){e&&this.updatePath(o,t)}updatePath(e,t){var o=this,r=o.keyframes,n=o.scaleY,i=r[e],a=r[e+1],l=o.getKeyframeValue(i,t),s=o.getKeyframeValue(a,t),c=o.getKeyframeX(i),u=(o.height-l+o.minValue)*n,m=o.getKeyframeX(a),p=(o.height-s+o.minValue)*n,d=m-c,f=c,v=u,h=m,g=p,y=i.easing
if(y||(y="Quadratic.InOut"),"Quadratic.InOut"==y&&(f=c+45*d/100,v=u,h=c+55*d/100,g=p),"Linear"==y){var b=p-u
f=c+20*d/100,v=u+20*b/100,h=c+80*d/100,g=u+80*b/100}if("Cubic.In"==y&&(f=c+32*d/100,v=u,h=c+67*d/100,g=u),"Cubic.Out"==y&&(f=c+33*d/100,v=p,h=c+68*d/100,g=p),"Static"==y){var x=p
return f=c,v=p=u,h=c,g=p,void(o.paramD+=` L ${m} ${u} L ${m} ${x}`)}if("Custom"==y){var w=i.handles[t][0],k=i.handles[t][1]
f=c+d*w.x/100,v=u+w.y*n,h=c+d*k.x/100,g=p+k.y*n}o.paramD+=` C ${f} ${v}, ${h} ${g}, ${m} ${p}`}getKeyframeX(e){return(e.frame-this.sceneItem.itemData.time.in)*this.scaleX}getKeyframeValue(e,t){return e.values[t]}}}),define("pikimov/classes/tools/motion-tracking",["exports","@ember/object"],function(e,t){function o(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=class{constructor(e,t){o(this,"controller",null),o(this,"motionTrackingComponent",null),o(this,"compositionManager",null),o(this,"zoom",100),o(this,"frameIndex",0),o(this,"maxFrameIndex",100),o(this,"startPosition",null),o(this,"isRunning",!1),o(this,"bakedPositions",[]),o(this,"sceneItem",null),o(this,"canvas2D",null),o(this,"label_frameIndex",null)
var r=this
r.controller=e,r.motionTrackingComponent=t,r.compositionManager=r.controller.compositionManager,r.zoom=r.motionTrackingComponent.zoom}getStartPosition(){return{x:this.startPosition.x,y:this.startPosition.y}}prepareItem(){var e=this,o=e.sceneItem.getCompItem(),r=e.sceneItem.getTransformAt(e.frameIndex)
o.position.useKeyframes||(0,t.set)(o.position,"useKeyframes",!0),(0,t.set)(o.position,"keyframes",[]),e.sceneItem.updateItemPosition(r.position)}startBaking(e,t,o){var r=this
console.log("start MT baking"),startLoading(),r.canvas2D=document.querySelector("#motionTracking canvas"),r.label_frameIndex=document.querySelector("#motionTracking .frameIndex"),r.frameIndex=e.startFrame,r.maxFrameIndex=e.endFrame,r.sceneItem=t,r.startPosition=o,r.controller.setFrame(r.frameIndex),setTimeout(function(){r.loadJSFeat()},500)}stopBaking(){console.log("STOP BAKING")
var e=this
e.isRunning=!1,e.controller.playbackUtils.pause(),e.stopJSFeat(),e.motionTrackingComponent.onTrackingDone(e.frameIndex)}loadJSFeat(){var e=this,t=document.createElement("script")
t.onload=function(){e.JSFeatLoaded()},t.src="js/libs/jsfeat.min.js",document.head.appendChild(t)}JSFeatLoaded(){stopLoading(),this.startJSFeat()}startJSFeat(){var e=this,t=e.zoom/100
e.isRunning=!0
var o=document.querySelector("#motionPath")
o.innerHTML="",o.style.width=e.canvas2D.clientWidth+"px",o.style.height=e.canvas2D.clientHeight+"px",e.prepareItem()
var r,n,i,a,l,s,c=e.sceneItem.itemData.position.keyframes
r=new jsfeat.pyramid_t(3),n=new jsfeat.pyramid_t(3),r.allocate(640,480,jsfeat.U8_t|jsfeat.C1_t),n.allocate(640,480,jsfeat.U8_t|jsfeat.C1_t),i=0,a=new Uint8Array(100),l=new Float32Array(200),s=new Float32Array(200)
var u=20,m=30,p=.01,d=.001,f=e.compositionManager.canvas,v=f.width,h=f.height,g=e.canvas2D.getContext("2d")
b()
var y=e.getStartPosition()
function b(){g.drawImage(f,0,0)
var e=g.getImageData(0,0,v,h),t=l
l=s,s=t
var o=n
n=r,r=o,jsfeat.imgproc.grayscale(e.data,v,h,r.data[0]),r.build(r.data[0],!0),jsfeat.optical_flow_lk.track(n,r,l,s,i,u,m,a,p,d)}s[i<<1]=y.x,s[1+(i<<1)]=y.y,i++,function o(){if(b(),function(){for(var e=i,t=0,o=0;t<e;++t)1==a[t]&&(o<t&&(s[o<<1]=s[t<<1],s[1+(o<<1)]=s[1+(t<<1)]),++o)
i=o}(),0==i)return openModal({h2:"Tracking lost",p:"tracking lost on frame "+e.frameIndex}),void e.stopBaking()
var r={x:s[0],y:s[1]},n=e.controller.keyframesUtils.generateKeyUid()
if(c.push({frame:e.frameIndex,values:{x:r.x/t,y:r.y/t,z:0},uid:n,static:!1,easing:"Linear"}),e.motionTrackingComponent.updateGhostCSS(r.x,r.y),e.addToMotionPath(r.x,r.y),e.label_frameIndex.textContent="#"+e.frameIndex,e.frameIndex>=e.maxFrameIndex)return void e.stopBaking()
if(e.frameIndex++,e.isRunning){var l=function(){o()}
e.compositionManager.renderNextFrame(l)}}()}addToMotionPath(){var e=document.querySelector("#motionPath"),t=this.sceneItem.itemData.position.keyframes,o=this.zoom/100
if(t.length>1){var r=t.length-1,n={x:t[r-1].values.x*o,y:t[r-1].values.y*o},i={x:t[r].values.x*o,y:t[r].values.y*o},a=`<line x1="${n.x}" x2="${i.x}" y1="${n.y}" y2="${i.y}" stroke="#ff33cc" stroke-width="3"/>`
e.innerHTML+=a}}stopJSFeat(){}}}),define("pikimov/classes/tools/transcribe",["exports","@ember/object"],function(e,t){function o(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=class{constructor(e,t){o(this,"controller",null),o(this,"transcribeComponent",null),o(this,"isRunning",!1),o(this,"transcriber",null)
var r=this
r.controller=e,r.transcribeComponent=t,r.loadTRModule()}async loadTRModule(){var e=this
await async function(e){return new Promise((t,o)=>{const r=document.createElement("script")
r.src=e,r.type="module",r.onload=()=>t(),r.onerror=()=>o(new Error(`Failed to load script: ${e}`)),document.head.appendChild(r)})}("js/tr/whisper.js"),e.transcriber=new c_transcriber(e.controller),e.transcriber.getReady(function(){(0,t.set)(e.transcribeComponent,"isReady",!0)})}trimAudioBuffer(e,t,o,r){console.log("trim audio buffer from",o,"to",r,"=>",r-o)
const n=t.sampleRate,i=Math.floor(o*n),a=Math.floor(r*n),l=t.numberOfChannels,s=e.createBuffer(l,a-i,n)
try{for(let e=0;e<l;e++){const o=t.getChannelData(e).subarray(i,a)
s.getChannelData(e).set(o)}}catch(c){console.error(c),gaEvent({event:"error - crop audio subs"}),alert("error while cropping audio for subs")}return s}audioBufferToWavFile(e){const t=e.numberOfChannels,o=e.sampleRate,r=e.length,n=new ArrayBuffer(44+r*t*2),i=new DataView(n)
let a=0
const l=e=>{for(let t=0;t<e.length;t++)i.setUint8(a++,e.charCodeAt(t))}
l("RIFF"),i.setUint32(a,36+r*t*2,!0),a+=4,l("WAVE"),l("fmt "),i.setUint32(a,16,!0),a+=4,i.setUint16(a,1,!0),a+=2,i.setUint16(a,t,!0),a+=2,i.setUint32(a,o,!0),a+=4,i.setUint32(a,o*t*2,!0),a+=4,i.setUint16(a,2*t,!0),a+=2,i.setUint16(a,16,!0),a+=2,l("data"),i.setUint32(a,r*t*2,!0),a+=4
const s=[]
for(let c=0;c<t;c++)s.push(e.getChannelData(c))
for(let c=0;c<r;c++)for(let e=0;e<t;e++){const t=Math.max(-1,Math.min(1,s[e][c]))
i.setInt16(a,32767*t,!0),a+=2}return new Blob([n],{type:"audio/wav"})}async start(e){var t=this,o=t.controller.activeCompositionData,r=1*o.frameRate,n=e.itemData.time,i=1*n.out
i>1*o.time.end&&(i=1*o.time.end)
var a=(n.in-n.trackIn)/r,l=roundValue((i-n.in)/r,2)
console.log("start_s",a,"s"),console.log("duration_s",l,"s")
var s=e.audioBuffer,c=new AudioContext,u=n.trackIn/r,m=u+l,p=t.trimAudioBuffer(c,s,u,m),d=t.audioBufferToWavFile(p),f=URL.createObjectURL(d)
return console.log("start tool - transcribe"),await t.transcriber.doIt(f,a,l,r,n.trackIn)}}}),define("pikimov/components/project/composition/add-item",["exports","@ember/component","@glimmer/component","@ember/object","@ember/runloop","@ember/template-factory"],function(e,t,o,r,n,i){var a
function l(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function s(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const c=(0,i.createTemplateFactory)({id:"JnnWEzTf",block:'[[[10,0],[14,1,"addItemSelector"],[14,"popover",""],[12],[1,"\\n\\n"],[41,[28,[37,2],[[30,0,["currentStep"]],1],null],[[[1,"    "],[10,"ul"],[14,0,"step1"],[12],[1,"\\n        "],[11,"li"],[4,[38,5],["click",[28,[37,6],[[30,0,["setType"]],"asset"],null]],null],[12],[10,"i"],[14,0,"bx bx-image-alt"],[12],[13],[1,"Image, video, audio"],[13],[1,"\\n        "],[11,"li"],[4,[38,5],["click",[28,[37,6],[[30,0,["addItem"]],"shape","plane"],null]],null],[12],[10,"i"],[14,0,"bx bx-rectangle"],[12],[13],[1,"Rectangle"],[13],[1,"\\n        "],[11,"li"],[4,[38,5],["click",[28,[37,6],[[30,0,["addItem"]],"shape","circle"],null]],null],[12],[10,"i"],[14,0,"bx bx-circle"],[12],[13],[1,"Disc / Elipse"],[13],[1,"\\n"],[41,[30,0,["config","features","freeShape"]],[[[1,"            "],[11,"li"],[4,[38,5],["click",[28,[37,6],[[30,0,["addItem"]],"freeShape",null],null]],null],[12],[10,"i"],[14,0,"bx bx-shape-polygon"],[12],[13],[1,"Vector shape"],[13],[1,"\\n"]],[]],null],[1,"        "],[11,"li"],[4,[38,5],["click",[28,[37,6],[[30,0,["setType"]],"asset"],null]],null],[12],[10,"i"],[14,0,"bx bx-cube"],[12],[13],[1,"3D model (.glb file)"],[13],[1,"\\n        "],[11,"li"],[4,[38,5],["click",[28,[37,6],[[30,0,["setType"]],"sequence"],null]],null],[12],[10,"i"],[14,0,"bx bx-images"],[12],[13],[1,"Image sequence"],[13],[1,"\\n"],[1,"        "],[11,"li"],[4,[38,5],["click",[28,[37,6],[[30,0,["addItem"]],"text",null],null]],null],[12],[10,"i"],[14,0,"bx bx-text"],[12],[13],[1,"Text"],[13],[1,"\\n        "],[11,"li"],[4,[38,5],["click",[28,[37,6],[[30,0,["addItem"]],"group",null],null]],null],[12],[10,"i"],[14,0,"bx bx-cross"],[12],[13],[1,"Group"],[13],[1,"\\n\\n\\n\\n"],[41,[30,0,["config","compositions","allow3D"]],[[[1,"            "],[11,"li"],[4,[38,5],["click",[28,[37,6],[[30,0,["setType"]],"light"],null]],null],[12],[10,"i"],[14,0,"bx bx-bulb"],[12],[13],[1,"Light"],[13],[1,"\\n"]],[]],null],[41,[30,0,["config","features","figmaImport"]],[[[1,"            "],[11,"li"],[4,[38,5],["click",[28,[37,6],[[30,0,["setType"]],"figma"],null]],null],[12],[10,"i"],[14,0,"bx bx-code-alt"],[12],[13],[1,"figma file"],[13],[1,"\\n"]],[]],null],[1,"\\n\\n"],[41,[30,0,["config","features","cloudVideos"]],[[[1,"            "],[11,"li"],[4,[38,5],["click",[28,[37,6],[[30,0,["setType"]],"cloudVideo"],null]],null],[12],[10,"i"],[14,0,"bx bx-cloud"],[12],[13],[1,"cloud Video"],[13],[1,"\\n"]],[]],null],[1,"        \\n    "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[41,[28,[37,2],[[30,0,["currentStep"]],2],null],[[[1,"    "],[10,"ul"],[14,0,"step2"],[12],[1,"\\n\\n"],[41,[28,[37,2],[[30,0,["currentType"]],"asset"],null],[[[1,"            "],[10,"li"],[14,5,"display:none;"],[12],[1,"\\n"],[1,"                "],[8,[39,8],null,[["@controller","@parent","@label","@multiple"],[[30,1],[30,0],"import a file",true]],null],[1,"\\n            "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[41,[28,[37,2],[[30,0,["currentType"]],"sequence"],null],[[[1,"            "],[10,"li"],[12],[1,"\\n                "],[8,[39,8],null,[["@controller","@parent","@label","@multiple","@type"],[[30,1],[30,0],"import sequence",true,"sequence"]],null],[1,"\\n                (select ALL files)\\n            "],[13],[1,"\\n            "],[10,"li"],[14,0,"empty"],[12],[1," "],[13],[1,"\\n"]],[]],null],[1,"        \\n\\n"],[41,[28,[37,2],[[30,0,["currentType"]],"light"],null],[[[1,"            "],[11,"li"],[24,0,"choice"],[4,[38,5],["click",[28,[37,6],[[30,0,["addItem"]],"light","point"],null]],null],[12],[1,"Point light"],[13],[1,"\\n            "],[11,"li"],[24,0,"choice"],[4,[38,5],["click",[28,[37,6],[[30,0,["addItem"]],"light","spot"],null]],null],[12],[1,"Spot light"],[13],[1,"\\n            "],[11,"li"],[24,0,"choice"],[4,[38,5],["click",[28,[37,6],[[30,0,["addItem"]],"light","sun"],null]],null],[12],[1,"Sun"],[13],[1,"\\n"]],[]],null],[1,"\\n"],[41,[28,[37,2],[[30,0,["currentType"]],"widget"],null],[[[1,"            "],[11,"li"],[24,0,"choice"],[4,[38,5],["click",[28,[37,6],[[30,0,["addItem"]],"widget","demo_weatherA"],null]],null],[12],[1,"demo: weather"],[13],[1,"\\n            "],[11,"li"],[24,0,"choice"],[4,[38,5],["click",[28,[37,6],[[30,0,["addItem"]],"widget","demo_timingCenter"],null]],null],[12],[1,"demo: timingCenter"],[13],[1,"\\n            "],[10,"li"],[14,0,"empty"],[12],[1," "],[13],[1,"\\n            "],[11,"li"],[24,0,"choice"],[4,[38,5],["click",[28,[37,6],[[30,0,["addItem"]],"widget","url"],null]],null],[12],[1,"iframe URL"],[13],[1,"\\n            "],[11,"li"],[24,0,"choice"],[4,[38,5],["click",[28,[37,6],[[30,0,["addItem"]],"widget","html"],null]],null],[12],[1,"HTML code"],[13],[1,"\\n"]],[]],null],[1,"\\n"],[41,[28,[37,2],[[30,0,["currentType"]],"figma"],null],[[[1,"            "],[10,"li"],[12],[1,"\\n                "],[10,"iframe"],[14,1,"figmaIframe"],[14,"width","300"],[14,"height","300"],[14,"src","https://pikimov.com/figma?bb=1"],[12],[13],[1,"\\n            "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[41,[28,[37,2],[[30,0,["currentType"]],"cloudVideo"],null],[[[1,"            "],[10,"li"],[12],[1,"\\n                "],[10,1],[14,5,"color:white!important;"],[12],[1,"Video URL"],[13],[1,"\\n                "],[8,[39,11],null,[["@type","@placeholder","@maxlength","@value","@action"],["text","https://","200",[30,0,["cloudVideoURL"]],[30,0,["setVideoURL"]]]],null],[1,"\\n\\n                "],[11,1],[24,0,"button"],[4,[38,5],["click",[28,[37,6],[[30,0,["setVideoURL"]],true],null]],null],[12],[1,"OK"],[13],[1,"\\n            "],[13],[1,"\\n"]],[]],null],[1,"\\n        "],[10,"li"],[14,0,"empty"],[12],[1," "],[13],[1,"\\n        "],[11,"li"],[24,0,"back"],[4,[38,5],["click",[28,[37,6],[[30,0,["setStep"]],1],null]],null],[12],[1,"\\n            <- back\\n        "],[13],[1,"\\n    "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[13],[1,"\\n"]],["@controller"],["div","if","eq","ul","li","on","fn","i","project/library/import-files","iframe","span","ui/property"]]',moduleName:"pikimov/components/project/composition/add-item.hbs",isStrictMode:!1})
let u=e.default=(a=class extends o.default{constructor(){super(...arguments),l(this,"controller",null),l(this,"currentStep",1),l(this,"currentType",null),l(this,"cloudVideoURL","https://pikimov.com/otoy-test-files/what will be the day.mp4"),l(this,"config",_config)
var e=this
e.controller=e.args.controller,_config.features.figmaImport&&window.addEventListener("message",e.f=function(t){e.gotMessage(e,t)}),(0,n.next)(function(){if("portrait"==e.controller.workspace){var t=$("#b_addItem").offset().left+78
$("#addItemSelector").css({left:t+"px"})}})}willDestroy(){window.removeEventListener("message",this.f,!1)}close(){this.args.parent.toggleAddItemSelector(!1)}setStep(e){(0,r.set)(this,"currentStep",e)}setType(e){(0,r.set)(this,"currentType",e),this.setStep(2),"asset"==e&&(0,n.next)(function(){$('#addItemSelector input[type="file"]').click()}),"cloudVideo"==e&&(0,n.next)(function(){$("#addItemSelector").css({width:"380px"}),$("#addItemSelector .text input").css({width:"370px"})})}addItem(e,t){var o=this.controller,r=o.compositionManager.compositionBuilder,n=o.activeCompositionData,i=new compositionsUtils(o,n),a=i.addItem(e,t)
i=null,o.selectionUtils.addToHoldSelection(a)
var l={itemData:o.getters.getCompItemByCompUid(n,a)}
r.addToQueue(l),r.processQueue(),this.close()}setVideoURL(e){var t=this
if(e){var o=t.controller.libraryManager,r={url:t.cloudVideoURL,fromCloud:!0}
o.importFromCloud("video",r),t.close()}}gotMessage(e,t){console.log("-- GOT message from figma iframe")
var o=t.data
if(o){var r="https://pikimov.com/figma/get-file.php?access_token="+o.access_token+"&file_ID="+fileID
$("#figmaIframe")[0].src=r}}},s(a.prototype,"setStep",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"setStep"),a.prototype),s(a.prototype,"setType",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"setType"),a.prototype),s(a.prototype,"addItem",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"addItem"),a.prototype),s(a.prototype,"setVideoURL",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"setVideoURL"),a.prototype),a);(0,t.setComponentTemplate)(c,u)}),define("pikimov/components/project/composition/composition",["exports","@ember/component","@glimmer/component","@ember/object","@ember/runloop","@ember/object/observers","@ember/template-factory"],function(e,t,o,r,n,i,a){var l
function s(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function c(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const u=(0,a.createTemplateFactory)({id:"0BGbYatR",block:'[[[10,0],[14,1,"middleColumn"],[12],[1,"\\n\\n    "],[10,0],[14,1,"composition"],[15,0,[29,[[52,[30,1,["isCompositionReady"]],"ready"]]]],[14,"tabIndex","0"],[12],[1,"\\n\\n        "],[10,0],[14,1,"overCanvas"],[12],[1,"\\n            "],[10,"canvas"],[14,1,"compositionCanvas"],[12],[13],[1,"\\n            "],[10,0],[14,1,"cssR"],[12],[13],[1,"\\n            "],[10,0],[14,1,"overControlsGizmo"],[14,0,"move rotate scale"],[12],[1,"\\n"],[1,"            "],[13],[1,"\\n        "],[13],[1,"\\n\\n    "],[13],[1,"\\n\\n    "],[10,0],[14,1,"currentFPS"],[14,0,"notranslate"],[12],[1,[30,1,["currentFPS"]]],[1," fps"],[13],[1,"\\n\\n    "],[41,[30,0,["displayStats"]],[[[11,0],[24,1,"skippedFrames"],[4,[38,3],["click",[30,0,["resetStats"]]],null],[12],[1,"c "],[1,[30,1,["skippedFrames"]]],[10,"br"],[12],[13],[1,"d "],[1,[30,1,["skippedWorkersFrames"]]],[13]],[]],null],[1,"\\n\\n"],[41,[30,1,["isCompositionReady"]],[[[1,"\\n"],[41,[28,[37,5],[[30,1,["compositionManager","cameraType"]],"3D"],null],[[[1,"            "],[10,0],[14,0,"cameras"],[12],[1,"\\n\\n"],[41,[30,0,["showViewSelectorTutorial"]],[[[41,[28,[37,6],[[30,1,["activeComposition","items","length"]],1],null],[[[1,"                    "],[10,0],[14,0,"tutorial animated viewSelector"],[12],[1,"Switch view"],[13],[1,"\\n"]],[]],null]],[]],null],[1,"\\n                "],[8,[39,7],null,[["@label","@labels","@values","@obj","@objProperty","@valueToTrack","@action"],[null,[30,0,["viewsLabels"]],[30,0,["views"]],[30,1,["compositionManager","renderEngine"]],"activeView",[30,1,["compositionManager","renderEngine","activeView"]],[30,0,["setView"]]]],null],[1,"\\n\\n            "],[13],[1,"\\n\\n"]],[]],null],[1,"\\n"],[41,[51,[30,1,["isFreeShapeEditorOpen"]]],[[[1,"            "],[8,[39,9],null,[["@controller"],[[30,1]]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,1,["isFreeShapeEditorOpen"]],[[[1,"            "],[8,[39,10],null,[["@controller"],[[30,1]]],null],[1,"\\n"]],[]],null],[1,"\\n"]],[]],null],[1,"\\n"],[13],[1,"\\n"]],["@controller"],["div","if","canvas","on","br","eq","mt","ui/property-selector","unless","project/composition/toolbar","project/composition/free-shape-editor"]]',moduleName:"pikimov/components/project/composition/composition.hbs",isStrictMode:!1})
let m=e.default=(l=class extends o.default{constructor(){super(...arguments),s(this,"interval",null),s(this,"controller",null),s(this,"isDragging",!1),s(this,"translateStart",{x:0,y:0}),s(this,"translateCurrent",{x:0,y:0}),s(this,"displayStats",!1),s(this,"overCanvas",null),s(this,"contextMenuComposition",null),s(this,"viewsLabels",["editor","camera"]),s(this,"views",["editor","camera"]),s(this,"showViewSelectorTutorial",!0)
var e=this
e.controller=e.args.controller,(_config.isDebug||_config.stats)&&(e.displayStats=!0),(0,i.addObserver)(e,"controller.activeComposition.uid",e.resetTranslateCSS),(0,n.next)(function(){e.overCanvas=document.querySelector("#overCanvas")
var t=document.querySelector("#composition"),o=$("#composition")
function r(){e.isDragging=!1,t.style.removeProperty("cursor")}_config.isDebug||t.addEventListener("contextmenu",e=>e.preventDefault()),o.on("pointerdown",function(r){"composition"==r.target.id&&e.controller.selectionUtils.clearSelection(),1==r.originalEvent.button&&o.addClass("spaceDown"),t.classList.contains("spaceDown")&&(e.isDragging=!0,t.style.cursor="grabbing")}),o.on("mousemove",function(o){if(t.classList.contains("spaceDown")||e.isDragging&&r(),e.isDragging&&_keyboardUtils.mouseDown){var n=_keyboardUtils.mouseStart.x-o.clientX,i=_keyboardUtils.mouseStart.y-o.clientY
e.translateCurrent.x=Math.round(e.translateStart.x-n),e.translateCurrent.y=Math.round(e.translateStart.y-i),"camera"==e.controller.compositionManager.renderEngine.activeView&&(e.capTranslate(),e.updateTranslateCSS())}}),$("body").on("pointerup",function(t){e.translateStart.x=e.translateCurrent.x,e.translateStart.y=e.translateCurrent.y,e.isDragging&&r()}),o.on("mouseup",function(t){if(2===t.button){if((new Date).getTime()>=_keyboardUtils.clickStartTime+400)return!1
e.controller.playbackUtils.pause(),e.contextMenuComposition=new contextComposition(e.controller,event)}}),o.on("contextmenu",function(e){return e.preventDefault(),!1})})}resetTranslateCSS(){var e=this
e.translateStart={x:0,y:0},e.translateCurrent={x:0,y:0},e.updateTranslateCSS()}capTranslate(){var e=this,t=e.controller.compositionDisplayZoom,o=1e3*t/100,r=800*t/100
e.translateCurrent.x<-1*o&&(e.translateCurrent.x=-1*o),e.translateCurrent.x>o&&(e.translateCurrent.x=o),e.translateCurrent.y<-1*r&&(e.translateCurrent.y=-1*r),e.translateCurrent.y>r&&(e.translateCurrent.y=r)}updateTranslateCSS(){var e=this,t=Math.round(e.translateCurrent.x),o=Math.round(e.translateCurrent.y)
e.overCanvas.style.transform=`translate(calc(-50% + ${t}px), calc(-50% + ${o}px))`}setView(e,t,o){(0,r.set)(e,t,o),this.controller.compositionManager.setView(o),(0,r.set)(this,"showViewSelectorTutorial",!1),this.controller.uiManager.keyboardFocus()}resetStats(){(0,r.set)(this.controller,"skippedFrames",0),(0,r.set)(this.controller,"skippedWorkersFrames",0)}},c(l.prototype,"setView",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"setView"),l.prototype),c(l.prototype,"resetStats",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"resetStats"),l.prototype),l);(0,t.setComponentTemplate)(u,m)}),define("pikimov/components/project/composition/free-shape-editor",["exports","@ember/component","@glimmer/component","@ember/object","@ember/runloop","@ember/object/observers","@ember/template-factory"],function(e,t,o,r,n,i,a){var l
function s(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function c(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const u=(0,a.createTemplateFactory)({id:"6xRwPLTW",block:'[[[10,0],[14,1,"freeShapeEditor"],[12],[1,"\\n\\n    "],[10,0],[14,1,"freeShapeComposition"],[12],[13],[1,"\\n\\n    "],[10,0],[14,1,"freeShapeEditorTools"],[12],[1,"\\n\\n        "],[8,[39,1],null,[["@controller"],[[30,1]]],null],[1,"\\n\\n        "],[11,1],[24,0,"button"],[4,[38,3],["click",[30,0,["toggleFreeShapeEditor"]]],null],[12],[1,"close shape editor"],[13],[1,"\\n\\n"],[1,"    "],[13],[1,"\\n\\n"],[13],[1,"\\n"]],["@controller"],["div","project/composition/shape-tools","span","on"]]',moduleName:"pikimov/components/project/composition/free-shape-editor.hbs",isStrictMode:!1})
let m=e.default=(l=class extends o.default{constructor(){super(...arguments),s(this,"controller",null),s(this,"compositionManager",null),s(this,"sceneItem",null),s(this,"scale",.5),s(this,"$composition",null)
var e=this
e.controller=e.args.controller,e.compositionManager=e.controller.compositionManager,e.sceneItem=e.controller.selectionUtils.getSelectedSceneItem(),(0,i.addObserver)(e,"controller.inputsUpdater",e.updateHandles),(0,i.addObserver)(e,"controller.currentFrame",e.updateHandles),(0,i.addObserver)(e,"controller.selectionItemsUpdater",e.onSelectionChanged),(0,i.addObserver)(e,"isFreeShapeEditorOpen",e.onClose),(0,n.next)(function(){$("#middleColumn .cameras").hide(),e.$composition=$("#freeShapeComposition"),e.setZoom(50)
var t=e.$composition[0]
e.sceneItem.setupEditor(t),e.sceneItem.createSVGHandles(),e.sceneItem.updateSVGHandles()})}onSelectionChanged(){(0,r.set)(this.controller,"isFreeShapeEditorOpen",!1)}updateHandles(){this.sceneItem.updateSVGHandles()}setZoom(e){var t=this;(0,r.set)(t,"scale",e/100)
var o=t.compositionManager.getDimensions()
t.$composition.css({width:1*o.width+"px",height:1*o.height+"px"})}toggleFreeShapeEditor(){var e=this.controller
e.isFreeShapeEditorOpen?(0,r.set)(e,"isFreeShapeEditorOpen",!1):(0,r.set)(e,"isFreeShapeEditorOpen",!0)}onClose(){this.controller.isFreeShapeEditorOpen||$("#middleColumn .cameras").show()}},c(l.prototype,"setZoom",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"setZoom"),l.prototype),c(l.prototype,"toggleFreeShapeEditor",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"toggleFreeShapeEditor"),l.prototype),l);(0,t.setComponentTemplate)(u,m)})
define("pikimov/components/project/composition/shape-tools",["exports","@ember/component","@glimmer/component","@ember/object","@ember/template-factory"],function(e,t,o,r,n){var i
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const a=(0,n.createTemplateFactory)({id:"sxBsKl0r",block:'[[[10,0],[14,1,"pathTools"],[12],[1,"\\n    "],[11,1],[16,0,[29,["ui_toolIcon tooltip ",[52,[28,[37,3],[[30,1,["toolbarUtils","currentTool"]],"move"],null],"on"]]]],[4,[38,4],["click",[28,[37,5],[[30,0,["toggleTool"]],"move"],null]],null],[12],[1,"\\n        "],[10,"img"],[14,"draggable","false"],[14,"src","icons/cursor-pointer.svg"],[12],[13],[1,"\\n        "],[10,1],[14,0,"tooltiptext p50"],[12],[1,"Select point"],[13],[1,"\\n    "],[13],[1,"\\n"],[1,"    "],[11,1],[16,0,[29,["ui_toolIcon tooltip ",[52,[28,[37,3],[[30,1,["toolbarUtils","currentTool"]],"removePoint"],null],"on"]]]],[4,[38,4],["click",[28,[37,5],[[30,0,["toggleTool"]],"removePoint"],null]],null],[12],[1,"\\n        "],[10,"img"],[14,"draggable","false"],[14,"src","icons/keyframe-minus-in.svg"],[12],[13],[1,"\\n        "],[10,1],[14,0,"tooltiptext p50"],[12],[1,"Delete point"],[13],[1,"\\n    "],[13],[1,"\\n\\n    "],[11,1],[16,0,[29,["ui_toolIcon tooltip ",[52,[28,[37,3],[[30,1,["toolbarUtils","currentTool"]],"addPoint"],null],"on"]]]],[4,[38,4],["click",[28,[37,5],[[30,0,["toggleTool"]],"addPoint"],null]],null],[12],[1,"\\n        "],[10,"img"],[14,"draggable","false"],[14,"src","icons/keyframe-plus-in.svg"],[12],[13],[1,"\\n        "],[10,1],[14,0,"tooltiptext p50"],[12],[1,"Add point"],[13],[1,"\\n    "],[13],[1,"\\n\\n    "],[11,1],[16,0,[29,["ui_toolIcon tooltip ",[52,[28,[37,3],[[30,1,["toolbarUtils","currentTool"]],"convertPoint"],null],"on"]]]],[4,[38,4],["click",[28,[37,5],[[30,0,["toggleTool"]],"convertPoint"],null]],null],[12],[1,"\\n        "],[10,"img"],[14,"draggable","false"],[14,"src","icons/git-commit.svg"],[12],[13],[1,"\\n        "],[10,1],[14,0,"tooltiptext p50"],[12],[1,"Convert point"],[13],[1,"\\n    "],[13],[1,"\\n"],[13],[1,"\\n"]],["@controller"],["div","span","if","eq","on","fn","img"]]',moduleName:"pikimov/components/project/composition/shape-tools.hbs",isStrictMode:!1})
let l=e.default=(i=class extends o.default{constructor(){super(...arguments)}toggleTool(e){this.args.controller.toolbarUtils.toggleTool(e)}},s=i.prototype,c="toggleTool",u=[r.action],m=Object.getOwnPropertyDescriptor(i.prototype,"toggleTool"),p=i.prototype,d={},Object.keys(m).forEach(function(e){d[e]=m[e]}),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=u.slice().reverse().reduce(function(e,t){return t(s,c,e)||e},d),p&&void 0!==d.initializer&&(d.value=d.initializer?d.initializer.call(p):void 0,d.initializer=void 0),void 0===d.initializer&&Object.defineProperty(s,c,d),i)
var s,c,u,m,p,d;(0,t.setComponentTemplate)(a,l)}),define("pikimov/components/project/composition/toolbar",["exports","@ember/component","@glimmer/component","@ember/object","@ember/object/observers","@ember/template-factory"],function(e,t,o,r,n,i){var a
function l(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function s(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const c=(0,i.createTemplateFactory)({id:"RR83Mr5B",block:'[[[10,0],[14,1,"toolbar"],[12],[1,"\\n\\n    "],[10,0],[14,1,"compositionZoom"],[12],[1,"\\n\\n        "],[8,[39,1],null,[["@value","@min","@max","@step","@action","@displayValue","@disabled"],[[30,0,["zoomInputValue"]],1,6,1,[30,0,["setZoomInput"]],false,[28,[37,2],[[30,0,["compositionManager","renderEngine","activeView"]],"editor"],null]]],null],[1,"\\n        "],[10,1],[15,0,[29,["compositionZoomValue ",[52,[28,[37,2],[[30,0,["compositionManager","renderEngine","activeView"]],"editor"],null],"disabled"]]]],[12],[1,[30,1,["compositionDisplayZoom"]]],[1,"%"],[13],[1,"\\n    "],[13],[1,"\\n\\n    "],[10,0],[14,5,"position:absolute;top:5px;left:110px;"],[12],[1,"\\n"],[1,"    "],[13],[1,"\\n\\n"],[41,[28,[37,2],[[30,0,["cameraType"]],"3D"],null],[[[1,"        "],[10,0],[14,1,"transformTools"],[12],[1,"\\n            "],[11,1],[16,0,[29,["translate",[52,[28,[37,2],[[30,1,["toolbarUtils","currentTool"]],"move"],null]," active"],[52,[51,[30,0,["canUseTranslate"]]]," disabled"]]]],[4,[38,6],["click",[28,[37,7],[[30,0,["setTool"]],"move"],null]],null],[12],[1,"\\n                "],[10,"img"],[14,"draggable","false"],[14,"src","icons/position.svg"],[12],[13],[1,"\\n            "],[13],[1,"\\n            "],[11,1],[16,0,[29,["rotate ",[52,[28,[37,2],[[30,1,["toolbarUtils","currentTool"]],"rotate"],null],"active"],[52,[51,[30,0,["canUseRotate"]]]," disabled"]]]],[4,[38,6],["click",[28,[37,7],[[30,0,["setTool"]],"rotate"],null]],null],[12],[1,"\\n                "],[10,"img"],[14,"draggable","false"],[14,"src","icons/rotation.svg"],[12],[13],[1,"\\n            "],[13],[1,"\\n            "],[11,1],[16,0,[29,["scale ",[52,[28,[37,2],[[30,1,["toolbarUtils","currentTool"]],"scale"],null],"active"],[52,[51,[30,0,["canUseScale"]]]," disabled"]]]],[4,[38,6],["click",[28,[37,7],[[30,0,["setTool"]],"scale"],null]],null],[12],[1,"\\n                "],[10,"img"],[14,"draggable","false"],[14,"src","icons/scale.svg"],[12],[13],[1,"\\n            "],[13],[1,"\\n\\n        "],[13],[1,"\\n        \\n"],[41,[30,0,["nbItemsSelected"]],[[[41,[51,[28,[37,2],[[30,1,["toolbarUtils","currentTool"]],"scale"],null]],[[[1,"            "],[10,0],[14,1,"transformSpace"],[12],[1,"\\n                "],[11,1],[16,0,[29,[[52,[28,[37,2],[[30,1,["toolbarUtils","currentToolSpace"]],"global"],null],"active"]]]],[4,[38,6],["click",[28,[37,7],[[30,0,["setToolSpace"]],"global"],null]],null],[12],[1,"global"],[13],[1,"\\n                "],[11,1],[16,0,[29,[[52,[28,[37,2],[[30,1,["toolbarUtils","currentToolSpace"]],"local"],null],"active"]]]],[4,[38,6],["click",[28,[37,7],[[30,0,["setToolSpace"]],"local"],null]],null],[12],[1,"local"],[13],[1,"\\n            "],[13],[1,"\\n"]],[]],null]],[]],null]],[]],null],[1,"    \\n    "],[10,0],[14,1,"otherTools"],[12],[1,"\\n\\n"],[41,[30,0,["pathTools"]],[[[1,"            "],[8,[39,9],null,[["@controller"],[[30,1]]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["anchorPointTool"]],[[[1,"\\n            "],[11,1],[24,1,"tool_anchor_point"],[16,0,[29,["ui_toolIcon tooltip ",[52,[28,[37,2],[[30,1,["toolbarUtils","currentTool"]],"anchorPoint"],null],"on"]]]],[4,[38,6],["click",[28,[37,7],[[30,0,["toggleTool"]],"anchorPoint"],null]],null],[12],[1,"\\n                "],[10,"img"],[14,"draggable","false"],[14,"src","icons/icon-anchor.svg"],[12],[13],[1,"\\n                "],[10,1],[14,0,"tooltiptext p50"],[12],[1,"Move anchor point"],[13],[1,"\\n            "],[13],[1,"\\n\\n"]],[]],null],[1,"\\n"],[41,[30,0,["nbItemsSelected"]],[[[1,"            "],[11,1],[24,1,"tool_align_h"],[24,0,"ui_toolIcon tooltip"],[4,[38,6],["click",[28,[37,7],[[30,0,["align"]],"h"],null]],null],[12],[1,"\\n                "],[10,"img"],[14,"draggable","false"],[14,"src","icons/icon-align.svg"],[12],[13],[1,"\\n                "],[10,1],[14,0,"tooltiptext p50"],[12],[1,"Center horizontally"],[13],[1,"\\n            "],[13],[1,"\\n            "],[11,1],[24,1,"tool_align_v"],[24,0,"ui_toolIcon tooltip"],[4,[38,6],["click",[28,[37,7],[[30,0,["align"]],"v"],null]],null],[12],[1,"\\n                "],[10,"img"],[14,"draggable","false"],[14,"src","icons/icon-align.svg"],[12],[13],[1,"\\n                "],[10,1],[14,0,"tooltiptext p50"],[12],[1,"Center vertically"],[13],[1,"\\n            "],[13],[1,"\\n"]],[]],null],[1,"\\n    "],[13],[1,"\\n\\n    \\n    "],[10,0],[14,1,"displayOptions"],[12],[1,"\\n\\n        "],[11,1],[24,0,"tooltip"],[4,[38,6],["click",[30,0,["toggleGrid"]]],null],[12],[1,"\\n            "],[10,"img"],[14,"draggable","false"],[14,"src","icons/icon-grid.svg"],[15,0,[29,[[52,[30,0,["compositionManager","compositionData","settings","grid","enabled"]],"on"]]]],[12],[13],[1,"\\n            "],[10,1],[14,0,"tooltiptext p85"],[12],[1,"Toggle grid"],[13],[1,"\\n        "],[13],[1,"\\n\\n"],[41,[28,[37,2],[[30,0,["cameraType"]],"3D"],null],[[[1,"        "],[11,1],[24,0,"tooltip"],[4,[38,6],["click",[30,0,["toggleWireframe"]]],null],[12],[1,"\\n            "],[10,"img"],[14,"draggable","false"],[14,"src","icons/icon-wireframe.svg"],[14,5,"height:18px"],[15,0,[29,[[52,[30,1,["projectData","settings","wireframe","enabled"]],"on"]]]],[12],[13],[1,"\\n            "],[10,1],[14,0,"tooltiptext p85"],[12],[1,"Toggle wireframe"],[13],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[1,"\\n    "],[13],[1,"\\n\\n"],[13],[1,"\\n"]],["@controller"],["div","ui/property-range","eq","span","if","unless","on","fn","img","project/composition/shape-tools"]]',moduleName:"pikimov/components/project/composition/toolbar.hbs",isStrictMode:!1})
let u=e.default=(a=class extends o.default{constructor(){super(...arguments),l(this,"controller",null),l(this,"compositionManager",null),l(this,"cameraType",null),l(this,"nbItemsSelected",0),l(this,"canUseTranslate",!1),l(this,"canUseRotate",!1),l(this,"canUseScale",!1),l(this,"zoomInputValue",1),l(this,"pathTools",!1),l(this,"anchorPointTool",!1)
var e=this
e.controller=e.args.controller,e.compositionManager=e.controller.compositionManager,e.cameraType=e.compositionManager.cameraType,(0,n.addObserver)(e,"controller.selectionItemsUpdater",e.onSelectionChanged),(0,n.addObserver)(e,"controller.compositionDisplayZoom",e.onZoomChanged),(0,n.addObserver)(e,"controller.currentFrame",e.onSelectionChanged),e.onZoomChanged(),e.onSelectionChanged()}onSelectionChanged(){var e=this,t=e.controller;(0,r.set)(e,"nbItemsSelected",t.selectionUtils.getNbItemsSelected())
var o=!1,n=!1
if("3D"==e.cameraType){var i=!1,a=!1,l=!1
t.selectionUtils.selectionArray.items.forEach(function(e){!e.position||e.position.hidden||e.position.disabled||(i=!0),!e.rotation||e.rotation.hidden||e.rotation.disabled||(a=!0),!e.scale||e.scale.hidden||e.scale.disabled||(l=!0)}),(0,r.set)(e,"canUseTranslate",i),(0,r.set)(e,"canUseRotate",a),(0,r.set)(e,"canUseScale",l)}if("2D"==e.cameraType&&1==e.nbItemsSelected){o=!0
var s=t.selectionUtils.getSelectedSceneItem()
if("group"==s.type&&(o=!1),"audio"==s.type&&(o=!1),"model"==s.type&&(o=!1),"light"==s.type&&(o=!1),"freeShape"==s.type&&(o=!1),"freeShape"==s.type){var c=s.getParamByName("points")
if(c.useKeyframes)t.keyframesUtils.getKeyByFrameIndex(c.keyframes,t.currentFrame)&&(n=!0)
else n=!0}}(0,r.set)(e,"anchorPointTool",o),(0,r.set)(e,"pathTools",n)}onZoomChanged(){var e=this,t=0,o=e.controller.compositionDisplayZoom
12.5==o&&(t=1),25==o&&(t=2),50==o&&(t=3),100==o&&(t=4),200==o&&(t=5),400==o&&(t=6),t!=e.zoomInputValue&&(0,r.set)(e,"zoomInputValue",t)}setZoomInput(){var e=this.controller,t=this.zoomInputValue,o=0
1==t&&(o=12.5),2==t&&(o=25),3==t&&(o=50),4==t&&(o=100),5==t&&(o=200),6==t&&(o=400),e.setCompositionDisplayZoom(o),e.uiManager.keyboardFocus()}setZoom(){var e=this.controller,t=e.compositionDisplayZoom
e.setCompositionDisplayZoom(t),e.uiManager.keyboardFocus()}setTool(e){var t=this;("move"!=e||t.canUseTranslate)&&("rotate"!=e||t.canUseRotate)&&("scale"!=e||t.canUseScale)&&(t.controller.toolbarUtils.setTool(e),t.controller.uiManager.keyboardFocus())}setToolSpace(e){this.controller.toolbarUtils.setToolSpace(e),this.controller.uiManager.keyboardFocus()}align(e){var t=this,o=!1,r=t.controller
r.playbackUtils.pause(),r.selectionUtils.selectionArray.items.forEach(function(n){var i=n.compUid,a=r.getters.getCompSceneItemByCompUid(i),l=r.getters.getCompItemCurrentTransformByCompUid(i)
if(l){var s={x:1*l.position.x,y:1*l.position.y,z:1*l.position.z}
if("2D"==t.cameraType)if(a.getParent())"h"==e&&(s.x=0),"v"==e&&(s.y=0)
else{var c=t.compositionManager.getDimensions()
"h"==e&&(s.x=c.width/2),"v"==e&&(s.y=c.height/2)}"3D"==t.cameraType&&("h"==e&&(s.x=0),"v"==e&&(s.y=0)),l.position.x==s.x&&l.position.y==s.y&&l.position.z==s.z||(o=!0,a.setPositionTo(s))}}),r.controlsUtils.updateSelection(),t.compositionManager.requestRender(),r.uiManager.keyboardFocus(),o&&r.addToHistory("item","edit position")}toggleTool(e){this.controller.toolbarUtils.toggleTool(e)}toggleGrid(){var e=this.compositionManager,t=this.controller,o=t.activeCompositionData.settings;(0,r.set)(o.grid,"enabled",!o.grid.enabled),e.updateBgColorAndGrid(),e.getReadyToRender(),t.uiManager.keyboardFocus()}toggleWireframe(){var e=this,t=e.controller.projectData.settings
t.wireframe||(0,r.set)(t,"wireframe",{enabled:!1})
var o=t.wireframe.enabled;(0,r.set)(t.wireframe,"enabled",!o),e.compositionManager.renderEngine.setWireframe(),e.compositionManager.getReadyToRender(),e.controller.uiManager.keyboardFocus()}},s(a.prototype,"setZoomInput",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"setZoomInput"),a.prototype),s(a.prototype,"setZoom",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"setZoom"),a.prototype),s(a.prototype,"setTool",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"setTool"),a.prototype),s(a.prototype,"setToolSpace",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"setToolSpace"),a.prototype),s(a.prototype,"align",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"align"),a.prototype),s(a.prototype,"toggleTool",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"toggleTool"),a.prototype),s(a.prototype,"toggleGrid",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"toggleGrid"),a.prototype),s(a.prototype,"toggleWireframe",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"toggleWireframe"),a.prototype),a);(0,t.setComponentTemplate)(c,u)}),define("pikimov/components/project/demos/demos",["exports","@ember/component","@glimmer/component","@ember/object","@ember/template-factory"],function(e,t,o,r,n){var i
function a(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function l(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const s=(0,n.createTemplateFactory)({id:"3l7rR9lc",block:'[[[10,0],[14,1,"demos"],[14,0,"modal"],[12],[1,"\\n\\n    "],[10,0],[12],[1,"\\n        "],[10,"header"],[12],[1,"\\n            "],[10,"h2"],[12],[1,"Demo projects"],[13],[1,"\\n            "],[11,1],[24,0,"b_close"],[4,[38,4],["click",[30,0,["closeList"]]],null],[12],[13],[1,"\\n        "],[13],[1,"\\n\\n        "],[10,"ul"],[14,0,"scrollbar"],[12],[1,"\\n"],[42,[28,[37,7],[[28,[37,7],[[30,0,["demos"]]],null]],null],null,[[[1,"            "],[11,"li"],[4,[38,4],["click",[28,[37,9],[[30,0,["selectDemo"]],[30,1]],null]],null],[12],[1,"\\n"],[1,"                "],[10,"video"],[15,"src",[29,["demos-covers/",[30,1,["cover"]]]]],[14,"muted",""],[14,"autoplay",""],[14,"playsinline",""],[14,"loop",""],[14,"disablePictureInPicture",""],[12],[13],[1,"\\n                "],[10,1],[14,0,"name"],[12],[1,[30,1,["name"]]],[13],[1,"\\n                "],[41,[30,1,["is3D"]],[[[10,1],[14,0,"is3D"],[12],[1,"3D"],[13]],[]],null],[1,"\\n                "],[41,[30,1,["new"]],[[[10,"img"],[14,0,"new"],[14,"src","images/effects/new.avif"],[14,"alt","new"],[12],[13]],[]],null],[1,"\\n            "],[13],[1,"\\n"]],[1]],null],[1,"        "],[13],[1,"\\n\\n"],[41,[28,[37,13],null,null],[[[1,"        "],[10,0],[14,5,"background:black;height:30px;"],[12],[1,"\\n            "],[10,"ul"],[12],[1,"\\n"],[42,[28,[37,7],[[28,[37,7],[[30,0,["devDemos"]]],null]],null],null,[[[1,"                "],[10,"li"],[14,0,"privateDemo"],[12],[1,"\\n                    "],[11,1],[24,0,"button"],[4,[38,4],["click",[28,[37,9],[[30,0,["selectDebugDemo"]],[30,3]],null]],null],[12],[1,[30,2,["name"]]],[13],[1,"\\n                "],[13],[1,"\\n"]],[2,3]],null],[1,"            "],[13],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[1,"\\n    "],[13],[1,"\\n"],[13],[1,"\\n"]],["item","item","index"],["div","header","h2","span","on","ul","each","-track-array","li","fn","video","if","img","is-debug"]]',moduleName:"pikimov/components/project/demos/demos.hbs",isStrictMode:!1})
let c=e.default=(i=class extends o.default{constructor(){super(...arguments),a(this,"controller",null),a(this,"demos",structuredClone(_demosProjects)),a(this,"devDemos",[]),this.controller=this.args.controller,_config.isDebug&&(this.devDemos=[{name:"4k video",json:_testProject1},{name:"subtitles tester",file:"subtitles-tester"},{name:"benchmark",file:"benchmark"}])}selectDemo(e){this.closeList(),this.controller.openDemoProject(e.file)}selectDebugDemo(e){var t=this
t.closeList()
var o=t.devDemos[e].file
if(o)t.controller.openDemoProject(o)
else{var r=structuredClone(t.devDemos[e].json)
r=t.controller.projectUtils.addMissingData(r),t.controller.loadProject(r,"new project")}}closeList(){this.controller.toggleProperty("isDemosListOpen")}},l(i.prototype,"selectDemo",[r.action],Object.getOwnPropertyDescriptor(i.prototype,"selectDemo"),i.prototype),l(i.prototype,"selectDebugDemo",[r.action],Object.getOwnPropertyDescriptor(i.prototype,"selectDebugDemo"),i.prototype),l(i.prototype,"closeList",[r.action],Object.getOwnPropertyDescriptor(i.prototype,"closeList"),i.prototype),i);(0,t.setComponentTemplate)(s,c)}),define("pikimov/components/project/effects-ui/glsl-shader",["exports","@ember/component","@glimmer/component","@ember/object","@ember/runloop","@ember/template-factory"],function(e,t,o,r,n,i){var a
function l(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function s(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const c=(0,i.createTemplateFactory)({id:"et2YpmZf",block:'[[[10,0],[15,1,[29,[[30,0,["domID"]]]]],[14,0,"effect-ui levels"],[12],[1,"\\n\\n"],[13],[1,"\\n\\n"],[42,[28,[37,2],[[28,[37,2],[[30,1,["params"]]],null]],null],null,[[[1,"\\n    "],[10,0],[15,0,[29,["param ",[52,[30,2,["useKeyframes"]],"useKeyframes"]]]],[12],[1,"\\n        "],[10,0],[12],[1,"\\n"],[41,[51,[30,2,["static"]]],[[[1,"            "],[11,"i"],[16,0,[29,["bx bx-time tooltip ",[52,[30,2,["useKeyframes"]],"on"]]]],[4,[38,6],["click",[28,[37,7],[[30,0,["toggleUseKeyframes"]],[30,2],[30,3]],null]],null],[12],[1,"\\n                "],[10,1],[14,0,"tooltiptext p0"],[12],[1,"toggle animated"],[13],[1,"\\n            "],[13],[1,"\\n"]],[]],null],[1,"        "],[13],[1,"\\n        "],[10,0],[12],[1,"\\n\\n"],[41,[28,[37,9],[[30,2,["type"]],"text"],null],[[[1,"            "],[8,[39,10],null,[["@type","@long","@label","@value","@placeholder","@action"],["textarea",true,[30,2,["name"]],[30,2,["value"]],"empty",[28,[37,7],[[30,0,["editValue"]],[30,3]],null]]],null],[1,"\\n"]],[]],null],[1,"\\n"],[1,"            "],[8,[39,11],null,[["@label","@obj","@property","@unit","@action","@disableMouseMove"],[[30,2,["name"]],[30,2],"value",[30,2,["unit"]],[28,[37,7],[[30,0,["editValue"]],[30,3]],null],true]],null],[1,"\\n        "],[13],[1,"\\n    "],[13],[1,"\\n\\n"]],[2,3]],null],[1,"\\n"],[11,1],[24,0,"button"],[4,[38,6],["click",[30,0,["addUniform"]]],null],[12],[10,"i"],[14,0,"bx bx-plus"],[12],[13],[1,"Add uniform"],[13]],["@effectData","param","index"],["div","each","-track-array","if","unless","i","on","fn","span","eq","ui/property","ui/property-number"]]',moduleName:"pikimov/components/project/effects-ui/glsl-shader.hbs",isStrictMode:!1})
let u=e.default=(a=class extends o.default{constructor(){super(...arguments),l(this,"controller",null),l(this,"domID",null),l(this,"widgetWidth",190),l(this,"gammaValues",[[9.99,0],[2,.3],[1,.5],[.5,.7],[0,1]])
var e=this
e.controller=e.args.controller,e.domID="fx_ui_"+(Math.floor(8999*Math.random())+1e3),e.params=e.args.effectData.params,(0,n.next)(function(){e.updateUI()})}updateUI(){}editValue(e,t=!0){t&&this.controller.addToHistory("effect","edit value"),this.controller.refreshAndRender()}toggleUseKeyframes(e,t){this.args.parent.toggleUseKeyframes(e,t),this.updateUI()}addUniform(){var e=this
console.log("+ uniform")
e.args.effectData.params=[...e.args.effectData.params,{name:"uniform",type:"number",rangeInput:!0,min:-100,max:100,value:0}],console.log(e.args.effectData)}},s(a.prototype,"editValue",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"editValue"),a.prototype),s(a.prototype,"toggleUseKeyframes",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"toggleUseKeyframes"),a.prototype),s(a.prototype,"addUniform",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"addUniform"),a.prototype),a);(0,t.setComponentTemplate)(c,u)}),define("pikimov/components/project/effects-ui/levels",["exports","@ember/component","@glimmer/component","@ember/object","@ember/runloop","@ember/template-factory"],function(e,t,o,r,n,i){var a
function l(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function s(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const c=(0,i.createTemplateFactory)({id:"Q5b2KGHr",block:'[[[10,0],[15,1,[29,[[30,0,["domID"]]]]],[14,0,"effect-ui levels"],[12],[1,"\\n    "],[10,0],[12],[1,"\\n        "],[10,0],[14,0,"input"],[12],[1,"\\n            "],[10,2],[12],[1,"input"],[13],[1,"\\n            "],[10,0],[14,0,"bar"],[12],[13],[1,"\\n            "],[10,1],[14,0,"black"],[12],[13],[1,"\\n            "],[10,1],[14,0,"white"],[12],[13],[1,"\\n            "],[10,1],[14,0,"gamma"],[12],[13],[1,"\\n        "],[13],[1,"\\n\\n        "],[10,0],[14,0,"output"],[12],[1,"\\n            "],[10,2],[12],[1,"output"],[13],[1,"\\n            "],[10,0],[14,0,"bar"],[12],[13],[1,"\\n            "],[10,1],[14,0,"black"],[12],[13],[1,"\\n            "],[10,1],[14,0,"white"],[12],[13],[1,"\\n        "],[13],[1,"\\n    "],[13],[1,"\\n"],[13],[1,"\\n\\n"],[42,[28,[37,4],[[28,[37,4],[[30,1,["params"]]],null]],null],null,[[[1,"    "],[10,0],[15,0,[29,["param ",[52,[30,2,["useKeyframes"]],"useKeyframes"]]]],[12],[1,"\\n        "],[10,0],[12],[1,"\\n"],[41,[51,[30,2,["static"]]],[[[1,"            "],[11,"i"],[16,0,[29,["bx bx-time tooltip ",[52,[30,2,["useKeyframes"]],"on"]]]],[4,[38,8],["click",[28,[37,9],[[30,0,["toggleUseKeyframes"]],[30,2],[30,3]],null]],null],[12],[1,"\\n                "],[10,1],[14,0,"tooltiptext p0"],[12],[1,"toggle animated"],[13],[1,"\\n            "],[13],[1,"\\n"]],[]],null],[1,"        "],[13],[1,"\\n        "],[10,0],[12],[1,"\\n"],[1,"            "],[8,[39,10],null,[["@label","@obj","@property","@unit","@action","@disableMouseMove"],[[30,2,["name"]],[30,2],"value",[30,2,["unit"]],[28,[37,9],[[30,0,["editValue"]],[30,3]],null],true]],null],[1,"\\n        "],[13],[1,"\\n    "],[13],[1,"\\n"]],[2,3]],null]],["@effectData","param","index"],["div","p","span","each","-track-array","if","unless","i","on","fn","ui/property-number"]]',moduleName:"pikimov/components/project/effects-ui/levels.hbs",isStrictMode:!1})
let u=e.default=(a=class extends o.default{constructor(){super(...arguments),l(this,"controller",null),l(this,"domID",null),l(this,"widgetWidth",190),l(this,"gammaValues",[[9.99,0],[2,.3],[1,.5],[.5,.7],[0,1]])
var e=this
e.controller=e.args.controller,e.domID="fx_ui_"+(Math.floor(8999*Math.random())+1e3),e.params=e.args.effectData.params,(0,n.next)(function(){e.updateUI()
var t=e.widgetWidth
const o={x:0},n=interact("#"+e.domID+" .input span")
n.styleCursor(!1)
var i=0
n.draggable({lockAxis:"x",modifiers:[interact.modifiers.restrict({restriction:"parent"})],listeners:{move(n){o.x+=n.dx,o.x<0&&(o.x=0),o.x>t&&(o.x=t),0==i&&o.x>Math.round(e.params[2].value*t/255)&&(o.x=Math.round(e.params[2].value*t/255)),2==i&&o.x<Math.round(e.params[0].value*t/255)&&(o.x=Math.round(e.params[0].value*t/255)),1==i&&(o.x<Math.round(e.params[0].value*t/255)&&(o.x=Math.round(e.params[0].value*t/255)),o.x>Math.round(e.params[2].value*t/255)&&(o.x=Math.round(e.params[2].value*t/255))),n.target.style.left=o.x+"px"
var a=0
if(a=Math.round(o.x/t*255),1==i)a=e.gammaLeftToValue(o.x)
else{var l=e.gammaValueToLeft(e.params[1].value)
document.querySelector("#"+e.domID+" .input .gamma").style.left=l+"px"}(0,r.set)(e.params[i],"value",a),e.controller.refreshAndRender()},start(r){$(r.target).hasClass("black")&&(i=0),$(r.target).hasClass("gamma")&&(i=1),$(r.target).hasClass("white")&&(i=2)
var n=Math.round(e.params[i].value*t/255)
1==i&&(n=e.gammaValueToLeft(e.params[i].value)),o.x=n},end(){e.controller.addToHistory("effect","edit value")}}})
const a=interact("#"+e.domID+" .output span")
i=0
a.draggable({lockAxis:"x",modifiers:[interact.modifiers.restrict({restriction:"parent"})],listeners:{move(n){o.x+=n.dx,o.x<0&&(o.x=0),o.x>t&&(o.x=t),n.target.style.left=o.x+"px"
var a=Math.round(o.x/t*255);(0,r.set)(e.params[i],"value",a),e.controller.refreshAndRender()},start(r){$(r.target).hasClass("black")&&(i=3),$(r.target).hasClass("white")&&(i=4)
var n=Math.round(e.params[i].value*t/255)
o.x=n},end(){e.controller.addToHistory("effect","edit value")}}}),e.updateCSS()})}updateUI(){var e=!0
this.params.forEach(function(t){t.useKeyframes&&(e=!1)})
var t=$("#"+this.domID)
e?(t.find(".input").show(),t.find(".output").show()):(t.find(".input").hide(),t.find(".output").hide())}editValue(e,t=!0){var o=this,n=$(event.target).val(),i=o.args.effectData.params[e]
"number"==i.type&&(1*n<i.min&&(0,r.set)(i,"value",i.min),1*n>i.max&&(0,r.set)(i,"value",i.max)),0==e&&1*o.params[0].value>1*o.params[2].value&&(0,r.set)(o.params[0],"value",1*o.params[2].value),2==e&&1*o.params[2].value<1*o.params[0].value&&(0,r.set)(o.params[2],"value",1*o.params[0].value),3==e&&1*o.params[3].value>1*o.params[4].value&&(0,r.set)(o.params[3],"value",1*o.params[4].value),4==e&&1*o.params[4].value<1*o.params[3].value&&(0,r.set)(o.params[4],"value",1*o.params[3].value),o.updateCSS(),t&&o.controller.addToHistory("effect","edit value"),o.controller.refreshAndRender()}toggleUseKeyframes(e,t){this.args.parent.toggleUseKeyframes(e,t),this.updateUI()}updateCSS(){var e=this,t=e.widgetWidth,o=null,r=$("#"+e.domID)[0]
o=Math.round(e.params[0].value*t/255),r.querySelector(".input .black").style.left=o+"px",o=Math.round(e.params[2].value*t/255),r.querySelector(".input .white").style.left=o+"px",o=e.gammaValueToLeft(e.params[1].value),r.querySelector(".input .gamma").style.left=o+"px",o=Math.round(e.params[3].value*t/255),r.querySelector(".output .black").style.left=o+"px",o=Math.round(e.params[4].value*t/255),r.querySelector(".output .white").style.left=o+"px"}gammaValueToLeft(e){var t=this,o=t.widgetWidth,r=(1*t.params[2].value-1*t.params[0].value)*o/255,n=Math.round(t.params[0].value*o/255),i=t.gammaValues,a=e
i.sort((e,t)=>e[0]-t[0])
let l=0
for(;l<i.length&&i[l][0]<a;)l++
if(0===l||l===i.length)return null
const s=i[l-1][0],c=i[l-1][1],u=i[l][0]
var m=100*(c+(i[l][1]-c)*(a-s)/(u-s)),p=Math.round(m/100*r)
return p=Math.round(n+p)}gammaLeftToValue(e){var t=this,o=t.widgetWidth,r=(1*t.params[2].value-1*t.params[0].value)*o/255,n=Math.round(t.params[0].value*o/255),i=t.gammaValues,a=(e-n)/r
if(0==a)return i[0][0]
if(a>=1)return i[i.length-1][0]
i.sort((e,t)=>e[1]-t[1])
let l=0
for(;l<i.length&&i[l][1]<a;)l++
if(0===l||l===i.length)return console.log("gamma out",a,l),null
const s=i[l-1][0],c=i[l-1][1]
var u=s+(i[l][0]-s)*(a-c)/(i[l][1]-c)
return u=Math.round(100*u)/100}},s(a.prototype,"editValue",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"editValue"),a.prototype),s(a.prototype,"toggleUseKeyframes",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"toggleUseKeyframes"),a.prototype),a);(0,t.setComponentTemplate)(c,u)}),define("pikimov/components/project/effects/effect-properties",["exports","@ember/component","@glimmer/component","@ember/object","@ember/template-factory"],function(e,t,o,r,n){var i
function a(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function l(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const s=(0,n.createTemplateFactory)({id:"qx7RRpFD",block:'[[[10,0],[14,0,"effect"],[12],[1,"\\n\\n    "],[10,1],[14,0,"thumb handle"],[12],[13],[1,"\\n\\n    "],[10,0],[12],[1,"\\n        "],[10,"header"],[12],[1,"\\n"],[41,[30,0,["canOpen"]],[[[1,"                "],[11,1],[24,0,"triangle"],[4,[38,4],["click",[30,0,["toggleOpen"]]],null],[12],[10,"i"],[15,0,[29,["bx bxs-right-arrow",[52,[30,1,["open"]]," bx-rotate-90"]]]],[12],[13],[13],[1,"\\n"]],[]],[[[1,"                "],[10,1],[14,0,"triangle"],[14,5,"visibility:hidden;"],[12],[13],[1,"\\n"]],[]]],[1,"\\n            "],[11,1],[24,0,"name"],[4,[38,4],["click",[30,0,["selectFX"]]],null],[12],[1,[30,1,["name"]]],[13],[1,"\\n\\n            "],[10,0],[14,0,"buttons"],[12],[1,"\\n\\n"],[41,[28,[37,6],["copyEffect"],null],[[[1,"                "],[11,1],[24,0,"buttonIcon tooltip"],[4,[38,4],["click",[30,0,["copyFX"]]],null],[12],[1,"\\n                    "],[10,"i"],[14,0,"fa fa-copy"],[12],[13],[1,"\\n                    "],[10,1],[14,0,"tooltiptext down p100"],[12],[1,"Copy effect"],[13],[1,"\\n                "],[13],[1,"\\n"]],[]],null],[1,"\\n                "],[11,1],[24,0,"buttonIcon enabled"],[4,[38,4],["click",[30,0,["toggleEnabled"]]],null],[12],[1,"\\n"],[41,[30,1,["enabled"]],[[[1,"                        "],[10,"i"],[14,0,"fa fa-eye"],[12],[13],[1,"\\n"]],[]],[[[1,"                        "],[10,"i"],[14,0,"fa fa-eye-slash"],[12],[13],[1,"\\n"]],[]]],[1,"                "],[13],[1,"\\n\\n                "],[11,1],[24,0,"buttonIcon delete"],[4,[38,4],["click",[30,0,["delete"]]],null],[12],[10,"i"],[14,0,"bx bx-trash"],[12],[13],[13],[1,"\\n            "],[13],[1,"\\n        "],[13],[1,"\\n\\n"],[41,[30,1,["open"]],[[[1,"        "],[10,0],[12],[1,"\\n"],[41,[28,[37,7],[[30,1,["type"]],"levels"],null],[[[1,"                "],[8,[39,8],null,[["@controller","@parent","@effectData"],[[30,2],[30,0],[30,1]]],null],[1,"\\n"]],[]],null],[41,[28,[37,7],[[30,1,["type"]],"glslShader"],null],[[[1,"                "],[8,[39,9],null,[["@controller","@parent","@compItem","@indexEffect","@effectData"],[[30,2],[30,0],[30,3],[30,4],[30,1]]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[51,[30,0,["customUI"]]],[[[42,[28,[37,12],[[28,[37,12],[[30,1,["params"]]],null]],null],null,[[[1,"                    "],[41,[51,[30,5,["hidden"]]],[[[1,"\\n\\n"],[41,[51,[28,[37,7],[[30,5,["type"]],"label"],null]],[[[1,"                    "],[10,0],[15,0,[29,["param ",[52,[30,5,["useKeyframes"]],"useKeyframes"]]]],[12],[1,"\\n                        "],[10,0],[12],[1,"\\n"],[41,[51,[30,5,["static"]]],[[[1,"                            "],[11,"i"],[16,0,[29,["bx bx-time tooltip ",[52,[30,5,["useKeyframes"]],"on"]]]],[4,[38,4],["click",[28,[37,13],[[30,0,["toggleUseKeyframes"]],[30,5],[30,6]],null]],null],[12],[1,"\\n                                "],[10,1],[14,0,"tooltiptext p0"],[12],[1,"toggle animated"],[13],[1,"\\n                            "],[13],[1,"\\n"]],[]],null],[1,"                        "],[13],[1,"\\n                        "],[10,0],[12],[1,"\\n"],[41,[28,[37,7],[[30,5,["type"]],"number"],null],[[[41,[30,5,["rangeInput"]],[[[1,"                                    "],[8,[39,14],null,[["@label","@value","@minRangeInput","@maxRangeInput","@step","@min","@max","@displayInput","@action","@noGrid","@unit"],[[30,5,["name"]],[30,5,["value"]],[30,5,["minRangeInput"]],[30,5,["maxRangeInput"]],[30,5,["stepRangeInput"]],[30,5,["min"]],[30,5,["max"]],true,[28,[37,13],[[30,0,["editValue"]],[30,6]],null],[30,5,["noGrid"]],[30,5,["unit"]]]],null],[1,"\\n"]],[]],[[[1,"                                    "],[8,[39,15],null,[["@label","@obj","@property","@unit","@action","@disableMouseMove"],[[30,5,["name"]],[30,5],"value",[30,5,["unit"]],[28,[37,13],[[30,0,["editValue"]],[30,6]],null],true]],null],[1,"\\n"]],[]]],[1,"\\n"]],[]],null],[41,[28,[37,7],[[30,5,["type"]],"color"],null],[[[1,"                            "],[8,[39,16],null,[["@label","@value","@action"],[[30,5,["name"]],[30,5,["value"]],[28,[37,13],[[30,0,["editValue"]],[30,6]],null]]],null],[1,"\\n"]],[]],null],[41,[28,[37,7],[[30,5,["type"]],"select"],null],[[[1,"                            "],[8,[39,17],null,[["@label","@options","@setValue","@target","@targetProperty","@valueToTrack"],[[30,5,["name"]],[30,5,["options"]],[30,0,["setSelectValue"]],[30,5],"value",[30,5,["value"]]]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[28,[37,7],[[30,5,["type"]],"selector"],null],[[[1,"                            "],[8,[39,18],null,[["@label","@labels","@values","@obj","@objProperty","@valueToTrack","@action"],[[30,5,["name"]],[28,[30,0,["selectorLabels"]],[[30,5]],null],[28,[30,0,["selectorValues"]],[[30,5]],null],[30,5],"value",[30,5,["value"]],[30,0,["setSelectorValue"]]]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[28,[37,7],[[30,5,["type"]],null],null],[[[1,"                                "],[10,0],[14,0,"property"],[12],[1,"\\n                                    "],[10,"label"],[12],[1,[30,5,["name"]]],[13],[1,"\\n                                    "],[10,0],[12],[13],[1,"\\n                                "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[41,[28,[37,7],[[30,5,["type"]],"libraryItem"],null],[[[1,"                            "],[8,[39,17],null,[["@label","@options","@setValue","@target","@targetProperty","@valueToTrack"],[[30,5,["name"]],[30,0,["libraryItemsList"]],[30,0,["setLibraryItem"]],[30,5],"value",[30,5,["value"]]]],null],[1,"\\n"]],[]],null],[41,[28,[37,7],[[30,5,["type"]],"compItem"],null],[[[1,"                            "],[8,[39,17],null,[["@label","@options","@setValue","@target","@targetProperty","@valueToTrack"],[[30,5,["name"]],[30,0,["compItemsList"]],[30,0,["setCompItem"]],[30,5],"value",[30,5,["value"]]]],null],[1,"\\n"]],[]],null],[1,"                        "],[13],[1,"\\n                    "],[13],[1,"\\n"]],[]],[[[1,"                        "],[10,2],[14,0,"label"],[12],[1,[30,5,["label"]]],[13],[1,"\\n"]],[]]]],[]],null]],[5,6]],null]],[]],null],[1,"\\n\\n"],[41,[30,0,["creditsLink"]],[[[1,"            "],[10,0],[14,0,"credits"],[12],[1,"\\n            credits: "],[10,3],[15,6,[29,[[30,0,["creditsLink"]]]]],[14,"target","_blank"],[12],[1,[30,0,["creditsLabel"]]],[13],[1,"\\n            "],[13],[1,"\\n"]],[]],null],[1,"\\n        "],[13],[1,"\\n        "]],[]],null],[1,"\\n\\n    "],[13],[1,"\\n"],[13],[1,"\\n"]],["@effectData","@controller","@compItem","@indexEffect","param","index"],["div","span","header","if","on","i","get-config-feature","eq","project/effects-ui/levels","project/effects-ui/glsl-shader","unless","each","-track-array","fn","ui/property-range","ui/property-number","ui/property-color","ui/property-select","ui/property-selector","label","p","a"]]',moduleName:"pikimov/components/project/effects/effect-properties.hbs",isStrictMode:!1})
let c=e.default=(i=class extends o.default{constructor(){super(...arguments),a(this,"controller",null),a(this,"compItem",null),a(this,"canOpen",!0),a(this,"customUI",!1),a(this,"libraryItemsList",[]),a(this,"compItemsList",[]),a(this,"creditsLink",null),a(this,"creditsLabel",null)
var e=this
e.controller=e.args.controller,e.compItem=e.args.compItem,_effects.forEach(function(t){t.type==e.args.effectData.type&&(t.customUI&&(e.customUI=!0),t.credits&&(e.creditsLink=t.credits,e.creditsLabel=t.credits.replace("https://","")))}),e.controller.projectData.library.forEach(function(t){e.libraryItemsList.push({value:t.libUid,name:t.name})})
var t=e.controller.activeCompositionData
e.controller.getters.getAllCompositionItems(t).forEach(function(t){e.compItem.compUid!=t.compUid&&e.compItemsList.push({value:t.compUid,name:t.name})})}getSceneItem(){return this.controller.getters.getCompSceneItemByCompUid(this.compItem.compUid)}selectorLabels(e){var t=[]
return e.options.forEach(function(e){t.push(e.name)}),t}selectorValues(e){var t=[]
return e.options.forEach(function(e){t.push(e.value)}),t}toggleOpen(){var e=this.args.effectData,t=!e.open
t||(t=void 0),(0,r.set)(e,"open",t)}selectFX(){}copyFX(){_keyboardUtils.clipBoard.effect=this.args.effectData,this.controller.triggerClipoardUpdater()}toggleUseKeyframes(e,t){var o=this,n=o.controller
if((0,r.set)(e,"useKeyframes",!e.useKeyframes),n.refreshAndRender(),n.addToHistory("effect","toggle use keyframes"),e.useKeyframes){if(!e.keyframes||!e.keyframes.length){var i=n.currentFrame,a=o.args.indexEffect
n.keyframesUtils.addEffectKey(o.compItem,e,i,a,t)}o.compItem.open||(0,r.set)(o.compItem,"open",!0)}}editValue(e,t=!0){var o=this,n=$(event.target).val(),i=o.args.effectData.params[e];("number"==i.type&&(1*n<i.min&&(0,r.set)(i,"value",i.min),1*n>i.max&&(0,r.set)(i,"value",i.max)),"text"!=o.compItem.type||"repeat x"!=i.name&&"repeat y"!=i.name)||(console.log("edit repeat -> rebuild"),o.getSceneItem().rebuild())
t&&o.controller.addToHistory("effect","edit value"),o.controller.refreshAndRender()}setSelectValue(e,t,o){(0,r.set)(e,t,o),this.controller.addToHistory("effect","edit value"),this.controller.refreshAndRender()}setSelectorValue(e,t,o){(0,r.set)(e,t,o),this.controller.addToHistory("effect","edit value"),this.controller.refreshAndRender()}setCompItem(e,t,o){o*=1,(0,r.set)(e,t,o),this.controller.addToHistory("effect","edit value"),this.controller.refreshAndRender()}setLibraryItem(e,t,o){console.log(o)}editCheckBox(){}toggleEnabled(){var e=this,t=e.controller,o=e.args.effectData;(0,r.set)(o,"enabled",!o.enabled),e.getSceneItem().effectManager.toggleEnabled(e.args.indexEffect,o.enabled),o.enabled?t.addToHistory("effect","enable effect"):t.addToHistory("effect","disable effect"),t.refreshAndRender()}delete(){var e=this.args.indexEffect
this.getSceneItem().removeEffect(e)}},l(i.prototype,"toggleOpen",[r.action],Object.getOwnPropertyDescriptor(i.prototype,"toggleOpen"),i.prototype),l(i.prototype,"selectFX",[r.action],Object.getOwnPropertyDescriptor(i.prototype,"selectFX"),i.prototype),l(i.prototype,"copyFX",[r.action],Object.getOwnPropertyDescriptor(i.prototype,"copyFX"),i.prototype),l(i.prototype,"toggleUseKeyframes",[r.action],Object.getOwnPropertyDescriptor(i.prototype,"toggleUseKeyframes"),i.prototype),l(i.prototype,"editValue",[r.action],Object.getOwnPropertyDescriptor(i.prototype,"editValue"),i.prototype),l(i.prototype,"setSelectValue",[r.action],Object.getOwnPropertyDescriptor(i.prototype,"setSelectValue"),i.prototype),l(i.prototype,"setSelectorValue",[r.action],Object.getOwnPropertyDescriptor(i.prototype,"setSelectorValue"),i.prototype),l(i.prototype,"setCompItem",[r.action],Object.getOwnPropertyDescriptor(i.prototype,"setCompItem"),i.prototype),l(i.prototype,"setLibraryItem",[r.action],Object.getOwnPropertyDescriptor(i.prototype,"setLibraryItem"),i.prototype),l(i.prototype,"editCheckBox",[r.action],Object.getOwnPropertyDescriptor(i.prototype,"editCheckBox"),i.prototype),l(i.prototype,"toggleEnabled",[r.action],Object.getOwnPropertyDescriptor(i.prototype,"toggleEnabled"),i.prototype),l(i.prototype,"delete",[r.action],Object.getOwnPropertyDescriptor(i.prototype,"delete"),i.prototype),i);(0,t.setComponentTemplate)(s,c)}),define("pikimov/components/project/effects/effects-selector",["exports","@ember/component","@glimmer/component","@ember/object","@ember/runloop","@ember/template-factory"],function(e,t,o,r,n,i){var a
function l(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function s(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const c=(0,i.createTemplateFactory)({id:"FpP8U1XZ",block:'[[[10,0],[14,1,"effectSelector"],[14,0,"modal"],[12],[1,"\\n    "],[10,0],[12],[1,"\\n        \\n        "],[10,"header"],[12],[1,"\\n            "],[10,"h2"],[12],[1,"Effects"],[13],[1,"\\n            "],[11,1],[24,0,"b_close"],[4,[38,4],["click",[30,0,["toogleSelector"]]],null],[12],[13],[1,"\\n        "],[13],[1,"\\n\\n        "],[10,"ul"],[12],[1,"\\n"],[42,[28,[37,7],[[28,[37,7],[[30,0,["effectsList"]]],null]],null],null,[[[1,"            "],[11,"li"],[16,0,[29,[[52,[30,1,["disabled"]],"disabled"]]]],[4,[38,4],["click",[28,[37,10],[[30,0,["selectFX"]],[30,1]],null]],null],[12],[1,"\\n"],[41,[30,1,["animatedThumbnail"]],[[[1,"                "],[10,"video"],[15,"src",[29,["images/effects/webm/",[30,1,["video"]]]]],[14,"muted",""],[14,"autoplay",""],[14,"playsinline",""],[14,"loop",""],[14,"disablePictureInPicture",""],[12],[13],[1,"\\n"]],[]],[[[1,"                "],[10,"img"],[14,"draggable","false"],[15,"src",[29,["images/effects/avif/",[30,1,["img"]]]]],[14,"alt","fx"],[12],[13],[1,"\\n"]],[]]],[1,"                "],[10,"h3"],[12],[1,[30,1,["name"]]],[13],[1,"\\n                "],[41,[30,1,["new"]],[[[10,"img"],[14,0,"new"],[14,"src","images/effects/new.avif"],[14,"alt","new"],[12],[13]],[]],null],[1,"\\n            "],[13],[1,"\\n"]],[1]],null],[1,"        "],[13],[1,"\\n\\n    "],[13],[1,"\\n"],[13],[1,"\\n"]],["effect"],["div","header","h2","span","on","ul","each","-track-array","li","if","fn","video","img","h3"]]',moduleName:"pikimov/components/project/effects/effects-selector.hbs",isStrictMode:!1})
let u=e.default=(a=class extends o.default{constructor(){super(...arguments),l(this,"effectsList",[])
var e=this,t=e.args.item.type,o=!1
_config.isDebug&&(o=!0),structuredClone(_effects).forEach(function(r){"null"!=r.type&&(o||!1!==r.production)&&(r.itemTypes&&!r.itemTypes.includes(t)&&(r.disabled=!0),r.itemTypesExcluded&&r.itemTypesExcluded.includes(t)&&(r.disabled=!0),r.img=r.name.replace(/ /g,"-")+".avif",r.animatedThumbnail&&(r.video=r.name.replace(/ /g,"-")+".webm"),e.effectsList.push(r))}),(0,n.next)(function(){var e=$("#effectSelector li").toArray()
function t(t,o){t>=e.length||setTimeout(function(){var o=e[t]
$(o).css({opacity:1})},o)}var o=0
for(o=0;o<11;o++){var r=0+60*o
t(o,r),o>=1&&t(o+8-1,r),o>=2&&t(o+16-2,r),o>=3&&t(o+24-3,r),o>=4&&t(o+32-4,r)}})}selectFX(e){if(!e.disabled){var t=null
_effects.forEach(function(o){o.type==e.type&&(t=o)})
var o=this.args.parent
o.toogleSelector(),o.newEffect=t,o.addEffect()}}toogleSelector(){this.args.parent.toogleSelector()}},s(a.prototype,"selectFX",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"selectFX"),a.prototype),s(a.prototype,"toogleSelector",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"toogleSelector"),a.prototype),a);(0,t.setComponentTemplate)(c,u)}),define("pikimov/components/project/effects/item-effects",["exports","@ember/component","@glimmer/component","@ember/object","@ember/object/observers","@ember/runloop","@ember/template-factory"],function(e,t,o,r,n,i,a){var l,s
function c(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function u(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const m=(0,a.createTemplateFactory)({id:"N/Wm2nSY",block:'[[[41,[30,0,["isSelectorOpen"]],[[[1,"    "],[8,[39,1],null,[["@item","@parent"],[[30,0,["item"]],[30,0]]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["canHaveEffects"]],[[[10,0],[14,1,"itemEffects"],[12],[1,"\\n    \\n    "],[10,0],[12],[1,"\\n"],[41,[28,[37,3],[[30,0,["item","effects","length"]],[30,0,["maxEffects"]]],null],[[[1,"            "],[10,0],[14,0,"effectSelector"],[12],[1,"\\n                "],[11,1],[24,0,"button"],[4,[38,5],["click",[30,0,["toogleSelector"]]],null],[12],[10,"i"],[14,0,"bx bx-plus"],[12],[13],[1,"Add effect"],[13],[1,"\\n            "],[13],[1,"\\n\\n"],[41,[30,0,["hasClipboardEffectData"]],[[[1,"            "],[11,1],[24,0,"button pasteFX"],[4,[38,5],["click",[30,0,["pasteFX"]]],null],[12],[1,"\\n                "],[10,"i"],[14,0,"bx bx-paste"],[12],[13],[1,"paste effect\\n            "],[13],[1,"\\n"]],[]],null],[1,"\\n"]],[]],[[[1,"            "],[10,"br"],[12],[13],[1,"Cannot add more effects\\n"]],[]]],[1,"    "],[13],[1,"\\n\\n    "],[10,0],[14,0,"effects scrollbar"],[12],[1,"\\n"],[42,[28,[37,9],[[28,[37,9],[[30,0,["item","effects"]]],null]],null],null,[[[1,"            "],[8,[39,10],null,[["@controller","@compItem","@effectData","@indexEffect"],[[30,3],[30,0,["item"]],[30,1],[30,2]]],null],[1,"\\n"]],[1,2]],null],[1,"    "],[13],[1,"\\n    \\n"],[13],[1,"\\n"]],[]],[[[10,0],[14,1,"itemEffects"],[14,5,"padding:40px 0 0 50px;height:auto;"],[12],[1,"\\n    Effects cannot be added "],[10,"br"],[12],[13],[1,"to this type of item ("],[1,[30,0,["item","type"]]],[1,")\\n"],[13],[1,"\\n"]],[]]]],["effect","index","@controller"],["if","project/effects/effects-selector","div","lt","span","on","i","br","each","-track-array","project/effects/effect-properties"]]',moduleName:"pikimov/components/project/effects/item-effects.hbs",isStrictMode:!1})
let p=e.default=(l=(0,r.computed)("controller.clipBoardUpdater"),s=class extends o.default{constructor(){super(...arguments),c(this,"controller",null),c(this,"item",null),c(this,"sceneItem",null),c(this,"effectsList",[]),c(this,"maxEffects",10),c(this,"newEffect",{}),c(this,"canHaveEffects",!0),c(this,"isSelectorOpen",!1)
var e=this
e.controller=e.args.controller,(0,n.addObserver)(e,"controller.selectionItemsUpdater",e.onSelectionChanged),e.onSelectionChanged()}setItem(e){(0,r.set)(this,"item",e)}onSelectionChanged(){var e=this
if(1==e.controller.selectionUtils.getNbItemsSelected()){var t=e.controller.selectionUtils.getSelectedCompItem()
if(e.setItem(t),e.item){var o=!0,n=e.item.type
"audio"==n&&(o=!1),"camera"==n&&(o=!1),"cameraTarget"==n&&(o=!1),"light"==n&&(o=!1),"gaussianSplat"==n&&(o=!1),(0,r.set)(e,"canHaveEffects",o),e.sceneItem=e.controller.getters.getCompSceneItemByCompUid(e.item.compUid)}else e.sceneItem=null;(0,i.next)(function(){e.isDestroyed||((0,r.set)(e,"newEffect",{}),e.doSortableEffects())})}else e.setItem(null)}get hasClipboardEffectData(){return!!_keyboardUtils.clipBoard.effect}toogleSelector(){var e=this
e.isSelectorOpen?(0,r.set)(e,"isSelectorOpen",!1):(0,r.set)(e,"isSelectorOpen",!0)}addEffect(){var e=this
e.controller.refreshAndRender()
var t=structuredClone(e.newEffect.params),o={type:e.newEffect.type,name:e.newEffect.name,enabled:!0,open:!0,params:t}
e.sceneItem.addEffect(o),e.controller.refreshAndRender()
var r="add fx "+e.newEffect.name
gaEvent({event:r})}pasteFX(){var e=this,t=structuredClone(_keyboardUtils.clipBoard.effect),o=e.sceneItem.type,r=!0
if(_effects.forEach(function(e){e.type==t.type&&(e.itemTypes&&(e.itemTypes.includes(o)||(r=!1)),e.itemTypesExcluded&&e.itemTypesExcluded.includes(o)&&(r=!1))}),r){e.sceneItem.addEffect(t),e.controller.refreshAndRender()
var n="paste fx "+t.name
gaEvent({event:n})}else openModal({h2:"Not possible",p:"Cannot paste effect on this item ("+t.name+")"})}doSortableEffects(){var e=this
var t=document.querySelector("#rightColumn .effects")
if(t)Sortable.create(t,{handle:".handle",animation:150,onStart:function(t){e.controller.uiManager.draggingCompItem=!0},onEnd:function(t){var o=t.item,r=t.oldIndex,n=t.newIndex,i=t.to.childElementCount-1;(function(t,o){var r,n=e.item.effects,i=structuredClone(n),a=n[t],l=structuredClone(a)
for(i.splice(t,1),i.splice(o,0,l),n.splice(0,n.length),r=0;r<i.length;r++)n.push(structuredClone(i[r]))
e.sceneItem.effectManager.resetEffects(),e.controller.addToHistory("item","reorder effects"),e.controller.refreshAndRender()})(r,n),n==i&&o.parentElement.removeChild(o)}})}},u(s.prototype,"hasClipboardEffectData",[l],Object.getOwnPropertyDescriptor(s.prototype,"hasClipboardEffectData"),s.prototype),u(s.prototype,"toogleSelector",[r.action],Object.getOwnPropertyDescriptor(s.prototype,"toogleSelector"),s.prototype),u(s.prototype,"addEffect",[r.action],Object.getOwnPropertyDescriptor(s.prototype,"addEffect"),s.prototype),u(s.prototype,"pasteFX",[r.action],Object.getOwnPropertyDescriptor(s.prototype,"pasteFX"),s.prototype),s);(0,t.setComponentTemplate)(m,p)}),define("pikimov/components/project/export-button",["exports","@ember/component","@glimmer/component","@ember/object","@ember/template-factory"],function(e,t,o,r,n){var i
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const a=(0,n.createTemplateFactory)({id:"VMvXeCj8",block:'[[[11,1],[24,1,"b_exportVideo"],[24,0,"button"],[4,[38,1],["click",[30,0,["openExportDialog"]]],null],[12],[1,"\\n    "],[10,"i"],[14,0,"bx bx-export"],[12],[13],[1,"Export video\\n"],[13]],[],["span","on","i"]]',moduleName:"pikimov/components/project/export-button.hbs",isStrictMode:!1})
let l=e.default=(i=class extends o.default{constructor(){super(...arguments)}openExportDialog(){var e=this.args.controller
0!=e.activeComposition.items.length?(0,r.set)(e,"isExportOpen",!0):openModal({h2:"This composition is empty",p:"Add something to it before exporting it"})}},s=i.prototype,c="openExportDialog",u=[r.action],m=Object.getOwnPropertyDescriptor(i.prototype,"openExportDialog"),p=i.prototype,d={},Object.keys(m).forEach(function(e){d[e]=m[e]}),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=u.slice().reverse().reduce(function(e,t){return t(s,c,e)||e},d),p&&void 0!==d.initializer&&(d.value=d.initializer?d.initializer.call(p):void 0,d.initializer=void 0),void 0===d.initializer&&Object.defineProperty(s,c,d),i)
var s,c,u,m,p,d;(0,t.setComponentTemplate)(a,l)}),define("pikimov/components/project/export/completed",["exports","@ember/component","@glimmer/component","@ember/object","@ember/template-factory"],function(e,t,o,r,n){var i
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const a=(0,n.createTemplateFactory)({id:"eEwmZ6pj",block:'[[[10,0],[14,1,"exportCompleted"],[14,5,"display:none;"],[12],[1,"\\n\\n    "],[10,0],[14,0,"dimmer"],[12],[13],[1,"\\n    "],[10,0],[14,0,"content"],[12],[1,"\\n\\n        "],[10,"h3"],[12],[1,"Export completed"],[13],[1,"\\n\\n        "],[10,"video"],[14,"controls",""],[14,"disablepictureinpicture",""],[14,1,"exportVideo"],[12],[13],[1,"\\n\\n        "],[10,0],[14,0,"buttons"],[12],[1,"\\n\\n            "],[10,1],[14,1,"exportVideoInfos"],[14,0,"notranslate"],[12],[13],[1,"\\n            \\n            "],[10,3],[14,0,"button green"],[14,1,"download"],[14,"target","_blank"],[12],[1,"save video file"],[13],[1,"\\n\\n"],[41,[28,[37,6],null,null],[[[1,"                "],[10,3],[14,0,"button green"],[14,1,"download_debug"],[14,"target","_blank"],[12],[1,"save video file long name"],[13],[1,"\\n"]],[]],null],[1,"            "],[10,"br"],[12],[13],[10,"br"],[12],[13],[1,"\\n\\n            "],[11,1],[24,0,"button"],[4,[38,8],["click",[30,0,["close"]]],null],[12],[1,"close"],[13],[1,"\\n\\n        "],[13],[1,"\\n\\n        "],[10,"img"],[14,0,"zoo"],[14,"src","images/zoo2.png"],[14,"alt","zoo"],[12],[13],[1,"\\n    "],[13],[1,"\\n\\n"],[13],[1,"\\n"]],[],["div","h3","video","span","a","if","is-debug","br","on","img"]]',moduleName:"pikimov/components/project/export/completed.hbs",isStrictMode:!1})
let l=e.default=(i=class extends o.default{constructor(){super(...arguments),document.addEventListener("fullscreenchange",this.onFullSCreenChange)}willDestroy(){document.removeEventListener("fullscreenchange",this.onFullSCreenChange)}onFullSCreenChange(){var e=document.querySelector("#exportVideo")
document.fullscreenElement==e&&e.focus()}close(){$("#exportVideo")[0].src="",this.args.controller.closeExport()}},s=i.prototype,c="close",u=[r.action],m=Object.getOwnPropertyDescriptor(i.prototype,"close"),p=i.prototype,d={},Object.keys(m).forEach(function(e){d[e]=m[e]}),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=u.slice().reverse().reduce(function(e,t){return t(s,c,e)||e},d),p&&void 0!==d.initializer&&(d.value=d.initializer?d.initializer.call(p):void 0,d.initializer=void 0),void 0===d.initializer&&Object.defineProperty(s,c,d),i)
var s,c,u,m,p,d;(0,t.setComponentTemplate)(a,l)}),define("pikimov/components/project/export/progress",["exports","@ember/component","@glimmer/component","@ember/object","@ember/runloop","@ember/template-factory"],function(e,t,o,r,n,i){var a
function l(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const s=(0,i.createTemplateFactory)({id:"43QcKLCi",block:'[[[10,0],[14,1,"exportProgress"],[14,5,"display:none;"],[12],[1,"\\n\\n    "],[10,0],[14,0,"dimmer"],[12],[13],[1,"\\n    "],[10,0],[14,0,"content"],[12],[1,"\\n\\n        Export progress"],[10,"br"],[12],[13],[1,"\\n        "],[10,"br"],[12],[13],[1,"\\n        \\n        "],[1,[30,0,["message"]]],[10,"br"],[12],[13],[1,"\\n        \\n        "],[41,[30,0,["progress"]],[[[10,"label"],[14,0,"notranslate"],[12],[1,[30,0,["progress"]]],[1,"%"],[13]],[]],null],[10,"br"],[12],[13],[1,"\\n\\n        "],[10,0],[14,1,"exportProgressBar"],[12],[1,"\\n            "],[10,0],[14,0,"filler"],[12],[13],[1,"\\n        "],[13],[1,"\\n        "],[10,"br"],[12],[13],[1,"\\n\\n        "],[10,"label"],[14,0,"notranslate"],[12],[41,[30,0,["totalEstimationMmss"]],[[[1,[30,0,["totalTimeMmss"]]],[1," / "],[1,[30,0,["totalEstimationMmss"]]]],[]],null],[13],[1,"\\n        "],[10,"br"],[12],[13],[10,"br"],[12],[13],[1,"\\n\\n        "],[11,1],[24,0,"button cancel"],[4,[38,5],["click",[30,0,["cancelExport"]]],null],[12],[1,"cancel"],[13],[1,"\\n\\n    "],[13],[1,"\\n\\n"],[13],[1,"\\n"]],[],["div","br","if","label","span","on"]]',moduleName:"pikimov/components/project/export/progress.hbs",isStrictMode:!1})
let c=e.default=(a=class extends o.default{constructor(){super(...arguments),l(this,"domElement",null),l(this,"progress",0),l(this,"message",null),l(this,"totalTimeMmss",0),l(this,"totalEstimationMmss",null)
var e=this;(0,n.next)(function(){e.domElement=document.querySelector("#exportProgress")
var t=$("#exportProgressBar .filler")
e.domElement.addEventListener("exportMessage",function(o){if(o.detail.message?(0,r.set)(e,"message",o.detail.message):(0,r.set)(e,"message",null),!o.detail.message||void 0!==o.detail.progress){var n=1*o.detail.progress,i=1*o.detail.totalTimeMs
if(n!=e.progress){if(n>1){var a=i
a-=60*(s=parseInt(a/1e3/60))*1e3,(c=parseInt(a/1e3))<10&&(c="0"+c),0==c&&(c="00"),s<10&&(s="0"+s),0==s&&(s="00")
var l=s+":"+c;(0,r.set)(e,"totalTimeMmss",l)
var s,c
a=100*i/n
a-=60*(s=parseInt(a/1e3/60))*1e3,(c=parseInt(a/1e3))<10&&(c="0"+c),0==c&&(c="00"),s<10&&(s="0"+s),0==s&&(s="00")
l=s+":"+c;(0,r.set)(e,"totalEstimationMmss",l)}(0,r.set)(e,"progress",n),t.css({width:e.progress+"%"})}}},!1)})}cancelExport(){this.args.parent.cancelExport()}},u=a.prototype,m="cancelExport",p=[r.action],d=Object.getOwnPropertyDescriptor(a.prototype,"cancelExport"),f=a.prototype,v={},Object.keys(d).forEach(function(e){v[e]=d[e]}),v.enumerable=!!v.enumerable,v.configurable=!!v.configurable,("value"in v||v.initializer)&&(v.writable=!0),v=p.slice().reverse().reduce(function(e,t){return t(u,m,e)||e},v),f&&void 0!==v.initializer&&(v.value=v.initializer?v.initializer.call(f):void 0,v.initializer=void 0),void 0===v.initializer&&Object.defineProperty(u,m,v),a)
var u,m,p,d,f,v;(0,t.setComponentTemplate)(s,c)}),define("pikimov/components/project/export/settings",["exports","@ember/component","@glimmer/component","@ember/object","pikimov/classes/export/export-video_a","pikimov/classes/export/export-video_b12","pikimov/classes/export/export-video_c","pikimov/classes/export/export-images","@ember/template-factory"],function(e,t,o,r,n,i,a,l,s){var c,u
function m(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function p(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const d=(0,s.createTemplateFactory)({id:"yD5jnMqU",block:'[[[10,0],[14,1,"exportSettings"],[12],[1,"\\n\\n    "],[10,0],[14,1,"export"],[12],[1,"\\n\\n        "],[1,[30,0,["sizeUpdated"]]],[1,"\\n\\n        "],[10,"header"],[12],[1,"\\n            "],[10,"h2"],[12],[1,"Export"],[13],[1,"\\n            "],[11,1],[24,0,"b_close"],[4,[38,4],["click",[30,0,["closeExport"]]],null],[12],[13],[1,"\\n        "],[13],[1,"\\n\\n        "],[8,[39,5],null,[["@noBorder"],[true]],[["default"],[[[[1,"Format"]],[]]]]],[1,"\\n\\n        "],[10,"ul"],[14,1,"formats"],[12],[1,"\\n            "],[11,"li"],[16,0,[29,[[52,[28,[37,9],[[30,0,["format"]],"video"],null],"active"]]]],[4,[38,4],["click",[28,[37,10],[[30,0,["setFormat"]],"video"],null]],null],[12],[1,"\\n                "],[10,1],[14,0,"name"],[12],[1,"Video"],[13],[1,"\\n                "],[10,2],[12],[1,".mp4 file\\n                    "],[10,"br"],[12],[13],[1,"\\n                    no alpha channel\\n                "],[13],[1,"\\n            "],[13],[1,"\\n            "],[11,"li"],[16,0,[29,[[52,[28,[37,9],[[30,0,["format"]],"imageSequence"],null],"active"]]]],[4,[38,4],["click",[28,[37,10],[[30,0,["setFormat"]],"imageSequence"],null]],null],[12],[1,"\\n                "],[10,1],[14,0,"name"],[12],[1,"Image sequence"],[13],[1,"\\n                "],[10,2],[12],[1,"Multiple .png files\\n                    "],[10,"br"],[12],[13],[1,"\\n                    optional alpha channel\\n                "],[13],[1,"\\n            "],[13],[1,"\\n        "],[13],[1,"\\n"],[1,"\\n        "],[10,"br"],[12],[13],[10,"br"],[12],[13],[1,"\\n\\n        "],[10,0],[14,0,"size"],[12],[1,"\\n            "],[8,[39,13],null,[["@label","@value","@min","@max","@step","@action","@displayValue","@unit"],["Size",[30,0,["size"]],25,100,25,[30,0,["editSize"]],true,"%"]],null],[1,"\\n\\n            "],[10,0],[12],[1,"\\n                "],[1,[30,0,["exportDimensions","width"]]],[1,"  "],[1,[30,0,["exportDimensions","height"]]],[1," pixels\\n            "],[13],[1,"\\n        "],[13],[1,"\\n\\n"],[41,[28,[37,9],[[30,0,["format"]],"video"],null],[[[1,"        "],[10,0],[12],[1,"\\n\\n"],[41,[28,[37,14],null,null],[[[1,"                "],[8,[39,15],null,[["@obj","@property","@label","@min","@max","@action"],[[30,0],"videoBitrate","videoBitrate",0,2000000000,[30,0,["editVideoBitrate"]]]],null],[1,"\\n\\n                "],[11,"button"],[24,0,"button"],[24,1,"exportVideoB"],[4,[38,4],["click",[30,0,["exportVideoB"]]],null],[12],[1,"export Video B ffmpeg wasm RGBA"],[13],[10,"br"],[12],[13],[1,"\\n                "],[10,"br"],[12],[13],[1,"\\n                "],[11,"button"],[24,0,"button"],[24,1,"exportVideoA"],[4,[38,4],["click",[30,0,["exportVideoA"]]],null],[12],[1,"export Video A ffmpeg OLD"],[13],[10,"br"],[12],[13],[1,"\\n\\n"]],[]],null],[1,"\\n            "],[11,1],[24,0,"button export"],[4,[38,4],["click",[30,0,["exportVideoC"]]],null],[12],[10,"i"],[14,0,"bx bx-export"],[12],[13],[1,"Export"],[13],[10,"br"],[12],[13],[1,"\\n\\n        "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[41,[28,[37,9],[[30,0,["format"]],"imageSequence"],null],[[[1,"        "],[10,0],[12],[1,"\\n            "],[8,[39,18],null,[["@label","@obj","@objProperty","@valueToTrackBoolean","@action"],["Transparent background",[30,1,["projectData"]],"transparent",[30,1,["projectData","transparent"]],[30,0,["editCheckBoxTransparent"]]]],null],[1,"\\n\\n            "],[11,1],[24,0,"button export"],[4,[38,4],["click",[30,0,["exportImages"]]],null],[12],[10,"i"],[14,0,"bx bx-export"],[12],[13],[1,"Export"],[13],[10,"br"],[12],[13],[1,"\\n\\n        "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[1,"\\n    "],[13],[1,"\\n"],[13],[1,"\\n\\n"],[8,[39,19],null,[["@parent"],[[30,0]]],null],[1,"\\n\\n"],[8,[39,20],null,[["@controller"],[[30,1]]],null],[1,"\\n"]],["@controller"],["div","header","h2","span","on","ui/property-title","ul","li","if","eq","fn","p","br","ui/property-range","is-debug","ui/property-number","button","i","ui/property-checkbox","project/export/progress","project/export/completed"]]',moduleName:"pikimov/components/project/export/settings.hbs",isStrictMode:!1})
let f=e.default=(c=(0,r.computed)("size"),u=class extends o.default{constructor(){super(...arguments),m(this,"controller",null),m(this,"activeComposition",null),m(this,"exportVideo",null),m(this,"size",100),m(this,"exportDimensions",{width:0,height:0}),m(this,"videoBitrate",0),m(this,"selectorLabels",["video","image sequence"]),m(this,"selectorValues",["video","imageSequence"]),m(this,"format","video")
var e=this
e.controller=e.args.controller,e.activeComposition=e.controller.activeCompositionData,e.updateSize(),e.updateVideoBitRate()}get sizeUpdated(){this.updateSize(),this.updateVideoBitRate()}setFormat(e){var t=this;((0,r.set)(t,"format",e),"video"==t.format)&&(t.controller.projectData.transparent&&t.editCheckBoxTransparent(null,null,!1))}setSelectorFormat(e,t,o){this.setFormat(o)}editCheckBoxTransparent(e,t,o){var n=this.controller,i=n.projectData
i.transparent?(0,r.set)(i,"transparent",o):(0,r.set)(i,"transparent",!0),n.selectionUtils.saveHoldCurrentSelection(),n.reopenComposition()}updateSize(){var e=this
if(e.activeComposition){var t=Math.floor(e.activeComposition.dimensions.width/100*e.size),o=Math.floor(e.activeComposition.dimensions.height/100*e.size)
t%2!=0&&(t-=1),o%2!=0&&(o-=1),t<2&&(t=2),o<2&&(o=2),(0,r.set)(e,"exportDimensions",{width:t,height:o})}}updateVideoBitRate(){var e=this,t=e.exportDimensions.width*e.exportDimensions.height,o=8e6
t>2073600&&(o=12e6),t<921600&&(o=5e6),t<230400&&(o=15e5),t<=16e4&&(o=1e6),1*e.activeComposition.frameRate>30&&(o=Math.floor(1.5*o)),(0,r.set)(e,"videoBitrate",o)}editSize(){}editVideoBitrate(){}exportVideoA(){var e=this
e.showProgressDiv(),e.exportVideo=new n.default(e.controller,e.activeComposition),e.exportVideo.exportVideo()}exportVideoB(){var e=this
e.showProgressDiv(),e.exportVideo=new i.default(e.controller,e.activeComposition,1*e.size)
e.exportVideo.exportVideo(!1,e.videoBitrate)}exportVideoC(){var e=this
e.showProgressDiv(),e.exportVideo=new a.default(e.controller,e.activeComposition,1*e.size)
e.exportVideo.exportVideo(!1,e.videoBitrate)}exportImages(){var e=this
e.showProgressDiv(),e.exportVideo=new l.default(e.controller,e.activeComposition,1*e.size),e.exportVideo.exportImages()}showProgressDiv(){$("#exportSettings").hide(),$("#exportProgress").show(),$("#exportProgressBar .filler").css({width:"0"})}cancelExport(){$("#exportProgress").hide(),gaEvent({event:"export - abort"}),this.exportVideo.abort()}closeExport(){this.controller.closeExport(!1)}},p(u.prototype,"sizeUpdated",[c],Object.getOwnPropertyDescriptor(u.prototype,"sizeUpdated"),u.prototype),p(u.prototype,"setFormat",[r.action],Object.getOwnPropertyDescriptor(u.prototype,"setFormat"),u.prototype),p(u.prototype,"setSelectorFormat",[r.action],Object.getOwnPropertyDescriptor(u.prototype,"setSelectorFormat"),u.prototype),p(u.prototype,"editCheckBoxTransparent",[r.action],Object.getOwnPropertyDescriptor(u.prototype,"editCheckBoxTransparent"),u.prototype),p(u.prototype,"editSize",[r.action],Object.getOwnPropertyDescriptor(u.prototype,"editSize"),u.prototype),p(u.prototype,"editVideoBitrate",[r.action],Object.getOwnPropertyDescriptor(u.prototype,"editVideoBitrate"),u.prototype),p(u.prototype,"exportVideoA",[r.action],Object.getOwnPropertyDescriptor(u.prototype,"exportVideoA"),u.prototype),p(u.prototype,"exportVideoB",[r.action],Object.getOwnPropertyDescriptor(u.prototype,"exportVideoB"),u.prototype),p(u.prototype,"exportVideoC",[r.action],Object.getOwnPropertyDescriptor(u.prototype,"exportVideoC"),u.prototype),p(u.prototype,"exportImages",[r.action],Object.getOwnPropertyDescriptor(u.prototype,"exportImages"),u.prototype),p(u.prototype,"cancelExport",[r.action],Object.getOwnPropertyDescriptor(u.prototype,"cancelExport"),u.prototype),p(u.prototype,"closeExport",[r.action],Object.getOwnPropertyDescriptor(u.prototype,"closeExport"),u.prototype),u);(0,t.setComponentTemplate)(d,f)}),define("pikimov/components/project/history/history",["exports","@ember/component","@glimmer/component","@ember/object","@ember/template-factory"],function(e,t,o,r,n){var i
function a(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const l=(0,n.createTemplateFactory)({id:"oExAVOWU",block:'[[[10,0],[14,1,"history"],[15,0,[29,[[52,[30,1,["isCompositionReady"]],"ready"]]]],[12],[1,"\\n\\n    "],[1,[30,0,["addedToDom"]]],[1,"\\n    "],[10,"br"],[12],[13],[1,"\\n\\n    "],[10,2],[12],[1,"Use "],[10,1],[14,0,"keyboard"],[12],[1,[30,0,["ctrlKey"]]],[13],[10,1],[14,0,"keyboard"],[12],[1,"Z"],[13],[1," to undo the last action"],[13],[1,"\\n\\n"],[1,"    "],[10,"ul"],[14,0,"scrollbar"],[12],[1,"\\n"],[42,[28,[37,7],[[28,[37,7],[[30,0,["historyUtils","history"]]],null]],null],null,[[[1,"        "],[11,"li"],[16,"data-index",[29,[[30,3]]]],[4,[38,9],["click",[28,[37,10],[[30,0,["clickStep"]],[30,3]],null]],null],[12],[1,"\\n            "],[10,1],[14,0,"index"],[12],[1,[28,[35,11],[[30,3]],null]],[1,"."],[13],[1," "],[1,[30,2,["type"]]],[1," - "],[1,[30,2,["what"]]],[1,"\\n            "],[10,1],[14,0,"dev"],[12],[1,[30,2,["options","needRebuild"]]],[13],[1,"\\n        "],[13],[1,"\\n"]],[2,3]],null],[1,"    "],[13],[1,"\\n\\n"],[13],[1,"\\n"]],["@controller","item","index"],["div","if","br","p","span","ul","each","-track-array","li","on","fn","plus-one"]]',moduleName:"pikimov/components/project/history/history.hbs",isStrictMode:!1})
let s=e.default=(i=class extends o.default{constructor(){super(...arguments),a(this,"controller",null),a(this,"historyUtils",null),a(this,"ctrlKey","Ctrl")
var e=this
e.controller=e.args.controller,e.historyUtils=e.controller.historyUtils,"macos"==_browser.os&&(e.ctrlKey="")}get addedToDom(){var e=this.historyUtils
e.highlightStep(e.currentStep)}clickStep(e){this.controller.selectionUtils.clearSelection()
var t,o=this.historyUtils,r=!1
for(t=0;t<e;t++){var n=o.history[t]
o.isHardResetNeeded(n)&&(r=!0)}n=o.history[e]
o.applyStepData(n,e)
r=!0
o.refreshComposition(r)}},c=i.prototype,u="clickStep",m=[r.action],p=Object.getOwnPropertyDescriptor(i.prototype,"clickStep"),d=i.prototype,f={},Object.keys(p).forEach(function(e){f[e]=p[e]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=m.slice().reverse().reduce(function(e,t){return t(c,u,e)||e},f),d&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(d):void 0,f.initializer=void 0),void 0===f.initializer&&Object.defineProperty(c,u,f),i)
var c,u,m,p,d,f;(0,t.setComponentTemplate)(l,s)}),define("pikimov/components/project/learn/animation",["exports","@ember/component","@glimmer/component","@ember/object","@ember/runloop","@ember/template-factory"],function(e,t,o,r,n,i){var a
function l(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function s(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const c=(0,i.createTemplateFactory)({id:"QqEVywqk",block:'[[[10,0],[14,1,"learn"],[14,0,"modal"],[12],[1,"\\n\\n    "],[10,0],[12],[1,"\\n\\n        "],[10,"header"],[12],[1,"\\n            "],[10,"h2"],[12],[1,"How to animate a property"],[13],[1,"\\n            "],[11,1],[24,0,"b_close"],[4,[38,4],["click",[30,1,["toogleLearn"]]],null],[12],[13],[1,"\\n        "],[13],[1,"\\n\\n        "],[10,0],[14,0,"body"],[12],[1,"\\n\\n             "],[10,0],[14,0,"image"],[12],[1,"\\n                "],[10,"img"],[12],[13],[1,"\\n                "],[10,1],[14,0,"title"],[12],[13],[1,"\\n                "],[10,0],[14,0,"tooltips"],[12],[13],[1,"\\n"],[41,[51,[28,[37,7],[[30,0,["currentStep"]],1],null]],[[[1,"                "],[11,1],[24,0,"prev"],[4,[38,4],["click",[30,0,["prev"]]],null],[12],[10,"i"],[14,0,"bx bx-play bx-rotate-180"],[12],[13],[13],[1,"\\n"]],[]],null],[41,[51,[28,[37,7],[[30,0,["currentStep"]],[30,0,["steps","length"]]],null]],[[[1,"                "],[11,1],[24,0,"next"],[4,[38,4],["click",[30,0,["next"]]],null],[12],[10,"i"],[14,0,"bx bx-play"],[12],[13],[13],[1,"\\n"]],[]],null],[1,"             "],[13],[1,"\\n             "],[10,0],[14,0,"steps notranslate"],[12],[1,"\\n\\n"],[42,[28,[37,10],[[28,[37,10],[[30,0,["steps"]]],null]],null],null,[[[1,"                    "],[11,1],[16,0,[29,[[52,[28,[37,7],[[30,0,["currentStep"]],[28,[37,12],[[30,3]],null]],null],"active"]]]],[4,[38,4],["click",[28,[37,13],[[30,0,["setStep"]],[28,[37,12],[[30,3]],null]],null]],null],[12],[1,[30,2,["index"]]],[13],[1,"\\n"]],[2,3]],null],[1,"                \\n             "],[13],[1,"\\n\\n"],[41,[51,[30,0,["answeredPoll"]]],[[[41,[28,[37,7],[[30,0,["currentStep"]],[30,0,["steps","length"]]],null],[[[1,"             "],[10,0],[14,0,"poll"],[12],[1,"\\n                "],[10,2],[12],[1,"Was this tutorial helpful?"],[13],[1,"\\n\\n                "],[11,1],[24,0,"button"],[4,[38,4],["click",[28,[37,13],[[30,0,["answerPoll"]],3],null]],null],[12],[1,"yes"],[13],[1,"\\n                "],[11,1],[24,0,"button"],[4,[38,4],["click",[28,[37,13],[[30,0,["answerPoll"]],2],null]],null],[12],[1,"a little bit"],[13],[1,"\\n                "],[11,1],[24,0,"button"],[4,[38,4],["click",[28,[37,13],[[30,0,["answerPoll"]],1],null]],null],[12],[1,"no"],[13],[1,"\\n             "],[13],[1,"\\n"]],[]],null]],[]],null],[1,"\\n        "],[13],[1,"\\n\\n\\n    "],[13],[1,"\\n"],[13],[1,"\\n"]],["@parent","step","index"],["div","header","h2","span","on","img","unless","eq","i","each","-track-array","if","plus-one","fn","p"]]',moduleName:"pikimov/components/project/learn/animation.hbs",isStrictMode:!1})
let u=e.default=(a=class extends o.default{constructor(){super(...arguments),l(this,"steps",[{index:1,tooltips:[{label:"Learn how to animate an item position",top:260,left:400}]},{index:2,tooltips:[{label:"To animate a property \n(position, rotation, opacity...)\nclick the clock icon\n\nIn this example the position is animated",left:610,top:50}]},{index:3,tooltips:[{label:"Drag the image to the bottom left corner",top:330,left:260},{label:"A keyframe has been created",top:490,left:280}]},{index:4,tooltips:[{label:"Drag to time bar to 00:05 (= 5 seconds)",top:480,left:720}]},{index:5,tooltips:[{label:"Drag the image to the top right corner",top:200,left:400},{label:"It will create a second keyframe",top:490,left:680}]},{index:6,tooltips:[{label:"The image position is now animated",top:200,left:400},{label:"Use the stop and play buttons for playback",top:360,left:180}]}]),l(this,"currentStep",1),l(this,"answeredPoll",!1)
var e=this
!0===window._answeredPoll&&(e.answeredPoll=!0),(0,n.next)(function(){e.setStep(1)})}setImage(e){var t="images/learn/animate-"+e+".png"
$("#learn .body img").eq(0).attr("src",t)
var o="",r=this.steps[this.currentStep-1]
r.tooltips&&r.tooltips.forEach(function(e){var t=1*e.top,r=1*e.left
o+=`<span class="tutorial animated" style="top:${t}px;left:${r}px">${e.label}</span>`}),$("#learn .body .tooltips").eq(0).html(o)}prev(){this.setStep(this.currentStep-1)}next(){this.setStep(this.currentStep+1)}setStep(e){var t=this;(0,r.set)(t,"currentStep",e),t.setImage(t.currentStep)}answerPoll(e){(0,r.set)(this,"answeredPoll",!0),window._answeredPoll=!0
var t="learn poll | animate 01 | "+e
console.log(t),gaEvent({event:t})}},s(a.prototype,"prev",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"prev"),a.prototype),s(a.prototype,"next",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"next"),a.prototype),s(a.prototype,"setStep",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"setStep"),a.prototype),s(a.prototype,"answerPoll",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"answerPoll"),a.prototype),a);(0,t.setComponentTemplate)(c,u)}),define("pikimov/components/project/left-column",["exports","@ember/component","@glimmer/component","@ember/object","@ember/object/observers","@ember/template-factory"],function(e,t,o,r,n,i){var a
function l(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function s(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const c=(0,i.createTemplateFactory)({id:"OJ00+0Ix",block:'[[[10,0],[14,1,"leftColumn"],[12],[1,"\\n\\n    "],[10,"header"],[12],[1,"\\n        "],[10,"h3"],[14,0,"notranslate"],[12],[1,[30,1,["projectName"]]],[1,[52,[30,1,["unsaved"]],"*"]],[13],[1,"\\n\\n        "],[11,1],[24,0,"b_minify tooltip"],[4,[38,5],["click",[30,0,["togglePanel"]]],null],[12],[1,"\\n            "],[10,"i"],[14,0,"bx bx-chevrons-left"],[12],[13],[1,"\\n            "],[10,1],[14,0,"tooltiptext down p100"],[12],[1,"Hide panel"],[13],[1,"\\n        "],[13],[1,"\\n        "],[11,1],[24,0,"b_expand"],[4,[38,5],["click",[30,0,["togglePanel"]]],null],[12],[1,"\\n            "],[10,"i"],[14,0,"bx bx-chevrons-right"],[12],[13],[1,"\\n        "],[13],[1,"\\n    "],[13],[1,"\\n\\n    "],[10,0],[14,0,"tabs sitting x3"],[12],[1,"\\n        "],[11,0],[16,0,[29,[[52,[28,[37,7],[[30,0,["selectedTab"]],"project"],null],"active"]]]],[4,[38,5],["click",[28,[37,8],[[30,0,["setSelectTab"]],"project"],null]],null],[12],[1,"project"],[13],[1,"\\n        "],[11,0],[16,0,[29,[[52,[28,[37,7],[[30,0,["selectedTab"]],"composition"],null],"active"]]]],[4,[38,5],["click",[28,[37,8],[[30,0,["setSelectTab"]],"composition"],null]],null],[12],[1,"composition"],[13],[1,"\\n        "],[11,0],[16,0,[29,[[52,[28,[37,7],[[30,0,["selectedTab"]],"history"],null],"active"]]]],[4,[38,5],["click",[28,[37,8],[[30,0,["setSelectTab"]],"history"],null]],null],[12],[1,"history"],[13],[1,"\\n    "],[13],[1,"\\n\\n    "],[10,0],[14,0,"body scrollbar"],[12],[1,"\\n"],[41,[30,1,["projectData"]],[[[1,"\\n"],[41,[28,[37,7],[[30,0,["selectedTab"]],"project"],null],[[[1,"                "],[8,[39,9],null,[["@controller"],[[30,1]]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[28,[37,7],[[30,0,["selectedTab"]],"composition"],null],[[[1,"                "],[41,[30,1,["activeComposition"]],[[[1,"\\n                "],[8,[39,10],null,[["@controller"],[[30,1]]],null],[1,"\\n"]],[]],null]],[]],null],[1,"            \\n"],[41,[28,[37,7],[[30,0,["selectedTab"]],"history"],null],[[[1,"                "],[8,[39,11],null,[["@controller"],[[30,1]]],null],[1,"\\n"]],[]],null]],[]],null],[1,"    "],[13],[1,"\\n\\n"],[13],[1,"\\n"]],["@controller"],["div","header","h3","if","span","on","i","eq","fn","project/library/library","project/properties/composition-properties","project/history/history"]]',moduleName:"pikimov/components/project/left-column.hbs",isStrictMode:!1})
let u=e.default=(a=class extends o.default{constructor(){super(...arguments),l(this,"selectedTab","project");(0,n.addObserver)(this,"args.controller.projectData",this.onProjectClosed)}onProjectClosed(){this.setSelectTab("project")}togglePanel(){$("#projectTop").toggleClass("minLeftColumn")
var e=this.args.controller.uiManager
e.resizeHandler(),setTimeout(function(){e.resizeHandler()},300)}setSelectTab(e){(0,r.set)(this,"selectedTab",e)}},s(a.prototype,"togglePanel",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"togglePanel"),a.prototype),s(a.prototype,"setSelectTab",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"setSelectTab"),a.prototype),a);(0,t.setComponentTemplate)(c,u)}),define("pikimov/components/project/library/compositions",["exports","@ember/component","@glimmer/component","@ember/object","@ember/runloop","@ember/template-factory"],function(e,t,o,r,n,i){var a
function l(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function s(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const c=(0,i.createTemplateFactory)({id:"tLNiQRuX",block:'[[[10,0],[14,1,"compositions"],[12],[1,"\\n\\n    "],[8,[39,1],null,[["@noBorder"],[true]],[["default"],[[[[1,"Compositions"],[10,1],[14,0,"dev"],[12],[1,"x"],[1,[30,1,["projectData","compositions","length"]]],[13]],[]]]]],[1,"\\n\\n"],[41,[30,0,["toggleForRefresh"]],[[[1,"        "],[10,"ul"],[14,1,"compositionsList"],[14,0,"notranslate"],[12],[1,"\\n"],[42,[28,[37,6],[[28,[37,6],[[30,1,["projectData","compositions"]]],null]],null],null,[[[1,"            "],[8,[39,7],null,[["@controller","@item","@index","@parent"],[[30,1],[30,2],[30,3],[30,0]]],null],[1,"\\n"]],[2,3]],null],[1,"        "],[13],[1,"\\n"]],[]],null],[1,"    "],[10,0],[14,0,"toolBar"],[12],[1,"\\n\\n"],[41,[30,0,["isAddItemSelectorOpen"]],[[[1,"        "],[8,[39,8],null,[["@ec","@parent"],[[30,4],[30,0]]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[28,[37,9],[[30,1,["projectData","compositions","length"]],[30,0,["maxCompositions"]]],null],[[[1,"        "],[11,1],[24,0,"button circle plus"],[4,[38,10],["click",[30,0,["addComposition"]]],null],[12],[13],[11,"label"],[4,[38,10],["click",[30,0,["addComposition"]]],null],[12],[1,"New composition"],[13],[1,"\\n"]],[]],[[[1,"        "],[10,1],[12],[1,"Project full ("],[1,[30,0,["maxCompositions"]]],[1," compositions)"],[13],[1,"\\n"]],[]]],[1,"\\n        "],[11,1],[24,0,"buttonIcon tooltip"],[4,[38,10],["click",[30,0,["delete"]]],null],[12],[10,"i"],[14,0,"fa fa-trash-o"],[12],[13],[10,1],[14,0,"tooltiptext p85"],[12],[1,"Delete"],[13],[13],[1,"\\n"],[41,[28,[37,9],[[30,1,["projectData","compositions","length"]],[30,0,["maxCompositions"]]],null],[[[1,"        "],[11,1],[24,0,"buttonIcon tooltip"],[4,[38,10],["click",[30,0,["duplicate"]]],null],[12],[10,"i"],[14,0,"bx bx-copy"],[12],[13],[10,1],[14,0,"tooltiptext p85"],[12],[1,"Duplicate"],[13],[13],[1,"\\n"]],[]],null],[41,[30,0,["showDuplicateModal"]],[[[1,"        "],[8,[39,13],null,[["@ec","@parent","@selection"],[[30,4],[30,0],[30,4,["selectionUtils","selectionArray"]]]],null],[1,"\\n"]],[]],null],[1,"\\n    "],[13],[1,"\\n"],[13],[1,"\\n"]],["@controller","item","index","@ec"],["div","ui/property-title","span","if","ul","each","-track-array","project/library/li-composition","project/hierarchy/add-item","lt","on","label","i","project/hierarchy/duplicate"]]',moduleName:"pikimov/components/project/library/compositions.hbs",isStrictMode:!1})
let u=e.default=(a=class extends o.default{constructor(){super(...arguments),l(this,"controller",null),l(this,"maxCompositions",_config.maxCompositions),l(this,"showDuplicateModal",!1),l(this,"toggleForRefresh",!0)
var e=this
e.controller=e.args.controller,(0,n.next)(function(){e.doSortableCompositions()})}addComposition(){this.controller.toggleProperty("isNewCompositionDialogOpen")}openComposition(e){var t=this.controller
console.log("click openComposition",e),t.isCompositionReady||console.log("click on comp li but controller.isCompositionReady FALSE"),t.activeComposition||console.log("error - no .activeComposition"),t.projectData.compositions[e]||console.log("error - no .projectData.compositions[index]"),t.projectData.compositions[e].uid!=t.activeComposition.uid&&t.setActiveComposition(e)}doSortableCompositions(){var e=this,t=e.controller
var o=document.querySelector("#compositionsList")
Sortable.create(o,{handle:".handle",animation:150,onStart:function(t){console.log("start drag comp",t.oldIndex),e.controller.uiManager.draggingFromProject=!0},onEnd:function(i){var a=i.item,l=i.oldIndex,s=document.querySelector("#overItemsInputs")
if(function(e,t,o){const r=o.getBoundingClientRect()
return e>=r.left&&e<=r.right&&t>=r.top&&t<=r.bottom}(i.originalEvent.clientX,i.originalEvent.clientY,s)){var c=l,u=t.projectData.compositions[c],m=structuredClone(u)
m.type="composition",t.libraryManager.addLibItemToComposition(m),(0,r.set)(e,"toggleForRefresh",!e.toggleForRefresh),(0,n.next)(function(){(0,r.set)(e,"toggleForRefresh",!e.toggleForRefresh),(0,n.next)(function(){e.doSortableCompositions()})})}else{var p=i.newIndex,d=o.childElementCount-1,f=t.activeComposition.uid,v=t.projectData.compositions
p==d&&a.remove()
var h=structuredClone(v)
h=moveArrayElement(h,l,p)
var g
v=[]
for(g=0;g<h.length;g++)v.push(structuredClone(h[g]))
for((0,r.set)(t.projectData,"compositions",v),g=0;g<t.projectData.compositions.length&&t.projectData.compositions[g].uid!=f;g++);t.setActiveComposition(g),(0,r.set)(e,"toggleForRefresh",!e.toggleForRefresh),(0,n.next)(function(){(0,r.set)(e,"toggleForRefresh",!e.toggleForRefresh),(0,n.next)(function(){e.doSortableCompositions()})})}e.controller.needSaving()}})}stopEditName(){}delete(){this.deleteComposition(this.controller.activeCompositionData)}duplicate(){var e=this,t=e.controller.activeCompositionData,o=t.name
openModal({h2:"Duplicate composition '"+o+"'?",callbackYes:function(){new compositionsUtils(e.controller,t,e.controller.projectData).duplicateComposition(),e.controller.needSaving()},yesButton:"yes",noButton:"cancel"})}deleteComposition(e){var t=this,o=t.controller,n=o.projectData.compositions
if(!(n.length<2)){var i=0
n.forEach(function(t,o){t==e&&(i=o)})
var a=e.uid,l=e.name
openModal({h2:"Delete composition '"+l+"'?",callbackYes:function(){console.log("delete composition")
var e=[...n.slice(0,i),...n.slice(i+1)];(0,r.set)(o.projectData,"compositions",e),(n=o.projectData.compositions).forEach(function(e){o.getters.getAllCompositionItems(e).forEach(function(t){"composition"==t.type&&t.compositionUid==a&&o.compositionManager.removeItemByCompUid(t.compUid,e.items)})}),t.openComposition(0),o.needSaving()},yesButton:"yes",noButton:"cancel"})}}},s(a.prototype,"addComposition",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"addComposition"),a.prototype),s(a.prototype,"openComposition",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"openComposition"),a.prototype),s(a.prototype,"delete",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"delete"),a.prototype),s(a.prototype,"duplicate",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"duplicate"),a.prototype),a);(0,t.setComponentTemplate)(c,u)}),define("pikimov/components/project/library/import-files",["exports","@ember/component","@glimmer/component","@ember/object","@ember/template-factory"],function(e,t,o,r,n){var i
function a(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const l=(0,n.createTemplateFactory)({id:"yHXAnaH/",block:'[[[10,0],[14,0,"import"],[12],[1,"\\n\\n"],[41,[51,[28,[37,2],[[28,[37,3],[[30,0,["library","length"]]],null],[30,0,["maxLibraryItems"]]],null]],[[[1,"        "],[8,[39,4],null,[["@label","@action","@accept","@multiple"],[[30,1],[30,0,["addFiles"]],[29,[[30,0,["accept"]]]],[30,2]]],null],[1,"\\n"]],[]],[[[1,"        "],[10,"br"],[12],[13],[1,"\\n        "],[10,1],[14,0,"warning"],[12],[1,"The library is full"],[13],[1,"\\n        "],[10,"br"],[12],[13],[1,"\\n"]],[]]],[1,"\\n"],[13],[1,"\\n"]],["@label","@multiple"],["div","unless","mt","plus-one","ui/file-input","br","span"]]',moduleName:"pikimov/components/project/library/import-files.hbs",isStrictMode:!1})
let s=e.default=(i=class extends o.default{constructor(){super(...arguments),a(this,"controller",null),a(this,"library",null),a(this,"accept",null),a(this,"maxLibraryItems",_config.maxLibraryItems)
var e=this
e.controller=e.args.controller,e.library=e.controller.projectData.library
var t=e.args.type,o="."+Object.values(_filesTypes).flat().join(",.")
"font"!=t&&(o=(o=o.replace(",.ttf","")).replace(",.woff","")),"sequence"==t&&(o=".png,.jpg,.jpeg,.webp,.avif,.tga"),"font"==t&&(o=".ttf,.woff"),(0,r.set)(e,"accept",o)}addFiles(){var e=this,t=e.args.parent
t&&t.close()
var o=e.controller.libraryManager,r=event.target.files
if(t&&"sequence"==t.currentType){var n=r.length
return 1==n?void openModal({h2:"You selected only 1 file",p:"Please select all the image sequence files"}):void openModal({h2:n+" files selected",p:"Is that ok?",callbackYes:function(){o.importSequence(r)},yesButton:"yes",noButton:"cancel"})}var i=[]
for(const a of r)i.push(a)
"font"==e.args.type&&e.controller.selectionUtils.holdFirstItem(),o.importFiles(i)}},c=i.prototype,u="addFiles",m=[r.action],p=Object.getOwnPropertyDescriptor(i.prototype,"addFiles"),d=i.prototype,f={},Object.keys(p).forEach(function(e){f[e]=p[e]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=m.slice().reverse().reduce(function(e,t){return t(c,u,e)||e},f),d&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(d):void 0,f.initializer=void 0),void 0===f.initializer&&Object.defineProperty(c,u,f),i)
var c,u,m,p,d,f;(0,t.setComponentTemplate)(l,s)}),define("pikimov/components/project/library/li-composition",["exports","@ember/component","@glimmer/component","@ember/object","@ember/template","@ember/template-factory"],function(e,t,o,r,n,i){var a,l
function s(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function c(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const u=(0,i.createTemplateFactory)({id:"V9ydRGZw",block:'[[[1,"\\n"],[10,"li"],[15,0,[29,[[52,[28,[37,2],[[30,1,["activeComposition","uid"]],[30,2,["uid"]]],null],"active"]," ",[52,[30,0,["isEditingName"]],"editName"]]]],[12],[1,"\\n    "],[10,1],[14,0,"thumb handle"],[12],[13],[1,"\\n    "],[11,1],[24,0,"content"],[4,[38,4],["click",[30,0,["openComposition"]]],null],[12],[1,"\\n\\n        "],[11,1],[24,0,"name"],[4,[38,4],["dblclick",[30,0,["editName"]]],null],[12],[1,[30,2,["name"]]],[13],[1,"\\n\\n        "],[8,[39,5],[[24,"placeholder","item name"],[24,"maxlength","20"],[4,[38,4],["blur",[30,0,["stopEditName"]]],null]],[["@type","@value","@enter"],["text",[30,2,["name"]],[30,0,["stopEditName"]]]],null],[1,"\\n\\n        "],[10,1],[14,0,"dev"],[12],[1,[30,2,["uid"]]],[13],[1,"\\n        "],[10,1],[14,0,"resolution"],[12],[1,[30,2,["dimensions","width"]]],[1,""],[1,[30,2,["dimensions","height"]]],[13],[1,"\\n\\n        "],[10,1],[14,0,"mmssms"],[12],[1,[30,0,["getMmssms"]]],[13],[1,"\\n\\n"],[41,[28,[37,2],[[30,2,["cameraType"]],"3D"],null],[[[1,"            "],[10,1],[14,0,"ddd"],[12],[1,"3D"],[13],[1,"\\n"]],[]],null],[1,"    "],[13],[1,"\\n"],[13],[1,"\\n"]],["@controller","@item"],["li","if","eq","span","on","input"]]',moduleName:"pikimov/components/project/library/li-composition.hbs",isStrictMode:!1})
let m=e.default=(a=(0,r.computed)("args.item.time.end","args.item.frameRate"),l=class extends o.default{constructor(){super(...arguments),s(this,"isEditingName",!1)}get getMmssms(){var e=this.args.item.time.end+1,t=this.args.item.frameRate,o=formatSeconds(e/t)
return(0,n.htmlSafe)(o)}openComposition(){var e=this,t=e.args.index
setTimeout(()=>{e.isEditingName||e.args.parent.openComposition(t)},300)}editName(){var e=$(event.target);(0,r.set)(this,"isEditingName",!0),e.parent().parent().addClass("editName")
var t=e.parent().find("input").first().focus()
t.focus(),t.select()}stopEditName(){var e=this
e.isEditingName&&e.args.parent.stopEditName(),(0,r.set)(e,"isEditingName",!1),e.args.parent.args.controller.needSaving()}},c(l.prototype,"getMmssms",[a],Object.getOwnPropertyDescriptor(l.prototype,"getMmssms"),l.prototype),c(l.prototype,"openComposition",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"openComposition"),l.prototype),c(l.prototype,"editName",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"editName"),l.prototype),c(l.prototype,"stopEditName",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"stopEditName"),l.prototype),l);(0,t.setComponentTemplate)(u,m)}),define("pikimov/components/project/library/library-item",["exports","@ember/component","@glimmer/component","@ember/object","@ember/template","@ember/template-factory"],function(e,t,o,r,n,i){var a
function l(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function s(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const c=(0,i.createTemplateFactory)({id:"alTPoD15",block:'[[[1,"\\n"],[11,"li"],[16,0,[29,[[52,[28,[37,2],[[30,1,["activeItem","libUid"]],[30,2,["libUid"]]],null],"active"]," ",[52,[30,0,["libManagerItem","isMissing"]],"missingItem"]]]],[16,"popovertarget",[29,["libPopover_",[30,2,["libUid"]]]]],[4,[38,3],["mouseenter",[30,0,["mouseenter"]]],null],[4,[38,3],["mouseleave",[30,0,["mouseleave"]]],null],[12],[1,"\\n    "],[10,1],[14,0,"thumb handle"],[12],[13],[1,"\\n    "],[11,1],[24,0,"content"],[16,"title",[29,[[30,2,["name"]]]]],[4,[38,3],["click",[28,[37,5],[[30,1,["selectItem"]],[30,2]],null]],null],[12],[1,"\\n        "],[10,1],[14,0,"type"],[12],[1,[30,0,["getIcon"]]],[13],[1,"\\n\\n        "],[10,"label"],[14,0,"name"],[12],[1,"\\n            "],[41,[28,[37,2],[[30,2,["type"]],"video"],null],[[[41,[30,2,["audioTracks"]],[[[10,"i"],[14,0,"bx bx-music"],[12],[13]],[]],null]],[]],null],[1,"\\n            "],[1,[30,2,["name"]]],[1,"\\n        "],[13],[1,"\\n        "],[10,1],[14,0,"dev"],[12],[1,[30,2,["libUid"]]],[13],[1,"\\n"],[1,"        "],[41,[28,[37,2],[[30,2,["type"]],"font"],null],[[[10,1],[14,0,"lorem"],[15,5,[28,[37,8],[[30,2,["name"]]],null]],[12],[1,"Lorem 1234"],[13]],[]],null],[1,"\\n        "],[41,[30,2,["duration"]],[[[10,1],[14,0,"mmssms"],[12],[1,[28,[35,9],[[30,2,["duration"]]],null]],[13]],[]],null],[1,"\\n    "],[13],[1,"\\n\\n    "],[10,0],[15,1,[29,["libPopover_",[30,2,["libUid"]]]]],[14,"popover","manual"],[12],[1,"\\n"],[1,"        "],[10,0],[12],[1,"\\n            "],[41,[30,0,["thumbnail"]],[[[10,0],[14,0,"thumbnail"],[12],[10,"img"],[15,"src",[29,[[30,0,["thumbnail","src"]]]]],[14,"alt","."],[12],[13],[13]],[]],null],[1,"\\n\\n"],[41,[28,[37,2],[[30,2,["type"]],"font"],null],[[[1,"                "],[10,"i"],[14,0,"bx bx-text"],[12],[13],[1,"\\n                "],[10,1],[14,0,"lorem"],[15,5,[28,[37,8],[[30,2,["name"]]],null]],[12],[1,"Lorem ipsum 1234"],[13],[1,"\\n"]],[]],null],[1,"            "],[41,[28,[37,2],[[30,2,["type"]],"model"],null],[[[10,"i"],[14,0,"bx bx-cube"],[12],[13]],[]],null],[1,"\\n            "],[41,[28,[37,2],[[30,2,["type"]],"audio"],null],[[[10,"i"],[14,0,"bx bx-music"],[12],[13]],[]],null],[1,"\\n            "],[41,[28,[37,2],[[30,2,["type"]],"imageSequence"],null],[[[10,"i"],[14,0,"bx bx-images"],[12],[13]],[]],null],[1,"\\n\\n            "],[41,[30,0,["libManagerItem","isMissing"]],[[[1,"missing file"]],[]],null],[1,"\\n        "],[13],[1,"\\n\\n        "],[10,2],[14,0,"type"],[12],[1,[30,0,["h_popover"]]],[13],[1,"  \\n\\n        "],[41,[30,2,["width"]],[[[10,1],[14,0,"resolution"],[12],[1,[30,2,["width"]]],[1,"  "],[1,[30,2,["height"]]],[13]],[]],null],[1,"\\n        "],[41,[30,2,["duration"]],[[[10,1],[14,0,"mmssms"],[12],[1,[28,[35,9],[[30,2,["duration"]]],null]],[13]],[]],null],[1,"\\n\\n        "],[41,[28,[37,2],[[30,2,["type"]],"model"],null],[[[10,1],[14,0,"tris"],[12],[1,[30,2,["tris"]]],[10,"i"],[14,0,"bx bx-shape-triangle"],[12],[13],[13]],[]],null],[1,"\\n        "],[10,2],[12],[1,[30,0,["p_popover"]]],[13],[1,"\\n    "],[13],[1,"\\n\\n"],[13],[1,"\\n   "]],["@parent","@item"],["li","if","eq","on","span","fn","label","i","css-font-family","format-duration","div","img","p"]]',moduleName:"pikimov/components/project/library/library-item.hbs",isStrictMode:!1})
let u=e.default=(a=class extends o.default{constructor(){super(...arguments),l(this,"controller",null),l(this,"item",null),l(this,"libManagerItem",null),l(this,"thumbnail",null),l(this,"h_popover",null),l(this,"p_popover",null)
var e=this
e.controller=e.args.controller,e.item=e.args.item,e.libManagerItem=e.controller.getters.getLibraryManagerItemByLibUid(e.item.libUid)
var t=e.item.type
"model"==t&&(t="3D model"),"imageSequence"==t&&(t="image sequence"),"gaussianSplat"==t&&(t="gaussian splat"),e.h_popover=t}get getIcon(){var e=null,t=this.item.type
return"image"==t&&(e="bx-image-alt"),"svg"==t&&(e="bx-image-alt"),"video"==t&&(e="bx-movie-play"),"font"==t&&(e="bx-text"),"model"==t&&(e="bx-cube"),"audio"==t&&(e="bx-music"),"imageSequence"==t&&(e="bx-images"),"gaussianSplat"==t&&(e="bx-droplet"),e?(0,n.htmlSafe)('<i class="bx '+e+'"></i>'):null}getPopoverText(){var e=this.item,t="",o=e.filesize
o&&(t+=o<2097152?" "+Math.floor(o/1024)+" KB\n":" "+roundValue(o/1024/1024,1)+" MB\n"),e.frameRate&&(t+=e.frameRate+" fps\n"),e.nbAudioChannels&&(1==e.nbAudioChannels&&(t+="mono\n"),2==e.nbAudioChannels&&(t+="stereo\n"),e.nbAudioChannels>2&&(t+=e.nbAudioChannels+" audio channels\n"))
var r=this.libManagerItem.getNbTimesUsed()
return t+="\n",0==r&&(t+="not used on project"),1==r&&(t+="used 1 time"),r>1&&(t+="used "+r+" times"),t}mouseenter(){var e=this
if(e.controller.uiManager.draggingFromProject)return;(0,r.set)(e,"p_popover",e.getPopoverText()),e.thumbnail||e.libManagerItem&&e.libManagerItem.thumbnail&&(0,r.set)(e,"thumbnail",e.libManagerItem.thumbnail)
const t=document.querySelector("#libPopover_"+e.item.libUid)
if("landscape"==e.controller.workspace){var o=document.getElementById("projectTop").offsetHeight
t.style.top=o-180+"px"}else{o=document.getElementById("columns").offsetHeight
t.style.top=o-180+"px"
var n=e.controller.uiManager.sw-e.controller.uiManager.projectRight_w-170
t.style.left=n+"px"}t.showPopover()}mouseleave(){document.querySelector("#libPopover_"+this.item.libUid).hidePopover()}},s(a.prototype,"mouseenter",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"mouseenter"),a.prototype),s(a.prototype,"mouseleave",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"mouseleave"),a.prototype),a);(0,t.setComponentTemplate)(c,u)}),define("pikimov/components/project/library/library",["exports","@ember/component","@glimmer/component","@ember/object","@ember/runloop","@ember/object/observers","@ember/template-factory"],function(e,t,o,r,n,i,a){var l
function s(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function c(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const u=(0,a.createTemplateFactory)({id:"IVk4HLjO",block:'[[[10,0],[14,1,"library"],[12],[1,"\\n\\n    "],[10,0],[12],[1,"\\n"],[41,[30,1,["projectData","credits"]],[[[1,"        "],[8,[39,2],null,null,[["default"],[[[[1,[30,1,["projectData","credits","text"]]],[1,"\\n"],[42,[28,[37,4],[[28,[37,4],[[30,1,["projectData","credits","links"]]],null]],null],null,[[[1,"                "],[10,3],[15,6,[29,[[30,2,["href"]]]]],[14,"target","_blank"],[12],[1,[30,2,["text"]]],[13],[1,"\\n"]],[2]],null],[1,"        "]],[]]]]],[1,"\\n        "],[10,"br"],[12],[13],[1,"\\n"]],[]],null],[1,"\\n        "],[8,[39,7],null,[["@label","@value","@action"],["background color",[30,1,["projectData","background"]],[30,0,["editBackground"]]]],null],[1,"\\n\\n"],[41,[28,[37,8],null,null],[[[1,"        "],[8,[39,9],null,[["@label","@obj","@objProperty","@valueToTrackBoolean","@action"],["transparent background",[30,1,["projectData"]],"transparent",[30,1,["projectData","transparent"]],[30,0,["editCheckBoxTransparent"]]]],null],[1,"\\n"]],[]],null],[1,"    "],[13],[1,"\\n\\n"],[1,"    "],[8,[39,10],null,[["@controller"],[[30,1]]],null],[1,"\\n\\n    "],[10,0],[14,1,"projectFiles"],[12],[1,"\\n        "],[8,[39,11],null,[["@noBorder"],[true]],[["default"],[[[[1,"Library files"],[10,1],[14,0,"dev"],[12],[1,"x"],[1,[30,1,["projectData","library","length"]]],[13]],[]]]]],[1,"\\n\\n"],[41,[28,[37,13],[[28,[37,14],[[30,1,["projectData","library","length"]]],null],[30,0,["maxLibraryItems"]]],null],[[[1,"            "],[10,1],[14,0,"warning"],[12],[1,"The library is full (max "],[1,[30,0,["maxLibraryItems"]]],[1," files)"],[13],[1,"\\n            "],[10,"br"],[12],[13],[1,"\\n"]],[]],null],[1,"\\n        "],[11,"ul"],[24,1,"libraryItems"],[24,0,"notranslate"],[4,[38,16],["dblclick",[30,0,["libraryDoubleClick"]]],null],[12],[1,"\\n"],[42,[28,[37,4],[[28,[37,4],[[30,1,["projectData","library"]]],null]],null],null,[[[1,"            "],[8,[39,17],null,[["@controller","@parent","@item"],[[30,1],[30,0],[30,3]]],null],[1,"\\n"]],[3]],null],[1,"        "],[13],[1,"\\n\\n        "],[10,0],[14,0,"toolBar files"],[12],[1,"\\n"],[41,[30,0,["activeItem"]],[[[1,"            "],[11,1],[24,0,"buttonIcon tooltip"],[4,[38,16],["click",[30,0,["remove"]]],null],[12],[10,"i"],[14,0,"fa fa-trash-o"],[12],[13],[10,1],[14,0,"tooltiptext p85"],[12],[1,"Remove file from project"],[13],[13],[1,"\\n            "],[11,1],[24,0,"buttonIcon tooltip"],[4,[38,16],["click",[30,0,["replace"]]],null],[12],[10,"i"],[14,0,"fa fa-refresh"],[12],[13],[10,1],[14,0,"tooltiptext p85"],[12],[1,"Choose another file as source"],[13],[13],[1,"\\n"]],[]],null],[1,"        "],[13],[1,"\\n\\n    "],[13],[1,"\\n"],[1,"\\n"],[41,[30,0,["doubleClicked"]],[[[1,"        "],[10,0],[14,5,"display:none;"],[12],[1,"\\n"],[1,"            "],[8,[39,19],null,[["@controller","@parent","@multiple"],[[30,1],null,true]],null],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[13],[1,"\\n"]],["@controller","item","item"],["div","if","ui/property-note","each","-track-array","a","br","ui/property-color","is-debug","ui/property-checkbox","project/library/compositions","ui/property-title","span","mt","plus-one","ul","on","project/library/library-item","i","project/library/import-files"]]',moduleName:"pikimov/components/project/library/library.hbs",isStrictMode:!1})
let m=e.default=(l=class extends o.default{constructor(){super(...arguments),s(this,"controller",null),s(this,"activeItem",null),s(this,"doubleClicked",!1),s(this,"maxLibraryItems",_config.maxLibraryItems)
var e=this
e.controller=e.args.controller,(0,i.addObserver)(e,"controller.projectData.library.length",e.onLibraryChanged),e.onLibraryChanged()}onLibraryChanged(){var e=this;(0,n.next)(function(){e.doSortableLibraryItems()})}editBackground(){var e=this.controller;(0,n.next)(function(){e.compositionManager.updateBgColorAndGrid(),e.refreshAndRender()}),e.addToHistory("item","edit background color")}editCheckBoxTransparent(e,t,o){var n=this.controller,i=n.projectData
i.transparent?(0,r.set)(i,"transparent",o):(0,r.set)(i,"transparent",!0),n.selectionUtils.saveHoldCurrentSelection(),n.reopenComposition()}async replaceFile(){var e,t=this,o=t.activeItem.libUid,r=-1
if(t.controller.projectData.library.forEach(function(e,t){e.libUid==o&&(r=t)}),-1!=r)try{const o={types:[{description:"Project library file",accept:_filesAccept}]};[e]=await window.showOpenFilePicker(o)
const n=await e.getFile()
t.controller.libraryManager.importOneFile(n,!1,r),t.selectItem(null),t.controller.needSaving()}catch(n){if("AbortError"==n.name)return void console.log("replaceFile: File picker was aborted by the user")
console.error("Error replacing library file:",n),alert("Error replacing library file")}else console.log("error no selected lib item")}doSortableLibraryItems(){var e=this.controller
function t(e,t,o){const r=o.getBoundingClientRect()
return e>=r.left&&e<=r.right&&t>=r.top&&t<=r.bottom}var o=document.querySelector("#libraryItems")
if(o)Sortable.create(o,{handle:".handle",animation:150,onStart:function(t){const o=document.querySelector("#libraryItems [popover]:popover-open")
o&&o.hidePopover(),e.uiManager.draggingFromProject=!0},onEnd:function(o){var i=o.item,a=o.oldIndex,l=o.newIndex,s=o.originalEvent.clientX,c=o.originalEvent.clientY
e.isCompositionReady||console.log("boom no element")
var u=t(s,c,document.querySelector("#leftColumn .body")),m=t(s,c,document.querySelector("#libraryItems"))
if(u&&m){i.remove()
var p,d=e.projectData.library,f=structuredClone(d)
for(f=moveArrayElement(f,a,l),d.splice(0,d.length),p=0;p<f.length;p++){var v=[...e.projectData.library,structuredClone(f[p])];(0,r.set)(e.projectData,"library",v)}e.needSaving()}else{i.remove(),(0,n.next)(function(){(0,r.set)(e.projectData,"library",structuredClone(e.projectData.library))})
var h=e.projectData.library[a],g=t(s,c,document.querySelector("#overItemsInputs")),y=t(s,c,document.querySelector("#composition"));(g||y)&&e.libraryManager.addLibItemToComposition(h)}}})}selectItem(e){(0,r.set)(this,"activeItem",e)}replace(){this.replaceFile()}remove(){var e=this,t=e.controller,o=e.activeItem.libUid,r=t.getters.getLibraryManagerItemByLibUid(o).getNbTimesUsed(),n=null
t.projectData.library.forEach(function(e){e.libUid==o&&(n=e)})
var i=null
r>0&&(i="It will be removed from all compositions"),openModal({h2:"remove '"+n.name+"' from the project?",p:i,callbackYes:function(){r>0&&t.selectionUtils.clearSelection(),t.libraryManager.removeItem(n,r),t.historyUtils.clearHistory(),t.needSaving(),e.selectItem(null)},yesButton:"yes",noButton:"cancel"})}libraryDoubleClick(){gaEvent({event:"library DoubleClick"});(0,r.set)(this,"doubleClicked",!0),(0,n.next)(function(){$('#library input[type="file"]').click()})}},c(l.prototype,"editBackground",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"editBackground"),l.prototype),c(l.prototype,"editCheckBoxTransparent",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"editCheckBoxTransparent"),l.prototype),c(l.prototype,"selectItem",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"selectItem"),l.prototype),c(l.prototype,"replace",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"replace"),l.prototype),c(l.prototype,"remove",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"remove"),l.prototype),c(l.prototype,"libraryDoubleClick",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"libraryDoubleClick"),l.prototype),l);(0,t.setComponentTemplate)(u,m)}),define("pikimov/components/project/main-header/main-header",["exports","@ember/component","@glimmer/component","@ember/object","@ember/runloop","@ember/template-factory"],function(e,t,o,r,n,i){var a,l
function s(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function c(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const u=(0,i.createTemplateFactory)({id:"2uD8gMd7",block:'[[[11,3],[24,0,"button"],[24,1,"b_patreon"],[24,6,"https://www.patreon.com/pikilipita"],[24,"target","_blank"],[24,"draggable","false"],[4,[38,1],["click",[30,1,["clickPatreonButton"]]],null],[12],[10,"img"],[14,"src","images/logo-patreon.png"],[14,"alt","Patreon logo"],[12],[13],[1,"Support on Patreon"],[13],[1,"\\n\\n"],[11,1],[24,0,"button"],[24,1,"b_bug"],[4,[38,1],["click",[30,0,["reportABug"]]],null],[12],[10,"i"],[14,0,"bx bx-bug"],[12],[13],[1,"Report a bug"],[13],[1,"\\n"],[10,1],[14,0,"button"],[14,1,"b_fullScreen"],[12],[10,"i"],[14,0,"bx bx-fullscreen"],[12],[13],[1,"Full screen"],[13],[1,"\\n\\n"],[10,"header"],[15,0,[29,[[52,[30,1,["unsaved"]],"unsaved"]]]],[12],[1,"\\n\\n    "],[11,"img"],[24,"src","images/logo-pikimov.png"],[24,"alt","pikimov logo"],[24,0,"logo"],[4,[38,1],["click",[30,0,["backToHome"]]],null],[12],[13],[1,"\\n    "],[10,1],[14,0,"r"],[12],[1,"v4"],[13],[1,"\\n\\n"],[1,"    "],[10,0],[14,0,"dropdown file"],[12],[1,"\\n        "],[10,"button"],[14,0,"dropbtn"],[12],[1,"File"],[13],[1,"\\n        "],[10,0],[14,0,"dropdown-content"],[12],[1,"\\n            "],[11,1],[4,[38,1],["click",[30,0,["newProject"]]],null],[12],[1,"New project"],[13],[1,"\\n            "],[11,1],[4,[38,1],["click",[30,0,["openProjectList"]]],null],[12],[1,"Open project"],[13],[1,"\\n            "],[11,1],[16,0,[29,["save ",[52,[51,[30,1,["unsaved"]]],"disabled"]]]],[4,[38,1],["click",[30,0,["actionSave"]]],null],[12],[1,"Save"],[13],[1,"\\n            "],[11,1],[4,[38,1],["click",[30,0,["actionSaveAs"]]],null],[12],[1,"Save project as"],[13],[1,"\\n        "],[13],[1,"\\n    "],[13],[1,"\\n\\n    "],[10,0],[14,0,"dropdown prefs"],[12],[1,"\\n        "],[10,"button"],[14,0,"dropbtn"],[12],[1,"Preferences"],[13],[1,"\\n        "],[10,0],[14,0,"dropdown-content"],[12],[1,"\\n            "],[11,1],[4,[38,1],["click",[28,[37,10],[[30,0,["setWorkspace"]],"landscape"],null]],null],[12],[1,"horizontal workspace"],[13],[1,"\\n            "],[11,1],[4,[38,1],["click",[28,[37,10],[[30,0,["setWorkspace"]],"portrait"],null]],null],[12],[1,"vertical workspace"],[13],[1,"\\n        "],[13],[1,"\\n    "],[13],[1,"\\n\\n    "],[10,0],[14,0,"dropdown tools"],[12],[1,"\\n        "],[10,"button"],[14,0,"dropbtn"],[12],[1,"Tools"],[13],[1,"\\n        "],[10,0],[14,0,"dropdown-content"],[12],[1,"\\n            "],[11,1],[4,[38,1],["click",[30,0,["openMotionTracking"]]],null],[12],[1,"Motion tracking"],[13],[1,"\\n            "],[11,1],[4,[38,1],["click",[30,0,["openTranscribe"]]],null],[12],[1,"Subtitle generator"],[13],[1,"\\n            "],[11,1],[4,[38,1],["click",[30,0,["openRemoveBg"]]],null],[12],[1,"Remove background"],[13],[1,"\\n"],[41,[28,[37,11],null,null],[[[1,"            "],[11,1],[4,[38,1],["click",[30,0,["openDepthEstimation"]]],null],[12],[1,"Depth estimation"],[13],[1,"\\n"]],[]],null],[1,"        "],[13],[1,"\\n    "],[13],[1,"\\n\\n    "],[11,1],[24,0,"nav"],[4,[38,1],["click",[30,0,["openDemosList"]]],null],[12],[1,"Demo projects"],[13],[1,"\\n\\n    "],[11,1],[24,0,"nav tutorials"],[4,[38,1],["click",[30,0,["toogleTutorials"]]],null],[12],[1,"Tutorials"],[13],[1,"\\n\\n    "],[11,1],[24,0,"nav learn"],[4,[38,1],["click",[30,0,["toogleLearn"]]],null],[12],[1,"Learn the basics\\n\\n"],[41,[30,0,["isCompositionEmpty"]],[[[1,"            "],[10,0],[14,0,"tutorial animated emptyComposition"],[12],[1,"Learn the basics"],[13],[1,"\\n"]],[]],null],[1,"\\n    "],[13],[1,"\\n\\n    "],[10,3],[14,0,"nav docs"],[14,6,"https://docs.pikimov.com"],[14,"target","_blank"],[12],[1,"Documentation"],[13],[1,"\\n    \\n    "],[10,1],[14,0,"nav help"],[12],[1,"Keyboard shortcuts"],[13],[1,"\\n\\n\\n\\n    "],[10,0],[14,0,"socialButtons"],[12],[1,"\\n        "],[10,3],[14,0,"twitter"],[14,6,"https://twitter.com/pikilipita"],[14,"target","_blank"],[12],[10,"i"],[14,0,"fa fa-twitter"],[12],[13],[13],[1,"\\n        "],[10,3],[14,0,"bluesky"],[14,6,"https://bsky.app/profile/pikilipita.com"],[14,"target","_blank"],[12],[10,"img"],[14,"src","images/icon-bluesky-header.svg"],[14,"alt","bluesky"],[12],[13],[13],[1,"\\n        "],[10,3],[14,0,"reddit"],[14,6,"https://www.reddit.com/r/pikimov/"],[14,"target","_blank"],[12],[10,"img"],[14,"src","images/icon-reddit-header.svg"],[14,"alt","reddit"],[12],[13],[13],[1,"\\n        "],[10,3],[14,0,"discord"],[14,6,"https://discord.gg/DhNcC7GQn7"],[14,"target","_blank"],[12],[10,"img"],[14,"src","images/icon-discord-header.svg"],[14,"alt","discord"],[12],[13],[13],[1,"\\n    "],[13],[1,"\\n\\n"],[41,[28,[37,11],null,null],[[[1,"        "],[10,0],[14,0,"debugButtons"],[12],[1,"\\n            "],[11,1],[24,1,"b_dev"],[24,0,"button"],[4,[38,1],["click",[30,0,["toggleDev"]]],null],[12],[1,"dev"],[13],[1,"\\n            "],[11,1],[24,0,"button"],[4,[38,1],["click",[28,[37,10],[[30,0,["doBenchmark"]],50],null]],null],[12],[1,"bm 50"],[13],[1,"\\n            "],[11,1],[24,0,"button"],[4,[38,1],["click",[28,[37,10],[[30,0,["doBenchmark"]],100],null]],null],[12],[1,"bm 100"],[13],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["isTutorialsVisible"]],[[[1,"        "],[8,[39,12],null,[["@parent"],[[30,0]]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["isLearnVisible"]],[[[1,"        "],[8,[39,13],null,[["@parent"],[[30,0]]],null],[1,"\\n"]],[]],null],[1,"\\n"],[13],[1,"\\n"],[41,[30,1,["isShortcutsOpen"]],[[[1,"    "],[8,[39,14],null,[["@controller"],[[30,1]]],null],[1,"\\n"]],[]],null]],["@controller"],["a","on","img","span","i","header","if","div","button","unless","fn","is-debug","project/tutorials/tutorials","project/learn/animation","project/main-header/shortcuts-table"]]',moduleName:"pikimov/components/project/main-header/main-header.hbs",isStrictMode:!1})
let m=e.default=(a=(0,r.computed)("args.controller.isCompositionReady","args.controller.activeComposition.items.length"),l=class extends o.default{constructor(){super(...arguments),s(this,"controller",null),s(this,"isTutorialsVisible",!1),s(this,"isLearnVisible",!1)
var e=this
e.controller=e.args.controller,(0,n.next)(function(){$("header .nav.help").on("mouseover",function(){(0,r.set)(e.controller,"isShortcutsOpen",!0),setTimeout(()=>{e.controller.isShortcutsOpen&&gaEvent({event:"show header Shortcuts"})},2e3)}),$("header .nav.help").on("mouseout",function(){(0,r.set)(e.controller,"isShortcutsOpen",!1)})})}get isCompositionEmpty(){var e=this.controller
if(!e.isCompositionReady)return!1
var t=e.compositionManager.cameraType
if(null!==localStorage.getItem("pikimov_nbProjectsCreated")&&1*localStorage.getItem("pikimov_nbProjectsCreated")>=3)return!1
return"2D"==t&&0==e.activeCompositionData.items.length||"3D"==t&&e.activeCompositionData.items.length<2}hideDropDown(){var e=$("#project > header .dropdown-content")
e.addClass("clicked"),setTimeout(function(){e.removeClass("clicked")},100)}newProject(){this.controller.toggleProperty("isNewProjectDialogOpen")}openProjectList(){this.controller.toggleProperty("isProjectsListOpen")}openDemosList(){this.controller.toggleProperty("isDemosListOpen")}actionSaveAs(){this.hideDropDown(),this.controller.projectUtils.saveAs()}actionSave(){this.hideDropDown(),this.controller.unsaved?this.controller.projectUtils.save():console.log("no need for saving")}openMotionTracking(){this.controller.closeAllmenus(),(0,r.set)(this.controller,"currentTool","motionTracking")}openTranscribe(){this.controller.closeAllmenus(),(0,r.set)(this.controller,"currentTool","transcribe")}openRemoveBg(){this.controller.closeAllmenus(),(0,r.set)(this.controller,"currentTool","removeBg")}openDepthEstimation(){this.controller.closeAllmenus(),(0,r.set)(this.controller,"currentTool","depthEstimation")}reportABug(){var e="You can report bugs to this email address: \npikilipita@pikilipita.com"
e+="\n\nIt helps a lot if you specify which operating system \nand web browser you are using.",e+="\n\n",e+="Your browser is most probably \n"+_browser.name+", version "+_browser.version,openModal({h2:"Report a bug",p:e})}toggleDev(){$(document.body).toggleClass("dev"),$("body .dev").toggle()}autosave(){_autosaveUtils.saveProject()}doCheck(){var e=this.controller.controlsUtils.transformControls
e.setSpace("local"===e.space?"world":"local"),this.controller.compositionManager.requestRender()}doBenchmark(e){this.controller.playbackUtils.doBenchmark(e)}toogleTutorials(){var e=this;(0,r.set)(e,"isTutorialsVisible",!e.isTutorialsVisible),e.isTutorialsVisible&&gaEvent({event:"show header Tutorials"})}toogleLearn(){var e=this;(0,r.set)(e,"isLearnVisible",!e.isLearnVisible),e.isLearnVisible&&gaEvent({event:"show header Learn"})}setWorkspace(e){var t=this.controller
t.workspace!=e&&(console.log("set Workspace",e),(0,r.set)(t,"workspace",e),(0,n.next)(function(){t.reopenComposition(),t.uiManager.setBestGrid()}))}backToHome(){openModal({h2:"Back to homepage?",callbackYes:function(){window.location="https://pikimov.com"},yesButton:"yes",noButton:"cancel"})}},c(l.prototype,"isCompositionEmpty",[a],Object.getOwnPropertyDescriptor(l.prototype,"isCompositionEmpty"),l.prototype),c(l.prototype,"newProject",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"newProject"),l.prototype),c(l.prototype,"openProjectList",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"openProjectList"),l.prototype),c(l.prototype,"openDemosList",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"openDemosList"),l.prototype),c(l.prototype,"actionSaveAs",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"actionSaveAs"),l.prototype),c(l.prototype,"actionSave",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"actionSave"),l.prototype),c(l.prototype,"openMotionTracking",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"openMotionTracking"),l.prototype),c(l.prototype,"openTranscribe",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"openTranscribe"),l.prototype),c(l.prototype,"openRemoveBg",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"openRemoveBg"),l.prototype),c(l.prototype,"openDepthEstimation",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"openDepthEstimation"),l.prototype),c(l.prototype,"reportABug",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"reportABug"),l.prototype),c(l.prototype,"toggleDev",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"toggleDev"),l.prototype),c(l.prototype,"autosave",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"autosave"),l.prototype),c(l.prototype,"doCheck",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"doCheck"),l.prototype),c(l.prototype,"doBenchmark",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"doBenchmark"),l.prototype),c(l.prototype,"toogleTutorials",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"toogleTutorials"),l.prototype),c(l.prototype,"toogleLearn",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"toogleLearn"),l.prototype),c(l.prototype,"setWorkspace",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"setWorkspace"),l.prototype),c(l.prototype,"backToHome",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"backToHome"),l.prototype),l);(0,t.setComponentTemplate)(u,m)}),define("pikimov/components/project/main-header/shortcuts-table",["exports","@ember/component","@glimmer/component","@ember/template-factory"],function(e,t,o,r){function n(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const i=(0,r.createTemplateFactory)({id:"/RVG2jEj",block:'[[[1,"\\n"],[10,0],[14,1,"shortCuts"],[12],[1,"\\n\\n"],[10,0],[12],[1,"\\n    "],[10,0],[14,0,"when"],[12],[1,"\\n        Generic shortcuts\\n    "],[13],[1,"\\n    "],[10,0],[14,0,"what"],[12],[1,"\\n        play / pause"],[10,"br"],[12],[13],[1,"\\n        move composition around"],[10,"br"],[12],[13],[1,"\\n        previous frame"],[10,"br"],[12],[13],[1,"\\n        next frame"],[10,"br"],[12],[13],[1,"\\n        jump back 10 frames"],[10,"br"],[12],[13],[1,"\\n        jump 10 frames"],[10,"br"],[12],[13],[1,"\\n        zoom in"],[10,"br"],[12],[13],[1,"\\n        zoom out"],[10,"br"],[12],[13],[1,"\\n        save project"],[10,"br"],[12],[13],[1,"\\n    "],[13],[1,"\\n    "],[10,0],[14,0,"key"],[12],[1,"\\n        "],[10,1],[14,0,"keyboard"],[12],[1,"Space"],[13],[10,"br"],[12],[13],[1,"\\n        hold "],[10,1],[14,0,"keyboard"],[12],[1,"Space"],[13],[1," + drag"],[10,"br"],[12],[13],[1,"\\n        "],[10,1],[14,0,"keyboard"],[12],[1,[30,0,["ctrlKey"]]],[13],[10,1],[14,0,"keyboard"],[12],[1,""],[13],[10,"br"],[12],[13],[1,"\\n        "],[10,1],[14,0,"keyboard"],[12],[1,[30,0,["ctrlKey"]]],[13],[10,1],[14,0,"keyboard"],[12],[1,""],[13],[10,"br"],[12],[13],[1,"\\n        "],[10,1],[14,0,"keyboard"],[12],[1,[30,0,["ctrlKey"]]],[13],[10,1],[14,0,"keyboard"],[12],[1,"Shift"],[13],[10,1],[14,0,"keyboard"],[12],[1,""],[13],[10,"br"],[12],[13],[1,"\\n        "],[10,1],[14,0,"keyboard"],[12],[1,[30,0,["ctrlKey"]]],[13],[10,1],[14,0,"keyboard"],[12],[1,"Shift"],[13],[10,1],[14,0,"keyboard"],[12],[1,""],[13],[10,"br"],[12],[13],[1,"\\n        "],[10,1],[14,0,"keyboard"],[12],[1,[30,0,["ctrlKey"]]],[13],[10,1],[14,0,"keyboard"],[12],[1,"+"],[13],[10,"br"],[12],[13],[1,"\\n        "],[10,1],[14,0,"keyboard"],[12],[1,[30,0,["ctrlKey"]]],[13],[10,1],[14,0,"keyboard"],[12],[1,"-"],[13],[10,"br"],[12],[13],[1,"\\n        "],[10,1],[14,0,"keyboard"],[12],[1,[30,0,["ctrlKey"]]],[13],[10,1],[14,0,"keyboard"],[12],[1,"S"],[13],[10,"br"],[12],[13],[1,"\\n    "],[13],[1,"\\n\\n    "],[10,0],[14,0,"when"],[12],[1,"\\n        On selected items\\n    "],[13],[1,"\\n    "],[10,0],[14,0,"what"],[12],[1,"\\n        duplicate items"],[10,"br"],[12],[13],[1,"\\n        remove items"],[10,"br"],[12],[13],[1,"\\n        previous visible key"],[10,"br"],[12],[13],[1,"\\n        next visible key"],[10,"br"],[12],[13],[1,"\\n        toggle visibility"],[10,"br"],[12],[13],[1,"\\n        toggle keys visibility"],[10,"br"],[12],[13],[1,"\\n    "],[13],[1,"\\n    "],[10,0],[14,0,"key"],[12],[1,"\\n        "],[10,1],[14,0,"keyboard"],[12],[1,[30,0,["ctrlKey"]]],[13],[10,1],[14,0,"keyboard"],[12],[1,"D"],[13],[10,"br"],[12],[13],[1,"\\n        "],[10,1],[14,0,"keyboard"],[12],[1,[30,0,["deleteKey"]]],[13],[10,"br"],[12],[13],[1,"\\n        "],[10,1],[14,0,"keyboard"],[12],[1,"J"],[13],[10,"br"],[12],[13],[1,"\\n        "],[10,1],[14,0,"keyboard"],[12],[1,"K"],[13],[10,"br"],[12],[13],[1,"\\n        "],[10,1],[14,0,"keyboard"],[12],[1,"H"],[13],[10,"br"],[12],[13],[1,"\\n        "],[10,1],[14,0,"keyboard"],[12],[1,"U"],[13],[10,"br"],[12],[13],[1,"\\n    "],[13],[1,"\\n\\n"],[41,[28,[37,4],[[30,1,["compositionManager","cameraType"]],"2D"],null],[[[1,"    "],[10,0],[14,0,"when"],[12],[1,"\\n        While moving items\\n    "],[13],[1,"\\n    "],[10,0],[14,0,"what"],[12],[1,"         \\n        lock on x or y axis"],[10,"br"],[12],[13],[1,"\\n    "],[13],[1,"\\n    "],[10,0],[14,0,"key"],[12],[1,"\\n        hold "],[10,1],[14,0,"keyboard"],[12],[1,"Shift"],[13],[1," + drag"],[10,"br"],[12],[13],[1,"                 \\n    "],[13],[1,"\\n\\n    "],[10,0],[14,0,"when"],[12],[1,"\\n        While rotating items\\n    "],[13],[1,"\\n    "],[10,0],[14,0,"what"],[12],[1,"         \\n        snap to 45 steps"],[10,"br"],[12],[13],[1,"\\n    "],[13],[1,"\\n    "],[10,0],[14,0,"key"],[12],[1,"\\n        hold "],[10,1],[14,0,"keyboard"],[12],[1,"Shift"],[13],[1," + drag"],[10,"br"],[12],[13],[1,"                 \\n    "],[13],[1,"\\n\\n    "],[10,0],[14,0,"when"],[12],[1,"\\n        While scaling items\\n    "],[13],[1,"\\n    "],[10,0],[14,0,"what"],[12],[1,"         \\n        free aspect ratio scaling"],[10,"br"],[12],[13],[1,"\\n    "],[13],[1,"\\n    "],[10,0],[14,0,"key"],[12],[1,"\\n        hold "],[10,1],[14,0,"keyboard"],[12],[1,"Shift"],[13],[1," + drag"],[10,"br"],[12],[13],[1,"                 \\n    "],[13],[1,"\\n"]],[]],null],[13],[1,"\\n\\n"],[13],[1,"\\n"]],["@controller"],["div","br","span","if","eq"]]',moduleName:"pikimov/components/project/main-header/shortcuts-table.hbs",isStrictMode:!1})
class a extends o.default{constructor(){super(...arguments),n(this,"ctrlKey","Ctrl"),n(this,"deleteKey","Delete"),"macos"==_browser.os&&(this.ctrlKey="",this.deleteKey="")}}e.default=a,(0,t.setComponentTemplate)(i,a)}),define("pikimov/components/project/new/new",["exports","@ember/component","@glimmer/component","@ember/object","@ember/runloop","@ember/template-factory"],function(e,t,o,r,n,i){var a,l
function s(e,t,o){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,o)}function c(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function u(e,t,o){return e.set(m(e,t),o),o}function m(e,t,o){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:o
throw new TypeError("Private element is not present on this object")}function p(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const d=(0,i.createTemplateFactory)({id:"OQ14KRB/",block:'[[[10,0],[14,1,"newProjectDialog"],[15,0,[29,["modal ",[30,1]]]],[12],[1,"\\n\\n    "],[10,0],[12],[1,"\\n        "],[10,"h2"],[12],[1,[30,2]],[13],[1,"\\n\\n        "],[10,0],[14,0,"grid"],[12],[1,"\\n\\n            "],[10,0],[12],[1,"\\n"],[41,[30,0,["config","allow3D"]],[[[1,"                    "],[8,[39,3],null,null,[["default"],[[[[1,"Camera space"]],[]]]]],[1,"\\n                    "],[10,"ul"],[14,1,"cameraType"],[12],[1,"\\n                        "],[11,"li"],[16,0,[29,[[52,[28,[37,6],[[30,0,["selectedCameraType"]],1],null],"active"]]]],[4,[38,7],["click",[28,[37,8],[[30,0,["selectCameraType"]],1],null]],null],[12],[1,"\\n                            "],[10,1],[14,0,"name"],[12],[1,"2D"],[13],[1,"\\n                            "],[10,2],[12],[1,"Classic editing, items are set up "],[10,"br"],[12],[13],[1,"in a 2D space (x,y)"],[13],[1,"\\n                        "],[13],[1,"\\n                        "],[11,"li"],[16,0,[29,[[52,[28,[37,6],[[30,0,["selectedCameraType"]],2],null],"active"]]]],[4,[38,7],["click",[28,[37,8],[[30,0,["selectCameraType"]],2],null]],null],[12],[1,"\\n                            "],[10,1],[14,0,"name"],[12],[1,"3D"],[13],[1,"\\n                            "],[10,2],[12],[1,"Camera and items are set up "],[10,"br"],[12],[13],[1,"in a 3D space (x,y,z)"],[13],[1,"\\n                        "],[13],[1,"\\n                    "],[13],[1,"\\n"]],[]],null],[1,"            "],[13],[1,"\\n\\n            "],[10,0],[12],[1,"\\n                "],[8,[39,3],null,null,[["default"],[[[[1,"Presets"]],[]]]]],[1,"\\n\\n                "],[10,"ul"],[14,1,"presets"],[12],[1,"\\n"],[42,[28,[37,13],[[28,[37,13],[[30,0,["presets"]]],null]],null],null,[[[1,"                    "],[11,"li"],[16,0,[29,[[30,3,["cssClass"]]," ",[52,[28,[37,6],[[30,0,["selectedPreset"]],[30,4]],null],"active"]]]],[4,[38,7],["click",[28,[37,8],[[30,0,["selectPreset"]],[30,4]],null]],null],[12],[1,"\\n                        "],[10,1],[14,0,"name"],[12],[1,[30,3,["name"]]],[13],[1,"\\n                        "],[10,1],[14,0,"dimensions"],[12],[1,[30,3,["dimensions","width"]]],[1,"  "],[1,[30,3,["dimensions","height"]]],[13],[1,"\\n                        "],[1,[30,3,["frameRate"]]],[1," fps\\n                    "],[13],[1,"\\n"]],[3,4]],null],[1,"                "],[13],[1,"\\n            "],[13],[1,"\\n\\n            "],[10,0],[14,0,"properties"],[12],[1,"\\n\\n                "],[8,[39,3],null,null,[["default"],[[[[1,"Composition properties"]],[]]]]],[1,"\\n\\n                "],[10,0],[14,0,"properties_x2"],[12],[1,"\\n                    "],[8,[39,14],null,[["@label","@obj","@property","@min","@max","@action"],["Resolution",[30,0,["properties","dimensions"]],"width",16,[30,0,["config","maxResolution","width"]],[30,0,["editItem"]]]],null],[1,"\\n                    "],[10,"label"],[12],[1,""],[13],[1,"\\n                    "],[8,[39,14],null,[["@obj","@property","@min","@max","@action"],[[30,0,["properties","dimensions"]],"height",16,[30,0,["config","maxResolution","height"]],[30,0,["editItem"]]]],null],[1,"\\n                    "],[10,"label"],[14,0,"unit"],[12],[1," px"],[13],[1,"\\n                "],[13],[1,"\\n                "],[8,[39,16],null,null,[["default"],[[[[1,"max "],[1,[30,0,["config","maxResolution","width"]]],[1,"  "],[1,[30,0,["config","maxResolution","height"]]],[1," px"]],[]]]]],[1,"\\n\\n                "],[10,"br"],[12],[13],[1,"\\n\\n                "],[8,[39,14],null,[["@label","@obj","@property","@action","@long","@unit"],["Frame rate",[30,0,["properties"]],"frameRate",[30,0,["editItem"]],true,"fps"]],null],[1,"\\n                "],[8,[39,16],null,null,[["default"],[[[[1,"max "],[1,[30,0,["config","maxFPS"]]],[1," fps"]],[]]]]],[1,"\\n\\n                "],[10,"br"],[12],[13],[1,"\\n\\n                "],[8,[39,14],null,[["@label","@obj","@property","@action","@unit"],["Duration",[30,0,["properties"]],"duration_seconds",[30,0,["editDuration"]],"seconds"]],null],[1,"\\n                "],[8,[39,16],null,null,[["default"],[[[[1,"max "],[1,[30,0,["maxDurationMinutes"]]],[1," minutes"]],[]]]]],[1,"\\n                "],[10,1],[14,0,"mmss"],[12],[1,"=> "],[1,[28,[35,17],[[30,0,["properties","duration_seconds"]]],null]],[1," mm:ss"],[13],[1,"\\n               \\n                "],[10,"br"],[12],[13],[1,"\\n\\n"],[41,[28,[37,6],[[30,1],"project"],null],[[[1,"                "],[11,0],[24,1,"newDropZone"],[4,[38,7],["dragenter",[30,0,["onDragEnter"]]],null],[4,[38,7],["dragleave",[30,0,["onDragLeave"]]],null],[4,[38,7],["dragover",[30,0,["preventDefault"]]],null],[4,[38,7],["drop",[30,0,["dropFile"]]],null],[12],[1,"\\n                    Drop a video file here to create a composition with the same resolution, frame rate, and duration\\n                "],[13],[1,"\\n"]],[]],null],[1,"\\n            "],[13],[1,"\\n        "],[13],[1,"\\n        "],[10,0],[14,0,"buttons"],[12],[1,"\\n            "],[11,1],[24,0,"button ok"],[4,[38,7],["click",[30,0,["submit"]]],null],[12],[1,"OK"],[13],[1,"\\n            "],[11,1],[24,0,"button cancel"],[4,[38,7],["click",[30,0,["closeDialog"]]],null],[12],[1,"Cancel"],[13],[1,"\\n        "],[13],[1,"\\n\\n    "],[13],[1,"\\n"],[13],[1,"\\n"]],["@what","@title","preset","index"],["div","h2","if","ui/property-title","ul","li","eq","on","fn","span","p","br","each","-track-array","ui/property-number","label","ui/property-note","format-duration"]]',moduleName:"pikimov/components/project/new/new.hbs",isStrictMode:!1})
let f=e.default=(l=new WeakMap,a=class extends o.default{constructor(){super(...arguments),c(this,"controller",null),c(this,"what","project"),c(this,"config",_config.compositions),c(this,"maxDurationMinutes",Math.floor(_config.compositions.maxDuration/60)),c(this,"presets",_compositionPresets),c(this,"selectedPreset",1),c(this,"selectedCameraType",1),c(this,"properties",{duration_seconds:10,cameraType:"2D"}),c(this,"videoFile",null),c(this,"videoProperties",null),s(this,l,null)
var e=this
e.controller=e.args.controller,e.selectPreset(0),(0,n.next)(function(){$("#newProjectDialog h2, #newProjectDialog .grid>div, #newProjectDialog .buttons").toArray().forEach(function(e,t){setTimeout(function(){$(e).css({opacity:1,transform:"none"})},0+100*t)})})}onDropFailed(e){this.videoFile=null,u(l,this,null),openModal({h2:e.h2,p:e.p})}loadDroppedFile(e){var t=this
t.videoFile=e
var o=getFileExtension(e.name)
if(o){var r=!1
if("mp4"==o&&(r=!0),"m4v"==o&&(r=!0),r){var n=e.type
if("image/svg+xml"==n&&(n="svg"),"video"==(n=n.split("/")[0])){startLoading()
var i=new FileReader
i.onload=function(o){u(l,t,new Blob([o.target.result])),t.getVideoInfos(e)},i.readAsArrayBuffer(e)}else t.onDropFailed({h2:"This is not a supported video file"})}else t.onDropFailed({h2:"This is not a supported video file format: ."+o})}else t.onDropFailed({h2:"This is not a supported file format",p:"(no file extension)"})}getVideoInfos(e){var t,o,n=this,i=new fileInfosUtils(e.name,(o=n,(t=l).get(m(t,o))))
i.getVideoFileInfos(function(e){if(console.log("OK file infos"),console.log(e),i.dispose(),i=null,stopLoading(),e.duration/60>=60)return n.videoFile=null,u(l,n,null),void openModal({h2:"This video is too long",p:"You can import videos up to 1 hour long"})
var t=n.properties;(0,r.set)(t,"dimensions",{width:e.width,height:e.height}),(0,r.set)(t,"frameRate",e.frameRate),(0,r.set)(t,"videoNbFrames",e.nbFrames)
var o=Math.round(e.nbFrames/e.frameRate*100)/100;(0,r.set)(t,"duration_seconds",o),n.videoProperties={width:e.width,height:e.height,durationS:o},e.audioTracks&&(n.videoProperties.audioTracks=e.audioTracks,n.videoProperties.nbAudioChannels=e.nbAudioChannels),n.editItem(),n.submit()},function(e){stopLoading(),console.log("ERROR video infos"),e||console.log("no video infos error message"),e&&openModal(e),n.videoFile=null,u(l,n,null),i.dispose(),i=null})}selectPreset(e){var t=this;(0,r.set)(t,"selectedPreset",e)
var o=structuredClone(t.presets[e]);(0,r.set)(t.properties,"dimensions",o.dimensions),(0,r.set)(t.properties,"frameRate",o.frameRate)}selectCameraType(e){var t=this;(0,r.set)(t,"selectedCameraType",e),1==e&&(0,r.set)(t.properties,"cameraType","2D"),2==e&&(0,r.set)(t.properties,"cameraType","3D")}editDuration(){(0,r.set)(this.properties,"videoNbFrames",void 0),this.editItem()}editItem(){var e=this.properties,t=this.config;(0,n.next)(function(){e.dimensions.width<16&&(0,r.set)(e.dimensions,"width",16),e.dimensions.height<16&&(0,r.set)(e.dimensions,"height",16),e.dimensions.width*e.dimensions.height>t.maxResolution.width*t.maxResolution.height&&(1*e.dimensions.width>t.maxResolution.width&&(0,r.set)(e.dimensions,"width",t.maxResolution.width),1*e.dimensions.height>t.maxResolution.height&&(0,r.set)(e.dimensions,"height",t.maxResolution.height)),1*e.frameRate<1&&(0,r.set)(e,"frameRate",1),1*e.frameRate>t.maxFPS&&(0,r.set)(e,"frameRate",t.maxFPS),1*e.duration_seconds<1&&(0,r.set)(e,"duration_seconds",1),1*e.duration_seconds>t.maxDuration&&(0,r.set)(e,"duration_seconds",t.maxDuration)})}editCameraD(e,t,o){(0,r.set)(e,t,o)}preventDefault(){event.preventDefault()}onDragEnter(){$("#newDropZone").addClass("dragFileOver"),event.preventDefault()}onDragLeave(){$("#newDropZone").removeClass("dragFileOver"),event.preventDefault()}dropFile(){if($("#newDropZone").removeClass("dragFileOver"),this.videoFile=null,event.dataTransfer.types.includes("Files")){var e=event.dataTransfer.items,t=e.length
const n=event.dataTransfer.items[0].webkitGetAsEntry()
if(n){if(n.isDirectory)return void event.preventDefault()}else console.log("Unable to determine if file or folder")
for(var o=0;o<t;o++)if("file"===e[o].kind){var r=e[o].getAsFile()
this.loadDroppedFile(r)
break}}event.preventDefault()}submit(){var e=this
console.log("new project: submit"),(0,r.set)(e.controller,"isNewProjectDialogOpen",!1),(0,r.set)(e.controller,"isNewCompositionDialogOpen",!1)
var t=e.properties
t.dimensions.width*=1,t.dimensions.height*=1,t.duration_seconds*=1,t.frameRate*=1,t.videoNbFrames?(t.duration_frames=t.videoNbFrames,delete t.videoNbFrames):(t.duration_frames=t.duration_seconds*t.frameRate,t.duration_frames=Math.floor(t.duration_frames)),delete t.duration_seconds
var o=null
e.videoFile&&(o={file:e.videoFile,properties:e.videoProperties}),e.args.createAction(e.controller,t,o)}closeDialog(){var e=this.controller
e.projectData||(console.log("no project, back to home"),e.router.transitionTo("index")),(0,r.set)(e,"isNewProjectDialogOpen",!1),(0,r.set)(e,"isNewCompositionDialogOpen",!1)}},p(a.prototype,"selectPreset",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"selectPreset"),a.prototype),p(a.prototype,"selectCameraType",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"selectCameraType"),a.prototype),p(a.prototype,"editDuration",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"editDuration"),a.prototype),p(a.prototype,"editItem",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"editItem"),a.prototype),p(a.prototype,"editCameraD",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"editCameraD"),a.prototype),p(a.prototype,"preventDefault",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"preventDefault"),a.prototype),p(a.prototype,"onDragEnter",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"onDragEnter"),a.prototype),p(a.prototype,"onDragLeave",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"onDragLeave"),a.prototype),p(a.prototype,"dropFile",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"dropFile"),a.prototype),p(a.prototype,"submit",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"submit"),a.prototype),p(a.prototype,"closeDialog",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"closeDialog"),a.prototype),a);(0,t.setComponentTemplate)(d,f)}),define("pikimov/components/project/open/files-locator",["exports","@ember/component","@glimmer/component","@ember/object","@ember/template-factory"],function(e,t,o,r,n){var i
function a(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function l(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const s=(0,n.createTemplateFactory)({id:"RdVL4ZF9",block:'[[[41,[30,0,["nbFilesToLocate"]],[[[10,0],[14,1,"filesLocator"],[12],[1,"\\n    \\n    "],[10,0],[12],[1,"\\n        "],[8,[39,2],null,null,[["default"],[[[[1,[30,1,["projectName"]]]],[]]]]],[1,"\\n        "],[10,"br"],[12],[13],[1,"\\n\\n        "],[8,[39,2],null,null,[["default"],[[[[1,"Where to find project files?"]],[]]]]],[1,"\\n\\n        "],[10,"ul"],[14,0,"scrollbar"],[12],[1,"\\n"],[42,[28,[37,6],[[28,[37,6],[[30,0,["libraryManager","libraryItems"]]],null]],null],null,[[[1,"            "],[10,"li"],[15,"data-libuid",[29,[[30,2,["libUid"]]]]],[12],[1,"\\n                "],[10,1],[14,0,"type"],[12],[1,"\\n                    "],[41,[28,[37,9],[[30,2,["type"]],"image"],null],[[[10,"i"],[14,0,"bx bx-image-alt"],[12],[13]],[]],null],[1,"\\n                    "],[41,[28,[37,9],[[30,2,["type"]],"svg"],null],[[[10,"i"],[14,0,"bx bx-image-alt"],[12],[13]],[]],null],[1,"\\n                    "],[41,[28,[37,9],[[30,2,["type"]],"video"],null],[[[10,"i"],[14,0,"bx bx-movie-play"],[12],[13]],[]],null],[1,"\\n                    "],[41,[28,[37,9],[[30,2,["type"]],"font"],null],[[[10,"i"],[14,0,"bx bx-text"],[12],[13]],[]],null],[1,"\\n                    "],[41,[28,[37,9],[[30,2,["type"]],"model"],null],[[[10,"i"],[14,0,"bx bx-cube"],[12],[13]],[]],null],[1,"\\n                    "],[41,[28,[37,9],[[30,2,["type"]],"audio"],null],[[[10,"i"],[14,0,"bx bx-music"],[12],[13]],[]],null],[1,"\\n                "],[13],[1,"\\n\\n                "],[10,1],[14,0,"filename"],[12],[1,[30,2,["filename"]]],[13],[1,"\\n"],[41,[30,2,["itemData","online"]],[[[1,"                    (online demo file)\\n"]],[]],[[[41,[30,2,["isLoaded"]],[[[41,[51,[30,2,["isMissing"]]],[[[1,"                        "],[10,1],[14,0,"folderName"],[12],[10,"i"],[14,0,"bx bx-folder-open"],[12],[13],[1,"/"],[1,[30,2,["folderName"]]],[13],[1,"\\n"]],[]],[[[1,"                        "],[10,1],[14,0,"ignored"],[12],[1,"ignored"],[13],[1,"\\n"]],[]]]],[]],[[[1,"                        "],[11,1],[24,0,"button"],[4,[38,12],["click",[28,[37,13],[[30,0,["locateFile"]],[30,3]],null]],null],[12],[1,"locate folder"],[13],[1,"\\n                        "],[11,1],[24,0,"button ignore cancel"],[4,[38,12],["click",[28,[37,13],[[30,0,["ignoreFile"]],[30,3]],null]],null],[12],[1,"ignore file"],[13],[1,"\\n"]],[]]]],[]]],[1,"            "],[13],[1,"\\n"]],[2,3]],null],[1,"        "],[13],[1,"\\n\\n        "],[10,0],[14,0,"buttons"],[12],[1,"\\n            "],[11,1],[24,0,"button cancel"],[4,[38,12],["click",[30,0,["cancel"]]],null],[12],[1,"Cancel"],[13],[1,"\\n        "],[13],[1,"\\n\\n    "],[13],[1,"    \\n\\n"],[13],[1,"\\n\\n"]],[]],[[[1,"\\n"],[10,0],[14,1,"projectLibraryLoader"],[12],[1,"\\n    "],[10,0],[12],[1,"\\n        "],[8,[39,2],null,[["@noTranslate"],[true]],[["default"],[[[[1,[30,1,["projectName"]]]],[]]]]],[1,"\\n        "],[10,"br"],[12],[13],[1,"\\n        "],[10,"br"],[12],[13],[1,"\\n        "],[10,2],[12],[1,"Loading project files..."],[13],[1,"\\n\\n        "],[10,0],[14,1,"libraryProgressBar"],[12],[1,"\\n            "],[10,0],[14,0,"filler"],[12],[13],[1,"\\n        "],[13],[1,"\\n    "],[13],[1,"\\n"],[13],[1,"\\n"]],[]]]],["@controller","item","index"],["if","div","ui/property-title","br","ul","each","-track-array","li","span","eq","i","unless","on","fn","p"]]',moduleName:"pikimov/components/project/open/files-locator.hbs",isStrictMode:!1})
let c=e.default=(i=class extends o.default{constructor(){super(...arguments),a(this,"controller",null),a(this,"libraryManager",null),a(this,"nbFilesToLocate",0)
var e=this
e.controller=e.args.controller,e.libraryManager=e.controller.libraryManager,e.libraryManager.libraryItems.forEach(function(t){if(t.itemData.compositionPropertiesFile)return console.log("remove compositionPropertiesFile flag"),void delete t.itemData.compositionPropertiesFile
t.itemData.online||t.itemData.fromCloud||t.isLoaded||e.nbFilesToLocate++})}locateFile(e){this.libraryManager.libraryItems.forEach(function(e){e.localFileNotFound=!1}),this.libraryManager.libraryItems[e].getLocalFile()}ignoreFile(e){this.libraryManager.libraryItems[e].ignoreFile()}async cancel(){var e=this.controller;(0,r.set)(e,"isFilesSelectorOpen",!1),await e.closeProject(),e.backToIndex()}},l(i.prototype,"locateFile",[r.action],Object.getOwnPropertyDescriptor(i.prototype,"locateFile"),i.prototype),l(i.prototype,"ignoreFile",[r.action],Object.getOwnPropertyDescriptor(i.prototype,"ignoreFile"),i.prototype),l(i.prototype,"cancel",[r.action],Object.getOwnPropertyDescriptor(i.prototype,"cancel"),i.prototype),i);(0,t.setComponentTemplate)(s,c)}),define("pikimov/components/project/open/open",["exports","@ember/component","@glimmer/component","@ember/object","@ember/template-factory"],function(e,t,o,r,n){var i
function a(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function l(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const s=(0,n.createTemplateFactory)({id:"yA6OuDWI",block:'[[[10,0],[14,1,"openProjectsList"],[14,0,"modal"],[12],[1,"\\n\\n    "],[10,0],[12],[1,"\\n        "],[10,"header"],[12],[1,"\\n            "],[10,"h2"],[12],[1,"Open project"],[13],[1,"\\n            "],[11,1],[24,0,"b_close"],[4,[38,4],["click",[30,0,["closeList"]]],null],[12],[13],[1,"\\n        "],[13],[1,"\\n\\n        "],[10,0],[14,0,"grid"],[12],[1,"\\n            "],[10,0],[12],[1,"\\n                "],[8,[39,5],null,null,[["default"],[[[[1,"Load project from hard drive"]],[]]]]],[1,"\\n\\n                "],[8,[39,6],null,[["@controller"],[[30,1]]],null],[1,"\\n\\n                "],[10,"img"],[14,0,"zoo"],[14,"src","images/zoo4.png"],[14,"alt","zoo"],[12],[13],[1,"\\n            "],[13],[1,"\\n            "],[10,0],[12],[1,"\\n"],[1,"            "],[10,"br"],[12],[13],[1,"\\n            "],[10,"br"],[12],[13],[1,"\\n\\n            "],[13],[1,"\\n            "],[10,0],[12],[1,"\\n"],[41,[30,0,["autosavedData","projects","length"]],[[[1,"                "],[8,[39,5],null,null,[["default"],[[[[1,"Automatic saves"]],[]]]]],[1,"\\n\\n                "],[10,"ul"],[14,0,"scrollbar"],[12],[1,"\\n"],[42,[28,[37,12],[[28,[37,12],[[30,0,["autosavedData","projects"]]],null]],null],null,[[[1,"                    "],[10,"li"],[12],[1,"\\n"],[1,"                        "],[10,1],[14,0,"name"],[12],[1,[30,2,["projectName"]]],[13],[1,"\\n                        "],[10,1],[14,0,"dev"],[12],[1,[30,2,["projectID"]]],[13],[1,"\\n                        "],[10,"br"],[12],[13],[1,"\\n"],[42,[28,[37,12],[[28,[37,12],[[30,2,["saves"]]],null]],null],null,[[[1,"                        "],[10,0],[14,0,"save"],[12],[1,"\\n                            "],[10,"label"],[14,0,"date"],[12],[1,[28,[35,15],[[30,4,["datetime"]]],null]],[13],[1,"\\n                            "],[10,0],[12],[1,"\\n                                "],[11,1],[24,0,"button"],[4,[38,4],["click",[28,[37,16],[[30,0,["selectAutosave"]],[30,2],[30,4]],null]],null],[12],[1,"load autosave"],[13],[1,"\\n                            "],[13],[1,"\\n                        "],[13],[1,"\\n"]],[4]],null],[1,"                    "],[13],[1,"\\n"]],[2,3]],null],[1,"                "],[13],[1,"\\n\\n"]],[]],null],[1,"\\n            "],[13],[1,"      \\n        "],[13],[1,"\\n\\n    "],[13],[1,"\\n"],[13],[1,"\\n"]],["@controller","itemProject","index","itemSave"],["div","header","h2","span","on","ui/property-title","project/open/project-loader","img","br","if","ul","each","-track-array","li","label","remove-seconds","fn"]]',moduleName:"pikimov/components/project/open/open.hbs",isStrictMode:!1})
let c=e.default=(i=class extends o.default{constructor(){super(...arguments),a(this,"controller",null),a(this,"autosavedData",null)
var e=this
e.controller=e.args.controller,e.autosavedData=_autosaveUtils.getLocalStorageData()}selectAutosave(e,t){console.log("select Autosave"),this.closeList()
var o=t.projectData,r="auto save | "+e.projectName
this.controller.loadProject(o,r)}closeList(){this.controller.toggleProperty("isProjectsListOpen")}},l(i.prototype,"selectAutosave",[r.action],Object.getOwnPropertyDescriptor(i.prototype,"selectAutosave"),i.prototype),l(i.prototype,"closeList",[r.action],Object.getOwnPropertyDescriptor(i.prototype,"closeList"),i.prototype),i);(0,t.setComponentTemplate)(s,c)}),define("pikimov/components/project/open/project-loader",["exports","@ember/component","@glimmer/component","@ember/object","@ember/template-factory"],function(e,t,o,r,n){var i
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const a=(0,n.createTemplateFactory)({id:"wCRdF7lM",block:'[[[11,1],[24,0,"button openProject"],[4,[38,1],["click",[30,0,["openProjectAction"]]],null],[12],[1,"Open project"],[13],[1,"\\n"]],[],["span","on"]]',moduleName:"pikimov/components/project/open/project-loader.hbs",isStrictMode:!1})
let l=e.default=(i=class extends o.default{constructor(){super(...arguments)}openProjectAction(){var e=this.args.controller;(0,r.set)(e,"isProjectsListOpen",!1),e.projectUtils.openProject()}},s=i.prototype,c="openProjectAction",u=[r.action],m=Object.getOwnPropertyDescriptor(i.prototype,"openProjectAction"),p=i.prototype,d={},Object.keys(m).forEach(function(e){d[e]=m[e]}),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=u.slice().reverse().reduce(function(e,t){return t(s,c,e)||e},d),p&&void 0!==d.initializer&&(d.value=d.initializer?d.initializer.call(p):void 0,d.initializer=void 0),void 0===d.initializer&&Object.defineProperty(s,c,d),i)
var s,c,u,m,p,d;(0,t.setComponentTemplate)(a,l)}),define("pikimov/components/project/properties/camera",["exports","@ember/component","@glimmer/component","@ember/object","@ember/object/observers","@ember/template-factory"],function(e,t,o,r,n,i){var a
function l(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const s=(0,i.createTemplateFactory)({id:"QaQ2GYEK",block:'[[[10,0],[14,0,"camera"],[12],[1,"\\n    "],[8,[39,1],null,[["@label","@obj","@objProperty","@valueToTrackBoolean","@action","@toolTip"],["Use a camera target",[30,1,["target"]],"enabled",[30,1,["target","enabled"]],[30,0,["editCheckBoxTarget"]],"If enabled, the camera always \\nlooks at the target position"]],null],[1,"\\n    "],[10,"br"],[12],[13],[10,"br"],[12],[13],[1,"\\n"],[13]],["@item"],["div","ui/property-checkbox","br"]]',moduleName:"pikimov/components/project/properties/camera.hbs",isStrictMode:!1})
let c=e.default=(a=class extends o.default{constructor(){super(...arguments),l(this,"controller",null),l(this,"item",null)
var e=this
e.controller=e.args.controller,e.item=e.args.item,(0,n.addObserver)(e,"controller.selectionItemsUpdater",e.onSelectionChanged)}onSelectionChanged(){(0,r.set)(this,"item",this.args.item)}editCheckBoxTarget(e,t,o){var n=this;(0,r.set)(e,t,o),n.controller.getters.getCompSceneItemByCompUid(n.item.compUid).onToggleEnableTarget(),n.args.parent.onSelectionChanged(),n.item.target.enabled?(0,r.set)(n.item.rotation,"disabled",!0):(0,r.set)(n.item.rotation,"disabled",!1),n.controller.needSaving()}},u=a.prototype,m="editCheckBoxTarget",p=[r.action],d=Object.getOwnPropertyDescriptor(a.prototype,"editCheckBoxTarget"),f=a.prototype,v={},Object.keys(d).forEach(function(e){v[e]=d[e]}),v.enumerable=!!v.enumerable,v.configurable=!!v.configurable,("value"in v||v.initializer)&&(v.writable=!0),v=p.slice().reverse().reduce(function(e,t){return t(u,m,e)||e},v),f&&void 0!==v.initializer&&(v.value=v.initializer?v.initializer.call(f):void 0,v.initializer=void 0),void 0===v.initializer&&Object.defineProperty(u,m,v),a)
var u,m,p,d,f,v;(0,t.setComponentTemplate)(s,c)}),define("pikimov/components/project/properties/composition-properties",["exports","@ember/component","@glimmer/component","@ember/object","@ember/object/observers","@ember/runloop","@ember/template-factory"],function(e,t,o,r,n,i,a){var l
function s(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function c(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const u=(0,a.createTemplateFactory)({id:"I0R4gdUY",block:'[[[10,0],[14,1,"compositionProperties"],[15,0,[29,[[52,[30,1,["isCompositionReady"]],"ready"]]]],[12],[1,"\\n\\n    "],[8,[39,2],null,null,[["default"],[[[[1,"Composition properties"]],[]]]]],[1,"\\n\\n"],[41,[30,0,["config","allow3D"]],[[[1,"    "],[8,[39,3],null,[["@label","@label1","@label2","@value1","@value2","@obj","@objProperty","@valueToTrack","@action"],["composition type","2D","3D","2D","3D",[30,1,["activeComposition"]],"cameraType",[30,1,["activeComposition","cameraType"]],[30,0,["editCameraType"]]]],null],[1,"\\n    "],[10,"br"],[12],[13],[1,"\\n"]],[]],null],[1,"\\n    "],[8,[39,5],null,[["@label","@obj","@property","@action","@unit"],["set duration in seconds",[30,0],"duration_seconds",[30,0,["editDuration_seconds"]],"seconds"]],null],[1,"\\n\\n    "],[8,[39,5],null,[["@label","@obj","@property","@action","@unit"],["set duration in frames",[30,0],"duration_frames",[30,0,["editDuration_frames"]],"frames"]],null],[1,"\\n\\n    "],[10,2],[14,0,"durationLimit"],[12],[1," maximum "],[1,[30,0,["maxDurationMinutes"]]],[1," minutes"],[13],[1,"\\n\\n    "],[10,"br"],[12],[13],[1,"\\n    \\n    "],[8,[39,5],null,[["@label","@obj","@property","@min","@max","@action","@long","@unit"],["frame rate",[30,1,["activeComposition"]],"frameRate",1,[30,0,["config","maxFPS"]],[30,0,["editFrameRate"]],true,"fps"]],null],[1,"\\n\\n    "],[8,[39,7],null,null,[["default"],[[[[1,"max "],[1,[30,0,["config","maxFPS"]]],[1," fps"]],[]]]]],[1,"\\n    \\n    "],[10,0],[14,0,"properties_x2"],[12],[1,"\\n        "],[8,[39,5],null,[["@label","@obj","@property","@min","@max","@action"],["resolution",[30,1,["activeComposition","dimensions"]],"width",16,[30,0,["config","maxResolution","width"]],[30,0,["editResolution"]]]],null],[1,"\\n        "],[10,"label"],[12],[1,""],[13],[1,"\\n        "],[8,[39,5],null,[["@obj","@property","@min","@max","@action"],[[30,1,["activeComposition","dimensions"]],"height",16,[30,0,["config","maxResolution","height"]],[30,0,["editResolution"]]]],null],[1,"\\n        "],[10,"label"],[14,0,"unit notranslate"],[12],[1," px"],[13],[1,"\\n    "],[13],[1,"\\n\\n    "],[8,[39,7],null,null,[["default"],[[[[1,"max "],[1,[30,0,["config","maxResolution","width"]]],[1,"  "],[1,[30,0,["config","maxResolution","height"]]],[1," px"]],[]]]]],[1,"\\n\\n    "],[10,"br"],[12],[13],[1,"\\n    "],[8,[39,9],null,[["@label","@value","@action"],["ambient light color",[30,1,["activeComposition","ambientLight","color"]],[30,0,["editAmbientLight"]]]],null],[1,"\\n\\n    "],[8,[39,5],null,[["@label","@obj","@property","@min","@max","@action"],["ambient light intensity",[30,1,["activeComposition","ambientLight"]],"intensity",0,100,[30,0,["editAmbientLight"]]]],null],[1,"\\n\\n    "],[8,[39,7],null,null,[["default"],[[[[1,"The ambient light only affects 3D models"]],[]]]]],[1,"\\n\\n"],[13],[1,"\\n"]],["@controller"],["div","if","ui/property-title","ui/property-selector","br","ui/property-number","p","ui/property-note","label","ui/property-color"]]',moduleName:"pikimov/components/project/properties/composition-properties.hbs",isStrictMode:!1})
let m=e.default=(l=class extends o.default{constructor(){super(...arguments),s(this,"controller",null),s(this,"config",_config.compositions),s(this,"duration_seconds",0),s(this,"duration_frames",0),s(this,"minFrames",2),s(this,"maxDuration",_config.compositions.maxDuration),s(this,"maxDurationMinutes",Math.floor(_config.compositions.maxDuration/60))
var e=this
e.controller=e.args.controller,(0,n.addObserver)(e,"controller.activeComposition.time.end",e.onDurationChanged),(0,n.addObserver)(e,"controller.activeComposition.frameRate",e.onDurationChanged),e.onDurationChanged()}onDurationChanged(){var e=this,t=e.controller.activeCompositionData
t&&(e.duration_frames==1*t.time.end+1&&e.duration_seconds==roundValue(e.duration_frames/t.frameRate,2)||((0,r.set)(e,"duration_frames",1*t.time.end+1),(0,r.set)(e,"duration_seconds",roundValue(e.duration_frames/t.frameRate,2)),e.updateTimeline()))}updateDuration(){this.updateComposition(),this.updateTimeline()}updateComposition(){var e=this.controller,t=e.activeCompositionData,o=e.compositionManager
e.playbackUtils.pause(),e.selectionUtils.clearSelection(),o.updateDimensions(),o.frameRate=t.frameRate,o.sceneItems.forEach(function(e){"video"!=e.type&&"audio"!=e.type||e.updateMaxFrames(),"video"==e.type&&e.updateInOutFrames()}),"3D"==t.cameraType&&o.renderEngine.updateCameraRatio()
var r=e.currentFrame
r>=t.time.end&&(r=t.time.end),e.setFrame(r)}updateTimeline(){var e=this.controller;(0,i.next)(function(){e.updateTimeline()})}editResolution(e){var t=this,o=t.controller;(0,i.next)(function(){var n=o.activeComposition.dimensions;(0,r.set)(n,"width",1*n.width),(0,r.set)(n,"height",1*n.height),n.width<16&&(0,r.set)(n,"width",16),n.height<16&&(0,r.set)(n,"height",16)
var i=t.config.maxResolution
n.width>i.width&&(0,r.set)(n,"width",i.width),n.height>i.height&&(0,r.set)(n,"height",i.height),e?(o.selectionUtils.saveHoldCurrentSelection(),o.reopenComposition(),o.addToHistory("composition","edit resolution")):t.updateComposition()})}editFrameRate(){var e=this,t=e.controller.activeCompositionData;(0,i.next)(function(){var o=1*t.frameRate
o<1&&(o=1),o>e.config.maxFPS&&(o=e.config.maxFPS),(0,r.set)(t,"frameRate",o),e.updateComposition(),e.editDuration_frames(),e.controller.addToHistory("composition","edit frame rate")})}editDuration_seconds(e){var t=this,o=t.controller.activeCompositionData,n=Math.floor(t.duration_seconds*o.frameRate),i=Math.floor(t.maxDuration*o.frameRate)
n<t.minFrames&&(n=t.minFrames),n>i&&(n=i),(0,r.set)(o.time,"end",n-1),(0,r.set)(t,"duration_frames",n)
var a=roundValue(t.duration_frames/o.frameRate,2);(0,r.set)(t,"duration_seconds",a),t.updateDuration(),e&&t.controller.addToHistory("composition","edit duration")}editDuration_frames(e){var t=this,o=t.controller.activeCompositionData,n=t.duration_frames,i=Math.floor(t.maxDuration*o.frameRate)
n<t.minFrames&&(n=t.minFrames),n>i&&(n=i),(0,r.set)(o.time,"end",n-1),(0,r.set)(t,"duration_frames",n)
var a=roundValue(t.duration_frames/o.frameRate,2);(0,r.set)(t,"duration_seconds",a),t.updateDuration(),e&&t.controller.addToHistory("composition","edit duration")}editCameraType(e,t,o){(0,r.set)(e,t,o)
var n=this.controller,i=n.projectData.compositions,a=n.activeCompositionData,l=new compositionsUtils(n,a),s=0
i.forEach(function(e,t){e.uid==a.uid&&(s=t)}),"2D"==a.cameraType&&(i[s]=l.convert3Dto2D()),"3D"==a.cameraType&&(i[s]=l.convert2Dto3D()),l=null,n.reopenComposition(),n.addToHistory("composition","set type to "+a.cameraType,{needRebuild:!0})}editAmbientLight(){var e=this.controller;(0,i.next)(function(){e.activeComposition.ambientLight.intensity*=1,e.compositionManager.updateAmientLight(),e.refreshAndRender(),e.needSaving(!0)})}},c(l.prototype,"editResolution",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"editResolution"),l.prototype),c(l.prototype,"editFrameRate",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"editFrameRate"),l.prototype),c(l.prototype,"editDuration_seconds",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"editDuration_seconds"),l.prototype),c(l.prototype,"editDuration_frames",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"editDuration_frames"),l.prototype),c(l.prototype,"editCameraType",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"editCameraType"),l.prototype),c(l.prototype,"editAmbientLight",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"editAmbientLight"),l.prototype),l);(0,t.setComponentTemplate)(u,m)}),define("pikimov/components/project/properties/expression",["exports","@ember/component","@glimmer/component","@ember/object","@ember/object/observers","@ember/runloop","@ember/template-factory"],function(e,t,o,r,n,i,a){var l,s
function c(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function u(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const m=(0,a.createTemplateFactory)({id:"Ipck6xAp",block:'[[[10,0],[15,1,[29,[[30,0,["domID"]]]]],[15,0,[29,["expression",[52,[30,1,["error"]]," error"]]]],[12],[1,"\\n    "],[10,"h3"],[12],[1,"Javascript expression "],[10,"label"],[12],[1,"engine v1.0.0"],[13],[13],[1,"\\n"],[41,[28,[37,4],[[30,0,["arrayLength"]],1],null],[[[1,"    "],[8,[39,5],null,[["@type","@spellcheck","@value","@placeholder","@action"],["textarea",false,[30,1,["expression","strings","0"]],"",[30,0,["editExpression"]]]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[28,[37,6],[[30,0,["arrayLength"]],1],null],[[[1,"\\n        "],[8,[39,7],null,[["@label","@labels","@values","@obj","@objProperty","@valueToTrack","@action"],["dimensions",[28,[37,8],["separated","together"],null],[28,[37,8],[true,false],null],[30,1,["expression"]],"separated",[30,1,["expression","separated"]],[30,0,["editSeparate"]]]],null],[1,"\\n\\n"],[41,[30,1,["expression","separated"]],[[[1,"            "],[8,[39,5],null,[["@type","@spellcheck","@value","@placeholder","@action"],["textarea",false,[30,1,["expression","strings","0"]],"x",[30,0,["editExpression"]]]],null],[1,"\\n"],[1,"            "],[8,[39,5],null,[["@type","@spellcheck","@value","@placeholder","@action"],["textarea",false,[30,1,["expression","strings","1"]],"y",[30,0,["editExpression"]]]],null],[1,"\\n"],[41,[28,[37,6],[[30,0,["arrayLength"]],2],null],[[[1,"            "],[8,[39,5],null,[["@type","@spellcheck","@value","@placeholder","@action"],["textarea",false,[30,1,["expression","strings","2"]],"z",[30,0,["editExpression"]]]],null],[1,"\\n"]],[]],null]],[]],[[[1,"            "],[8,[39,5],null,[["@type","@spellcheck","@value","@placeholder","@action"],["textarea",false,[30,1,["expression","strings","0"]],[30,0,["togetherPlaceholder"]],[30,0,["editExpression"]]]],null],[1,"\\n"]],[]]]],[]],null],[1,"    "],[11,1],[24,0,"button"],[4,[38,10],["click",[30,0,["submit"]]],null],[12],[1,"update"],[13],[1,"\\n    "],[10,3],[14,0,"button help"],[14,6,"https://docs.pikimov.com/expressions"],[14,"target","_blank"],[12],[1,"help"],[13],[1,"\\n\\n    "],[10,1],[14,0,"value notranslate"],[12],[1,[30,0,["getDisplayValue"]]],[13],[1,"\\n\\n"],[13]],["@property"],["div","if","h3","label","eq","ui/property","mt","ui/property-selector","array","span","on","a"]]',moduleName:"pikimov/components/project/properties/expression.hbs",isStrictMode:!1})
let p=e.default=(l=(0,r.computed)("args.controller.currentFrame","args.controller.inputsUpdater","refreshDisplayedValue","args.property.error"),s=class extends o.default{constructor(){super(...arguments),c(this,"domID",null),c(this,"controller",null),c(this,"sceneItem",null),c(this,"arrayLength",1),c(this,"togetherPlaceholder",null),c(this,"refreshDisplayedValue",0),c(this,"thisIsFirstResize",!0)
var e=this
e.controller=e.args.controller,e.domID="exp_"+(Math.floor(8999*Math.random())+1e3)
var t=e.args.axes
t&&(e.arrayLength=0,t.x&&e.arrayLength++,t.y&&e.arrayLength++,t.z&&e.arrayLength++),e.togetherPlaceholder="[x, y]",3==e.arrayLength&&(e.togetherPlaceholder="[x, y, z]"),(0,n.addObserver)(e,"controller.selectionItemsUpdater",e.onSelectionChanged),e.onSelectionChanged(),(0,i.next)(function(){e.trackTextareasHeight()})}trackTextareasHeight(){var e=this
const t=document.querySelectorAll(`#${e.domID} textarea`)
if(!t||0==t.length)return
var o=e.args.property,r=o.expression.separated
o.expression.sizes||(o.expression.sizes={together:{},separated:[]})
var n=o.expression.sizes
r?t.forEach(function(e,t){n.separated[t]&&(e.style.height=n.separated[t].h+"px")}):n.together.h&&(t[0].style.height=n.together.h+"px")
const i=new ResizeObserver(o=>{e.thisIsFirstResize?e.thisIsFirstResize=!1:o.forEach(function(e){const o=e.target
var i=e.contentRect.height,a=0
o==t[1]&&(a=1),o==t[2]&&(a=2),0!=i&&(console.log(a,"New h:",i),r?n.separated[a]={h:i}:n.together={h:i},console.log(n))})})
t.forEach(e=>i.observe(e))}onSelectionChanged(){var e=this.controller.selectionUtils
if(1==e.getNbItemsSelected()){var t=e.getSelectedSceneItem();(0,r.set)(this,"sceneItem",t)}}editExpression(){}editSeparate(e,t,o){(0,r.set)(e,t,o),this.submit()
var n=this;(0,i.next)(function(){n.trackTextareasHeight()})}submit(){(0,r.set)(this,"refreshDisplayedValue",Math.random()),this.controller.refreshAndRender()}get getDisplayValue(){var e=this,t=e.args.property,o=e.controller.currentFrame,r=e.args.property.name
if(t.error)return"  ERROR  "
var n=null
if(r)n=e.sceneItem.getParamValueAt(o,r)
else{var i=e.sceneItem.getCompItem(),a=e.sceneItem.getTransformAt(o)
t==i.position&&(n=a.position.x+", "+a.position.y,3==e.arrayLength&&(n=a.position.x+", "+a.position.y+", "+a.position.z)),t==i.rotation&&(n=a.rotation.z,3==e.arrayLength&&(n=a.rotation.x+", "+a.rotation.y+", "+a.rotation.z)),t==i.scale&&(n=a.scale.x+", "+a.scale.y,3==e.arrayLength&&(n=a.scale.x+", "+a.scale.y+", "+a.scale.z)),n="["+n+"]"}return"= "+n}},u(s.prototype,"editExpression",[r.action],Object.getOwnPropertyDescriptor(s.prototype,"editExpression"),s.prototype),u(s.prototype,"editSeparate",[r.action],Object.getOwnPropertyDescriptor(s.prototype,"editSeparate"),s.prototype),u(s.prototype,"submit",[r.action],Object.getOwnPropertyDescriptor(s.prototype,"submit"),s.prototype),u(s.prototype,"getDisplayValue",[l],Object.getOwnPropertyDescriptor(s.prototype,"getDisplayValue"),s.prototype),s);(0,t.setComponentTemplate)(m,p)}),define("pikimov/components/project/properties/font-selector",["exports","@ember/component","@glimmer/component","@ember/object","@ember/template-factory"],function(e,t,o,r,n){var i,a
function l(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function s(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const c=(0,n.createTemplateFactory)({id:"f6/bbP3n",block:'[[[10,0],[14,0,"fontSelector"],[12],[1,"\\n\\n    "],[10,1],[14,0,"dev"],[12],[1,"font LibUid "],[1,[30,1,["libUid"]]],[13],[1,"\\n    \\n    "],[10,0],[14,0,"property"],[12],[1,"\\n        "],[10,"label"],[12],[1,"font"],[13],[1,"\\n        "],[10,0],[12],[1,"\\n            "],[10,"button"],[15,"popovertarget",[29,["fontSelector_",[30,0,["domUid"]]]]],[14,0,"button"],[12],[1,[30,0,["getFontName"]]],[13],[1,"\\n        "],[13],[1,"\\n    "],[13],[1,"\\n\\n"],[13],[1,"\\n\\n"],[10,0],[15,1,[29,["fontSelector_",[30,0,["domUid"]]]]],[14,0,"fontSelectorPopover"],[14,"popover",""],[12],[1,"\\n\\n    "],[10,"ul"],[14,0,"notranslate"],[12],[1,"\\n"],[42,[28,[37,6],[[28,[37,6],[[30,0,["fonts"]]],null]],null],null,[[[1,"        "],[11,"li"],[16,0,[29,[[52,[28,[37,9],[[30,2,["value"]],[30,1,["font"]]],null],"active"]]]],[4,[38,10],["click",[28,[37,11],[[30,0,["selectFont"]],[30,3]],null]],null],[12],[1,"\\n            "],[1,[30,2,["name"]]],[1,"\\n"],[1,"        "],[13],[1,"\\n"]],[2,3]],null],[1,"    "],[13],[1,"\\n\\n    "],[8,[39,12],null,[["@controller","@label","@type"],[[30,4],"import a font","font"]],null],[1,"\\n\\n"],[13]],["@item","font","index","@controller"],["div","span","label","button","ul","each","-track-array","li","if","eq","on","fn","project/library/import-files"]]',moduleName:"pikimov/components/project/properties/font-selector.hbs",isStrictMode:!1})
let u=e.default=(i=(0,r.computed)("args.item.font"),a=class extends o.default{constructor(){super(...arguments),l(this,"controller",null),l(this,"fonts",[]),l(this,"domUid",null)
var e=this
e.controller=e.args.controller
var t=e.args.item
t.compUid&&(e.domUid=t.compUid),t.uid&&(e.domUid=t.uid),e.buildFontsArray()}buildFontsArray(){var e=structuredClone(_fonts)
this.controller.projectData.library.forEach(function(t){if("font"==t.type){var o=t.name
o.length>20&&(o=o.substr(0,20)+"..."),e.push({name:o,value:t.libUid})}}),(0,r.set)(this,"fonts",e)}get getFontName(){var e=this,t=""
return e.fonts.forEach(function(o){o.value==e.args.item.font&&(t=o.name)}),t}selectFont(e){var t=this
$("#fontSelector_"+t.domUid)[0].hidePopover()
var o=t.fonts[e].value
t.args.parent.setItemFont(o)}},s(a.prototype,"getFontName",[i],Object.getOwnPropertyDescriptor(a.prototype,"getFontName"),a.prototype),s(a.prototype,"selectFont",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"selectFont"),a.prototype),a);(0,t.setComponentTemplate)(c,u)})
define("pikimov/components/project/properties/item-param-property",["exports","@ember/component","@glimmer/component","@ember/object","@ember/template-factory"],function(e,t,o,r,n){var i
function a(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function l(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const s=(0,n.createTemplateFactory)({id:"Fe4xLkGu",block:'[[[41,[51,[30,1,["disabled"]]],[[[41,[51,[30,1,["hidden"]]],[[[10,0],[15,0,[29,["param ",[52,[30,1,["useKeyframes"]],"useKeyframes"]]]],[12],[1,"\\n\\n    "],[8,[39,3],null,[["@paramData","@animAction","@expAction"],[[30,1],[30,0,["toggleUseKeyframes"]],[30,0,["toggleUseExpression"]]]],null],[1,"\\n    "],[10,0],[12],[1,"\\n"],[41,[28,[37,4],[[30,1,["type"]],"number"],null],[[[1,"            "],[8,[39,5],null,[["@label","@value","@min","@max","@minRangeInput","@maxRangeInput","@action","@displayInput","@unit"],[[30,1,["name"]],[30,1,["value"]],[30,1,["min"]],[30,1,["max"]],[30,1,["minRangeInput"]],[30,1,["maxRangeInput"]],[30,0,["editItem"]],true,[30,1,["unit"]]]],null],[1,"\\n"]],[]],null],[41,[28,[37,4],[[30,1,["type"]],"vector2"],null],[[[1,"        "],[10,0],[14,0,"properties_x2"],[12],[1,"\\n            "],[8,[39,6],null,[["@label","@obj","@property","@min","@max","@action"],[[30,1,["name"]],[30,1,["value"]],"x",[30,1,["min"]],[30,1,["max"]],[28,[37,7],[[30,0,["editItem"]]],null]]],null],[1,"\\n            "],[8,[39,6],null,[["@label","@obj","@property","@min","@max","@unit","@action"],[null,[30,1,["value"]],"y",[30,1,["min"]],[30,1,["max"]],[30,1,["unit"]],[28,[37,7],[[30,0,["editItem"]]],null]]],null],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[41,[28,[37,4],[[30,1,["type"]],"color"],null],[[[1,"            "],[8,[39,8],null,[["@label","@value","@action"],[[30,1,["name"]],[30,1,["value"]],[30,0,["editItem"]]]],null],[1,"\\n"]],[]],null],[41,[28,[37,4],[[30,1,["type"]],"boolean"],null],[[[1,"            "],[8,[39,9],null,[["@label","@obj","@objProperty","@valueToTrackBoolean","@action"],[[30,1,["name"]],[30,1],"value",[30,1,["value"]],[30,0,["editItemBoolean"]]]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[28,[37,4],[[30,1,["type"]],"text"],null],[[[1,"            "],[8,[39,10],null,[["@type","@label","@value","@hiddenInput","@placeholder","@action"],["textarea",[30,1,["name"]],[30,1,["value"]],[30,1,["hiddenInput"]],"empty",[30,0,["editText"]]]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[28,[37,4],[[30,1,["type"]],"selector"],null],[[[1,"            "],[8,[39,11],null,[["@label","@labels","@values","@obj","@objProperty","@valueToTrack","@action","@useFaIcons"],[[30,1,["name"]],[30,1,["labels"]],[30,1,["values"]],[30,1],"value",[30,1,["value"]],[30,0,["setSelectorValue"]],[28,[37,4],[[30,1,["name"]],"text align"],null]]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[28,[37,4],[[30,1,["type"]],null],null],[[[1,"            "],[10,0],[14,0,"property"],[12],[1,"\\n                "],[10,"label"],[12],[1,[30,1,["name"]]],[13],[1,"\\n                "],[10,0],[12],[13],[1,"\\n            "],[13],[1,"\\n"]],[]],null],[1,"        \\n    "],[13],[1,"\\n\\n"],[13],[1,"\\n\\n"],[41,[30,1,["useExpression"]],[[[1,"    "],[8,[39,13],null,[["@controller","@property"],[[30,2],[30,1]]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,1,["value"]],[[[42,[28,[37,15],[[28,[37,15],[[30,1,["params"]]],null]],null],null,[[[1,"    "],[8,[39,16],null,[["@controller","@parent","@paramData","@item"],[[30,2],[30,0],[30,3],[30,0,["item"]]]],null],[1,"\\n"]],[3]],null]],[]],null],[1,"        \\n"]],[]],null],[1,"\\n"]],[]],null]],["@paramData","@controller","paramData"],["unless","div","if","project/properties/toggle-icons","eq","ui/property-range","ui/property-number","fn","ui/property-color","ui/property-checkbox","ui/property","ui/property-selector","label","project/properties/expression","each","-track-array","project/properties/item-param-property"]]',moduleName:"pikimov/components/project/properties/item-param-property.hbs",isStrictMode:!1})
let c=e.default=(i=class extends o.default{constructor(){super(...arguments),a(this,"controller",null),a(this,"item",null),a(this,"sceneItem",null),a(this,"displayParam",!1)
var e=this
e.controller=e.args.controller,e.item=e.args.item,e.sceneItem=e.controller.getters.getCompSceneItemByCompUid(e.item.compUid),e.updateRequired()}updateRequired(){var e=this,t=e.args.paramData
if(t.requires){console.log("paramData.requires",t.requires)
var o=t.requires,r=e.sceneItem.getParamValueAt(0,o)
e.displayParam=r}else e.displayParam=!0}toggleUseKeyframes(){var e=this,t=e.args.paramData,o=e.controller
if((0,r.set)(t,"useKeyframes",!t.useKeyframes),t.useKeyframes){if(!t.keyframes||!t.keyframes.length){var n=o.currentFrame
o.keyframesUtils.addParamKey(e.item,t,n)}e.item.open||(0,r.set)(e.item,"open",!0)}"speed"==t.name&&e.sceneItem.updateInOutFrames(),"opacity"!=t.name&&"volume"!=t.name||o.keyframesUtils.sendKeyEvent(e.item.compUid),e.sceneItem.isAnimated()||(0,r.set)(e.item,"open",!1),o.refreshAndRender(),o.addToHistory("item param","toggle use keyframes")}toggleUseExpression(){var e=this,t=e.args.paramData;(0,r.set)(t,"useExpression",!t.useExpression)
t.expression||(t.expression={strings:[""]}),e.controller.refreshAndRender(),e.controller.addToHistory("item","toggle expression on "+t.name)}editItem(e=!0){var t=this,o=t.controller,n=o.compositionManager,i=t.args.paramData
"function"==typeof t.args.parent.triggerPixelSizeUpdater&&t.args.parent.triggerPixelSizeUpdater(),void 0!==i.min&&i.value<i.min&&(0,r.set)(i,"value",1*i.min),void 0!==i.max&&i.value>i.max&&(0,r.set)(i,"value",1*i.max),requestAnimationFrame(function(){"number"==i.type&&(0,r.set)(i,"value",1*i.value)}),"fov"==i.name&&(n.camera.fov=1*i.value,n.camera.updateProjectionMatrix()),"zoom"==i.name&&(n.camera.zoom=1*i.value,n.camera.updateProjectionMatrix()),"corners"==i.name&&t.sceneItem.rebuild(),e&&("opacity"!=i.name&&"volume"!=i.name||o.keyframesUtils.sendKeyEvent(t.item.compUid)),o.refreshAndRender(),e&&o.addToHistory("item","item property")}editItemBoolean(e,t,o){(0,r.set)(e,t,o)
var n=this
n.sceneItem.rebuild(),n.controller.refreshAndRender(),n.controller.addToHistory("item","item property"),n.updateRequired()}editText(){var e=this
"text"==e.sceneItem.type&&(e.sceneItem.rebuild(),e.args.parent.triggerPixelSizeUpdater()),e.controller.addToHistory("item","item text"),e.controller.refreshAndRender()}setSelectorValue(e,t,o){var n=this;(0,r.set)(e,t,o)
var i=n.args.paramData.name
if(n.controller.addToHistory("item","item property"),"fill type"==i&&(n.sceneItem.setFillType(o),n.sceneItem.updateColor()),"gradient type"==i&&(n.sceneItem.setGradientType(o),n.sceneItem.updateColor()),"light type"==i)return n.sceneItem.updateLightType(),void n.controller.compositionManager.buildCompositionThenSelect(null)
"text align"==i&&(n.item.box&&n.item.box.enabled||("left"==o&&(0,r.set)(n.item.anchorPoint.values,"x",0),"center"==o&&(0,r.set)(n.item.anchorPoint.values,"x",50),"right"==o&&(0,r.set)(n.item.anchorPoint.values,"x",100))),n.controller.refreshAndRender()}},l(i.prototype,"toggleUseKeyframes",[r.action],Object.getOwnPropertyDescriptor(i.prototype,"toggleUseKeyframes"),i.prototype),l(i.prototype,"toggleUseExpression",[r.action],Object.getOwnPropertyDescriptor(i.prototype,"toggleUseExpression"),i.prototype),l(i.prototype,"editItem",[r.action],Object.getOwnPropertyDescriptor(i.prototype,"editItem"),i.prototype),l(i.prototype,"editItemBoolean",[r.action],Object.getOwnPropertyDescriptor(i.prototype,"editItemBoolean"),i.prototype),l(i.prototype,"editText",[r.action],Object.getOwnPropertyDescriptor(i.prototype,"editText"),i.prototype),l(i.prototype,"setSelectorValue",[r.action],Object.getOwnPropertyDescriptor(i.prototype,"setSelectorValue"),i.prototype),i);(0,t.setComponentTemplate)(s,c)}),define("pikimov/components/project/properties/item-properties",["exports","@ember/component","@glimmer/component","@ember/object","@ember/object/observers","@ember/template-factory"],function(e,t,o,r,n,i){var a
function l(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function s(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const c=(0,i.createTemplateFactory)({id:"axNBLOTe",block:'[[[10,0],[14,1,"itemProperties"],[12],[1,"\\n\\n"],[41,[28,[37,2],[[30,0,["sceneItem","resDivider"]],2],null],[[[1,"    "],[8,[39,3],null,null,[["default"],[[[[1,"The video is displayed at 1/2 resolution, \\n        but exported at full resolution\\n    "]],[]]]]],[1,"\\n"]],[]],null],[1,"\\n"],[41,[28,[37,2],[[30,0,["sceneItem","resDivider"]],4],null],[[[1,"    "],[8,[39,3],null,null,[["default"],[[[[1,"The video is displayed at 1/4 resolution, \\n        but exported at full resolution\\n    "]],[]]]]],[1,"\\n"]],[]],null],[1,"\\n"],[41,[28,[37,2],[[30,0,["item","type"]],"light"],null],[[[1,"    "],[8,[39,3],null,null,[["default"],[[[[1,"Lights only affect 3D models. \\n"],[1,"    "]],[]]]]],[1,"\\n"]],[]],null],[1,"\\n"],[41,[28,[37,2],[[30,0,["item","type"]],"cameraTarget"],null],[[[1,"        "],[8,[39,3],null,null,[["default"],[[[[1,"The camera is looking at this position"]],[]]]]],[1,"\\n"]],[]],null],[1,"\\n    "],[10,1],[14,0,"dev"],[12],[1,"compUid "],[1,[30,0,["item","compUid"]]],[1," | libUid "],[1,[30,0,["item","libUid"]]],[13],[1,"\\n\\n"],[41,[51,[28,[37,2],[[30,0,["item","type"]],"audio"],null]],[[[1,"        "],[8,[39,6],null,[["@controller","@parent"],[[30,1],[30,0]]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["canBeBlended"]],[[[1,"    "],[10,0],[14,0,"blendMode"],[12],[1,"\\n        "],[8,[39,7],null,[["@label","@options","@setValue","@target","@targetProperty","@valueToTrack"],["blend mode",[30,0,["blendModesList"]],[30,0,["setBlendModeValue"]],[30,0,["item"]],"blendMode",[30,0,["item","blendMode"]]]],null],[1,"\\n    "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[41,[28,[37,2],[[30,0,["item","type"]],"text"],null],[[[1,"        "],[8,[39,8],null,[["@controller","@item"],[[30,1],[30,0,["item"]]]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[28,[37,2],[[30,0,["item","type"]],"camera"],null],[[[1,"        "],[8,[39,9],null,[["@controller","@item","@parent"],[[30,1],[30,0,["item"]],[30,0]]],null],[1,"\\n"]],[]],null],[1,"\\n"],[42,[28,[37,11],[[28,[37,11],[[30,0,["item","params"]]],null]],null],null,[[[1,"        "],[8,[39,12],null,[["@controller","@parent","@paramData","@item"],[[30,1],[30,0],[30,2],[30,0,["item"]]]],null],[1,"\\n"]],[2]],null],[1,"\\n"],[41,[30,0,["canBeMask"]],[[[1,"        "],[8,[39,13],null,[["@controller","@item"],[[30,1],[30,0,["item"]]]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[28,[37,14],["repeat"],null],[[[41,[30,0,["canRepeat"]],[[[1,"        "],[8,[39,15],null,[["@controller","@item"],[[30,1],[30,0,["item"]]]],null],[1,"\\n"]],[]],null]],[]],null],[1,"\\n"],[41,[30,0,["showNoMaskingMessage"]],[[[1,"    "],[10,"br"],[12],[13],[1,"\\n    "],[10,2],[14,0,"noMasking"],[12],[1," Masking and blend modes are not possible on 3D compositions"],[13],[1,"\\n"]],[]],null],[1,"\\n\\n"],[41,[28,[37,2],[[30,0,["item","type"]],"model"],null],[[[1,"        "],[11,1],[24,0,"button"],[4,[38,18],["click",[28,[37,19],[[30,0,["setBasicMats"]],1],null]],null],[12],[1,"setBasicMats"],[13],[1,"\\n        "],[11,1],[24,0,"button"],[4,[38,18],["click",[28,[37,19],[[30,0,["setBasicMats"]],0],null]],null],[12],[1,"revert mats"],[13],[1,"\\n"]],[]],null],[1,"\\n\\n"],[41,[30,0,["is3DComp"]],[[[41,[28,[37,2],[[30,0,["item","type"]],"freeShape"],null],[[[41,[51,[30,1,["isFreeShapeEditorOpen"]]],[[[1,"    "],[10,0],[14,5,"margin:5px 0 5px 18px;"],[12],[1,"\\n        "],[11,1],[24,0,"button"],[4,[38,18],["click",[30,0,["toggleFreeShapeEditor"]]],null],[12],[1,"edit shape"],[13],[1,"\\n    "],[13],[1,"\\n"]],[]],null]],[]],null]],[]],null],[1,"\\n"],[1,"\\n"],[13]],["@controller","paramData"],["div","if","eq","ui/property-note","span","unless","project/properties/item-transform","ui/property-select","project/properties/text","project/properties/camera","each","-track-array","project/properties/item-param-property","project/properties/mask","get-config-feature","project/properties/repeat","br","p","on","fn"]]',moduleName:"pikimov/components/project/properties/item-properties.hbs",isStrictMode:!1})
let u=e.default=(a=class extends o.default{constructor(){super(...arguments),l(this,"controller",null),l(this,"compositionManager",null),l(this,"item",null),l(this,"sceneItem",null),l(this,"is3DComp",!1),l(this,"canBeMask",!0),l(this,"canBeBlended",!0),l(this,"canRepeat",!1),l(this,"showNoMaskingMessage",!1),l(this,"blendModesList",[{name:"normal",value:"normal"},{name:"add",value:"additive"},{name:"multiply",value:"multiply"},{name:"screen",value:"screen"},{name:"difference",value:"difference"},{name:"overlay",value:"overlay"}]),l(this,"pixelSizeUpdater",null)
var e=this
e.controller=e.args.controller,e.compositionManager=e.controller.compositionManager,(0,n.addObserver)(e,"controller.selectionItemsUpdater",e.onSelectionChanged),e.onSelectionChanged()}setItem(e){var t=this,o=null,n=null
e&&(o=t.controller.getters.getCompItemByCompUid(t.controller.activeCompositionData,e),n=t.controller.getters.getSceneItemByCompUid(t.compositionManager,e)),(0,r.set)(t,"item",o),(0,r.set)(t,"sceneItem",n)}onSelectionChanged(){var e=this
if(1==e.controller.selectionUtils.getNbItemsSelected()){var t=e.controller.selectionUtils.getSelectedCompUid()
e.setItem(t),"3D"==e.compositionManager.cameraType?(0,r.set)(e,"is3DComp",!0):(0,r.set)(e,"is3DComp",!1)
var o=e.compositionManager.nbItems,n=!0,i=!1,a=e.item.type
"audio"==a&&(n=!1),"group"==a&&(n=!1),"camera"==a&&(n=!1),"light"==a&&(n=!1),o<2&&(n=!1),e.is3DComp&&(n=!1),(0,r.set)(e,"canBeMask",n)
var l=!0
"audio"!=a&&"group"!=a&&"camera"!=a&&"light"!=a||(l=!1),e.item.mask&&e.item.mask.enabled&&(l=!1),n&&e.is3DComp&&(i=!0),l&&e.is3DComp&&(i=!0)
var s=!1
"video"!=a&&"composition"!=a&&"imageSequence"!=a||(s=!0),(0,r.set)(e,"canRepeat",s),e.is3DComp&&(l=!1),(0,r.set)(e,"canBeBlended",l),(0,r.set)(e,"showNoMaskingMessage",i)}else e.setItem(null)}triggerPixelSizeUpdater(){(0,r.set)(this,"pixelSizeUpdater",Math.random())}setBlendModeValue(e,t,o){var n=this;(0,r.set)(n.item,"blendMode",o),n.controller.refreshAndRender(),n.controller.addToHistory("item","edit blend mode")}setBasicMats(e){var t=this
e?(t.sceneItem.convertToBasicMaterials(),t.controller.refreshAndRender()):t.sceneItem.revertMaterials()}toggleFreeShapeEditor(){var e=this.controller
e.isFreeShapeEditorOpen?(0,r.set)(e,"isFreeShapeEditorOpen",!1):(0,r.set)(e,"isFreeShapeEditorOpen",!0)}},s(a.prototype,"setBlendModeValue",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"setBlendModeValue"),a.prototype),s(a.prototype,"setBasicMats",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"setBasicMats"),a.prototype),s(a.prototype,"toggleFreeShapeEditor",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"toggleFreeShapeEditor"),a.prototype),a);(0,t.setComponentTemplate)(c,u)}),define("pikimov/components/project/properties/item-transform",["exports","@ember/component","@glimmer/component","@ember/object","@ember/object/observers","@ember/runloop","@ember/template-factory"],function(e,t,o,r,n,i,a){var l
function s(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function c(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const u=(0,a.createTemplateFactory)({id:"rr5RJh3K",block:'[[[10,0],[14,0,"transform"],[12],[1,"\\n\\n    "],[10,0],[15,0,[29,["position ",[52,[30,0,["positionData","useKeyframes"]],"useKeyframes"]]]],[12],[1,"\\n        "],[8,[39,2],null,[["@paramData","@type","@animAction","@expAction"],[[30,0,["positionData"]],"number",[28,[37,3],[[30,0,["toggleUseKeyframes"]],"position"],null],[28,[37,3],[[30,0,["toggleUseExpression"]],"position"],null]]],null],[1,"\\n        "],[10,"label"],[12],[1,"position"],[13],[1,"\\n        "],[10,0],[14,0,"values"],[12],[1,"\\n"],[41,[51,[30,0,["is3DComp"]]],[[[1,"                "],[8,[39,6],null,[["@obj","@property","@noTranslate","@action"],[[30,0,["positionData","values"]],"x",true,[30,0,["editPosition"]]]],null],[1,"\\n                "],[8,[39,6],null,[["@obj","@property","@noTranslate","@action"],[[30,0,["positionData","values"]],"y",true,[30,0,["editPosition"]]]],null],[1,"\\n"],[41,[30,0,["positionAxes","z"]],[[[1,"                "],[8,[39,6],null,[["@obj","@property","@noTranslate","@action"],[[30,0,["positionData","values"]],"z",true,[30,0,["editPosition"]]]],null],[1,"\\n"]],[]],null],[1,"                "],[10,"label"],[14,0,"unit notranslate"],[12],[1,"px"],[13],[1,"\\n"]],[]],[[[1,"                "],[8,[39,6],null,[["@obj","@property","@label","@extraClasses","@noTranslate","@action"],[[30,0,["positionData","values"]],"x","x","x",true,[30,0,["editPosition"]]]],null],[1,"\\n                "],[8,[39,6],null,[["@obj","@property","@label","@extraClasses","@noTranslate","@action"],[[30,0,["positionData","values"]],"y","y","y",true,[30,0,["editPosition"]]]],null],[1,"\\n                "],[8,[39,6],null,[["@obj","@property","@label","@extraClasses","@noTranslate","@action"],[[30,0,["positionData","values"]],"z","z","z",true,[30,0,["editPosition"]]]],null],[1,"\\n                "],[10,"label"],[14,0,"unit notranslate"],[12],[13],[1,"\\n"]],[]]],[1,"            \\n        "],[13],[1,"\\n    "],[13],[1,"\\n\\n"],[41,[30,0,["positionData","useExpression"]],[[[1,"        "],[8,[39,7],null,[["@controller","@property","@axes"],[[30,1],[30,0,["item","position"]],[30,0,["positionAxes"]]]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["rotationAxes"]],[[[1,"    "],[10,0],[15,0,[29,["rotation ",[52,[30,0,["rotationData","useKeyframes"]],"useKeyframes"]]]],[12],[1,"\\n        "],[8,[39,2],null,[["@paramData","@type","@animAction","@expAction"],[[30,0,["rotationData"]],"number",[28,[37,3],[[30,0,["toggleUseKeyframes"]],"rotation"],null],[28,[37,3],[[30,0,["toggleUseExpression"]],"rotation"],null]]],null],[1,"\\n        "],[10,"label"],[12],[1,"rotation"],[13],[1,"\\n        "],[10,0],[14,0,"values"],[12],[1,"\\n"],[41,[51,[30,0,["is3DComp"]]],[[[41,[30,0,["rotationAxes","x"]],[[[1,"                    "],[8,[39,6],null,[["@obj","@property","@action"],[[30,0,["rotationData","values"]],"x",[30,0,["editRotation"]]]],null],[1,"\\n"]],[]],null],[41,[30,0,["rotationAxes","y"]],[[[1,"                    "],[8,[39,6],null,[["@obj","@property","@action"],[[30,0,["rotationData","values"]],"y",[30,0,["editRotation"]]]],null],[1,"\\n"]],[]],null],[41,[30,0,["rotationAxes","z"]],[[[1,"                    "],[8,[39,6],null,[["@obj","@property","@action"],[[30,0,["rotationData","values"]],"z",[30,0,["editRotation"]]]],null],[1,"\\n"]],[]],null],[1,"                "],[10,"label"],[14,0,"unit notranslate"],[12],[1,""],[13],[1,"\\n"]],[]],[[[41,[30,0,["rotationAxes","x"]],[[[1,"                    "],[8,[39,6],null,[["@obj","@property","@label","@extraClasses","@noTranslate","@action"],[[30,0,["rotationData","values"]],"x","x","x",true,[30,0,["editRotation"]]]],null],[1,"\\n"]],[]],null],[41,[30,0,["rotationAxes","y"]],[[[1,"                    "],[8,[39,6],null,[["@obj","@property","@label","@extraClasses","@noTranslate","@action"],[[30,0,["rotationData","values"]],"y","y","y",true,[30,0,["editRotation"]]]],null],[1,"\\n"]],[]],null],[41,[30,0,["rotationAxes","z"]],[[[1,"                    "],[8,[39,6],null,[["@obj","@property","@label","@extraClasses","@noTranslate","@action"],[[30,0,["rotationData","values"]],"z","z","z",true,[30,0,["editRotation"]]]],null],[1,"\\n"]],[]],null],[1,"                "],[10,"label"],[14,0,"unit notranslate"],[12],[1,""],[13],[1,"\\n"]],[]]],[1,"        "],[13],[1,"\\n    "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["rotationData","useExpression"]],[[[1,"        "],[8,[39,7],null,[["@controller","@property","@axes"],[[30,1],[30,0,["item","rotation"]],[30,0,["rotationAxes"]]]],null],[1,"\\n"]],[]],null],[1,"\\n    "],[41,[51,[30,0,["scaleData","hidden"]]],[[[1,"\\n    "],[10,0],[15,0,[29,["scale ",[52,[30,0,["scaleData","useKeyframes"]],"useKeyframes"]]]],[12],[1,"\\n        "],[8,[39,2],null,[["@paramData","@type","@animAction","@expAction"],[[30,0,["scaleData"]],"number",[28,[37,3],[[30,0,["toggleUseKeyframes"]],"scale"],null],[28,[37,3],[[30,0,["toggleUseExpression"]],"scale"],null]]],null],[1,"\\n"],[1,"        "],[10,"label"],[12],[1,"scale \\n            "],[11,1],[16,0,[29,["keepRatio tooltip ",[52,[30,0,["scaleData","keepScaleRatio"]],"on"]]]],[4,[38,9],["click",[30,0,["toggleKeepScaleRatio"]]],null],[12],[1,"\\n                "],[10,"i"],[14,0,"bx bx-link"],[12],[13],[1,"\\n                "],[10,1],[14,0,"tooltiptext p50"],[12],[1,"toggle keep aspect ratio"],[13],[1,"\\n            "],[13],[1,"\\n\\n"],[41,[30,0,["useScaleUnitButton"]],[[[41,[51,[28,[37,11],[[30,0,["item","type"]],"group"],null]],[[[1,"                "],[11,1],[16,0,[29,["unitButton ",[52,[28,[37,11],[[30,0,["scaleData","displayUnit"]],"px"],null],"px"]]]],[4,[38,9],["click",[30,0,["toggleScaleUnit"]]],null],[12],[1,"\\n                    "],[10,"label"],[12],[1,"%"],[13],[1,"\\n                    "],[10,"label"],[12],[1,"px"],[13],[1,"\\n                "],[13],[1,"\\n"]],[]],null]],[]],null],[1,"        "],[13],[1,"\\n        "],[10,0],[14,0,"values"],[12],[1,"\\n"],[41,[51,[28,[37,11],[[30,0,["scaleData","displayUnit"]],"px"],null]],[[[41,[51,[30,0,["is3DComp"]]],[[[1,"                    "],[8,[39,6],null,[["@obj","@property","@noTranslate","@action"],[[30,0,["scaleData","values"]],"x",true,[28,[37,3],[[30,0,["editScale"]],"x"],null]]],null],[1,"\\n"],[41,[30,0,["scaleAxes","y"]],[[[1,"                    "],[8,[39,6],null,[["@obj","@property","@noTranslate","@action"],[[30,0,["scaleData","values"]],"y",true,[28,[37,3],[[30,0,["editScale"]],"y"],null]]],null],[1,"\\n"]],[]],null],[41,[30,0,["scaleAxes","z"]],[[[1,"                    "],[8,[39,6],null,[["@obj","@property","@noTranslate","@action"],[[30,0,["scaleData","values"]],"z",true,[28,[37,3],[[30,0,["editScale"]],"z"],null]]],null],[1,"\\n"]],[]],null]],[]],[[[1,"                    "],[8,[39,6],null,[["@obj","@property","@label","@extraClasses","@noTranslate","@action"],[[30,0,["scaleData","values"]],"x","x","x",true,[28,[37,3],[[30,0,["editScale"]],"x"],null]]],null],[1,"\\n"],[41,[30,0,["scaleAxes","y"]],[[[1,"                    "],[8,[39,6],null,[["@obj","@property","@label","@extraClasses","@noTranslate","@action"],[[30,0,["scaleData","values"]],"y","y","y",true,[28,[37,3],[[30,0,["editScale"]],"y"],null]]],null],[1,"\\n"]],[]],null],[41,[30,0,["scaleAxes","z"]],[[[1,"                    "],[8,[39,6],null,[["@obj","@property","@label","@extraClasses","@noTranslate","@action"],[[30,0,["scaleData","values"]],"z","z","z",true,[28,[37,3],[[30,0,["editScale"]],"z"],null]]],null],[1,"\\n"]],[]],null]],[]]],[1,"\\n"]],[]],[[[1,"                "],[8,[39,6],null,[["@obj","@property","@noTranslate","@action"],[[30,0,["scalePx"]],"x",true,[28,[37,3],[[30,0,["editScalePx"]],"x"],null]]],null],[1,"\\n                "],[8,[39,6],null,[["@obj","@property","@noTranslate","@action"],[[30,0,["scalePx"]],"y",true,[28,[37,3],[[30,0,["editScalePx"]],"y"],null]]],null],[1,"\\n"],[41,[30,0,["scaleAxes","z"]],[[[1,"                "],[8,[39,6],null,[["@obj","@property","@noTranslate","@action"],[[30,0,["scalePx"]],"z",true,[28,[37,3],[[30,0,["editScalePx"]],"z"],null]]],null],[1,"\\n"]],[]],null]],[]]],[1,"\\n"],[41,[28,[37,11],[[30,0,["scaleData","displayUnit"]],"%"],null],[[[1,"            "],[10,"label"],[14,0,"unit notranslate"],[12],[1,"%"],[13],[1,"\\n"]],[]],[[[1,"            "],[10,"label"],[14,0,"unit notranslate"],[12],[1,"px"],[13],[1,"\\n"]],[]]],[1,"\\n        "],[13],[1,"\\n    "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["scaleData","useExpression"]],[[[1,"        "],[8,[39,7],null,[["@controller","@property","@axes"],[[30,1],[30,0,["item","scale"]],[30,0,["scaleAxes"]]]],null],[1,"\\n"]],[]],null],[13],[1,"\\n\\n"],[41,[30,0,["anchorPointTool"]],[[[10,0],[14,0,"anchorPoint"],[12],[1,"\\n    "],[10,"label"],[12],[1,"anchor point"],[13],[1,"\\n    "],[8,[39,6],null,[["@obj","@property","@noTranslate","@action"],[[30,0,["item","anchorPoint","values"]],"x",true,[30,0,["editAnchorPoint"]]]],null],[1,"\\n    "],[8,[39,6],null,[["@obj","@property","@noTranslate","@action","@unit"],[[30,0,["item","anchorPoint","values"]],"y",true,[30,0,["editAnchorPoint"]],"%"]],null],[1,"\\n"],[13],[1,"\\n"]],[]],null]],["@controller"],["div","if","project/properties/toggle-icons","fn","label","unless","ui/property-number","project/properties/expression","span","on","i","eq"]]',moduleName:"pikimov/components/project/properties/item-transform.hbs",isStrictMode:!1})
let m=e.default=(l=class extends o.default{constructor(){super(...arguments),s(this,"controller",null),s(this,"compositionManager",null),s(this,"item",null),s(this,"sceneItem",null),s(this,"is3DComp",!1),s(this,"positionData",null),s(this,"rotationData",null),s(this,"scaleData",null),s(this,"positionAxes",null),s(this,"rotationAxes",null),s(this,"scaleAxes",null),s(this,"savedScaleRatio",null),s(this,"useScaleUnitButton",!1),s(this,"scalePx",null),s(this,"anchorPointTool",!0)
var e=this
e.controller=e.args.controller,e.compositionManager=e.controller.compositionManager,(0,n.addObserver)(e,"controller.currentFrame",e.onFrameChanged),(0,n.addObserver)(e,"controller.selectionItemsUpdater",e.onSelectionChanged),(0,n.addObserver)(e.args,"parent.pixelSizeUpdater",function(){e.isDestroyed||"px"==e.scaleData.displayUnit&&(e.updateScalePx(),e.saveScaleRatio())}),e.onSelectionChanged()}setItem(e){var t=this,o=t.controller.getters.getCompItemByCompUid(t.controller.activeCompositionData,e);(0,r.set)(t,"item",o),(0,r.set)(t,"positionData",t.item.position),(0,r.set)(t,"rotationData",t.item.rotation),(0,r.set)(t,"scaleData",t.item.scale),t.sceneItem=t.controller.getters.getSceneItemByCompUid(t.compositionManager,e),t.scaleData&&(t.scaleData.keepScaleRatio&&t.saveScaleRatio(),t.updateScalePx())}onFrameChanged(){var e=this
e.scaleData&&"px"==e.scaleData.displayUnit&&e.updateScalePx()}onSelectionChanged(){var e=this
if(1==e.controller.selectionUtils.getNbItemsSelected()){var t=e.controller.selectionUtils.getSelectedCompUid()
if(e.setItem(t),!e.sceneItem||!e.sceneItem.isMissing){"3D"==e.compositionManager.cameraType?(0,r.set)(e,"is3DComp",!0):(0,r.set)(e,"is3DComp",!1)
var o=e.item.type,n=e.sceneItem.getTransformEnabledAxes()
if((0,r.set)(e,"positionAxes",n.position),(0,r.set)(e,"rotationAxes",n.rotation),(0,r.set)(e,"scaleAxes",n.scale),e.scaleData&&(e.scaleData.displayUnit||(e.scaleData.displayUnit="%")),!e.is3DComp&&"group"!=o&&"model"!=o&&"light"!=o&&"freeShape"!=o&&e.item.anchorPoint){(0,r.set)(e,"anchorPointTool",!0)
var a=e.sceneItem;(0,i.next)(function(){if(a.isSelected){var e=a.controlsHandles
e&&e.domOrigin||console.log("no handles for ",a.name),e&&e.domOrigin&&e.savePreviousAnchorCSS()}})}else(0,r.set)(e,"anchorPointTool",!1)}}}editPosition(e){var t=this,o={x:1*t.positionData.values.x,y:1*t.positionData.values.y,z:1*t.positionData.values.z}
t.sceneItem.setPositionTo(o),t.controller.refreshAndRender(),!1!==e&&t.controller.addToHistory("item","edit position")}editRotation(e){var t=this,o={x:1*t.rotationData.values.x,y:1*t.rotationData.values.y,z:1*t.rotationData.values.z}
t.sceneItem.setRotationTo(o),t.controller.refreshAndRender(),!1!==e&&t.controller.addToHistory("item","edit rotation")}toggleScaleUnit(){var e=this.scaleData,t="px"
"px"==e.displayUnit&&(t="%"),(0,r.set)(e,"displayUnit",t)}setScaleUnit(e,t,o){(0,r.set)(e,t,o),"px"==o&&this.updateScalePx()}editScale(e,t){var o=this,r={x:1*o.scaleData.values.x,y:1*o.scaleData.values.y,z:1*o.scaleData.values.z}
o.scaleData.keepScaleRatio&&(r=o.applyScaleRatio(r,e)),o.sceneItem.setScaleTo(r),o.controller.refreshAndRender(),!1!==t&&o.controller.addToHistory("item","edit scale")}editScalePx(e,t){var o=this,r=o.compositionManager.currentFrame,n=o.sceneItem.getDimensionsAt(r),i={x:o.scalePx.x/n.width*100,y:o.scalePx.y/n.height*100,z:o.scaleData.values.z}
o.sceneItem.getTransformEnabledAxes().scale.z&&(i.z=o.scalePx.z/n.depth*100),o.scaleData.keepScaleRatio&&(i=o.applyScaleRatio(i,e)),i={x:roundValue(i.x,2),y:roundValue(i.y,2),z:roundValue(i.z,2)},o.sceneItem.setScaleTo(i),o.updateScalePx(),o.controller.refreshAndRender(),!1!==t&&o.controller.addToHistory("item","edit scale")}updateScalePx(){var e=this
if(e.item){var t=e.compositionManager.currentFrame,o=e.sceneItem.getDimensionsAt(t),n={x:roundValue(o.width*e.scaleData.values.x/100,2),y:roundValue(o.height*e.scaleData.values.y/100,2)}
e.sceneItem.getTransformEnabledAxes().scale.z&&(n.z=roundValue(o.depth*e.scaleData.values.z/100,2)),(0,r.set)(e,"scalePx",n)}}applyScaleRatio(e,t){var o=this,r=1
return"x"==t&&(r=e.x/o.savedScaleRatio.x),"y"==t&&(r=e.y/o.savedScaleRatio.y),"z"==t&&(r=e.z/o.savedScaleRatio.z),"x"!=t&&(e.x=o.savedScaleRatio.x*r),"y"!=t&&(e.y=o.savedScaleRatio.y*r),"z"!=t&&(e.z=o.savedScaleRatio.z*r),e}toggleKeepScaleRatio(){var e=this,t=e.scaleData.keepScaleRatio
void 0===t&&(t=!1),(0,r.set)(e.scaleData,"keepScaleRatio",!t),e.scaleData.keepScaleRatio&&e.saveScaleRatio()}saveScaleRatio(){var e=this,t={x:1*e.scaleData.values.x,y:1*e.scaleData.values.y,z:1*e.scaleData.values.z}
e.savedScaleRatio=t}editAnchorPoint(e){var t=this,o=t.sceneItem,n=o.controlsHandles,i=t.item.anchorPoint;(0,r.set)(i.values,"x",roundValue(i.values.x,1)),(0,r.set)(i.values,"y",roundValue(i.values.y,1)),n.savePreviousAnchorCSS(),n.update()
var a=n.domOrigin.getBoundingClientRect(),l=a.x-n.previousAnchorPointCSS.x,s=a.y-n.previousAnchorPointCSS.y,c=t.controller.compositionDisplayZoom/100,u=l/c,m=s/c,p=t.controller.currentFrame,d=o.getTransformAt(p),f={x:d.position.x+u,y:d.position.y+m,z:d.position.z}
o.setPositionTo(f,!1),o.itemData.position.keyframes&&o.itemData.position.keyframes.forEach(function(e){if(e.frame!=p){var t=e.values,o={x:t.x+u,y:t.y+m,z:t.z}
e.values={x:o.x,y:o.y,z:o.z}}}),e&&t.controller.refreshAndRender()}toggleUseKeyframes(e){var t=this,o=null
"position"==e&&(o=t.positionData),"rotation"==e&&(o=t.rotationData),"scale"==e&&(o=t.scaleData),(0,r.set)(o,"useKeyframes",!o.useKeyframes),o.useKeyframes&&(o.keyframes||t.controller.keyframesUtils.addTransformKey(t.item,e),t.item.open||(0,r.set)(t.item,"open",!0)),t.sceneItem.isAnimated()||(0,r.set)(t.item,"open",!1),t.controller.refreshAndRender(),t.controller.addToHistory("item","toggle use keyframes")}toggleUseExpression(e){var t=this,o=null
"position"==e&&(o=t.item.position),"rotation"==e&&(o=t.item.rotation),"scale"==e&&(o=t.item.scale),(0,r.set)(o,"useExpression",!o.useExpression)
var n=[""]
"position"==e&&(n=["",""]),"scale"==e&&(n=["",""]),o.expression||(o.expression={separated:!0,strings:n}),t.controller.triggerRefreshInputsValues(),t.controller.refreshAndRender(),t.controller.addToHistory("item","toggle expression on "+e)}},c(l.prototype,"editPosition",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"editPosition"),l.prototype),c(l.prototype,"editRotation",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"editRotation"),l.prototype),c(l.prototype,"toggleScaleUnit",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"toggleScaleUnit"),l.prototype),c(l.prototype,"setScaleUnit",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"setScaleUnit"),l.prototype),c(l.prototype,"editScale",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"editScale"),l.prototype),c(l.prototype,"editScalePx",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"editScalePx"),l.prototype),c(l.prototype,"toggleKeepScaleRatio",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"toggleKeepScaleRatio"),l.prototype),c(l.prototype,"editAnchorPoint",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"editAnchorPoint"),l.prototype),c(l.prototype,"toggleUseKeyframes",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"toggleUseKeyframes"),l.prototype),c(l.prototype,"toggleUseExpression",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"toggleUseExpression"),l.prototype),l);(0,t.setComponentTemplate)(u,m)}),define("pikimov/components/project/properties/mask",["exports","@ember/component","@glimmer/component","@ember/object","@ember/object/observers","@ember/template-factory"],function(e,t,o,r,n,i){var a
function l(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function s(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const c=(0,i.createTemplateFactory)({id:"0uoAYOFg",block:'[[[10,0],[14,0,"mask"],[12],[1,"\\n    "],[10,"br"],[12],[13],[1,"\\n    "],[8,[39,2],null,[["@label","@toolTip","@obj","@objProperty","@valueToTrackBoolean","@action"],["set as mask","Mask the item below this one",[30,0,["item","mask"]],"enabled",[30,0,["item","mask","enabled"]],[30,0,["editCheckBoxMask"]]]],null],[1,"\\n\\n"],[41,[30,0,["item","mask","enabled"]],[[[1,"        "],[8,[39,4],null,[["@label","@labels","@values","@obj","@objProperty","@valueToTrack","@action"],["mask type",[28,[37,5],["alpha","luminance"],null],[28,[37,5],["alpha","luma"],null],[30,0,["item","mask"]],"type",[30,0,["item","mask","type"]],[30,0,["setMaskType"]]]],null],[1,"\\n\\n        "],[8,[39,6],null,[["@label","@value","@min","@max","@minRangeInput","@maxRangeInput","@action","@displayInput","@unit"],["feather size",[30,0,["item","mask","feather","value"]],0,100,0,50,[30,0,["editFeather"]],true,"px"]],null],[1,"\\n\\n        "],[8,[39,6],null,[["@label","@value","@min","@max","@minRangeInput","@maxRangeInput","@action","@displayInput","@unit"],["expansion size",[30,0,["item","mask","expansion","value"]],-100,100,-20,20,[30,0,["editExpansion"]],true,"px"]],null],[1,"\\n\\n        "],[8,[39,2],null,[["@label","@obj","@objProperty","@valueToTrackBoolean","@action"],["invert masking",[30,0,["item","mask"]],"invert",[30,0,["item","mask","invert"]],[30,0,["editCheckBoxInvert"]]]],null],[1,"\\n"]],[]],null],[13]],[],["div","br","ui/property-checkbox","if","ui/property-selector","array","ui/property-range"]]',moduleName:"pikimov/components/project/properties/mask.hbs",isStrictMode:!1})
let u=e.default=(a=class extends o.default{constructor(){super(...arguments),l(this,"controller",null),l(this,"item",null)
var e=this
e.controller=e.args.controller,(0,n.addObserver)(e,"controller.selectionItemsUpdater",e.onSelectionChanged),e.onSelectionChanged()}addMissinData(){var e=this.item
e.mask||(0,r.set)(e,"mask",{enabled:!1,type:"alpha"}),_config.features.freeShape||(e.mask.feather&&(delete e.mask.feather,console.log("hotfix: delete feather")),e.mask.expansion&&(delete e.mask.expansion,console.log("hotfix: delete expansion"))),e.mask.enabled&&(e.mask.type||(0,r.set)(e.mask,"type","alpha"),_config.features.freeShape&&(e.mask.feather||(console.log("add feather + expand"),e.mask.feather={min:0,max:100,value:0},e.mask.expansion={min:-100,max:100,value:0})))}onSelectionChanged(){var e=this,t=e.controller.selectionUtils
if(1==t.getNbItemsSelected()){var o=t.getSelectedCompItem();(0,r.set)(e,"item",o),e.item.mask&&e.item.mask.enabled&&e.addMissinData()}}updateMask(){var e=this.controller
e.selectionUtils.saveHoldCurrentSelection()
var t=new compositionsUtils(e,e.activeComposition)
t.rebuildSoft(),t=null,e.rebuildTimelineComponent()}editCheckBoxMask(e,t,o){var n=this
n.addMissinData()
e=n.item.mask;(0,r.set)(e,t,o),n.addMissinData(),n.updateMask(),n.controller.addToHistory("item","edit mask")}editCheckBoxInvert(e,t,o){(0,r.set)(e,t,o),this.updateMask(),this.controller.addToHistory("item","edit mask")}setMaskType(e,t,o){(0,r.set)(e,t,o),this.updateMask(),this.controller.addToHistory("item","edit mask")}editFeather(e){var t=this.item.mask.feather
t.value<t.min&&(0,r.set)(t,"value",1*t.min),t.value>t.max&&(0,r.set)(t,"value",1*t.max),this.controller.refreshAndRender(),e&&this.controller.addToHistory("item","edit mask")}editExpansion(e){var t=this.item.mask.expansion
t.value<t.min&&(0,r.set)(t,"value",1*t.min),t.value>t.max&&(0,r.set)(t,"value",1*t.max),this.controller.refreshAndRender(),e&&this.controller.addToHistory("item","edit mask")}},s(a.prototype,"editCheckBoxMask",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"editCheckBoxMask"),a.prototype),s(a.prototype,"editCheckBoxInvert",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"editCheckBoxInvert"),a.prototype),s(a.prototype,"setMaskType",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"setMaskType"),a.prototype),s(a.prototype,"editFeather",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"editFeather"),a.prototype),s(a.prototype,"editExpansion",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"editExpansion"),a.prototype),a);(0,t.setComponentTemplate)(c,u)}),define("pikimov/components/project/properties/repeat",["exports","@ember/component","@glimmer/component","@ember/object","@ember/object/observers","@ember/template-factory"],function(e,t,o,r,n,i){var a
function l(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function s(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const c=(0,i.createTemplateFactory)({id:"MejjRBfT",block:'[[[10,0],[14,0,"mask"],[12],[1,"\\n    "],[10,"br"],[12],[13],[1,"\\n    "],[8,[39,2],null,[["@label","@toolTip","@obj","@objProperty","@valueToTrackBoolean","@action"],["allow repeating","Activate to allow time loops",[30,0,["item","repeat"]],"enabled",[30,0,["item","repeat","enabled"]],[30,0,["toggleEnabled"]]]],null],[1,"\\n\\n"],[41,[30,0,["item","repeat","enabled"]],[[[1,"\\n        "],[8,[39,4],null,null,[["default"],[[[[1,"To repeat the item, \\n            extend its stripe in the timeline\\n        "]],[]]]]],[1,"\\n\\n        "],[8,[39,5],null,[["@label","@value","@min","@max","@action","@displayInput"],["loop end frame",[30,0,["item","repeat","end"]],[30,0,["min"]],[30,0,["max"]],[30,0,["setEnd"]],true]],null],[1,"\\n"]],[]],null],[13]],[],["div","br","ui/property-checkbox","if","ui/property-note","ui/property-range"]]',moduleName:"pikimov/components/project/properties/repeat.hbs",isStrictMode:!1})
let u=e.default=(a=class extends o.default{constructor(){super(...arguments),l(this,"controller",null),l(this,"item",null),l(this,"min",1),l(this,"max",1)
var e=this
e.controller=e.args.controller,(0,n.addObserver)(e,"controller.selectionItemsUpdater",e.onSelectionChanged),e.onSelectionChanged()}onSelectionChanged(){var e=this,t=e.controller.selectionUtils
if(1==t.getNbItemsSelected()){var o=t.getSelectedCompItem();(0,r.set)(e,"item",o)
var n=e.controller.compositionManager,i=e.controller.getters.getSceneItemByCompUid(n,o.compUid);(0,r.set)(e,"max",i.maxFramesInComposition)}}toggleEnabled(e,t,o){var n=this,i=n.item,a=n.controller.compositionManager,l=n.controller.getters.getSceneItemByCompUid(a,i.compUid)
i.repeat?((0,r.set)(i,"repeat",void 0),i.time.out-i.time.in>l.maxFramesInComposition-1&&(0,r.set)(i.time,"out",i.time.in+l.maxFramesInComposition-1)):(0,r.set)(i,"repeat",{enabled:!0,type:"loop",start:0,end:l.maxFramesInComposition}),n.controller.addToHistory("item","toggle repeat")}setEnd(){var e=this.item.repeat
requestAnimationFrame(function(){(0,r.set)(e,"end",1*e.end)})}},s(a.prototype,"toggleEnabled",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"toggleEnabled"),a.prototype),s(a.prototype,"setEnd",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"setEnd"),a.prototype),a);(0,t.setComponentTemplate)(c,u)}),define("pikimov/components/project/properties/text",["exports","@ember/component","@glimmer/component","@ember/object","@ember/object/observers","@ember/template-factory"],function(e,t,o,r,n,i){var a
function l(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function s(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const c=(0,i.createTemplateFactory)({id:"Gjmwu4M1",block:'[[[10,0],[14,0,"textBox"],[12],[1,"\\n\\n    "],[8,[39,1],null,[["@label","@obj","@objProperty","@valueToTrackBoolean","@action"],["set text width",[30,1,["box"]],"enabled",[30,1,["box","enabled"]],[30,0,["setuseBox"]]]],null],[1,"\\n\\n"],[41,[30,1,["box","enabled"]],[[[1,"        "],[8,[39,3],null,[["@label","@value","@min","@max","@minRangeInput","@maxRangeInput","@action","@displayInput","@unit"],["width",[30,1,["box","width"]],20,2000,20,2000,[30,0,["editBoxSize"]],true,"px"]],null],[1,"\\n"]],[]],null],[13],[1,"\\n\\n"],[8,[39,4],null,[["@controller","@item","@parent"],[[30,2],[30,1],[30,0]]],null]],["@item","@controller"],["div","ui/property-checkbox","if","ui/property-range","project/properties/font-selector"]]',moduleName:"pikimov/components/project/properties/text.hbs",isStrictMode:!1})
let u=e.default=(a=class extends o.default{constructor(){super(...arguments),l(this,"controller",null),l(this,"item",null),l(this,"textAlignProperty",null),l(this,"textAlignLabels",["left","center","right"]),l(this,"textAlignValues",["left","center","right"])
var e=this
e.controller=e.args.controller,e.item=e.args.item,(0,n.addObserver)(e,"controller.selectionItemsUpdater",e.onSelectionChanged),e.textAlignProperty=e.item.params[3]}onSelectionChanged(){(0,r.set)(this,"item",this.args.item)}rebuildItem(){this.controller.getters.getCompSceneItemByCompUid(this.item.compUid).rebuild()}setItemFont(e){var t=this;(0,r.set)(t.item,"font",e),t.controller.addToHistory("item","set font",{needRebuild:!0}),t.rebuildItem(),_config.troikaText&&setTimeout(()=>{t.controller.refreshAndRender()},400)}setuseBox(e,t,o){var n=this
n.item.box||((0,r.set)(n.item,"box",{enabled:!0,width:500}),e=n.item.box),(0,r.set)(e,t,o),n.rebuildItem()}editBoxSize(){var e=this.item
e.box.width<20&&(0,r.set)(e.box,"width",20),e.box.width>2e3&&(0,r.set)(e.box,"width",2e3),this.rebuildItem()}},s(a.prototype,"setuseBox",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"setuseBox"),a.prototype),s(a.prototype,"editBoxSize",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"editBoxSize"),a.prototype),a);(0,t.setComponentTemplate)(c,u)}),define("pikimov/components/project/properties/toggle-icons",["exports","@ember/component","@glimmer/component","@ember/template-factory"],function(e,t,o,r){function n(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const i=(0,r.createTemplateFactory)({id:"Zj0hkqBV",block:'[[[1,"\\n"],[10,0],[14,0,"toggleIcons"],[12],[1,"\\n"],[41,[51,[30,1,["static"]]],[[[1,"        "],[11,"i"],[16,0,[29,["bx bx-time tooltip ",[52,[30,1,["useKeyframes"]],"on"]]]],[4,[38,4],["click",[30,2]],null],[12],[1,"\\n            "],[10,1],[14,0,"tooltiptext p0"],[12],[1,"toggle animated"],[13],[1,"\\n        "],[13],[1,"\\n"],[41,[30,0,["canUseExpressions"]],[[[1,"            "],[11,"i"],[16,0,[29,["bx bx-code-curly tooltip ",[52,[30,1,["useExpression"]],"on"]]]],[4,[38,4],["click",[30,3]],null],[12],[1,"\\n                "],[10,1],[14,0,"tooltiptext p0"],[12],[1,"toggle js expression"],[13],[1,"\\n            "],[13],[1,"\\n"]],[]],null]],[]],null],[13]],["@paramData","@animAction","@expAction"],["div","unless","i","if","on","span"]]',moduleName:"pikimov/components/project/properties/toggle-icons.hbs",isStrictMode:!1})
class a extends o.default{constructor(){super(...arguments),n(this,"type",null),n(this,"canUseExpressions",!1),this.type=this.args.paramData.type,this.args.type&&(this.type=this.args.type),_config.features.expressions&&("number"!=this.type&&"text"!=this.type||(this.canUseExpressions=!0))}}e.default=a,(0,t.setComponentTemplate)(i,a)}),define("pikimov/components/project/right-column",["exports","@ember/component","@glimmer/component","@ember/object","@ember/object/observers","@ember/template-factory"],function(e,t,o,r,n,i){var a
function l(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function s(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const c=(0,i.createTemplateFactory)({id:"gdytkhjC",block:'[[[10,0],[14,1,"rightColumn"],[12],[1,"\\n\\n    "],[10,"header"],[12],[1,"\\n        "],[10,"h3"],[14,0,"notranslate"],[12],[1,[30,0,["item","name"]]],[13],[1,"\\n\\n        "],[11,1],[24,0,"b_minify tooltip"],[4,[38,4],["click",[30,0,["togglePanel"]]],null],[12],[1,"\\n            "],[10,"i"],[14,0,"bx bx-chevrons-right"],[12],[13],[1,"\\n            "],[10,1],[14,0,"tooltiptext down p0"],[12],[1,"Hide panel"],[13],[1,"\\n        "],[13],[1,"\\n        "],[11,1],[24,0,"b_expand"],[4,[38,4],["click",[30,0,["togglePanel"]]],null],[12],[1,"\\n            "],[10,"i"],[14,0,"bx bx-chevrons-left"],[12],[13],[1,"\\n        "],[13],[1,"\\n    "],[13],[1,"\\n\\n"],[41,[30,1,["isCompositionReady"]],[[[1,"        "],[41,[30,0,["item"]],[[[1,"\\n\\n"],[41,[51,[30,0,["isMissing"]]],[[[1,"            "],[10,0],[14,0,"tabs sitting x3"],[12],[1,"\\n                "],[11,0],[16,0,[29,[[52,[28,[37,8],[[30,0,["selectedTab"]],"properties"],null],"active"]]]],[4,[38,4],["click",[28,[37,9],[[30,0,["setSelectTab"]],"properties"],null]],null],[12],[1,"properties"],[13],[1,"\\n                "],[11,0],[16,0,[29,[[52,[28,[37,8],[[30,0,["selectedTab"]],"effects"],null],"active"]]]],[4,[38,4],["click",[28,[37,9],[[30,0,["setSelectTab"]],"effects"],null]],null],[12],[1,"effects\\n                    "],[41,[30,0,["item","effects","length"]],[[[10,1],[14,0,"counter notranslate"],[12],[1,[30,0,["item","effects","length"]]],[13]],[]],null],[1,"\\n                "],[13],[1,"\\n            "],[13],[1,"\\n\\n            "],[10,0],[14,0,"body scrollbar"],[12],[1,"\\n"],[41,[28,[37,8],[[30,0,["selectedTab"]],"properties"],null],[[[1,"                    "],[8,[39,10],null,[["@controller"],[[30,1]]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[28,[37,8],[[30,0,["selectedTab"]],"effects"],null],[[[1,"                    "],[8,[39,11],null,[["@controller"],[[30,1]]],null],[1,"\\n"]],[]],null],[1,"            "],[13],[1,"\\n"]],[]],[[[1,"                "],[10,0],[14,0,"nothing"],[12],[1,"\\n                    "],[10,2],[12],[1,"missing file"],[13],[1,"\\n                "],[13],[1,"\\n"]],[]]],[1,"            \\n"]],[]],[[[1,"            "],[10,0],[14,0,"nothing"],[12],[1,"\\n"],[41,[30,0,["nbItemsSelected"]],[[[1,"                "],[10,2],[12],[1,"multiple items selected"],[13],[1,"          \\n"]],[]],[[[1,"                "],[10,2],[12],[1,"nothing selected"],[13],[1,"\\n"]],[]]],[1,"            "],[13],[1,"\\n"]],[]]]],[]],null],[1,"\\n"],[13]],["@controller"],["div","header","h3","span","on","i","if","unless","eq","fn","project/properties/item-properties","project/effects/item-effects","p"]]',moduleName:"pikimov/components/project/right-column.hbs",isStrictMode:!1})
let u=e.default=(a=class extends o.default{constructor(){super(...arguments),l(this,"selectedTab","properties"),l(this,"controller",null),l(this,"item",null),l(this,"nbItemsSelected",0),l(this,"isMissing",!1)
var e=this
e.controller=e.args.controller,(0,n.addObserver)(e,"controller.selectionItemsUpdater",e.onSelectionChanged),(0,n.addObserver)(e,"controller.projectData",e.onProjectClosed),e.onSelectionChanged()}onProjectClosed(){this.setSelectTab("properties")}setItem(e){var t=this
if((0,r.set)(t,"item",e),e){var o=t.controller.getters.getSceneItemByCompUid(t.controller.compositionManager,t.item.compUid)
o&&(0,r.set)(t,"isMissing",o.isMissing)}}onSelectionChanged(){var e=this
if(e.controller.selectionUtils)if((0,r.set)(e,"nbItemsSelected",e.controller.selectionUtils.getNbItemsSelected()),1==e.nbItemsSelected){var t=e.controller.selectionUtils.getSelectedCompItem()
e.setItem(t)}else e.setItem(null)}togglePanel(){$("#projectTop").toggleClass("minRightColumn")
var e=this.controller.uiManager
e.resizeHandler(),setTimeout(function(){e.resizeHandler()},300)}setSelectTab(e){(0,r.set)(this,"selectedTab",e)}},s(a.prototype,"togglePanel",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"togglePanel"),a.prototype),s(a.prototype,"setSelectTab",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"setSelectTab"),a.prototype),a);(0,t.setComponentTemplate)(c,u)}),define("pikimov/components/project/timeline/curves-editor",["exports","@ember/component","@glimmer/component","@ember/object","@ember/template-factory"],function(e,t,o,r,n){var i,a,l
function s(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function c(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const u=(0,n.createTemplateFactory)({id:"JAYrnNFS",block:'[[[10,0],[14,1,"curvesEditor"],[12],[1,"\\n\\n    "],[10,2],[14,0,"propertyName"],[12],[13],[1,"\\n    \\n"],[13],[1,"\\n"],[1,[30,0,["onZoomChanged"]]],[1,"\\n"],[1,[30,0,["onTimelineResized"]]]],[],["div","p"]]',moduleName:"pikimov/components/project/timeline/curves-editor.hbs",isStrictMode:!1})
let m=e.default=(i=(0,r.computed)("args.zoom"),a=(0,r.computed)("controller.uiManager.timelineHeight"),l=class extends o.default{constructor(){super(...arguments),s(this,"timelineComponent",null)
this.timelineComponent=this.args.controller.timelineComponent}willDestroy(){this.timelineComponent.curvesEditorManager&&this.timelineComponent.curvesEditorManager.destroy()}get onZoomChanged(){var e=this
e.timelineComponent.curvesEditorManager&&e.timelineComponent.curvesEditorManager.onZoomChanged(e.args.zoom)}get onTimelineResized(){this.timelineComponent.curvesEditorManager&&this.timelineComponent.curvesEditorManager.build()}},c(l.prototype,"onZoomChanged",[i],Object.getOwnPropertyDescriptor(l.prototype,"onZoomChanged"),l.prototype),c(l.prototype,"onTimelineResized",[a],Object.getOwnPropertyDescriptor(l.prototype,"onTimelineResized"),l.prototype),l);(0,t.setComponentTemplate)(u,m)}),define("pikimov/components/project/timeline/input/b-curve-editor",["exports","@ember/component","@glimmer/component","@ember/object","@ember/runloop","@ember/template-factory"],function(e,t,o,r,n,i){var a
function l(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const s=(0,i.createTemplateFactory)({id:"8oXLw6Zl",block:'[[[41,[30,0,["displayButton"]],[[[11,1],[16,0,[29,["b_curvesEditor",[52,[30,1,["curvesEditorOpen"]]," on"]]]],[4,[38,2],["click",[30,0,["toggleCurveEditor"]]],null],[12],[1,"\\n    "],[10,"i"],[14,0,"bx bx-stats"],[12],[13],[1,"\\n"],[13],[1,"\\n"]],[]],null]],["@property"],["if","span","on","i"]]',moduleName:"pikimov/components/project/timeline/input/b-curve-editor.hbs",isStrictMode:!1})
let c=e.default=(a=class extends o.default{constructor(){super(...arguments),l(this,"controller",null),l(this,"displayButton",!1)
var e=this
e.controller=e.args.controller,_config.features.curvesEditor&&(e.displayButton=!0)
var t=e.controller.timelineComponent
e.args.property.curvesEditorOpen&&((0,r.set)(t,"isCurvesEditorOpen",!0),e.doCurveEditor())}doCurveEditor(){var e=this,t=e.controller.timelineComponent;(0,n.next)(function(){if(!t.doCurveEditor()){t.closeCurvesEditor()
var o=e.args.property;(0,r.set)(o,"curvesEditorOpen",void 0)}})}toggleCurveEditor(){var e=this,t=e.controller.timelineComponent,o=e.args.property,n=o.curvesEditorOpen
void 0===n&&(n=!1),n=!n
var i=e.controller.activeCompositionData
e.controller.getters.getAllCompositionItems(i).forEach(function(e){e.position&&(0,r.set)(e.position,"curvesEditorOpen",void 0),e.rotation&&(0,r.set)(e.rotation,"curvesEditorOpen",void 0),e.scale&&(0,r.set)(e.scale,"curvesEditorOpen",void 0),e.params.forEach(function(e){(0,r.set)(e,"curvesEditorOpen",void 0)}),e.effects.forEach(function(e){e.params.forEach(function(e){(0,r.set)(e,"curvesEditorOpen",void 0)})})}),(0,r.set)(t,"isCurvesEditorOpen",n),n?(0,r.set)(o,"curvesEditorOpen",n):(0,r.set)(o,"curvesEditorOpen",void 0),n?e.doCurveEditor():t.closeCurvesEditor(),e.controller.addToHistory("key","toggle curves editor")}},u=a.prototype,m="toggleCurveEditor",p=[r.action],d=Object.getOwnPropertyDescriptor(a.prototype,"toggleCurveEditor"),f=a.prototype,v={},Object.keys(d).forEach(function(e){v[e]=d[e]}),v.enumerable=!!v.enumerable,v.configurable=!!v.configurable,("value"in v||v.initializer)&&(v.writable=!0),v=p.slice().reverse().reduce(function(e,t){return t(u,m,e)||e},v),f&&void 0!==v.initializer&&(v.value=v.initializer?v.initializer.call(f):void 0,v.initializer=void 0),void 0===v.initializer&&Object.defineProperty(u,m,v),a)
var u,m,p,d,f,v;(0,t.setComponentTemplate)(s,c)}),define("pikimov/components/project/timeline/input/item-effect-param",["exports","@ember/component","@glimmer/component","@ember/object","@ember/runloop","@ember/object/observers","@ember/template-factory"],function(e,t,o,r,n,i,a){var l,s,c
function u(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function m(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const p=(0,a.createTemplateFactory)({id:"m19PlhL0",block:'[[[41,[30,1,["useKeyframes"]],[[[1,"\\n    "],[1,[30,0,["onValuesUpdated"]]],[1,"\\n\\n    "],[10,0],[15,0,[29,["param ",[52,[30,1,["useKeyframes"]],"useKeyframes"]," ",[52,[51,[30,0,["keyOnFrame"]]],"noKey"]," ",[52,[51,[30,0,["hasKeyframes"]]],"noKeys"]]]],[12],[1,"\\n        "],[10,0],[12],[1,"\\n            "],[10,"label"],[12],[1,[30,2,["args","effectData","name"]]],[13],[1,"\\n\\n"],[41,[28,[37,4],[[30,1,["type"]],"number"],null],[[[1,"\\n"],[41,[30,1,["rangeInput__TODO"]],[[[1,"                    "],[8,[39,5],null,[["@label","@value","@min","@max","@displayInput","@action","@noGrid","@disabled"],[[30,1,["name"]],[30,0,["input","param","value"]],[30,1,["min"]],[30,1,["max"]],true,[30,0,["editValueRange"]],[30,1,["noGrid"]],[28,[37,6],[[30,0,["keyOnFrame"]],true],null]]],null],[1,"\\n"]],[]],[[[1,"                    "],[8,[39,7],null,[["@label","@obj","@property","@min","@max","@action","@disabled"],[[30,1,["name"]],[30,0,["input","param"]],"value",[30,0,["input","min"]],[30,0,["input","max"]],[30,0,["editValue"]],[28,[37,6],[[30,0,["keyOnFrame"]],true],null]]],null],[1," \\n"]],[]]],[1,"   \\n"]],[]],null],[1,"\\n"],[41,[28,[37,4],[[30,1,["type"]],"color"],null],[[[1,"                "],[8,[39,8],null,[["@label","@value","@action","@disabled"],[[30,1,["name"]],[30,0,["input","param","value"]],[30,0,["editValue"]],[28,[37,6],[[30,0,["keyOnFrame"]],true],null]]],null],[1,"\\n"]],[]],null],[1,"\\n        "],[13],[1,"\\n        "],[10,0],[12],[1,"\\n            "],[8,[39,9],null,[["@controller","@item","@property"],[[30,3],[30,4],[30,1]]],null],[1,"\\n        "],[13],[1,"\\n        "],[10,0],[14,0,"keysButtons"],[12],[1,"\\n"],[41,[30,1,["useKeyframes"]],[[[1,"            "],[11,"i"],[24,0,"bx bx-chevron-left"],[4,[38,11],["click",[30,0,["prevKey"]]],null],[12],[13],[1,"\\n            "],[11,"i"],[24,0,"bx bx-key addKey off"],[24,"title","Add keyframe"],[4,[38,11],["click",[30,0,["addKey"]]],null],[12],[13],[1,"\\n            "],[11,"i"],[24,0,"bx bx-key removeKey on"],[4,[38,11],["click",[30,0,["removeKey"]]],null],[12],[13],[1,"\\n            "],[11,"i"],[24,0,"bx bx-chevron-right"],[4,[38,11],["click",[30,0,["nextKey"]]],null],[12],[13],[1,"\\n"]],[]],null],[1,"        "],[13],[1,"\\n    "],[13],[1,"\\n\\n"]],[]],null]],["@paramData","@parent","@controller","@item"],["if","div","unless","label","eq","ui/property-range","neq","ui/property-number","ui/property-color","project/timeline/input/b-curve-editor","i","on"]]',moduleName:"pikimov/components/project/timeline/input/item-effect-param.hbs",isStrictMode:!1})
let d=e.default=(l=(0,r.computed)("args.controller.inputsUpdater","args.item.time.in"),s=(0,r.computed)("args.controller.currentFrame","args.randomForKeyEvent","args.item.time.in"),c=class extends o.default{constructor(){super(...arguments),u(this,"controller",null),u(this,"item",null),u(this,"sceneItem",null),u(this,"hasKeyframes",!1),u(this,"indexParam",null),u(this,"input",{})
var e=this
e.controller=e.args.controller,e.item=e.args.item,e.sceneItem=e.controller.getters.getCompSceneItemByCompUid(e.item.compUid),e.paramData=e.args.paramData,e.indexParam=e.args.indexParam,(0,i.addObserver)(e,"controller.currentFrame",e.onFrameChanged),(0,i.addObserver)(e,"paramData.useKeyframes",e.checkHasKeyframes),(0,n.next)(function(){e.controller.isCompositionReady&&(e.onFrameChanged(),e.checkHasKeyframes())})}updateUseKeyframes(){this.args.parent.updateUseKeyframes()}onFrameChanged(){var e=this
if(e.paramData.useKeyframes&&e.controller.compositionManager){var t=e.sceneItem
if(t&&t.effectManager){var o=e.controller.currentFrame,n=e.controller.getters.getEffectParamValue(t,e.args.indexEffect,e.args.indexParam,o);(0,r.set)(e.input,"param",{value:n})}}}checkHasKeyframes(){var e=this,t=!1
e.paramData.keyframes&&e.paramData.keyframes.length&&(t=!0),(0,r.set)(e,"hasKeyframes",t),e.updateUseKeyframes(),e.onFrameChanged()}updateValue(e,t){var o=this,n=o.paramData
if("number"==n.type&&(e*=1,void 0!==n.min&&e<n.min&&(e=n.min),void 0!==n.max&&e>n.max&&(e=n.max),(0,r.set)(o.input.param,"value",e)),n.useKeyframes){var i=n.keyframes,a=o.controller.keyframesUtils.getKeyByFrameIndex(i,o.controller.currentFrame);(0,r.set)(a,"values",{p:e}),o.controller.keyframesUtils.checkStaticKeys(i)}else(0,r.set)(n,"value",e)
o.controller.refreshAndRender(),!1!==t&&o.controller.addToHistory("item","edit fx param value")}get onValuesUpdated(){this.onFrameChanged()}get keyOnFrame(){var e=this,t=e.paramData.keyframes
return!t||!!e.controller.keyframesUtils.getKeyByFrameIndex(t,e.controller.currentFrame)}editValue(e){var t=this.input.param.value
this.updateValue(t,e)}editValueRange(e){var t=$(event.target).val()
this.updateValue(t,e)}toggleUseKeyframes(){var e=this,t=e.paramData;(0,r.set)(t,"useKeyframes",!t.useKeyframes),e.controller.refreshAndRender(),e.controller.addToHistory("item fx param","toggle use keyframes"),t.useKeyframes&&!t.keyframes&&e.addKey(),e.onFrameChanged()}addKey(){var e=this,t=e.args.indexEffect
e.controller.keyframesUtils.addEffectKey(e.item,e.paramData,null,t,e.indexParam),(0,r.set)(e,"hasKeyframes",!0)}removeKey(){var e=this
e.controller.keyframesUtils.deleteKeyByFrameIndex(e.paramData.keyframes,e.controller.currentFrame),e.checkHasKeyframes()}prevKey(){var e=this,t=e.controller.keyframesUtils.findPreviousKeyframe(e.controller.currentFrame,e.paramData.keyframes)
null!==t&&e.controller.setFrame(t)}nextKey(){var e=this,t=e.controller.keyframesUtils.findNextKeyframe(e.controller.currentFrame,e.paramData.keyframes)
null!==t&&e.controller.setFrame(t)}},m(c.prototype,"onValuesUpdated",[l],Object.getOwnPropertyDescriptor(c.prototype,"onValuesUpdated"),c.prototype),m(c.prototype,"keyOnFrame",[s],Object.getOwnPropertyDescriptor(c.prototype,"keyOnFrame"),c.prototype),m(c.prototype,"editValue",[r.action],Object.getOwnPropertyDescriptor(c.prototype,"editValue"),c.prototype),m(c.prototype,"editValueRange",[r.action],Object.getOwnPropertyDescriptor(c.prototype,"editValueRange"),c.prototype),m(c.prototype,"toggleUseKeyframes",[r.action],Object.getOwnPropertyDescriptor(c.prototype,"toggleUseKeyframes"),c.prototype),m(c.prototype,"addKey",[r.action],Object.getOwnPropertyDescriptor(c.prototype,"addKey"),c.prototype),m(c.prototype,"removeKey",[r.action],Object.getOwnPropertyDescriptor(c.prototype,"removeKey"),c.prototype),m(c.prototype,"prevKey",[r.action],Object.getOwnPropertyDescriptor(c.prototype,"prevKey"),c.prototype),m(c.prototype,"nextKey",[r.action],Object.getOwnPropertyDescriptor(c.prototype,"nextKey"),c.prototype),c);(0,t.setComponentTemplate)(p,d)}),define("pikimov/components/project/timeline/input/item-effect",["exports","@ember/component","@glimmer/component","@ember/object","@ember/template-factory"],function(e,t,o,r,n){function i(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const a=(0,n.createTemplateFactory)({id:"cTvxz64M",block:'[[[10,0],[15,0,[29,["effect",[52,[51,[30,1,["enabled"]]]," disabled"]]]],[12],[1,"\\n"],[42,[28,[37,3],[[28,[37,3],[[30,1,["params"]]],null]],null],null,[[[1,"    "],[8,[39,4],null,[["@controller","@parent","@indexEffect","@item","@paramData","@indexParam","@randomForKeyEvent"],[[30,4],[30,0],[30,5],[30,6],[30,2],[30,3],[30,7]]],null],[1,"\\n"]],[2,3]],null],[13]],["@effectData","param","index","@controller","@effectIndex","@item","@randomForKeyEvent"],["div","unless","each","-track-array","project/timeline/input/item-effect-param"]]',moduleName:"pikimov/components/project/timeline/input/item-effect.hbs",isStrictMode:!1})
class l extends o.default{constructor(){super(...arguments),i(this,"effectData",null),i(this,"useKeyframes",!1)
this.effectData=this.args.effectData}updateUseKeyframes(){var e=!1
this.effectData.params.forEach(function(t){t.useKeyframes&&(e=!0)}),(0,r.set)(this,"useKeyframes",e)}}e.default=l,(0,t.setComponentTemplate)(a,l)}),define("pikimov/components/project/timeline/input/item-inputs",["exports","@ember/component","@glimmer/component","@ember/object","@ember/runloop","@ember/object/observers","@ember/template-factory"],function(e,t,o,r,n,i,a){var l,s
function c(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function u(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const m=(0,a.createTemplateFactory)({id:"0x3YvdS7",block:'[[[41,[30,0,["isMissing"]],[[[11,0],[16,0,[29,["oneItemInputs missingItem",[52,[30,0,["isSelected"]]," active"]]]],[16,"data-compuid",[29,[[30,1,["compUid"]]]]],[4,[38,2],["click",[30,0,["selectItem"]]],null],[12],[1,"\\n    "],[10,"label"],[12],[1,"missing item ("],[1,[30,1,["name"]]],[1,")"],[13],[1,"\\n"],[13],[1,"\\n"]],[]],[[[10,0],[15,0,[29,["oneItemInputs",[52,[30,0,["isSelected"]]," active"],[52,[30,1,["open"]]," open"]]]],[15,"data-compuid",[29,[[30,1,["compUid"]]]]],[12],[1,"\\n\\n    "],[11,1],[24,0,"thumb handle"],[4,[38,2],["click",[30,0,["selectItem"]]],null],[12],[13],[1,"\\n\\n    "],[10,0],[14,0,"inputs"],[12],[1,"\\n\\n        "],[10,"header"],[15,"data-compuid",[29,[[30,1,["compUid"]]]]],[12],[1,"\\n"],[41,[30,0,["canOpen"]],[[[1,"            "],[11,1],[24,0,"triangle"],[4,[38,2],["click",[30,0,["toggleOpen"]]],null],[12],[10,"i"],[15,0,[29,["bx bxs-right-arrow",[52,[30,1,["open"]]," bx-rotate-90"]]]],[12],[13],[13],[1,"\\n"]],[]],[[[1,"            "],[10,1],[14,0,"triangle"],[14,5,"visibility:hidden;"],[12],[13],[1,"\\n"]],[]]],[1,"\\n            "],[10,0],[14,0,"eyeAndAudio"],[12],[1,"\\n\\n"],[1,"                "],[41,[30,1,["time"]],[[[1,"\\n                "],[11,1],[24,0,"visible"],[4,[38,2],["click",[30,0,["toggleVisibility"]]],null],[12],[1,"\\n"],[41,[51,[28,[37,8],[[30,1,["type"]],"audio"],null]],[[[41,[30,1,["hidden"]],[[[1,"                            "],[10,"i"],[14,0,"fa fa-eye-slash"],[12],[13],[1,"\\n"]],[]],[[[1,"                            "],[10,"i"],[14,0,"fa fa-eye"],[12],[13],[1,"\\n"]],[]]]],[]],[[[41,[30,1,["hidden"]],[[[1,"                            "],[10,"i"],[14,0,"bx bx-volume-mute"],[12],[13],[1,"\\n"]],[]],[[[1,"                            "],[10,"i"],[14,0,"bx bx-volume-full"],[12],[13],[1,"\\n"]],[]]]],[]]],[1,"                "],[13],[1,"\\n"]],[]],[[[1,"                "],[10,1],[12],[13],[1,"\\n"]],[]]],[1,"\\n"],[41,[30,0,["sceneItem","hasAudio"]],[[[1,"                "],[11,1],[24,0,"audio"],[4,[38,2],["click",[30,0,["toggleSubCompMuted"]]],null],[12],[1,"\\n"],[41,[30,1,["muted"]],[[[1,"                        "],[10,"i"],[14,0,"bx bx-volume-mute"],[12],[13],[1,"\\n"]],[]],[[[1,"                        "],[10,"i"],[14,0,"bx bx-volume-full"],[12],[13],[1,"\\n"]],[]]],[1,"                "],[13],[1,"  \\n"]],[]],null],[1,"            "],[13],[1,"\\n\\n"],[1,"            "],[11,1],[24,0,"lock"],[4,[38,2],["click",[30,0,["toggleLock"]]],null],[12],[1,"\\n"],[41,[30,1,["locked"]],[[[1,"                    "],[10,"i"],[14,0,"fa fa-lock"],[12],[13],[1,"\\n"]],[]],[[[1,"                    "],[10,"i"],[14,0,"fa fa-unlock"],[12],[13],[1,"\\n"]],[]]],[1,"            "],[13],[1,"\\n\\n            "],[11,1],[16,0,[29,["name ",[52,[30,0,["isEditingName"]],"editName"]]]],[4,[38,2],["mousedown",[30,0,["selectItem"]]],null],[4,[38,2],["dblclick",[30,0,["editName"]]],null],[12],[1,"\\n                "],[10,1],[14,0,"dev"],[12],[1,[30,1,["compUid"]]],[1," "],[1,[30,0,["subIndex"]]],[13],[1,"\\n                "],[10,"label"],[14,0,"notranslate"],[12],[1,[30,1,["name"]]],[13],[1,"\\n                "],[8,[39,9],[[24,"placeholder","item name"],[24,"maxlength","22"],[4,[38,2],["blur",[30,0,["stopEditName"]]],null]],[["@type","@value","@enter"],["text",[30,1,["name"]],[30,0,["stopEditName"]]]],null],[1,"\\n            "],[13],[1,"\\n\\n            "],[41,[30,1,["time"]],[[[1,"\\n            "],[10,0],[14,0,"inOut"],[12],[1,"\\n                "],[8,[39,10],null,[["@obj","@property","@action","@max"],[[30,1,["time"]],"in",[30,0,["editItemTime"]],[30,1,["time","out"]]]],null],[1,"\\n                "],[8,[39,10],null,[["@label","@obj","@property","@noTranslate","@action"],["",[30,1,["time"]],"out",true,[30,0,["editItemTime"]]]],null],[1,"\\n            "],[13],[1,"\\n"]],[]],null],[1,"        "],[13],[1,"\\n\\n        "],[41,[30,0,["canOpen"]],[[[1,"\\n"],[41,[30,1,["open"]],[[[1,"\\n            "],[8,[39,11],null,[["@controller","@item","@randomForKeyEvent"],[[30,2],[30,1],[30,0,["randomForKeyEvent"]]]],null],[1,"\\n\\n"],[42,[28,[37,13],[[28,[37,13],[[30,1,["params"]]],null]],null],null,[[[1,"\\n"],[41,[30,3,["useKeyframes"]],[[[1,"                    "],[8,[39,14],null,[["@controller","@item","@paramData","@randomForKeyEvent"],[[30,2],[30,1],[30,3],[30,0,["randomForKeyEvent"]]]],null],[1,"\\n"]],[]],null],[1,"\\n"],[42,[28,[37,13],[[28,[37,13],[[30,3,["params"]]],null]],null],null,[[[41,[30,4,["useKeyframes"]],[[[1,"                    "],[8,[39,14],null,[["@controller","@item","@paramData","@randomForKeyEvent"],[[30,2],[30,1],[30,4],[30,0,["randomForKeyEvent"]]]],null],[1,"\\n"]],[]],null]],[4]],null],[1,"\\n"]],[3]],null],[1,"\\n"],[1,"            "],[10,0],[14,0,"effects"],[12],[1,"\\n"],[42,[28,[37,13],[[28,[37,13],[[30,1,["effects"]]],null]],null],null,[[[1,"                    "],[8,[39,15],null,[["@controller","@item","@effectData","@effectIndex","@randomForKeyEvent"],[[30,2],[30,1],[30,5],[30,6],[30,0,["randomForKeyEvent"]]]],null],[1,"\\n"]],[5,6]],null],[1,"            "],[13],[1,"\\n\\n"]],[]],null]],[]],null],[1,"\\n"],[41,[28,[37,8],[[30,1,["type"]],"group"],null],[[[1,"        "],[10,0],[15,0,[29,["overSubItems",[52,[51,[30,1,["items","length"]]]," empty"]]]],[12],[1,"\\n"],[41,[30,1,["items","length"]],[[[1,"                \\n                "],[10,"header"],[14,0,"groupHeader"],[15,"data-parentCompUid",[30,1,["compUid"]]],[12],[1,"\\n                    "],[11,1],[24,0,"triangle"],[4,[38,2],["click",[30,0,["toggleGroupOpen"]]],null],[12],[10,"i"],[15,0,[29,["bx bxs-right-arrow",[52,[30,1,["groupOpen"]]," bx-rotate-90"]]]],[12],[13],[13],[1,"\\n                    "],[10,"label"],[15,0,[29,[[52,[30,0,["isChildSelected"]],"childSelected"]]]],[12],[1,"group items"],[13],[1,"\\n                "],[13],[1,"\\n\\n"],[41,[30,1,["groupOpen"]],[[[1,"                "],[10,0],[14,0,"subItems"],[15,"data-parentCompUid",[30,1,["compUid"]]],[12],[1,"\\n"],[42,[28,[37,13],[[28,[37,13],[[30,1,["items"]]],null]],null],null,[[[1,"                    "],[8,[39,16],null,[["@controller","@item","@timeline"],[[30,2],[30,7],[30,9]]],null],[1,"\\n"]],[7,8]],null],[1,"                "],[13],[1,"\\n"]],[]],null]],[]],[[[1,"                "],[10,"header"],[14,0,"groupHeader"],[15,"data-parentCompUid",[30,1,["compUid"]]],[12],[1,"\\n                    "],[10,"label"],[12],[1,"empty group"],[13],[1,"\\n                "],[13],[1,"\\n"]],[]]],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[1,"\\n    "],[13],[1,"\\n\\n"],[13],[1,"\\n"]],[]]]],["@item","@controller","paramData","subParamData","effectData","index","subItem","index","@timeline"],["if","div","on","label","span","header","i","unless","eq","input","ui/property-number","project/timeline/input/item-transform-inputs","each","-track-array","project/timeline/input/item-param-inputs","project/timeline/input/item-effect","project/timeline/input/item-inputs"]]',moduleName:"pikimov/components/project/timeline/input/item-inputs.hbs",isStrictMode:!1})
let p=e.default=(l=(0,r.computed)("args.item.open","randomForKeyEvent"),s=class extends o.default{constructor(){super(...arguments),c(this,"controller",null),c(this,"item",null),c(this,"sceneItem",null),c(this,"isMissing",!1),c(this,"isSelected",!1),c(this,"isEditingName",!1),c(this,"isMasked",!1),c(this,"isChildSelected",!1),c(this,"randomForKeyEvent",0)
var e=this
e.controller=e.args.controller,e.item=e.args.item,e.sceneItem=e.controller.getters.getCompSceneItemByCompUid(e.item.compUid),e.sceneItem||console.log("error - no sceneItem item-input",e.item.compUid,e.item.name,e.item.type),e.sceneItem.isMissing&&(e.isMissing=!0),e.subIndex=e.sceneItem.localIndex,(0,i.addObserver)(e,"controller.selectionItemsUpdater",e.onSelectionChanged),e.onSelectionChanged(),(0,n.next)(function(){e.onKeyEvent=e.onKeyEvent.bind(e)
var t="keyframesUpdate_"+e.item.compUid
document.addEventListener(t,e.onKeyEvent,!1)})}willDestroy(){var e="keyframesUpdate_"+this.item.compUid
document.removeEventListener(e,this.onKeyEvent,!1)}onKeyEvent(){(0,r.set)(this,"randomForKeyEvent",Math.random())}onSelectionChanged(){var e=this,t=e.controller.selectionUtils.selectionArray.items
if(0!=e.controller.selectionUtils.getNbItemsSelected()){var o=t.some(function(t){return t.compUid==e.item.compUid});(0,r.set)(e,"isSelected",o)
var n=e.controller.getters.getAllChidrenItems(e.item),i=!1
n.forEach(function(e){i||t.some(function(t){return t.compUid==e.compUid})&&(i=!0)}),(0,r.set)(e,"isChildSelected",i)
var a=e.sceneItem.isMasked();(0,r.set)(e,"isMasked",a)}else e.isSelected&&(0,r.set)(e,"isSelected",!1)}get canOpen(){return this.sceneItem.isAnimated()}editName(){if(!_keyboardUtils.controlKey){(0,r.set)(this,"isEditingName",!0)
var e=$(event.currentTarget)
e.addClass("editName")
var t=e.find("input").first()
t.focus(),t.select()}}stopEditName(){this.isEditingName&&this.args.timeline.stopEditName(),(0,r.set)(this,"isEditingName",!1)}toggleOpen(){var e=!this.item.open
e||(e=void 0),(0,r.set)(this.item,"open",e)}toggleGroupOpen(){(0,r.set)(this.item,"groupOpen",!this.item.groupOpen)}toggleLock(){var e=this,t=!e.item.locked
t||(t=void 0),(0,r.set)(e.item,"locked",t),e.item.locked&&(e.controller.selectionUtils.removeFromSelection(e.item),e.controller.selectionUtils.updateDom(),e.controller.refreshAndRender())}selectItem(){var e=this
e.item.locked||(e.isEditingName||2!=event.button&&((0,n.next)(function(){e.controller.uiManager.keyboardFocus()}),_keyboardUtils.controlKey?e.controller.selectionUtils.toggleItemToSelection(e.item):e.controller.selectionUtils.selectItem(e.item)))}editItemTime(){var e=this,t=e.sceneItem,o=t.type,i=e.item.time,a=1*i.out
if(a>5e5&&(a=5e5),!("video"!=o&&"audio"!=o&&"composition"!=o||e.item.repeat&&e.item.repeat.enabled)){var l=t.getStripeMaxFrames(),s=1*i.in+l-1*i.trackIn
a>s&&(a=s)}1*i.in>a&&(0,r.set)(i,"in",a),(0,r.set)(i,"out",a),"video"==o&&t.updateInOutFrames(),e.controller.addToHistory("item","edit on/out"),"audio"==o&&t.buildWaveForm(),(0,n.next)(function(){(0,r.set)(i,"in",1*i.in),(0,r.set)(i,"out",1*i.out)}),e.controller.refreshAndRender()}toggleVisibility(){var e=this
void 0===e.item.hidden&&(e.item.hidden=!1),(0,r.set)(e.item,"hidden",!e.item.hidden),e.controller.refreshAndRender(),e.controller.needSaving()}toggleSubCompMuted(){var e=this
void 0===e.item.muted&&(e.item.muted=!1),(0,r.set)(e.item,"muted",!e.item.muted),e.controller.needSaving()}},u(s.prototype,"canOpen",[l],Object.getOwnPropertyDescriptor(s.prototype,"canOpen"),s.prototype),u(s.prototype,"editName",[r.action],Object.getOwnPropertyDescriptor(s.prototype,"editName"),s.prototype),u(s.prototype,"stopEditName",[r.action],Object.getOwnPropertyDescriptor(s.prototype,"stopEditName"),s.prototype),u(s.prototype,"toggleOpen",[r.action],Object.getOwnPropertyDescriptor(s.prototype,"toggleOpen"),s.prototype),u(s.prototype,"toggleGroupOpen",[r.action],Object.getOwnPropertyDescriptor(s.prototype,"toggleGroupOpen"),s.prototype),u(s.prototype,"toggleLock",[r.action],Object.getOwnPropertyDescriptor(s.prototype,"toggleLock"),s.prototype),u(s.prototype,"selectItem",[r.action],Object.getOwnPropertyDescriptor(s.prototype,"selectItem"),s.prototype),u(s.prototype,"editItemTime",[r.action],Object.getOwnPropertyDescriptor(s.prototype,"editItemTime"),s.prototype),u(s.prototype,"toggleVisibility",[r.action],Object.getOwnPropertyDescriptor(s.prototype,"toggleVisibility"),s.prototype),u(s.prototype,"toggleSubCompMuted",[r.action],Object.getOwnPropertyDescriptor(s.prototype,"toggleSubCompMuted"),s.prototype),s);(0,t.setComponentTemplate)(m,p)}),define("pikimov/components/project/timeline/input/item-param-inputs",["exports","@ember/component","@glimmer/component","@ember/object","@ember/object/observers","@ember/template-factory"],function(e,t,o,r,n,i){var a,l,s
function c(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function u(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const m=(0,i.createTemplateFactory)({id:"NAB8iYkN",block:'[[[1,[30,0,["onValuesUpdated"]]],[1,"\\n\\n"],[10,0],[15,0,[29,["param ",[52,[30,1,["useKeyframes"]],"useKeyframes"]," ",[52,[51,[30,0,["keyOnFrame"]]],"noKey"]," ",[52,[51,[30,0,["hasKeyframes"]]],"noKeys"]]]],[12],[1,"\\n    \\n    "],[10,0],[12],[1,"\\n        "],[10,"label"],[12],[1,[30,1,["name"]]],[13],[1,"\\n        \\n"],[41,[28,[37,4],[[30,1,["type"]],"number"],null],[[[1,"            "],[8,[39,5],null,[["@obj","@property","@action","@min","@max","@disabled"],[[30,0,["input","param"]],"value",[30,0,["editValue"]],[30,0,["paramData","min"]],[30,0,["paramData","max"]],[28,[37,6],[[30,0,["keyOnFrame"]],true],null]]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[28,[37,4],[[30,1,["type"]],"color"],null],[[[1,"            "],[8,[39,7],null,[["@label","@value","@action","@disabled"],["",[30,0,["input","param","value"]],[30,0,["editValue"]],[28,[37,6],[[30,0,["keyOnFrame"]],true],null]]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[28,[37,4],[[30,1,["type"]],"text"],null],[[[1,"            "],[8,[39,8],null,[["@type","@label","@value","@placeholder","@action","@disabled"],["textarea",null,[30,0,["input","param","value"]],"empty",[30,0,["editValue"]],[28,[37,6],[[30,0,["keyOnFrame"]],true],null]]],null],[1,"\\n"]],[]],null],[1,"\\n    "],[13],[1,"\\n    "],[10,0],[12],[1,"\\n        "],[8,[39,9],null,[["@controller","@item","@property"],[[30,2],[30,3],[30,1]]],null],[1,"\\n    "],[13],[1,"\\n    "],[10,0],[14,0,"keysButtons"],[12],[1,"\\n"],[41,[30,1,["useKeyframes"]],[[[1,"        "],[11,"i"],[24,0,"bx bx-chevron-left"],[4,[38,11],["click",[30,0,["prevKey"]]],null],[12],[13],[1,"\\n        "],[11,"i"],[24,0,"bx bx-key addKey off"],[24,"title","Add keyframe"],[4,[38,11],["click",[30,0,["addKey"]]],null],[12],[13],[1,"\\n        "],[11,"i"],[24,0,"bx bx-key removeKey on"],[4,[38,11],["click",[30,0,["removeKey"]]],null],[12],[13],[1,"\\n        "],[11,"i"],[24,0,"bx bx-chevron-right"],[4,[38,11],["click",[30,0,["nextKey"]]],null],[12],[13],[1,"\\n"]],[]],null],[1,"    "],[13],[1,"\\n"],[13],[1,"\\n\\n\\n"]],["@paramData","@controller","@item"],["div","if","unless","label","eq","ui/property-number","neq","ui/property-color","ui/property","project/timeline/input/b-curve-editor","i","on"]]',moduleName:"pikimov/components/project/timeline/input/item-param-inputs.hbs",isStrictMode:!1})
let p=e.default=(a=(0,r.computed)("args.controller.inputsUpdater","args.item.time.in"),l=(0,r.computed)("args.controller.currentFrame","args.randomForKeyEvent","args.item.time.in"),s=class extends o.default{constructor(){super(...arguments),c(this,"controller",null),c(this,"item",null),c(this,"hasKeyframes",!1),c(this,"input",{})
var e=this
e.controller=e.args.controller,e.item=e.args.item,e.paramData=e.args.paramData,(0,n.addObserver)(e,"controller.currentFrame",e.onFrameChanged),(0,n.addObserver)(e,"paramData.useKeyframes",e.checkHasKeyframes),(0,n.addObserver)(e,"paramData.keyframes.length",e.onFrameChanged),e.onFrameChanged(),e.checkHasKeyframes()}onFrameChanged(){var e=this
if(e.controller.isCompositionReady&&e.paramData.useKeyframes){var t=e.controller.getters.getCompSceneItemByCompUid(e.item.compUid)
if(t&&!t.isDestroyed){var o=e.controller.currentFrame,n=t.getParamValueAt(o,e.paramData.name);(0,r.set)(e.input,"param",{value:n})}}}checkHasKeyframes(){var e=this,t=!1
e.paramData.keyframes&&e.paramData.keyframes.length&&(t=!0),(0,r.set)(e,"hasKeyframes",t),e.onFrameChanged()}get onValuesUpdated(){this.onFrameChanged()}get keyOnFrame(){var e=this,t=e.paramData.keyframes
return!t||!!e.controller.keyframesUtils.getKeyByFrameIndex(t,e.controller.currentFrame)}editValue(e=!0){var t=this,o=t.controller,n=t.input.param.value,i=t.paramData
if("number"==i.type&&(n*=1),i.useKeyframes){var a=i.keyframes,l=o.keyframesUtils.getKeyByFrameIndex(a,o.currentFrame);(0,r.set)(l,"values",{p:n}),o.keyframesUtils.checkStaticKeys(a)}else(0,r.set)(i,"value",n)
"color"==i.type&&o.getters.getCompSceneItemByCompUid(t.item.compUid).updateColor()
if(i.curvesEditorOpen){var s=document.querySelector("#curvesEditor")
if(s){var c=new CustomEvent("exportMessage",{detail:{what:"rebuildCurvesEditor",property:i}})
s.dispatchEvent(c)}}o.refreshAndRender(),e&&o.addToHistory("item","edit param value"),o.keyframesUtils.sendKeyEvent(t.item.compUid)}toggleUseKeyframes(){var e=this,t=e.paramData;(0,r.set)(t,"useKeyframes",!t.useKeyframes),e.controller.refreshAndRender(),e.controller.addToHistory("item param","toggle use keyframes"),t.useKeyframes&&!t.keyframes&&e.addKey(),e.onFrameChanged()}addKey(){var e=this
e.controller.keyframesUtils.addParamKey(e.item,e.paramData,null),(0,r.set)(e,"hasKeyframes",!0)}removeKey(){var e=this
e.controller.keyframesUtils.deleteKeyByFrameIndex(e.paramData.keyframes,e.controller.currentFrame),e.checkHasKeyframes()}prevKey(){var e=this,t=e.controller.keyframesUtils.findPreviousKeyframe(e.controller.currentFrame,e.paramData.keyframes)
null!==t&&e.controller.setFrame(t)}nextKey(){var e=this,t=e.controller.keyframesUtils.findNextKeyframe(e.controller.currentFrame,e.paramData.keyframes)
null!==t&&e.controller.setFrame(t)}},u(s.prototype,"onValuesUpdated",[a],Object.getOwnPropertyDescriptor(s.prototype,"onValuesUpdated"),s.prototype),u(s.prototype,"keyOnFrame",[l],Object.getOwnPropertyDescriptor(s.prototype,"keyOnFrame"),s.prototype),u(s.prototype,"editValue",[r.action],Object.getOwnPropertyDescriptor(s.prototype,"editValue"),s.prototype),u(s.prototype,"toggleUseKeyframes",[r.action],Object.getOwnPropertyDescriptor(s.prototype,"toggleUseKeyframes"),s.prototype),u(s.prototype,"addKey",[r.action],Object.getOwnPropertyDescriptor(s.prototype,"addKey"),s.prototype),u(s.prototype,"removeKey",[r.action],Object.getOwnPropertyDescriptor(s.prototype,"removeKey"),s.prototype),u(s.prototype,"prevKey",[r.action],Object.getOwnPropertyDescriptor(s.prototype,"prevKey"),s.prototype),u(s.prototype,"nextKey",[r.action],Object.getOwnPropertyDescriptor(s.prototype,"nextKey"),s.prototype),s);(0,t.setComponentTemplate)(m,p)}),define("pikimov/components/project/timeline/input/item-transform-inputs",["exports","@ember/component","@glimmer/component","@ember/object","@ember/object/observers","@ember/template-factory"],function(e,t,o,r,n,i){var a,l,s,c,u
function m(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function p(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const d=(0,i.createTemplateFactory)({id:"Lmi/ESOp",block:'[[[1,[30,0,["onValuesUpdated"]]],[1,"\\n\\n"],[41,[30,0,["showPositionInputs"]],[[[10,0],[15,0,[29,["position ",[52,[30,0,["positionData","useKeyframes"]],"useKeyframes"]," ",[52,[51,[30,0,["positionKeyOnFrame"]]],"noKey"]]]],[12],[1,"\\n    "],[10,0],[12],[1,"\\n        "],[10,"label"],[12],[1,"position"],[13],[1,"\\n        "],[8,[39,4],null,[["@label","@obj","@property","@noTranslate","@action","@disabled"],["x",[30,0,["input","transform","position"]],"x",true,[30,0,["editPosition"]],[28,[37,5],[[30,0,["positionKeyOnFrame"]],true],null]]],null],[1,"\\n        "],[8,[39,4],null,[["@label","@obj","@property","@noTranslate","@action","@disabled"],["y",[30,0,["input","transform","position"]],"y",true,[30,0,["editPosition"]],[28,[37,5],[[30,0,["positionKeyOnFrame"]],true],null]]],null],[1,"\\n"],[41,[30,0,["positionAxes","z"]],[[[1,"        "],[8,[39,4],null,[["@label","@obj","@property","@noTranslate","@action","@disabled"],["z",[30,0,["input","transform","position"]],"z",true,[30,0,["editPosition"]],[28,[37,5],[[30,0,["positionKeyOnFrame"]],true],null]]],null],[1,"\\n"]],[]],null],[1,"    "],[13],[1,"\\n    "],[10,0],[12],[1,"\\n        "],[8,[39,6],null,[["@controller","@item","@property"],[[30,1],[30,2],[30,2,["position"]]]],null],[1,"\\n    "],[13],[1,"\\n    "],[10,0],[14,0,"keysButtons"],[12],[1,"\\n"],[41,[30,0,["positionData","useKeyframes"]],[[[1,"        "],[11,"i"],[24,0,"bx bx-chevron-left"],[4,[38,8],["click",[28,[37,9],[[30,0,["prevKey"]],"position"],null]],null],[12],[13],[1,"\\n        "],[11,"i"],[24,0,"bx bx-key addKey off"],[24,"title","Add keyframe"],[4,[38,8],["click",[28,[37,9],[[30,0,["addKey"]],"position"],null]],null],[12],[13],[1,"\\n        "],[11,"i"],[24,0,"bx bx-key removeKey on"],[24,"title","Remove keyframe"],[4,[38,8],["click",[28,[37,9],[[30,0,["removeKey"]],"position"],null]],null],[12],[13],[1,"\\n        "],[11,"i"],[24,0,"bx bx-chevron-right"],[4,[38,8],["click",[28,[37,9],[[30,0,["nextKey"]],"position"],null]],null],[12],[13],[1,"\\n"]],[]],null],[1,"    "],[13],[1,"\\n"],[13],[1,"\\n"]],[]],null],[41,[30,0,["showRotationInputs"]],[[[10,0],[15,0,[29,["rotation ",[52,[30,0,["rotationData","useKeyframes"]],"useKeyframes"]," ",[52,[51,[30,0,["rotationKeyOnFrame"]]],"noKey"]]]],[12],[1,"\\n    "],[10,0],[12],[1,"\\n        "],[10,"label"],[12],[1,"rotation"],[13],[1,"\\n\\n"],[41,[30,0,["showRotationInputs","x"]],[[[1,"        "],[8,[39,4],null,[["@label","@obj","@property","@noTranslate","@action","@disabled"],["x",[30,0,["input","transform","rotation"]],"x",true,[30,0,["editRotation"]],[28,[37,5],[[30,0,["rotationKeyOnFrame"]],true],null]]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["showRotationInputs","y"]],[[[1,"            "],[8,[39,4],null,[["@label","@obj","@property","@noTranslate","@action","@disabled"],["y",[30,0,["input","transform","rotation"]],"y",true,[30,0,["editRotation"]],[28,[37,5],[[30,0,["rotationKeyOnFrame"]],true],null]]],null],[1,"\\n"]],[]],null],[1,"        "],[8,[39,4],null,[["@label","@obj","@property","@noTranslate","@action","@disabled"],["z",[30,0,["input","transform","rotation"]],"z",true,[30,0,["editRotation"]],[28,[37,5],[[30,0,["rotationKeyOnFrame"]],true],null]]],null],[1,"\\n    "],[13],[1,"\\n    "],[10,0],[12],[1,"\\n        "],[8,[39,6],null,[["@controller","@item","@property"],[[30,1],[30,2],[30,2,["rotation"]]]],null],[1,"\\n    "],[13],[1,"\\n    "],[10,0],[14,0,"keysButtons"],[12],[1,"\\n"],[41,[30,0,["rotationData","useKeyframes"]],[[[1,"        "],[11,"i"],[24,0,"bx bx-chevron-left"],[4,[38,8],["click",[28,[37,9],[[30,0,["prevKey"]],"rotation"],null]],null],[12],[13],[1,"\\n        "],[11,"i"],[24,0,"bx bx-key addKey off"],[24,"title","Add keyframe"],[4,[38,8],["click",[28,[37,9],[[30,0,["addKey"]],"rotation"],null]],null],[12],[13],[1,"\\n        "],[11,"i"],[24,0,"bx bx-key removeKey on"],[24,"title","Remove keyframe"],[4,[38,8],["click",[28,[37,9],[[30,0,["removeKey"]],"rotation"],null]],null],[12],[13],[1,"\\n        "],[11,"i"],[24,0,"bx bx-chevron-right"],[4,[38,8],["click",[28,[37,9],[[30,0,["nextKey"]],"rotation"],null]],null],[12],[13],[1,"\\n"]],[]],null],[1,"    "],[13],[1,"\\n"],[13],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["input","transform","scale"]],[[[10,0],[15,0,[29,["scale ",[52,[30,0,["scaleData","useKeyframes"]],"useKeyframes"]," ",[52,[51,[30,0,["scaleKeyOnFrame"]]],"noKey"]]]],[12],[1,"\\n    "],[10,0],[12],[1,"\\n        "],[10,"label"],[12],[1,"scale"],[13],[1,"\\n        "],[8,[39,4],null,[["@label","@obj","@property","@noTranslate","@action","@disabled"],["x",[30,0,["input","transform","scale"]],"x",true,[30,0,["editScale"]],[28,[37,5],[[30,0,["scaleKeyOnFrame"]],true],null]]],null],[1,"\\n        "],[8,[39,4],null,[["@label","@obj","@property","@noTranslate","@action","@disabled"],["y",[30,0,["input","transform","scale"]],"y",true,[30,0,["editScale"]],[28,[37,5],[[30,0,["scaleKeyOnFrame"]],true],null]]],null],[1,"\\n"],[41,[28,[37,10],[[30,2,["type"]],"model"],null],[[[1,"        "],[8,[39,4],null,[["@label","@obj","@property","@noTranslate","@action","@disabled"],["z",[30,0,["input","transform","scale"]],"z",true,[30,0,["editScale"]],[28,[37,5],[[30,0,["scaleKeyOnFrame"]],true],null]]],null],[1,"\\n"]],[]],null],[1,"    "],[13],[1,"\\n    "],[10,0],[12],[1,"\\n        "],[8,[39,6],null,[["@controller","@item","@property"],[[30,1],[30,2],[30,2,["scale"]]]],null],[1,"\\n    "],[13],[1,"\\n    "],[10,0],[14,0,"keysButtons"],[12],[1,"\\n"],[41,[30,0,["scaleData","useKeyframes"]],[[[1,"        "],[11,"i"],[24,0,"bx bx-chevron-left"],[4,[38,8],["click",[28,[37,9],[[30,0,["prevKey"]],"scale"],null]],null],[12],[13],[1,"\\n        "],[11,"i"],[24,0,"bx bx-key addKey off"],[24,"title","Add keyframe"],[4,[38,8],["click",[28,[37,9],[[30,0,["addKey"]],"scale"],null]],null],[12],[13],[1,"\\n        "],[11,"i"],[24,0,"bx bx-key removeKey on"],[24,"title","Remove keyframe"],[4,[38,8],["click",[28,[37,9],[[30,0,["removeKey"]],"scale"],null]],null],[12],[13],[1,"\\n        "],[11,"i"],[24,0,"bx bx-chevron-right"],[4,[38,8],["click",[28,[37,9],[[30,0,["nextKey"]],"scale"],null]],null],[12],[13],[1,"\\n"]],[]],null],[1,"    "],[13],[1,"\\n"],[13],[1,"\\n"]],[]],null]],["@controller","@item"],["if","div","unless","label","ui/property-number","neq","project/timeline/input/b-curve-editor","i","on","fn","eq"]]',moduleName:"pikimov/components/project/timeline/input/item-transform-inputs.hbs",isStrictMode:!1})
let f=e.default=(a=(0,r.computed)("args.controller.inputsUpdater"),l=(0,r.computed)("args.controller.currentFrame","args.randomForKeyEvent","positionData.keyframes.length","args.item.time.in"),s=(0,r.computed)("args.controller.currentFrame","args.randomForKeyEvent","rotationData.keyframes.length","args.item.time.in"),c=(0,r.computed)("args.controller.currentFrame","args.randomForKeyEvent","scaleData.keyframes.length","args.item.time.in"),u=class extends o.default{constructor(){super(...arguments),m(this,"controller",null),m(this,"item",null),m(this,"keyframesUtils",null),m(this,"hasPositionKeyframes",!1),m(this,"hasRotationKeyframes",!1),m(this,"hasScaleKeyframes",!1),m(this,"showPositionInputs",!0),m(this,"showRotationInputs",!1),m(this,"positionAxes",null),m(this,"input",{}),m(this,"positionData",null),m(this,"rotationData",null),m(this,"scaleData",null)
var e=this
e.controller=e.args.controller,e.item=e.args.item,e.keyframesUtils=e.controller.keyframesUtils,"audio"!=e.item.type?(e.positionData=e.item.position,e.rotationData=e.item.rotation,e.scaleData=e.item.scale,(0,n.addObserver)(e,"controller.currentFrame",e.onFrameChanged),(0,n.addObserver)(e,"item.time.in",e.onFrameChanged),(0,n.addObserver)(e,"item.time.in",e.positionKeyOnFrame),(0,n.addObserver)(e,"positionData.useKeyframes",e.checkHasKeyframes),(0,n.addObserver)(e,"rotationData.useKeyframes",e.checkHasKeyframes),(0,n.addObserver)(e,"scaleData.useKeyframes",e.checkHasKeyframes),e.onFrameChanged(),e.checkHasKeyframes(),e.checkShowRotationInputs(),e.positionAxes={x:!0,y:!0},"light"==e.item.type&&(e.positionAxes.z=!0),"3D"==e.controller.activeComposition.cameraType&&(e.positionAxes.z=!0)):e.showPositionInputs=!1}checkShowRotationInputs(){var e=this,t={z:!0}
"model"==e.item.type&&(t={x:!0,y:!0,z:!0}),"3D"==e.controller.activeComposition.cameraType&&(t={x:!0,y:!0,z:!0}),e.item.rotation&&e.item.rotation.disabled&&(t=!1),(0,r.set)(e,"showRotationInputs",t)}onFrameChanged(){var e=this
if(e.controller.isCompositionReady){var t=e.controller.getters.getCompItemCurrentTransformByCompUid(e.item.compUid);(0,r.set)(e.input,"transform",t)}}checkHasKeyframes(){var e=this,t=!1,o=!1,n=!1
e.positionData.keyframes&&e.positionData.keyframes.length&&(t=!0),e.rotationData.keyframes&&e.rotationData.keyframes.length&&(o=!0),e.scaleData.keyframes&&e.scaleData.keyframes.length&&(n=!0),(0,r.set)(e,"hasPositionKeyframes",t),(0,r.set)(e,"hasRotationKeyframes",o),(0,r.set)(e,"hasScaleKeyframes",n)}get onValuesUpdated(){this.onFrameChanged()}get positionKeyOnFrame(){var e=this,t=e.positionData.keyframes
return!t||!!e.keyframesUtils.getKeyByFrameIndex(t,e.controller.currentFrame)}get rotationKeyOnFrame(){var e=this,t=e.rotationData.keyframes
return!t||!!e.keyframesUtils.getKeyByFrameIndex(t,e.controller.currentFrame)}get scaleKeyOnFrame(){var e=this,t=e.scaleData.keyframes
return!t||!!e.keyframesUtils.getKeyByFrameIndex(t,e.controller.currentFrame)}selectItem(){this.controller.selectItem(this.item)}editPosition(e){var t=this,o=t.controller,n=t.positionData.keyframes,i=t.keyframesUtils.getKeyByFrameIndex(n,o.currentFrame)
if(i){var a={x:1*t.input.transform.position.x,y:1*t.input.transform.position.y,z:1*i.values.z}
t.positionAxes.z&&(a.z=1*t.input.transform.position.z),(0,r.set)(i,"values",a)}t.keyframesUtils.checkStaticKeys(n),o.refreshAndRender(),!1!==e&&o.addToHistory("item","edit position")}editRotation(e){var t=this,o=t.controller,n=t.rotationData.keyframes,i=t.keyframesUtils.getKeyByFrameIndex(n,o.currentFrame)
if(i){var a={x:1*t.input.transform.rotation.x,y:1*t.input.transform.rotation.y,z:1*t.input.transform.rotation.z};(0,r.set)(i,"values",a)}t.keyframesUtils.checkStaticKeys(n),o.refreshAndRender(),!1!==e&&o.addToHistory("item","edit rotation")}editScale(e){var t=this,o=t.controller,n=t.scaleData.keyframes,i=t.keyframesUtils.getKeyByFrameIndex(n,o.currentFrame)
if(i){var a={x:1*t.input.transform.scale.x,y:1*t.input.transform.scale.y,z:1*t.input.transform.scale.z};(0,r.set)(i,"values",a)}t.keyframesUtils.checkStaticKeys(n),o.refreshAndRender(),!1!==e&&o.addToHistory("item","edit scale")}toggleUseKeyframes(e){var t=this,o=null
"position"==e&&(o=t.positionData),"rotation"==e&&(o=t.rotationData),"scale"==e&&(o=t.scaleData),(0,r.set)(o,"useKeyframes",!o.useKeyframes),t.controller.refreshAndRender(),t.controller.addToHistory("item","toggle use keyframes"),o.useKeyframes&&!o.keyframes&&t.addKey(e),t.onFrameChanged()}addKey(e){var t=this
t.keyframesUtils.addTransformKey(t.item,e),t.checkHasKeyframes()}removeKey(e){var t=this,o=null
"position"==e&&(o=t.positionData),"rotation"==e&&(o=t.rotationData),"scale"==e&&(o=t.scaleData),t.keyframesUtils.deleteKeyByFrameIndex(o.keyframes,t.controller.currentFrame),t.checkHasKeyframes()}prevKey(e){var t=this,o=null
"position"==e&&(o=t.positionData),"rotation"==e&&(o=t.rotationData),"scale"==e&&(o=t.scaleData)
var r=t.keyframesUtils.findPreviousKeyframe(t.controller.currentFrame,o.keyframes)
null!==r&&t.controller.setFrame(r)}nextKey(e){var t=this,o=null
"position"==e&&(o=t.positionData),"rotation"==e&&(o=t.rotationData),"scale"==e&&(o=t.scaleData)
var r=t.keyframesUtils.findNextKeyframe(t.controller.currentFrame,o.keyframes)
null!==r&&t.controller.setFrame(r)}},p(u.prototype,"onValuesUpdated",[a],Object.getOwnPropertyDescriptor(u.prototype,"onValuesUpdated"),u.prototype),p(u.prototype,"positionKeyOnFrame",[l],Object.getOwnPropertyDescriptor(u.prototype,"positionKeyOnFrame"),u.prototype),p(u.prototype,"rotationKeyOnFrame",[s],Object.getOwnPropertyDescriptor(u.prototype,"rotationKeyOnFrame"),u.prototype),p(u.prototype,"scaleKeyOnFrame",[c],Object.getOwnPropertyDescriptor(u.prototype,"scaleKeyOnFrame"),u.prototype),p(u.prototype,"selectItem",[r.action],Object.getOwnPropertyDescriptor(u.prototype,"selectItem"),u.prototype),p(u.prototype,"editPosition",[r.action],Object.getOwnPropertyDescriptor(u.prototype,"editPosition"),u.prototype),p(u.prototype,"editRotation",[r.action],Object.getOwnPropertyDescriptor(u.prototype,"editRotation"),u.prototype),p(u.prototype,"editScale",[r.action],Object.getOwnPropertyDescriptor(u.prototype,"editScale"),u.prototype),p(u.prototype,"toggleUseKeyframes",[r.action],Object.getOwnPropertyDescriptor(u.prototype,"toggleUseKeyframes"),u.prototype),p(u.prototype,"addKey",[r.action],Object.getOwnPropertyDescriptor(u.prototype,"addKey"),u.prototype),p(u.prototype,"removeKey",[r.action],Object.getOwnPropertyDescriptor(u.prototype,"removeKey"),u.prototype),p(u.prototype,"prevKey",[r.action],Object.getOwnPropertyDescriptor(u.prototype,"prevKey"),u.prototype),p(u.prototype,"nextKey",[r.action],Object.getOwnPropertyDescriptor(u.prototype,"nextKey"),u.prototype),u);(0,t.setComponentTemplate)(d,f)}),define("pikimov/components/project/timeline/markers-bar-marker",["exports","@ember/component","@glimmer/component","@ember/object","@ember/template","@ember/runloop","@ember/template-factory"],function(e,t,o,r,n,i,a){var l,s
function c(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const u=(0,a.createTemplateFactory)({id:"XqWAQkve",block:'[[[1,"\\n"],[10,1],[14,0,"marker"],[15,5,[30,0,["cssMarker"]]],[15,"title",[29,[[30,0,["markerData","frame"]]]]],[15,"data-index",[29,[[30,1]]]],[12],[1,"\\n"],[10,"label"],[14,0,"notranslate"],[12],[1,[30,0,["markerData","name"]]],[13],[1,"\\n"],[13],[1,"\\n"]],["@index"],["span","label"]]',moduleName:"pikimov/components/project/timeline/markers-bar-marker.hbs",isStrictMode:!1})
let m=e.default=(l=(0,r.computed)("markerData.frame","args.zoom"),s=class extends o.default{constructor(){super(...arguments),c(this,"compositionData",null),c(this,"markerData",null)
var e=this,t=e.args.index
e.compositionData=e.args.compositionData,e.markerData=e.compositionData.markers[t],(0,i.next)(function(){e.setupDrag()})}setupDrag(){var e=this
const t=interact(`.marker[data-index="${e.args.index}"]`)
t.styleCursor(!1)
var o=0
const r={x:0}
t.draggable({lockAxis:"x",modifiers:[interact.modifiers.restrict({restriction:"parent"})],listeners:{move(t){r.x+=t.dx
var n=Math.round(r.x/e.args.zoom)
e.setFrame(o+n)},start(){r.x=0,o=e.markerData.frame},end(){}}})}setFrame(e){e=Math.max(0,Math.min(e,this.compositionData.time.end)),(0,r.set)(this.markerData,"frame",e)}get cssMarker(){var e=Math.round(this.markerData.frame*this.args.zoom)
return(0,n.htmlSafe)("left:"+e+"px;")}},p=s.prototype,d="cssMarker",f=[l],v=Object.getOwnPropertyDescriptor(s.prototype,"cssMarker"),h=s.prototype,g={},Object.keys(v).forEach(function(e){g[e]=v[e]}),g.enumerable=!!g.enumerable,g.configurable=!!g.configurable,("value"in g||g.initializer)&&(g.writable=!0),g=f.slice().reverse().reduce(function(e,t){return t(p,d,e)||e},g),h&&void 0!==g.initializer&&(g.value=g.initializer?g.initializer.call(h):void 0,g.initializer=void 0),void 0===g.initializer&&Object.defineProperty(p,d,g),s)
var p,d,f,v,h,g;(0,t.setComponentTemplate)(u,m)}),define("pikimov/components/project/timeline/markers-bar",["exports","@ember/component","@glimmer/component","@ember/object","@ember/runloop","@ember/template-factory"],function(e,t,o,r,n,i){var a,l
function s(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const c=(0,i.createTemplateFactory)({id:"M9ZIQ8Gj",block:'[[[10,0],[14,1,"markersBar"],[12],[1,"\\n"],[42,[28,[37,2],[[28,[37,2],[[30,0,["markers"]]],null]],null],null,[[[1,"    "],[8,[39,3],null,[["@compositionData","@zoom","@index"],[[30,0,["compositionData"]],[30,3],[30,2]]],null],[1,"\\n"]],[1,2]],null],[13],[1,"\\n"],[1,[30,0,["onZoomChanged"]]],[1,"\\n\\n"],[10,0],[14,1,"markersBarContextMenu"],[14,0,"contextMenu"],[14,"popover",""],[12],[13]],["marker","index","@zoom"],["div","each","-track-array","project/timeline/markers-bar-marker"]]',moduleName:"pikimov/components/project/timeline/markers-bar.hbs",isStrictMode:!1})
let u=e.default=(a=(0,r.computed)("args.zoom","controller.activeComposition.time.start","controller.activeComposition.time.end"),l=class extends o.default{constructor(){super(...arguments),s(this,"controller",null),s(this,"compositionData",null),s(this,"width",0),s(this,"markers",null),s(this,"maxMarkers",100)
var e=this
e.controller=e.args.controller,e.compositionData=e.controller.activeCompositionData,e.markers=e.compositionData.markers,(0,n.next)(function(){e.controller.isCompositionReady&&e.addClickEvents()})}get onZoomChanged(){var e=this,t=e.controller.getters.getCompositionNbFrames(e.controller.activeComposition)
e.width=Math.floor(t*e.args.zoom),$("#markersBar").css({width:e.width+"px"})}addClickEvents(){var e=this
const t=document.querySelector("#markersBar")
$("#markersBar").on("mousedown",function(t){if(2!==t.originalEvent.button){e.controller.playbackUtils.pause()
var o=$(this).offset().left,r=t.pageX-o,n=Math.round(r/e.args.zoom)
e.setFrame(n)}}),t.addEventListener("contextmenu",e=>{e.preventDefault()}),t.addEventListener("mouseup",t=>{2===t.button&&(t.preventDefault(),e.openMenu(t))})}openMenu(e){var t=this,o=t.controller
const n=document.querySelector("#markersBarContextMenu")
var i=e.clientX
i+180>window.innerWidth&&(i=window.innerWidth-180),n.innerHTML="",n.style.left=`${i}px`,n.style.top=`${e.clientY}px`,n.showPopover()
var a=n,l=o.keyframesUtils.timelineZoom,s=$("#overStripes").offset().left,c=e.pageX-s,u=Math.round(c/l),m=0
t.compositionData.markers&&(m=t.compositionData.markers.length)
var p=document.createElement("ul")
if($(e.target).is("#markersBar"))if(m<t.maxMarkers){var d=document.createElement("li"),f="add marker on frame "+u
d.innerHTML="<label>"+f+"</label>",d.addEventListener("click",e=>{t.addMarker(u),t.closeMenu()}),p.appendChild(d)}else{(d=document.createElement("li")).innerHTML="<label>cannot add more markers</label>",p.appendChild(d)}if($(e.target).is(".marker")){var v=$(e.target).attr("data-index")
f="delete marker";(d=document.createElement("li")).innerHTML="<label>"+f+"</label>",d.addEventListener("click",e=>{t.deleteMarker(v),t.closeMenu()}),p.appendChild(d)
d=document.createElement("li")
var h=t.compositionData.markers[v]
d.innerHTML=`Rename: <input type="text" value="${h.name}" maxlength="20" class="notranslate">`
var g=$(d).find("input")
g.on("change",function(){var e=g.val();(0,r.set)(h,"name",e),t.closeMenu()}),p.appendChild(d)}a.appendChild(p)}closeMenu(){const e=document.querySelector("#markersBarContextMenu")
e&&e.hidePopover()}addMarker(e){var t=this,o=t.compositionData
o.markers||(console.log("create markers array"),o.markers=[])
var n={frame:e,name:""+(o.markers.length+1)}
o.markers.push(n),(0,r.set)(t,"markers",null),requestAnimationFrame(function(){(0,r.set)(t,"markers",o.markers)})}deleteMarker(e){var t=this,o=t.compositionData
o.markers.splice(e,1),(0,r.set)(t,"markers",null),requestAnimationFrame(function(){(0,r.set)(t,"markers",o.markers)})}setFrame(e){e!=this.controller.currentFrame&&this.controller.setFrame(e)}},m=l.prototype,p="onZoomChanged",d=[a],f=Object.getOwnPropertyDescriptor(l.prototype,"onZoomChanged"),v=l.prototype,h={},Object.keys(f).forEach(function(e){h[e]=f[e]}),h.enumerable=!!h.enumerable,h.configurable=!!h.configurable,("value"in h||h.initializer)&&(h.writable=!0),h=d.slice().reverse().reduce(function(e,t){return t(m,p,e)||e},h),v&&void 0!==h.initializer&&(h.value=h.initializer?h.initializer.call(v):void 0,h.initializer=void 0),void 0===h.initializer&&Object.defineProperty(m,p,h),l)
var m,p,d,f,v,h;(0,t.setComponentTemplate)(c,u)}),define("pikimov/components/project/timeline/stripe/item-stripe-keys",["exports","@ember/component","@glimmer/component","@ember/object","@ember/runloop","@ember/object/observers","@ember/template-factory"],function(e,t,o,r,n,i,a){var l,s
function c(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function u(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const m=(0,a.createTemplateFactory)({id:"8quoK5y5",block:'[[[10,0],[15,0,[29,["overStripe ",[52,[30,1,["open"]],"open"]]]],[12],[1,"\\n"],[1,"    "],[8,[39,2],null,[["@controller","@item","@zoom"],[[30,2],[30,1],[30,3]]],null],[1,"\\n\\n"],[41,[51,[30,0,["isMissing"]]],[[[41,[30,1,["open"]],[[[1,"    "],[1,[30,0,["checkStaticKeysWhenOpening"]]],[1,"\\n        "],[11,0],[24,0,"keyframes"],[16,"data-compuid",[29,[[30,1,["compUid"]]]]],[4,[38,4],["contextmenu",[30,0,["contextMenuHandler"]]],null],[12],[1,"\\n\\n"],[41,[30,1,["position","useKeyframes"]],[[[1,"            "],[10,0],[14,0,"position"],[12],[1,"\\n"],[42,[28,[37,6],[[28,[37,6],[[30,1,["position","keyframes"]]],null]],null],null,[[[1,"                    "],[8,[39,7],null,[["@controller","@key","@type","@zoom"],[[30,2],[30,4],"position",[30,3]]],null],[1,"\\n"]],[4]],null],[1,"            "],[13],[1,"\\n"]],[]],null],[1,"\\n            "],[41,[51,[30,1,["rotation","disabled"]]],[[[1,"\\n"],[41,[30,1,["rotation","useKeyframes"]],[[[1,"            "],[10,0],[14,0,"rotation"],[12],[1,"\\n"],[42,[28,[37,6],[[28,[37,6],[[30,1,["rotation","keyframes"]]],null]],null],null,[[[1,"                    "],[8,[39,7],null,[["@controller","@key","@type","@zoom"],[[30,2],[30,5],"rotation",[30,3]]],null],[1,"\\n"]],[5]],null],[1,"            "],[13],[1,"\\n"]],[]],null]],[]],null],[1,"\\n"],[41,[30,1,["scale","useKeyframes"]],[[[1,"            "],[10,0],[14,0,"scale"],[12],[1,"\\n"],[42,[28,[37,6],[[28,[37,6],[[30,1,["scale","keyframes"]]],null]],null],null,[[[1,"                    "],[8,[39,7],null,[["@controller","@key","@type","@zoom"],[[30,2],[30,6],"scale",[30,3]]],null],[1,"\\n"]],[6]],null],[1,"            "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[42,[28,[37,6],[[28,[37,6],[[30,1,["params"]]],null]],null],null,[[[41,[30,7,["useKeyframes"]],[[[1,"                "],[10,0],[15,0,[29,["param ",[30,7,["type"]]]]],[12],[1,"\\n"],[42,[28,[37,6],[[28,[37,6],[[30,7,["keyframes"]]],null]],null],null,[[[1,"                        "],[8,[39,7],null,[["@controller","@key","@type","@zoom"],[[30,2],[30,8],"param",[30,3]]],null],[1,"\\n"]],[8]],null],[1,"                "],[13],[1,"\\n"]],[]],null],[42,[28,[37,6],[[28,[37,6],[[30,7,["params"]]],null]],null],null,[[[41,[30,9,["useKeyframes"]],[[[1,"                    "],[10,0],[14,0,"param"],[12],[1,"\\n"],[42,[28,[37,6],[[28,[37,6],[[30,9,["keyframes"]]],null]],null],null,[[[1,"                            "],[8,[39,7],null,[["@controller","@key","@type","@zoom"],[[30,2],[30,10],"sub_param",[30,3]]],null],[1,"\\n"]],[10]],null],[1,"                    "],[13],[1,"\\n"]],[]],null]],[9]],null]],[7]],null],[1,"\\n"],[42,[28,[37,6],[[28,[37,6],[[30,1,["effects"]]],null]],null],null,[[[42,[28,[37,6],[[28,[37,6],[[30,11,["params"]]],null]],null],null,[[[41,[30,12,["useKeyframes"]],[[[1,"                    "],[10,0],[14,0,"effect"],[12],[1,"\\n"],[42,[28,[37,6],[[28,[37,6],[[30,12,["keyframes"]]],null]],null],null,[[[1,"                            "],[8,[39,7],null,[["@controller","@key","@type","@zoom"],[[30,2],[30,13],"effect",[30,3]]],null],[1,"\\n"]],[13]],null],[1,"                    "],[13],[1,"\\n"]],[]],null]],[12]],null]],[11]],null],[1,"\\n        "],[13],[1,"\\n    "]],[]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,1,["items","length"]],[[[1,"    "],[10,0],[14,0,"overSubStripes"],[12],[1,"\\n"],[41,[30,1,["groupOpen"]],[[[42,[28,[37,6],[[28,[37,6],[[30,1,["items"]]],null]],null],null,[[[1,"            "],[8,[39,8],null,[["@controller","@item","@zoom"],[[30,2],[30,14],[30,3]]],null],[1,"\\n"]],[14]],null]],[]],null],[1,"    "],[13],[1,"\\n"]],[]],[[[41,[28,[37,9],[[30,1,["type"]],"group"],null],[[[1,"        "],[10,0],[14,0,"overSubStripes"],[12],[13],[1,"\\n"]],[]],null]],[]]],[13],[1,"\\n"]],["@item","@controller","@zoom","key","key","key","paramData","key","subParamData","key","effect","param","key","subItem"],["div","if","project/timeline/stripe/item-stripe","unless","on","each","-track-array","project/timeline/stripe/keyframe","project/timeline/stripe/item-stripe-keys","eq"]]',moduleName:"pikimov/components/project/timeline/stripe/item-stripe-keys.hbs",isStrictMode:!1})
let p=e.default=(l=(0,r.computed)("args.item.open"),s=class extends o.default{constructor(){super(...arguments),c(this,"keyframesUtils",null),c(this,"isMissing",!1)
var e=this,t=e.args.controller
t.getters.getCompSceneItemByCompUid(e.args.item.compUid).isMissing&&(e.isMissing=!0),e.keyframesUtils=t.keyframesUtils,(0,i.addObserver)(e,"args.zoom",e.onZoomChanged),(0,n.next)(function(){e.checkStaticKeys()})}onZoomChanged(){this.checkStaticKeys()}get checkStaticKeysWhenOpening(){var e=this;(0,n.next)(function(){e.checkStaticKeys()})}checkStaticKeys(){var e=this,t=e.args.item,o=e.keyframesUtils
function r(e){e.keyframes&&o.checkStaticKeys(e.keyframes)}o.timelineZoom=e.args.zoom,t.position&&r(t.position),t.rotation&&r(t.rotation),t.scale&&r(t.scale),t.params&&t.params.forEach(function(e){r(e)}),t.effects&&t.effects.forEach(function(e){e.params.forEach(function(e){r(e)})})}contextMenuHandler(e){if(!$(e.target).hasClass("keyframe")){var t=this.args.item,o=[],r=this.keyframesUtils
t.position.useKeyframes&&o.push({what:"position",keyframes:t.position.keyframes,addKeyFunction:function(e){r.addTransformKey(t,"position",e)}}),t.rotation.useKeyframes&&o.push({what:"rotation",keyframes:t.rotation.keyframes,addKeyFunction:function(e){r.addTransformKey(t,"rotation",e)}}),t.scale.useKeyframes&&o.push({what:"scale",keyframes:t.scale.keyframes,addKeyFunction:function(e){r.addTransformKey(t,"scale",e)}}),t.params.forEach(function(e){e.useKeyframes&&(o.push({what:e.name,keyframes:e.keyframes,addKeyFunction:function(o){r.addParamKey(t,e,o)}}),e.params&&e.params.forEach(function(e){e.useKeyframes&&o.push({what:e.name,keyframes:e.keyframes,addKeyFunction:function(o){r.addParamKey(t,e,o)}})}))}),t.effects.forEach(function(e,n){e.params.forEach(function(i,a){i.useKeyframes&&o.push({what:e.type+" | "+i.name,keyframes:i.keyframes,addKeyFunction:function(e){r.addEffectKey(t,i,e,n,a)}})})}),r.openContextMenuInsertKey(e,t,o),e.preventDefault()}}},u(s.prototype,"checkStaticKeysWhenOpening",[l],Object.getOwnPropertyDescriptor(s.prototype,"checkStaticKeysWhenOpening"),s.prototype),u(s.prototype,"contextMenuHandler",[r.action],Object.getOwnPropertyDescriptor(s.prototype,"contextMenuHandler"),s.prototype),s);(0,t.setComponentTemplate)(m,p)}),define("pikimov/components/project/timeline/stripe/item-stripe",["exports","@ember/component","@glimmer/component","@ember/object","@ember/template","@ember/runloop","@ember/object/observers","pikimov/classes/stripe-curve","@ember/template-factory"],function(e,t,o,r,n,i,a,l,s){var c,u,m,p
function d(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function f(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const v=(0,s.createTemplateFactory)({id:"AmwjASk9",block:'[[[1,"\\n"],[11,0],[16,0,[29,["stripe ",[30,1,["type"]],[52,[30,1,["locked"]]," locked"],[52,[30,1,["repeat","enabled"]]," repeat"],[52,[30,0,["sceneItem","isSelected"]]," selected"]]]],[16,"data-compuid",[29,[[30,1,["compUid"]]]]],[16,5,[30,0,["cssStripeDiv"]]],[4,[38,2],["mousedown",[30,0,["mouseDownStripe"]]],null],[4,[38,2],["mouseup",[30,0,["mouseUpStripe"]]],null],[12],[1,"\\n\\n"],[1,"    "],[10,0],[14,0,"trackIn"],[15,5,[30,0,["cssTrackInDiv"]]],[12],[13],[1,"\\n    "],[10,0],[14,0,"trackOut"],[15,5,[30,0,["cssTrackOutDiv"]]],[12],[13],[1,"\\n\\n    "],[10,0],[14,0,"resize-handle left"],[12],[13],[1,"\\n    "],[10,0],[14,0,"resize-handle right"],[12],[13],[1,"\\n\\n    "],[41,[28,[37,3],[[30,1,["type"]],"shape"],null],[[[10,"i"],[14,0,"bx bx-rectangle"],[12],[13]],[]],null],[1,"\\n    "],[41,[28,[37,3],[[30,1,["type"]],"audio"],null],[[[10,"i"],[14,0,"bx bx-music"],[12],[13]],[]],null],[1,"\\n    "],[41,[28,[37,3],[[30,1,["type"]],"text"],null],[[[10,"i"],[14,0,"bx bx-text"],[12],[13]],[]],null],[1,"\\n"],[1,"    "],[41,[28,[37,3],[[30,1,["type"]],"imageSequence"],null],[[[10,"i"],[14,0,"bx bx-images"],[12],[13]],[]],null],[1,"\\n    "],[41,[28,[37,3],[[30,1,["type"]],"model"],null],[[[10,"i"],[14,0,"bx bx-cube"],[12],[13]],[]],null],[1,"\\n    "],[41,[28,[37,3],[[30,1,["type"]],"composition"],null],[[[10,"i"],[14,0,"bx bx-images"],[12],[13]],[]],null],[1,"\\n    "],[41,[28,[37,3],[[30,1,["type"]],"group"],null],[[[10,"label"],[12],[1,"Group"],[13]],[]],null],[1,"\\n    "],[41,[28,[37,3],[[30,1,["type"]],"camera"],null],[[[10,"i"],[14,0,"bx bx-camera-movie"],[12],[13]],[]],null],[1,"\\n    "],[41,[28,[37,3],[[30,1,["type"]],"cameraTarget"],null],[[[10,"i"],[14,0,"bx bx-target-lock"],[12],[13]],[]],null],[1,"\\n    "],[41,[28,[37,3],[[30,1,["type"]],"light"],null],[[[10,"i"],[14,0,"bx bx-bulb"],[12],[13],[10,"label"],[12],[1,[30,0,["sceneItem","lightType"]]],[13]],[]],null],[1,"\\n    "],[41,[30,0,["thumbnail"]],[[[10,"img"],[15,"src",[29,[[30,0,["thumbnail","src"]]]]],[14,"alt","."],[14,0,"thumbnail"],[12],[13]],[]],null],[1,"\\n\\n"],[41,[30,1,["mask","enabled"]],[[[1,"        "],[10,"i"],[14,0,"bx bxs-mask"],[12],[13],[10,"label"],[14,0,"masking"],[12],[1,[30,0,["maskingText"]]],[13],[1,"\\n"]],[]],null],[1,"    "],[41,[30,0,["isMasked"]],[[[10,"i"],[14,0,"bx bx-mask"],[12],[13]],[]],null],[1,"\\n\\n"],[1,"    "],[41,[30,1,["animation","freeRun"]],[[[10,"label"],[12],[1,"Free run - "],[1,[30,1,["animation","playMode"]]],[13]],[]],null],[1,"\\n\\n    "],[41,[30,1,["repeat","enabled"]],[[[10,"label"],[12],[10,"i"],[14,0,"bx bx-repeat"],[12],[13],[13]],[]],null],[1,"\\n\\n    "],[41,[28,[37,3],[[30,1,["type"]],"audio"],null],[[[10,"canvas"],[14,0,"waveForm"],[12],[13]],[]],null],[1,"\\n"],[13]],["@item"],["div","if","on","eq","i","label","img","canvas"]]',moduleName:"pikimov/components/project/timeline/stripe/item-stripe.hbs",isStrictMode:!1})
let h=e.default=(c=(0,r.computed)("args.zoom","args.item.time.in","args.item.time.out","args.item.time.trackIn","args.item.repeat.enabled","args.item.repeat.end"),u=(0,r.computed)("args.zoom","args.item.time.trackIn"),m=(0,r.computed)("args.zoom","args.item.time.out"),p=class extends o.default{constructor(){super(...arguments),d(this,"controller",null),d(this,"compositionManager",null),d(this,"item",null),d(this,"sceneItem",null),d(this,"left",0),d(this,"width",0),d(this,"isMasked",!1),d(this,"maskingText",null),d(this,"thumbnail",null),d(this,"mouseDownTime",0),d(this,"contextMenuItemStripe",null),d(this,"snapTolerance",5),d(this,"possibleSnaps",[]),d(this,"snapGhost",null),d(this,"stripeCurve",null)
var e=this
e.controller=e.args.controller,e.compositionManager=e.controller.compositionManager,e.item=e.args.item,e.sceneItem=e.controller.getters.getCompSceneItemByCompUid(e.item.compUid)
var t=e.sceneItem
e.thumbnail=t.thumbnail
var o=e.controller.timelineUtils;(0,a.addObserver)(e,"args.item.mask.enabled",e.onMaskChanged),e.onMaskChanged(),e.checkIfMasked(),(0,i.next)(function(){var r=e.controller
if(!r.isCompositionReady)return
const n=document.querySelector('.stripe[data-compuid="'+e.item.compUid+'"]')
if(n||(console.log("error scope",'.stripe[data-compuid="'+e.item.compUid+'"]'),console.log("infos",e.item.name,e.item.type)),"camera"==e.item.type||"cameraTarget"==e.item.type)return void n.addEventListener("contextmenu",e=>(e.preventDefault(),!1))
if(n.addEventListener("contextmenu",t=>{t.preventDefault(),e.contextMenuItemStripe=new contextItemTimeline(e.controller,e.item.compUid,t)}),t.isMissing)return
"audio"==t.type&&t.buildWaveForm(),"light"!=t.type&&(e.stripeCurve=new l.default(t,e.args.zoom),(0,a.addObserver)(e,"args.zoom",function(){e.stripeCurve.onZoomChanged(e.args.zoom)}))
var s=document.querySelector("#timeline"),c={},u=[],m=0
const p={x:0,y:0},d=interact('.stripe[data-compuid="'+e.item.compUid+'"]')
d.styleCursor(!1),d.draggable({lockAxis:"x",modifiers:[interact.modifiers.restrict({restriction:"parent"})],listeners:{move(t){if(0!=t.dx&&(p.x+=t.dx,!s.classList.contains("spaceDown"))){var o=e.args.zoom,r=Math.round(p.x/o)
if(e.item.time.in!=c.in+r){var n={in:r,out:r}
e.updateDragInOut(u,n)}}},start(){s.classList.contains("spaceDown")||(o.startEditStripe(),p.x=0,c.in=1*e.item.time.in,c.out=1*e.item.time.out,u=[],e.controller.selectionUtils.selectionArray.items.forEach(function(e,t){e.time&&(u[t]={in:1*e.time.in,out:1*e.time.out})}),_config.features.snapping&&r.activeCompositionData.settings.snapping&&r.activeCompositionData.settings.snapping.enabled&&e.doPossibleSnapsArray())},end(){(0,i.next)(function(){o.stopEditStripe()})}}}).resizable({edges:{left:!0,right:!0},margin:8,listeners:{start(){o.startEditStripe(),m=1*e.item.time.out-1*e.item.time.in,c.in=1*e.item.time.in,c.trackIn=1*e.item.time.trackIn,c.out=1*e.item.time.out
var t=event.target
t.classList.contains("trackIn")&&(t=t.parentElement),t.classList.contains("resize-handle")&&(t=t.parentElement),t.setAttribute("data-x",0),_config.features.snapping&&r.activeCompositionData.settings.snapping&&r.activeCompositionData.settings.snapping.enabled&&e.doPossibleSnapsArray()},move(t){if(!document.querySelector("#timeline").classList.contains("spaceDown")){var o=t.target,r=e.args.zoom,n=parseFloat(o.getAttribute("data-x"))||0,i=t.rect.width
n+=t.deltaRect.left,o.setAttribute("data-x",n)
var a={in:0,out:0}
if(t.edges.left){var l=Math.round(n/r)
a.in=l}if(t.edges.right){var s=Math.round(i/r)
a.out=s-m}(a.in||a.out)&&e.updateResizeInOut(c,a)}},end(){o.stopEditStripe(),"audio"==t.type&&t.buildWaveForm()}},modifiers:[interact.modifiers.restrictEdges({outer:"parent"}),interact.modifiers.restrictSize({min:{width:10}})]})})}willDestroy(){super.willDestroy(...arguments),this.removeSnapGhost(),interact('.stripe[data-compuid="'+this.item.compUid+'"]').unset()}doPossibleSnapsArray(){var e=this,t=e.controller.selectionUtils
if(e.possibleSnaps=[],1==t.getNbItemsSelected()){e.snapTolerance=Math.floor(16/e.args.zoom)
var o,r=e.compositionManager.sceneItems,n=t.getSelectedSceneItem()
if((o=r[n.compIndex-1])&&o.itemData.time){var i=o.itemData.time
e.possibleSnaps.push(1*i.in,1*i.out+1)}if((o=r[n.compIndex+1])&&o.itemData.time){i=o.itemData.time
e.possibleSnaps.push(1*i.in,1*i.out+1)}}}onMaskChanged(){var e=this
if(e.item.mask&&e.item.mask.enabled){var t=e.sceneItem.getMasked(),o="nothing to mask"
t&&(o="alpha masking: ","luma"==e.item.mask.type&&(o="luminance masking: "),o+=t.name,"group"==t.type&&(o+=" (all group items)")),(0,r.set)(e,"maskingText",o)}}checkIfMasked(){(0,r.set)(this,"isMasked",this.sceneItem.isMasked())}mouseDownStripe(){var e=this;(e.checkIfMasked(),2!=event.button)&&(e.mouseDownTime=(new Date).getTime(),_keyboardUtils.controlKey?e.selectItem():e.sceneItem.isSelected||e.selectItem())}mouseUpStripe(){2!=event.button&&(_keyboardUtils.controlKey||(new Date).getTime()-this.mouseDownTime>300||this.selectItem())}selectItem(){var e=this
e.item.locked||(e.controller.timelineUtils.isEditingStripe?console.log("isEditingStripe >> abort select item"):_keyboardUtils.controlKey?e.controller.selectionUtils.toggleItemToSelection(e.item):e.controller.selectionUtils.selectItem(e.item))}updateDragInOut(e,t){var o=this
o.controller.selectionUtils.selectionArray.items.forEach(function(n,i){if(n.time){var a=e[i].in+t.in,l=e[i].out+t.out
if(_config.features.snapping&&o.snapTolerance>1&&1==o.controller.selectionUtils.getNbItemsSelected()){var s=!1,c=!1
o.possibleSnaps.forEach(function(e){if(!s&&!c){var t
if(Math.abs(e-a)<o.snapTolerance)return s=!0,a+=t=e-a,void(l+=t)
if(Math.abs(e-l)<o.snapTolerance)c=!0,a+=t=e-l-1,l+=t}}),s||c?(o.snapGhost||o.addSnapGhost(),o.updateSnapGhostCSS(c)):o.removeSnapGhost()}var u=a-n.time.in
n.time.in==a&&n.time.out==l||((0,r.set)(n.time,"in",a),(0,r.set)(n.time,"out",l),o.controller.keyframesUtils.moveItemKeyframes(n,u))}}),o.controller.refreshAndRender()}updateResizeInOut(e,t){var o=this,n=o.item.type,i=e.in+t.in,a=e.out+t.out,l=o.sceneItem,s=o.item.time,c=0
if(_config.features.snapping&&o.snapTolerance>1&&1==o.controller.selectionUtils.getNbItemsSelected()){var u=!1,m=!1
o.possibleSnaps.forEach(function(e){if(!u&&!m)return t.in&&Math.abs(e-i)<o.snapTolerance?(u=!0,void(i+=c=e-i)):void(t.out&&Math.abs(e-a)<o.snapTolerance&&(m=!0,a+=c=e-a-1))}),u||m?(o.snapGhost||o.addSnapGhost(),o.updateSnapGhostCSS(m)):o.removeSnapGhost()}if("video"==n||"audio"==n||"composition"==n||"imageSequence"==n){var p=e.trackIn+t.in
if(p+=c,s.in==i&&s.out==a&&s.trackIn==p)return
if(p<0)return
if(!o.item.repeat||!o.item.repeat.enabled){var d=l.getStripeMaxFrames(),f=1*s.in+d-1*s.trackIn
a>f&&(a=f)}(0,r.set)(s,"trackIn",p),(0,r.set)(s,"in",i),(0,r.set)(s,"out",a),l.updateMaxFrames(),"video"==n&&l.updateInOutFrames(),"audio"==n&&l.buildWaveForm()}else{if(s.in==i&&s.out==a)return;(0,r.set)(s,"in",i),(0,r.set)(s,"out",a)}o.stripeCurve&&o.stripeCurve.build(),o.compositionManager.renderSameFrame()}addSnapGhost(){var e=this
e.snapGhost=document.createElement("div"),e.snapGhost.className="snapGhost",document.getElementById("overStripes").appendChild(e.snapGhost)}updateSnapGhostCSS(e){var t=this,o=$(".leftRight>.right")[0].scrollLeft,r=350+t.left-o
e&&(r+=t.width),t.snapGhost.style.left=r+"px"}removeSnapGhost(){var e=this
_config.features.snapping&&e.snapGhost&&(e.snapGhost.remove(),e.snapGhost=null)}get cssStripeDiv(){var e=this,t=e.item
if("camera"==t.type||"cameraTarget"==t.type)return(0,n.htmlSafe)(null)
var o=e.args.zoom,r=t.time.in,i=t.time.out-t.time.in
i+=1,e.left=Math.round(r*o),e.width=Math.round(i*o)
var a,l,s="left:"+e.left+"px;width:"+e.width+"px;"
if(t.repeat&&t.repeat.enabled){var c=1*t.repeat.end-1+1,u=e.sceneItem.getParamValueAt(0,"speed")/100,m=Math.round(e.args.zoom*c/u)
s+=`background-image:${l=(a=m)-4,`url("data:image/svg+xml,${encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='${a}' height='20' viewBox='0 0 ${a} 20'>\n                <polyline points='${l},0 ${l+4},4 ${l},8 ${l+4},12 ${l},16 ${l+4},20' stroke='#707070' fill='transparent' stroke-width='1'/>\n                </svg>`).replace(/'/g,"%27").replace(/"/g,"%22")}")`};`,s+="background-position:2px 0;"}return(0,n.htmlSafe)(s)}get cssTrackInDiv(){var e=this,t=e.item.type
if("video"!=t&&"audio"!=t&&"composition"!=t&&"imageSequence"!=t)return(0,n.htmlSafe)(null)
var o=e.args.zoom,r=e.item.time.trackIn,i=Math.round(r*o),a="left:"+-1*i+"px;width:"+i+"px;"
return(0,n.htmlSafe)(a)}get cssTrackOutDiv(){return(0,n.htmlSafe)(null)}},f(p.prototype,"mouseDownStripe",[r.action],Object.getOwnPropertyDescriptor(p.prototype,"mouseDownStripe"),p.prototype),f(p.prototype,"mouseUpStripe",[r.action],Object.getOwnPropertyDescriptor(p.prototype,"mouseUpStripe"),p.prototype),f(p.prototype,"selectItem",[r.action],Object.getOwnPropertyDescriptor(p.prototype,"selectItem"),p.prototype),f(p.prototype,"cssStripeDiv",[c],Object.getOwnPropertyDescriptor(p.prototype,"cssStripeDiv"),p.prototype),f(p.prototype,"cssTrackInDiv",[u],Object.getOwnPropertyDescriptor(p.prototype,"cssTrackInDiv"),p.prototype),f(p.prototype,"cssTrackOutDiv",[m],Object.getOwnPropertyDescriptor(p.prototype,"cssTrackOutDiv"),p.prototype),p);(0,t.setComponentTemplate)(v,h)}),define("pikimov/components/project/timeline/stripe/keyframe",["exports","@ember/component","@glimmer/component","@ember/object","@ember/object/observers","@ember/runloop","@ember/template-factory"],function(e,t,o,r,n,i,a){var l,s
function c(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function u(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const m=(0,a.createTemplateFactory)({id:"OOQIeY56",block:'[[[11,0],[16,0,[29,["keyframe ",[30,1],[52,[30,2,["selected"]]," selected"],[52,[30,2,["static"]]," static"],[52,[30,0,["isDragged"]]," dragged"],[52,[30,0,["isValueDown"]]," valueDown"],[52,[30,0,["isValueUp"]]," valueUp"]]]],[16,1,[29,[[30,0,["domID"]]]]],[16,"data-uid",[30,2,["uid"]]],[4,[38,2],["click",[30,0,["clickKey"]]],null],[12],[10,1],[14,0,"static"],[12],[13],[13],[1,"\\n"],[1,[30,0,["onZoomChanged"]]]],["@type","@key"],["div","if","on","span"]]',moduleName:"pikimov/components/project/timeline/stripe/keyframe.hbs",isStrictMode:!1})
let p=e.default=(l=(0,r.computed)("args.zoom"),s=class extends o.default{constructor(){super(...arguments),c(this,"controller",null),c(this,"key",null),c(this,"domID",null),c(this,"left",0),c(this,"domElement",null),c(this,"isSelected",!1),c(this,"isDragged",!1),c(this,"isValueUp",!1),c(this,"isValueDown",!1)
var e=this
if(e.controller=e.args.controller,e.key=e.args.key,e.domID="k_"+e.args.type+"_"+e.key.uid,(0,n.addObserver)(e,"controller.selectionKeysUpdater",e.onSelectionChanged),_config.isDebug){var t=e.findPreviousKey()
t&&void 0!==t.values.p&&(t.values.p<e.key.values.p&&(e.isValueUp=!0),t.values.p>e.key.values.p&&(e.isValueDown=!0))}(0,i.next)(function(){if(!e.controller.isCompositionReady)return
e.domElement=document.querySelector("#"+e.domID),e.updateCSS()
const t={x:0}
var o,n
interact("#"+e.domID).draggable({lockAxis:"x",modifiers:[interact.modifiers.restrict({restriction:"parent"})],listeners:{move(r){if(0!=r.dx&&!e.isTimelineSpaceDown()){t.x+=r.dx
var i=Math.round(t.x/n)*n
o=Math.round(t.x/n),e.controller.keyframesUtils.moveDrag(o,i)}},start(){e.isTimelineSpaceDown()||(e.selectKeyframe(),n=e.args.zoom,t.x=0,(0,r.set)(e,"isDragged",!0),e.controller.keyframesUtils.startDrag())},end(){e.isTimelineSpaceDown()||((0,r.set)(e,"isDragged",!1),e.controller.keyframesUtils.stopDrag(o,n))}}}),e.domElement||(console.log("*error* sentry keyframe, no dom","#"+e.domID),console.log("infos",e.isSelected,e.args.type,e.key.uid)),e.domElement.addEventListener("selectByRectangle",function(t){e.key.selected||e.selectKeyframe()},!1),e.domElement.addEventListener("deselectByRectangle",function(t){e.key.selected&&e.controller.selectionUtils.deselectKey(e.key)},!1),e.domElement.addEventListener("mousedown",function(t){var o=new CustomEvent("startDragKey")
if(document.querySelector(".selection-rect").dispatchEvent(o),!_keyboardUtils.controlKey&&!e.key.selected)return e.controller.selectionUtils.clearKeysSelection(),void e.selectKeyframe()}),e.domElement.addEventListener("mouseup",function(t){if(!document.querySelector(".contextMenu_key_easing")){var o=_keyboardUtils.controlKey
o||e.controller.selectionUtils.clearKeysSelection(),(o||!e.key.selected)&&o&&e.key.selected?e.controller.selectionUtils.deselectKey(e.key):e.selectKeyframe()}},!1)})}willDestroy(){interact("#"+this.domID).unset()}isTimelineSpaceDown(){var e=document.querySelector("#timeline")
return e||this.controller&&console.warn("WARNING isTimelineSpaceDown",this.controller.isCompositionReady),!!e.classList.contains("spaceDown")}onSelectionChanged(){var e=this,t=e.controller.selectionUtils.selectionArray.keys,o=!1
t.forEach(function(t){t==e.key&&(o=!0)}),o?(0,r.set)(e.key,"selected",!0):(0,r.set)(e.key,"selected",void 0)}findPreviousKey(){var e=this,t=e.key.frame,o=e.controller.keyframesUtils.getKeyArrayByUid(e.key.uid),r=null,n=null
return o.forEach(function(e){e.frame<t&&e.frame>=r&&(r=e.frame,n=e)}),n}selectKeyframe(){this.controller.selectionUtils.selectKey(this.key)}get onZoomChanged(){this.updateCSS()}updateCSS(){var e=this,t=e.domElement
if(t){var o=Math.round(e.key.frame*e.args.zoom-5)
t.style.left=o+"px",t.style.transform="none",t.style.display="block"}}clickKey(){document.getElementById("overStripes").focus()}},u(s.prototype,"onZoomChanged",[l],Object.getOwnPropertyDescriptor(s.prototype,"onZoomChanged"),s.prototype),u(s.prototype,"clickKey",[r.action],Object.getOwnPropertyDescriptor(s.prototype,"clickKey"),s.prototype),s);(0,t.setComponentTemplate)(m,p)}),define("pikimov/components/project/timeline/stripes",["exports","@ember/component","@glimmer/component","@ember/object","@ember/runloop","@ember/template-factory"],function(e,t,o,r,n,i){var a
function l(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function s(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const c=(0,i.createTemplateFactory)({id:"picvm/Zk",block:'[[[11,0],[24,1,"overStripes"],[24,"tabIndex","0"],[4,[38,1],["mousedown",[30,0,["clickOverStripes"]]],null],[4,[38,1],["mouseup",[30,0,["mouseUpOverStripes"]]],null],[12],[1,"\\n"],[42,[28,[37,3],[[28,[37,3],[[30,1,["activeComposition","items"]]],null]],null],null,[[[41,[51,[30,2,["disabled"]]],[[[1,"        "],[8,[39,5],null,[["@controller","@item","@zoom"],[[30,1],[30,2],[30,3]]],null],[1,"\\n"]],[]],null]],[2]],null],[13]],["@controller","item","@zoom"],["div","on","each","-track-array","unless","project/timeline/stripe/item-stripe-keys"]]',moduleName:"pikimov/components/project/timeline/stripes.hbs",isStrictMode:!1})
let u=e.default=(a=class extends o.default{constructor(){super(...arguments),l(this,"controller",null)
var e=this
e.controller=e.args.controller,(0,n.next)(function(){e.controller.keyframesUtils.addMouseEvents()})}clickOverStripes(){(this.removeSnapGhosts(),document.querySelector("#timeline").classList.contains("spaceDown"))||(_keyboardUtils.controlKey||("overStripes"==event.target.id||event.target.classList.contains("overStripe")||event.target.parentNode.classList.contains("keyframes"))&&this.controller.selectionUtils.clearSelection())}mouseUpOverStripes(){this.removeSnapGhosts()}removeSnapGhosts(){$("#overStripes .snapGhost").remove()}},s(a.prototype,"clickOverStripes",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"clickOverStripes"),a.prototype),s(a.prototype,"mouseUpOverStripes",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"mouseUpOverStripes"),a.prototype),a);(0,t.setComponentTemplate)(c,u)}),define("pikimov/components/project/timeline/timebar",["exports","@ember/component","@glimmer/component","@ember/object","@ember/template","@ember/runloop","@ember/template-factory"],function(e,t,o,r,n,i,a){var l,s,c,u
function m(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function p(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const d=(0,a.createTemplateFactory)({id:"NGrFzfSm",block:'[[[10,0],[14,1,"timeBar"],[14,0,"notranslate"],[12],[1,"\\n    "],[10,0],[14,0,"times"],[12],[13],[1,"\\n    "],[10,0],[14,1,"timeCursor"],[15,5,[30,0,["cssTimeCursor"]]],[12],[10,1],[14,0,"bar"],[12],[13],[13],[1,"\\n"],[13],[1,"\\n"],[1,[30,0,["onZoomChanged"]]],[1,"\\n"],[1,[30,0,["onFrameRateChanged"]]],[1,"\\n\\n"],[8,[39,2],null,[["@controller","@zoom"],[[30,1],[30,2]]],null],[1,"\\n"]],["@controller","@zoom"],["div","span","project/timeline/markers-bar"]]',moduleName:"pikimov/components/project/timeline/timebar.hbs",isStrictMode:!1})
let f=e.default=(l=(0,r.computed)("args.zoom","controller.activeComposition.time.start","controller.activeComposition.time.end"),s=(0,r.computed)("args.zoom","controller.activeComposition.frameRate"),c=(0,r.computed)("args.controller.currentFrame","args.zoom"),u=class extends o.default{constructor(){super(...arguments),m(this,"controller",null),m(this,"width",0)
var e=this
e.controller=e.args.controller,(0,i.next)(function(){e.controller.isCompositionReady&&(e.addClickEvents(),e.drawBars(),e.addTimes())})}get onZoomChanged(){var e=this,t=e.controller.getters.getCompositionNbFrames(e.controller.activeComposition)
e.width=Math.floor(t*e.args.zoom),$("#timeBar").css({width:e.width+"px"}),$("#overStripes").css({width:e.width+"px"})}get onFrameRateChanged(){this.controller.activeComposition.frameRate<1?console.log("error frameRate < 1"):(this.drawBars(),this.addTimes())}calculateStep(e){var t=1
return e<50&&(t=2),e<20&&(t=5),e<10&&(t=10),e<5&&(t=20),e<2&&(t=60),e<1&&(t=120),e<.5&&(t=300),t}drawBars(){var e=this,t=document.querySelector("#timeBar"),o=e.args.zoom*e.controller.activeComposition.frameRate,r=o*e.calculateStep(o),n="repeating-linear-gradient(to right,"
n+=`transparent 0, transparent ${r-1}px, #aaaaaa ${r-1}px, #aaaaaa ${r}px`,n+=")",t.style.backgroundImage=n}addTimes(){var e=this,t=$("#timeBar .times")[0]
t.innerHTML=""
var o,r=e.controller.activeComposition.time.end,n=e.controller.activeComposition.frameRate,i=Math.floor(r/n)+1,a=e.args.zoom*n,l=e.calculateStep(a)
for(o=0;o<=i;o+=l)if(0!=o){var s=document.createElement("span"),c=formatSeconds(o)
s.innerText=c,s.style.left=Math.round(o*a)+"px",t.appendChild(s)}}addClickEvents(){var e=this
$("#timeBar").on("mousedown",function(t){if(e.controller.playbackUtils.pause(),"timeLoopStart"==t.target.id)return!0
if("timeLoopEnd"==t.target.id)return!0
if("timeCursor"==t.target.id)return!0
var o=$(this).offset().left,r=t.pageX-o,n=Math.round(r/e.args.zoom)
e.setFrame(n)})
const t=interact("#timeBar")
t.styleCursor(!1)
var o=0
const r={x:0}
t.draggable({lockAxis:"x",modifiers:[interact.modifiers.restrict({})],listeners:{move(t){r.x+=t.dx
var n=Math.round(r.x/e.args.zoom)
e.setFrame(o+n)},start(){r.x=0,o=e.controller.currentFrame},end(){e.controller.refreshAndRender(),e.controller.uiManager.keyboardFocus()}}})}get cssTimeCursor(){var e=Math.round(this.controller.currentFrame*this.args.zoom)
return(0,n.htmlSafe)("left:"+e+"px;")}setFrame(e){e<0&&(e=0),e!=this.controller.currentFrame&&this.controller.setFrame(e)}},p(u.prototype,"onZoomChanged",[l],Object.getOwnPropertyDescriptor(u.prototype,"onZoomChanged"),u.prototype),p(u.prototype,"onFrameRateChanged",[s],Object.getOwnPropertyDescriptor(u.prototype,"onFrameRateChanged"),u.prototype),p(u.prototype,"cssTimeCursor",[c],Object.getOwnPropertyDescriptor(u.prototype,"cssTimeCursor"),u.prototype),u);(0,t.setComponentTemplate)(d,f)}),define("pikimov/components/project/timeline/timeline-controls",["exports","@ember/component","@glimmer/component","@ember/object","@ember/template-factory"],function(e,t,o,r,n){var i
function a(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function l(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const s=(0,n.createTemplateFactory)({id:"C7HBZ+rM",block:'[[[10,0],[14,1,"timelineControls"],[14,0,"notranslate"],[12],[1,"\\n\\n    "],[10,0],[12],[1,"\\n        "],[10,0],[14,1,"playBackControls"],[12],[1,"\\n            "],[11,1],[24,0,"button stop"],[4,[38,2],["click",[30,0,["stop"]]],null],[12],[1,"\\n                "],[10,"img"],[14,"draggable","false"],[14,"src","icons/stop.svg"],[12],[13],[1,"\\n            "],[13],[1," \\n            "],[11,1],[24,0,"button play"],[4,[38,2],["click",[30,0,["play"]]],null],[12],[1,"\\n                "],[10,"img"],[14,"draggable","false"],[14,"src","icons/play.svg"],[12],[13],[1,"\\n            "],[13],[1,"\\n            "],[11,1],[24,0,"button pause"],[4,[38,2],["click",[30,0,["pause"]]],null],[12],[1,"\\n                "],[10,"img"],[14,"draggable","false"],[14,"src","icons/pause.svg"],[12],[13],[1,"\\n            "],[13],[1," \\n        "],[13],[1,"\\n    "],[13],[1,"\\n\\n    "],[10,0],[14,0,"time"],[12],[1,"\\n"],[41,[30,1,["compositionManager"]],[[[1,"            "],[10,1],[14,0,"mmssms"],[12],[1,[28,[35,5],[[30,1,["currentFrame"]],[30,1,["activeComposition","frameRate"]]],null]],[13],[1,"\\n            "],[10,1],[14,0,"frames"],[12],[1,[30,1,["currentFrame"]]],[1," / "],[1,[30,1,["activeComposition","time","end"]]],[13],[1,"\\n"]],[]],null],[1,"    "],[13],[1,"\\n\\n    "],[10,0],[14,0,"zoom"],[12],[1,"\\n        -\\n        "],[8,[39,6],null,[["@label","@value","@min","@max","@step","@action"],[null,[30,1,["timelineZoom"]],0,1,0.1,[30,0,["onZoomChanged"]]]],null],[1,"\\n        +\\n    "],[13],[1,"\\n\\n    "],[10,0],[14,0,"timelineTools"],[12],[1,"\\n"],[41,[28,[37,7],["snapping"],null],[[[1,"        "],[11,1],[16,0,[29,["ui_toolIcon tooltip ",[52,[30,1,["compositionManager","compositionData","settings","snapping","enabled"]],"on"]]]],[4,[38,2],["click",[28,[37,8],[[30,0,["toggleSnap"]]],null]],null],[12],[1,"\\n            "],[10,"img"],[14,"draggable","false"],[14,"src","icons/icon-snap.svg"],[12],[13],[1,"\\n            "],[10,1],[14,0,"tooltiptext p50"],[12],[1,"Toggle auto snapping"],[13],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[1,"    "],[13],[1,"\\n\\n    "],[10,0],[14,0,"name notranslate"],[12],[1,"\\n        "],[1,[30,1,["activeComposition","name"]]],[1," "],[10,1],[14,0,"dev"],[12],[1,"x"],[1,[30,0,["getNbItems"]]],[13],[1,"\\n    "],[13],[1,"\\n\\n"],[13],[1,"\\n  "]],["@controller"],["div","span","on","img","if","frame-to-time","ui/property-range","get-config-feature","fn"]]',moduleName:"pikimov/components/project/timeline/timeline-controls.hbs",isStrictMode:!1})
let c=e.default=(i=class extends o.default{constructor(){super(...arguments),a(this,"controller",null)
this.controller=this.args.controller}play(){this.controller.playbackUtils.play(),this.controller.uiManager.keyboardFocus()}pause(){this.controller.playbackUtils.pause(),this.controller.uiManager.keyboardFocus()}stop(){this.controller.playbackUtils.stop(),this.controller.uiManager.keyboardFocus()}onZoomChanged(){this.args.parent.rebuild()}toggleSnap(){var e=this.controller.activeCompositionData,t=e.settings.snapping
t||((0,r.set)(e.settings,"snapping",{enabled:!1}),t=e.settings.snapping)
var o=t.enabled;(0,r.set)(t,"enabled",!o)}},l(i.prototype,"play",[r.action],Object.getOwnPropertyDescriptor(i.prototype,"play"),i.prototype),l(i.prototype,"pause",[r.action],Object.getOwnPropertyDescriptor(i.prototype,"pause"),i.prototype),l(i.prototype,"stop",[r.action],Object.getOwnPropertyDescriptor(i.prototype,"stop"),i.prototype),l(i.prototype,"onZoomChanged",[r.action],Object.getOwnPropertyDescriptor(i.prototype,"onZoomChanged"),i.prototype),l(i.prototype,"toggleSnap",[r.action],Object.getOwnPropertyDescriptor(i.prototype,"toggleSnap"),i.prototype),i);(0,t.setComponentTemplate)(s,c)}),define("pikimov/components/project/timeline/timeline",["exports","@ember/component","@glimmer/component","@ember/object","@ember/runloop","pikimov/classes/managers/curves-editor-manager","@ember/template-factory"],function(e,t,o,r,n,i,a){var l,s,c
function u(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function m(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const p=(0,a.createTemplateFactory)({id:"XZ7L6rqd",block:'[[[1,"\\n"],[10,0],[14,1,"timeline"],[12],[1,"\\n\\n    "],[10,0],[14,0,"resizer"],[12],[13],[1,"\\n\\n    "],[10,"header"],[12],[1,"\\n        "],[10,0],[14,0,"left"],[12],[1,"\\n"],[1,"\\n"],[41,[28,[37,3],[[30,0,["getNbItems"]],[30,0,["maxItems"]]],null],[[[1,"            "],[11,1],[24,1,"b_addItem"],[24,0,"button"],[4,[38,5],["click",[30,0,["toggleAddItemSelector"]]],null],[12],[1,"\\n                "],[10,"i"],[14,0,"bx bx-plus"],[12],[13],[1,"Add item\\n            "],[13],[1,"\\n"]],[]],[[[1,"            items limit reached ("],[1,[30,0,["maxItems"]]],[1,")\\n"]],[]]],[1,"\\n            "],[8,[39,7],null,[["@controller"],[[30,1]]],null],[1,"\\n        "],[13],[1,"\\n        "],[8,[39,8],null,[["@controller","@parent"],[[30,1],[30,0]]],null],[1,"\\n    "],[13],[1,"\\n\\n"],[41,[30,0,["isAddItemSelectorOpen"]],[[[1,"        "],[8,[39,9],null,[["@controller","@parent","@overlayComponent"],[[30,1],[30,0],[30,0]]],null],[1,"\\n"]],[]],null],[1,"\\n    "],[10,0],[14,0,"leftRight"],[12],[1,"\\n\\n        "],[10,0],[14,0,"left"],[12],[1,"\\n\\n            "],[10,0],[14,0,"topLeft"],[12],[1,"\\n            "],[13],[1,"\\n\\n"],[41,[30,0,["isCompositionEmpty"]],[[[1,"                "],[10,0],[14,0,"tutorial animated emptyComposition"],[12],[1,"Start here"],[13],[1,"\\n"],[1,"                "],[10,2],[14,0,"empty"],[12],[1,"empty composition"],[13],[1,"\\n"]],[]],null],[1,"\\n"],[1,"            "],[11,0],[24,1,"overItemsInputs"],[4,[38,5],["dragenter",[30,0,["dragEnter"]]],null],[4,[38,5],["dragover",[30,0,["dragOver"]]],null],[4,[38,5],["dragleave",[30,0,["dragLeave"]]],null],[4,[38,5],["drop",[30,0,["dropFile"]]],null],[12],[1,"    \\n"],[42,[28,[37,12],[[28,[37,12],[[30,1,["activeComposition","items"]]],null]],null],null,[[[41,[51,[30,2,["disabled"]]],[[[1,"                        "],[8,[39,14],null,[["@controller","@item","@timeline"],[[30,1],[30,2],[30,0]]],null],[1,"\\n"]],[]],null]],[2]],null],[1,"            "],[13],[1,"\\n\\n        "],[13],[1,"\\n        "],[10,0],[14,0,"right scrollbar"],[12],[1,"\\n\\n            "],[8,[39,15],null,[["@controller","@zoom"],[[30,1],[30,0,["zoomScale"]]]],null],[1,"\\n\\n"],[41,[30,0,["isCurvesEditorOpen"]],[[[1,"                "],[8,[39,16],null,[["@controller","@zoom"],[[30,1],[30,0,["zoomScale"]]]],null],[1,"\\n"]],[]],[[[1,"                "],[8,[39,17],null,[["@controller","@zoom"],[[30,1],[30,0,["zoomScale"]]]],null],[1,"\\n"]],[]]],[1,"\\n        "],[13],[1,"\\n\\n    "],[13],[1,"\\n\\n    "],[10,0],[14,0,"selection-rect"],[12],[13],[1,"\\n\\n"],[13]],["@controller","item"],["div","header","if","lt","span","on","i","project/export-button","project/timeline/timeline-controls","project/composition/add-item","p","each","-track-array","unless","project/timeline/input/item-inputs","project/timeline/timebar","project/timeline/curves-editor","project/timeline/stripes"]]',moduleName:"pikimov/components/project/timeline/timeline.hbs",isStrictMode:!1})
let d=e.default=(l=(0,r.computed)("args.controller.activeComposition.items.length"),s=(0,r.computed)("args.controller.isCompositionReady"),c=class extends o.default{constructor(){super(...arguments),u(this,"controller",null),u(this,"contextMenuItem",null),u(this,"fullWidth",0),u(this,"minZoom",1),u(this,"maxZoom",20),u(this,"zoomScale",1),u(this,"maxItems",_config.compositions.maxItems),u(this,"isAddItemSelectorOpen",!1),u(this,"compositionsUtils",null),u(this,"isCurvesEditorOpen",!1),u(this,"curvesEditorManager",null)
var e=this
e.controller=e.args.controller,e.controller.timelineComponent=this
var t=e.controller.activeCompositionData
e.compositionsUtils=new compositionsUtils(e.controller,t,null),(0,n.next)(function(){if(e.controller.isCompositionReady){e.controller.uiManager.setupResizerBar(),e.rebuild(),e.controller.timelineUtils.addMouseEvents(),e.doSortable()
var t=document.querySelector("#timeline")
_config.isDebug||t.addEventListener("contextmenu",e=>e.preventDefault()),e.addContextMenuEvents(),$("#timeline").on("click",function(){e.closeContextMenus()})
var o=document.querySelector("#timeline .right"),r=document.querySelector("#overItemsInputs")
o.addEventListener("scroll",function(){r.scrollTop=this.scrollTop}),r.addEventListener("scroll",function(){o.scrollTop=this.scrollTop})}})}addContextMenuEvents(){var e=this
document.querySelectorAll(".oneItemInputs").forEach(function(t){t.addEventListener("contextmenu",t=>{t.preventDefault()
var o=1*$(t.target).parents(".oneItemInputs").attr("data-compuid")
o&&(e.contextMenuItem=new contextItemTimeline(e.controller,o,t))})})}get isCompositionEmpty(){this.doCurveEditor()
var e=this.controller.compositionManager
return"2D"==e.cameraType&&0==e.nbItems||"3D"==e.cameraType&&e.nbItems<2}get getNbItems(){return this.controller.compositionManager.nbItems}closeContextMenus(){var e=this
e.controller.keyframesUtils.closeContextMenus(),e.contextMenuItem&&e.contextMenuItem.closeMenu(),e.controller.removeContextMenusDom()}rebuild(){var e=this,t=e.controller
if(t.isCompositionReady){var o=t.uiManager.getAppWidth()
if("portrait"==t.workspace)o=document.querySelector("#timeline").getBoundingClientRect().width
var i=o-350-14,a=t.getters.getCompositionNbFrames(t.activeComposition)
e.minZoom=i/a
var l=1*t.timelineZoom,s=e.minZoom+l*(e.maxZoom-e.minZoom);(0,r.set)(e,"zoomScale",s),e.fullWidth=a*e.zoomScale,e.drawBgLines()
var c=$("#timeline .right.scrollbar");(0,n.next)(function(){var o=Math.round(t.currentFrame*e.zoomScale),r=Math.round(o-i/2)
c.scrollLeft(r)})}}drawBgLines(){var e=this,t=e.controller.activeComposition.frameRate,o=e.zoomScale*t,r=o*e.calculateStep(o)
o>250&&(r=o/t)
var i="repeating-linear-gradient(to right,"
i+=`transparent 0, transparent ${r-1}px, #444444 ${r-1}px, #444444 ${r}px`,i+=")",(0,n.next)(function(){$("#overStripes").css({width:e.fullWidth+"px",backgroundImage:i}),$("#curvesEditor").css({width:e.fullWidth+"px",backgroundImage:i})})}calculateStep(e){var t=1
return e<50&&(t=2),e<20&&(t=5),e<10&&(t=5),e<5&&(t=10),e<1&&(t=30),t}dragEnter(e){if(-1===e.dataTransfer.types.indexOf("Files"))return!1
e.preventDefault()
var t=$(e.target)
t.is("#overItemsInputs")||(t=t.parents("#overItemsInputs")),t.addClass("isDragover")}dragOver(e){e.preventDefault()}dragLeave(e){}dropFile(e){}stopEditName(){var e=this.controller
e.isCompositionReady&&(e.addToHistory("item","edit name"),e.compositionManager.sceneItems.forEach(function(e){var t=e.getCompItem()
e.name=t.name}),e.needSaving())}doSortable(){var e=this,t=e.controller
if(t.isCompositionReady){var o=document.querySelector("#overItemsInputs")
new Sortable(o,{handle:".handle",group:{name:"top",put:["top","children"]},animation:150,fallbackOnBody:!0,swapThreshold:.65,onStart:function(e){a(e)},onEnd:function(e){l(e)}})
var r,i=document.querySelectorAll("#overItemsInputs .subItems, #overItemsInputs .groupHeader")
for(r=0;r<i.length;r++)new Sortable(i[r],{handle:".handle",group:{name:"children",put:["top","children"],pull:["top","children"]},animation:150,fallbackOnBody:!0,swapThreshold:.65,onStart:function(e){a(e)},onEnd:function(e){l(e)}})}function a(e){var o=e.item.getAttribute("data-compuid")
t.uiManager.draggingCompItem=!0
var r=t.activeCompositionData,n=t.getters.getCompItemByCompUid(r,o)
t.selectionUtils.isItemSelected(n)||t.selectionUtils.selectItem(n),e.item.classList.remove("open")}function l(o){var r=o.item,i=o.newIndex,a=o.to.getAttribute("data-parentCompUid"),l=o.to.childElementCount-1
t.playbackUtils.pause(),e.compositionsUtils.setNewOrder(a,i)?(i==l&&r.remove(),(0,n.next)(function(){e.doSortable(),e.addContextMenuEvents()})):console.log("cancel reordering")}}checkCurveEditorStatus(){var e=this
e.getCurveEditorConfig()?((0,r.set)(e,"isCurvesEditorOpen",!0),(0,n.next)(function(){e.doCurveEditor()||e.closeCurvesEditor()})):e.closeCurvesEditor()}getCurveEditorConfig(){var e=null,t=null,o=this.controller,r=o.getters.getAllCompositionItems(o.activeCompositionData),n=null,i=null
return r.forEach(function(r){var a=o.getters.getSceneItemByCompUid(o.compositionManager,r.compUid)
o.getters.getItemAllProperties(r).forEach(function(o){if(o.curvesEditorOpen){if(e=a.name,n=(t=o).name,i=["p"],t==r.position){n="position"
var l=a.getTransformEnabledAxes().position
i=[],l.x&&i.push("x"),l.y&&i.push("y"),l.z&&i.push("z")}if(t==r.rotation){n="rotation"
l=a.getTransformEnabledAxes().rotation
i=[],l.x&&i.push("x"),l.y&&i.push("y"),l.z&&i.push("z")}if(t==r.scale){n="scale"
l=a.getTransformEnabledAxes().scale
i=[],l.x&&i.push("x"),l.y&&i.push("y"),l.z&&i.push("z")}}})}),t?{itemName:e,property:t,propertyName:n,propertyValues:i}:null}doCurveEditor(){var e=this,t=e.getCurveEditorConfig()
return t?"lattice points"==t.propertyName?(openModal({p:"This property is not editable with the graph editor"}),!1):(e.curvesEditorManager=new i.default(e.controller,e.zoomScale),e.curvesEditorManager.setConfig(t),e.curvesEditorManager.build(),(0,n.next)(function(){e.drawBgLines()}),!0):(e.isCurvesEditorOpen&&e.closeCurvesEditor(),!1)}refreshCurveEditor(){this.curvesEditorManager&&this.curvesEditorManager.build()}closeCurvesEditor(){(0,r.set)(this,"isCurvesEditorOpen",!1),this.drawBgLines()}toggleAddItemSelector(e){var t=this
!1!==e&&(e=!t.isAddItemSelectorOpen),(0,r.set)(t,"isAddItemSelectorOpen",e),t.isAddItemSelectorOpen&&(0,n.next)(function(){if(t.isAddItemSelectorOpen||console.log("WARNING isAddItemSelectorOpen FALSE"),!t.isAddItemSelectorOpen)return
const e=document.getElementById("addItemSelector")
e||console.log("error -- popover is null",t.isAddItemSelectorOpen,t.controller.isCompositionReady),e.showPopover()
var o=450
"landscape"==t.controller.workspace&&(o=document.getElementById("projectTop").clientHeight)
var n=o+60
e.style.top=n+"px",e.addEventListener("toggle",o=>{e.matches(":popover-open")||(0,r.set)(t,"isAddItemSelectorOpen",!1)})})}},m(c.prototype,"isCompositionEmpty",[l],Object.getOwnPropertyDescriptor(c.prototype,"isCompositionEmpty"),c.prototype),m(c.prototype,"getNbItems",[s],Object.getOwnPropertyDescriptor(c.prototype,"getNbItems"),c.prototype),m(c.prototype,"dragEnter",[r.action],Object.getOwnPropertyDescriptor(c.prototype,"dragEnter"),c.prototype),m(c.prototype,"dragOver",[r.action],Object.getOwnPropertyDescriptor(c.prototype,"dragOver"),c.prototype),m(c.prototype,"dragLeave",[r.action],Object.getOwnPropertyDescriptor(c.prototype,"dragLeave"),c.prototype),m(c.prototype,"dropFile",[r.action],Object.getOwnPropertyDescriptor(c.prototype,"dropFile"),c.prototype),m(c.prototype,"toggleAddItemSelector",[r.action],Object.getOwnPropertyDescriptor(c.prototype,"toggleAddItemSelector"),c.prototype),c);(0,t.setComponentTemplate)(p,d)}),define("pikimov/components/project/tools/depth-estimation",["exports","@ember/component","@glimmer/component","@ember/object","@ember/runloop","@ember/template-factory"],function(e,t,o,r,n,i){var a
function l(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function s(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const c=(0,i.createTemplateFactory)({id:"boUmJOWk",block:'[[[10,0],[14,1,"UI_MT"],[14,0,"modal"],[12],[1,"\\n\\n    "],[10,0],[14,1,"removeBg"],[12],[1,"\\n        "],[10,"header"],[12],[1,"\\n            "],[10,"h2"],[12],[1,"Depth estimation"],[13],[1,"\\n"],[41,[51,[30,0,["isRunning"]]],[[[1,"            "],[11,1],[24,0,"b_close"],[4,[38,5],["click",[30,0,["closeTool"]]],null],[12],[13],[1,"\\n"]],[]],null],[1,"        "],[13],[1,"\\n\\n        "],[10,0],[14,0,"composition"],[12],[1,"\\n\\n            "],[10,0],[14,0,"overCanvas scrollbar"],[12],[1,"\\n                "],[10,"canvas"],[12],[13],[1,"\\n            "],[13],[1,"\\n\\n            "],[10,0],[14,0,"topHelp"],[12],[1,"\\n\\n"],[41,[51,[30,0,["isRunning"]]],[[[1,"\\n                    "],[10,2],[12],[1,"Use this tool to estimate the depth of an image or video"],[13],[1,"\\n"]],[]],[[[1,"                    "],[10,"br"],[12],[13],[1,"\\n                    "],[10,2],[12],[1,"Please be patient, the process can be VERY long"],[13],[1,"\\n"]],[]]],[1,"\\n            "],[13],[1,"\\n            \\n\\n"],[41,[28,[37,10],[[30,0,["currentStep"]],1],null],[[[1,"                "],[10,0],[14,0,"itemsSelector"],[12],[1,"\\n                    "],[8,[39,11],null,null,[["default"],[[[[1,"Choose the source"]],[]]]]],[1,"\\n                    "],[10,"br"],[12],[13],[1,"\\n\\n"],[41,[51,[30,0,["sceneItemsB","length"]]],[[[1,"                        "],[10,1],[14,0,"warning"],[12],[1,"There is no possible source"],[13],[1,"\\n"]],[]],null],[1,"\\n                    "],[10,"ul"],[14,0,"scrollbar notranslate"],[12],[1,"\\n"],[42,[28,[37,14],[[28,[37,14],[[30,0,["sceneItemsB"]]],null]],null],null,[[[1,"                        "],[11,"li"],[16,0,[29,["grid ",[52,[28,[37,10],[[30,0,["activeSource"]],[30,1]],null],"active"]]]],[4,[38,5],["click",[28,[37,16],[[30,0,["selectItemB"]],[30,1]],null]],null],[12],[1,"\\n                            "],[10,1],[12],[41,[30,1,["thumbnail"]],[[[10,"img"],[15,"src",[29,[[30,1,["thumbnail","src"]]]]],[14,"alt","."],[14,0,"thumbnail"],[12],[13]],[]],null],[13],[1,"\\n                            "],[10,"label"],[12],[1,[30,1,["name"]]],[13],[1,"\\n                        "],[13],[1,"\\n"]],[1]],null],[1,"                    "],[13],[1,"\\n\\n"],[41,[30,0,["activeSource"]],[[[1,"                        "],[11,1],[24,0,"button"],[4,[38,5],["click",[28,[37,16],[[30,0,["setsceneItemS"]],[30,0,["activeSource"]]],null]],null],[12],[1,"next"],[13],[1,"\\n"]],[]],[[[1,"                        "],[10,1],[14,0,"button"],[14,5,"visibility:hidden"],[12],[1," "],[13],[1,"\\n"]],[]]],[1,"                "],[13],[1," \\n"]],[]],null],[1,"\\n"],[41,[28,[37,10],[[30,0,["currentStep"]],2],null],[[[1,"                "],[10,0],[14,0,"itemsSelector"],[12],[1,"\\n                    "],[8,[39,11],null,null,[["default"],[[[[1,"Choose a folder to save the generated mask"]],[]]]]],[1,"\\n                    "],[10,"br"],[12],[13],[1,"\\n\\n                    "],[8,[39,19],null,null,[["default"],[[[[1,"it is recommended to save the mask in the same folder as other project assets"]],[]]]]],[1,"\\n\\n                    "],[11,1],[24,0,"button"],[4,[38,5],["click",[30,0,["chooseFolderAction"]]],null],[12],[1,"choose folder"],[13],[1,"\\n                "],[13],[1," \\n"]],[]],null],[1,"\\n        "],[13],[1,"\\n\\n        "],[10,0],[14,0,"settings"],[12],[1,"\\n\\n            "],[10,0],[12],[1,"\\n"],[41,[30,0,["isRunning"]],[[[1,"                \\n                "],[10,2],[12],[1,"\\n                    Frame "],[1,[28,[35,20],[[30,0,["nbFramesBaked"]]],null]],[1," / "],[1,[30,0,["nbFramesToBake"]]],[1," \\n                    "],[10,"br"],[12],[13],[10,"br"],[12],[13],[1,"\\n                    "],[10,0],[14,0,"progressBar"],[12],[1,"\\n                        "],[10,0],[14,0,"filler"],[12],[13],[1,"\\n                    "],[13],[1,"\\n                "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["done"]],[[[1,"                    "],[10,"video"],[14,"controls",""],[14,1,"removeBgResult"],[12],[13],[1,"\\n"]],[]],null],[1,"            "],[13],[1,"\\n\\n"],[41,[51,[30,0,["done"]]],[[[1,"            "],[10,0],[12],[1,"\\n\\n"],[41,[51,[30,0,["isRunning"]]],[[[41,[28,[37,10],[[30,0,["currentStep"]],3],null],[[[1,"\\n                    "],[10,0],[14,0,"startEnd"],[12],[1,"\\n                        "],[10,"br"],[12],[13],[1,"\\n                        "],[8,[39,22],null,[["@label","@obj","@property","@min","@max","@action"],["start on frame",[30,0],"startFrame",0,[30,0,["endFrame"]],null]],null],[1,"\\n\\n                        "],[8,[39,22],null,[["@label","@obj","@property","@min","@max","@action"],["stop on frame",[30,0],"endFrame",[30,0,["startFrame"]],[30,0,["compositionData","time","end"]],null]],null],[1,"\\n                    "],[13],[1,"\\n\\n"]],[]],null]],[]],null],[1,"\\n"],[41,[30,0,["isRunning"]],[[[41,[28,[37,23],[[30,0,["nbFramesBaked"]],1],null],[[[1,"                        "],[10,"br"],[12],[13],[1,"\\n                        Total time estimated: "],[1,[30,0,["total_time_estimated_m"]]],[1," "],[41,[28,[37,23],[[30,0,["total_time_estimated_m"]],1],null],[[[1,"minutes"]],[]],[[[1,"minute"]],[]]],[1,"\\n                        "],[10,"br"],[12],[13],[10,"br"],[12],[13],[1,"\\n                        Time remaining: "],[1,[30,0,["total_time_remaining_m"]]],[1," "],[41,[28,[37,23],[[30,0,["total_time_remaining_m"]],1],null],[[[1,"minutes"]],[]],[[[1,"minute"]],[]]],[1,"\\n"]],[]],null]],[]],null],[1,"\\n            "],[13],[1,"\\n\\n            "],[10,0],[14,0,"buttons"],[12],[1,"\\n\\n"],[41,[28,[37,10],[[30,0,["currentStep"]],3],null],[[[1,"\\n"],[41,[51,[30,0,["isRunning"]]],[[[1,"                    "],[11,1],[24,1,"b_start"],[24,0,"button"],[4,[38,5],["click",[30,0,["start"]]],null],[12],[1,"Start"],[13],[1,"\\n                    "],[10,"br"],[12],[13],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["isRunning"]],[[[1,"                        "],[11,1],[24,0,"button red"],[4,[38,5],["click",[30,0,["abort"]]],null],[12],[1,"Abort"],[13],[1,"\\n"]],[]],null]],[]],null],[1,"\\n            "],[13],[1,"\\n"]],[]],null],[1,"\\n        "],[13],[1,"\\n    "],[13],[1,"\\n\\n"],[13]],["item"],["div","header","h2","unless","span","on","canvas","p","br","if","eq","ui/property-title","ul","each","-track-array","li","fn","img","label","ui/property-note","plus-one","video","ui/property-number","mt"]]',moduleName:"pikimov/components/project/tools/depth-estimation.hbs",isStrictMode:!1})
let u=e.default=(a=class extends o.default{constructor(){super(...arguments),l(this,"controller",null),l(this,"compositionManager",null),l(this,"compositionData",null),l(this,"removeBg",null),l(this,"visibilityArray",[]),l(this,"zoom",100),l(this,"activeSource",null),l(this,"sceneItemsB",[]),l(this,"sceneItemS",null),l(this,"nbFramesToBake",0),l(this,"nbFramesBaked",0),l(this,"startFrame",0),l(this,"endFrame",10),l(this,"frameIndex",0),l(this,"currentStep",1),l(this,"isRunning",!1),l(this,"isAborted",!1),l(this,"done",!1),l(this,"toolCanvas",null),l(this,"start_time",0),l(this,"total_time_estimated",0),l(this,"total_time_remaining",0),l(this,"total_time_estimated_m",0),l(this,"total_time_remaining_m",0),l(this,"fileName",null),l(this,"directoryHandle",null),l(this,"fileHandle",null),l(this,"allowedTypes",["image","video","imageSequence"])
var e=this
e.controller=e.args.controller,e.compositionManager=e.controller.compositionManager,e.compositionData=e.controller.activeCompositionData,e.controller.getters.getAllCompositionItems(e.compositionData).forEach(function(t){e.visibilityArray["item_"+t.compUid]=t.hidden})
var t=e.compositionManager.getDimensions()
t.width*t.height>2073600&&(e.zoom=50),e.sceneItemsB=e.controller.getters.getAllCompositionSceneItems(e.compositionManager,e.allowedTypes),(0,n.next)(function(){e.controller.setCompositionDisplayZoom(e.zoom)
var t=e.compositionManager.canvas
e.toolCanvas=document.querySelector("#removeBg canvas"),e.toolCanvas.width=t.width,e.toolCanvas.height=t.height}),e.loadTRModule()}async loadTRModule(){await async function(e){return new Promise((t,o)=>{const r=document.createElement("script")
r.src=e,r.type="module",r.onload=()=>t(),r.onerror=()=>o(new Error(`Failed to load script: ${e}`)),document.head.appendChild(r)})}("js/tr/depth-estimation.js")}async selectFolder(){var e=this
try{e.directoryHandle=await window.showDirectoryPicker()
var t=new Date,o=(t.getHours()+100).toString().substring(1)+(t.getMinutes()+100).toString().substring(1)+(t.getSeconds()+100).toString().substring(1)
e.fileName="remove-bg-mask-"+e.sceneItemS.name+"_"+o+".mp4"}catch(r){return console.log(r.name),console.error("Catch error selecting directory:",r),!1}return!0}async saveVideoFile(){var e=this
e.fileHandle=await e.directoryHandle.getFileHandle(e.fileName,{create:!0})
var t=$("#removeBgResult")[0],o=await async function(e){const t=await fetch(e.src)
return await t.blob()}(t)
await async function(t){try{const o=await e.fileHandle.createWritable()
await o.write(t),await o.close(),console.log("Video mask saved successfully")}catch(o){console.error("Error saving video:",o)}}(o)}async startJob(){var e=this
e.startFrame*=1,e.endFrame*=1,e.frameIndex=e.startFrame,(0,r.set)(e,"nbFramesToBake",e.endFrame-e.startFrame+1),(0,r.set)(e,"isRunning",!0),(0,r.set)(e,"done",!1),e.removeBg=new c_depthEstimation(e.controller,e.toolCanvas.width,e.toolCanvas.height),e.removeBg.getReady(async function(){e.start_time=new Date,e.doOneFrame()})}async importMaskFile(){var e=this
var t=[await e.fileHandle.getFile()]
e.controller.libraryManager.importFiles(t)
var o=setInterval(function(){e.controller.isCompositionReady&&(clearInterval(o),o=null,e.setupMaskItem())},200)}setupMaskItem(){var e=this
console.log("depth estimation setup mask item")
var t=e.compositionManager.sceneItems[0].itemData;(0,r.set)(t.time,"in",e.startFrame),(0,r.set)(t.time,"out",e.endFrame),t.mask={enabled:1,type:"luma"}
var o=100/e.zoom*100
t.scale.values={x:o,y:o,z:100}
var n=e.sceneItemS.parentCompUid,i=e.sceneItemS.localIndex
n||i--
var a=new compositionsUtils(e.controller,e.compositionData,null)
a.setNewOrder(n,i)||console.log("error mask reordering"),a=null}hideAllItemsButSource(){this.compositionManager.sceneItems.forEach(function(e){e.itemData.hidden=!0})
var e=this.activeSource
e&&(e.itemData.hidden=void 0,e.getParents().forEach(function(e){e.itemData.hidden=void 0}))}updatePreview(e){var t=this
t.compositionManager.refreshComposition(e),t.compositionManager.getReadyToRender(function(){var e=t.compositionManager.canvas
t.toolCanvas.getContext("2d").drawImage(e,0,0)})}selectItemB(e){var t=this;(0,r.set)(t,"activeSource",e),t.hideAllItemsButSource()
var o=1*e.itemData.time.in,n=e.itemData.time.out
o<0&&(o=0),n>1*t.compositionData.time.end&&(n=1*t.compositionData.time.end),t.startFrame=o,t.endFrame=n,t.updatePreview(o)}setsceneItemS(e){(0,r.set)(this,"sceneItemS",e),(0,r.set)(this,"currentStep",2)}async chooseFolderAction(){await this.selectFolder()?(0,r.set)(this,"currentStep",3):alert("a folder must be selected")}start(){this.isAborted=!1,gaEvent({event:"tool - depth estimation - start"}),this.startJob()}abort(){console.log("--- abort ---"),this.isAborted=!0}doOneFrame(){var e=this
if(e.isAborted)return console.log("process has been aborted"),void(0,r.set)(e,"isRunning",!1)
var t=e.compositionManager.canvas
e.compositionManager.refreshComposition(e.frameIndex),e.compositionManager.getReadyToRender(async function(){console.log("do one frame",e.frameIndex),e.toolCanvas.getContext("2d").drawImage(t,0,0),requestAnimationFrame(async function(){if(!e.isDestroyed){var t=await RawImage.fromCanvas(e.toolCanvas),o=new Date
if(await e.removeBg.doOneFrame(t),!e.isDestroyed){var i=new Date,a=Math.floor(i-o),l=Math.floor(i-e.start_time)
console.log("frameTime",Math.floor(a/1e3)),console.log("totalTime",Math.floor(l/1e3)),e.frameIndex++,(0,r.set)(e,"nbFramesBaked",e.nbFramesBaked+1)
var s=Math.floor(e.nbFramesBaked/e.nbFramesToBake*100)
s<.1&&(s=.1),e.total_time_estimated=Math.round(l/s*100/1e3),e.total_time_remaining=Math.round(e.total_time_estimated-l/1e3),(0,r.set)(e,"total_time_estimated_m",Math.round(e.total_time_estimated/60)),(0,r.set)(e,"total_time_remaining_m",Math.round(e.total_time_remaining/60)),console.log("%",s," total t est.",e.total_time_estimated),$("#removeBg .progressBar .filler").css({width:s+"%"}),(0,n.next)(function(){e.frameIndex<=1*e.endFrame?e.doOneFrame():e.onCompleted(t)})}}})})}onCompleted(e){var t=this
console.log("remove bg: completed"),gaEvent({event:"tool - remove bg - completed"}),t.controller.getters.getAllCompositionItems(t.compositionData).forEach(function(e){e.hidden=t.visibilityArray["item_"+e.compUid]}),(0,r.set)(t,"isRunning",!1),(0,r.set)(t,"done",!0)
t.removeBg.finalizeVideoFile(function(){var e="win-mixkit-ethereal-fairy-win-sound-2019.mp3",o=100*Math.random()
o>33&&(e="megaman2-victory.mp3"),o>66&&(e="zelda-item-fanfare.mp3")
var r=new Audio("audios/"+e)
r.volume=.6,r.play()
var n="total time: "+t.total_time_estimated_m+" minutes"
t.total_time_estimated_m<2&&(n="total time: "+t.total_time_estimated_m+" minute"),openModal({h2:"Task completed",p:n,OKButton:"save result",callbackYes:async function(){await t.saveVideoFile(),await t.importMaskFile(),t.closeTool()}})})}closeTool(){this.isRunning,(0,r.set)(this.controller,"currentTool",null)}},s(a.prototype,"selectItemB",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"selectItemB"),a.prototype),s(a.prototype,"setsceneItemS",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"setsceneItemS"),a.prototype),s(a.prototype,"chooseFolderAction",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"chooseFolderAction"),a.prototype),s(a.prototype,"start",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"start"),a.prototype),s(a.prototype,"abort",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"abort"),a.prototype),s(a.prototype,"closeTool",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"closeTool"),a.prototype),a);(0,t.setComponentTemplate)(c,u)}),define("pikimov/components/project/tools/motion-tracking",["exports","@ember/component","@glimmer/component","@ember/object","@ember/runloop","pikimov/classes/tools/motion-tracking","@ember/template-factory"],function(e,t,o,r,n,i,a){var l
function s(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function c(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const u=(0,a.createTemplateFactory)({id:"Nqp+8zwy",block:'[[[10,0],[14,1,"UI_MT"],[14,0,"modal"],[12],[1,"\\n\\n"],[41,[28,[37,2],[[30,0,["compositionData","cameraType"]],"2D"],null],[[[1,"    "],[10,0],[14,1,"motionTracking"],[12],[1,"\\n        "],[10,"header"],[12],[1,"\\n            "],[10,"h2"],[12],[1,"Motion tracking"],[13],[1,"\\n            "],[11,1],[24,0,"b_close"],[4,[38,6],["click",[30,0,["closeTool"]]],null],[12],[13],[1,"\\n        "],[13],[1,"\\n\\n        "],[10,0],[14,0,"composition"],[12],[1,"\\n\\n            "],[10,0],[14,0,"overCanvas scrollbar"],[12],[1,"\\n                "],[10,"canvas"],[12],[13],[1,"\\n                "],[10,"svg"],[14,1,"motionPath"],[12],[13],[1,"\\n                "],[10,1],[14,0,"ghost"],[12],[10,1],[14,0,"ghostName"],[12],[1,[30,0,["sceneItemA","name"]]],[13],[13],[1,"\\n            "],[13],[1,"\\n\\n            "],[10,0],[14,0,"topHelp"],[12],[1,"\\n\\n"],[1,"                "],[10,2],[12],[1,"Use this tool to follow the movement of an object in a video"],[13],[1,"\\n\\n                "],[10,3],[14,0,"button"],[14,6,"https://www.youtube.com/watch?v=5MZBb2XHSCs"],[14,"target","_blank"],[12],[1,"watch tutorial"],[13],[1,"\\n\\n            "],[13],[1,"\\n            \\n\\n"],[41,[28,[37,2],[[30,0,["currentStep"]],1],null],[[[1,"                "],[10,0],[14,0,"itemsSelector"],[12],[1,"\\n                    "],[8,[39,11],null,null,[["default"],[[[[1,"Choose the tracking source"]],[]]]]],[1,"\\n                    "],[10,"br"],[12],[13],[1,"\\n\\n"],[41,[51,[30,0,["sceneItemsB","length"]]],[[[1,"                        "],[10,1],[14,0,"warning"],[12],[1,"There is no possible "],[10,"br"],[12],[13],[1,"tracking source"],[13],[1,"\\n"]],[]],null],[1,"\\n                    "],[10,"ul"],[14,0,"scrollbar notranslate"],[12],[1,"\\n"],[42,[28,[37,16],[[28,[37,16],[[30,0,["sceneItemsB"]]],null]],null],null,[[[1,"                        "],[11,"li"],[16,0,[29,["grid ",[52,[28,[37,2],[[30,0,["activeSource"]],[30,1]],null],"active"]]]],[4,[38,6],["click",[28,[37,18],[[30,0,["selectItemB"]],[30,1]],null]],null],[12],[1,"\\n                            "],[10,1],[12],[41,[30,1,["thumbnail"]],[[[10,"img"],[15,"src",[29,[[30,1,["thumbnail","src"]]]]],[14,"alt","."],[14,0,"thumbnail"],[12],[13]],[]],null],[13],[1,"\\n                            "],[10,"label"],[12],[1,[30,1,["name"]]],[13],[1,"\\n                        "],[13],[1,"\\n"]],[1]],null],[1,"                    "],[13],[1,"\\n\\n"],[41,[30,0,["activeSource"]],[[[1,"                        "],[11,1],[24,0,"button"],[4,[38,6],["click",[28,[37,18],[[30,0,["setSceneItemB"]],[30,0,["activeSource"]]],null]],null],[12],[1,"next"],[13],[1,"\\n"]],[]],[[[1,"                        "],[10,1],[14,0,"button"],[14,5,"visibility:hidden"],[12],[1," "],[13],[1,"\\n"]],[]]],[1,"                "],[13],[1," \\n"]],[]],null],[1,"\\n"],[41,[28,[37,2],[[30,0,["currentStep"]],2],null],[[[1,"                "],[10,0],[14,0,"itemsSelector"],[12],[1,"\\n                    "],[8,[39,11],null,null,[["default"],[[[[1,"Choose the tracking target"]],[]]]]],[1,"\\n                    "],[10,"br"],[12],[13],[1,"\\n\\n"],[41,[30,0,["sceneItemsA","length"]],[[[1,"                        "],[10,"ul"],[14,0,"scrollbar notranslate"],[12],[1,"\\n"],[42,[28,[37,16],[[28,[37,16],[[30,0,["sceneItemsA"]]],null]],null],null,[[[1,"                            "],[11,"li"],[16,0,[29,[[52,[28,[37,2],[[30,0,["activeTarget"]],[30,2]],null],"active"]]]],[4,[38,6],["click",[28,[37,18],[[30,0,["selectItemA"]],[30,2]],null]],null],[12],[1,"\\n                                "],[10,"label"],[12],[1,[30,2,["name"]]],[13],[1,"\\n                            "],[13],[1,"\\n"]],[2]],null],[1,"                        "],[13],[1,"\\n"]],[]],[[[1,"                        "],[10,1],[14,0,"warning"],[12],[1,"There is no group on the composition"],[13],[1,"\\n                        "],[10,"br"],[12],[13],[10,"br"],[12],[13],[1,"\\n"]],[]]],[1,"\\n                    "],[11,1],[24,0,"button b_addGroup"],[4,[38,6],["click",[30,0,["addGroup"]]],null],[12],[1,"add a group"],[13],[1,"\\n"],[41,[30,0,["activeTarget"]],[[[1,"                        "],[11,1],[24,0,"button"],[4,[38,6],["click",[28,[37,18],[[30,0,["setSceneItemA"]],[30,0,["activeTarget"]]],null]],null],[12],[1,"next"],[13],[1,"\\n"]],[]],[[[1,"                        "],[10,1],[14,0,"button"],[14,5,"visibility:hidden"],[12],[1," "],[13],[1,"\\n"]],[]]],[1,"                "],[13],[1," \\n"]],[]],null],[1,"\\n"],[41,[28,[37,2],[[30,0,["currentStep"]],3],null],[[[41,[51,[30,0,["done"]]],[[[1,"                "],[10,0],[14,0,"itemsSelector"],[12],[1,"\\n                    "],[10,0],[14,0,"help"],[12],[1,"\\n                        "],[10,"ol"],[12],[1,"\\n                            "],[10,"li"],[12],[1,"Place the group to the desired starting position"],[13],[1,"\\n                            "],[10,"li"],[12],[1,"Set tracking start and end frame"],[13],[1,"\\n                            "],[10,"li"],[12],[1,"Press Start"],[13],[1,"\\n                        "],[13],[1,"\\n                    "],[13],[1,"\\n                "],[13],[1,"\\n"]],[]],null]],[]],null],[1,"\\n        "],[13],[1,"\\n\\n        "],[10,0],[14,0,"settings"],[12],[1,"\\n\\n"],[41,[30,0,["activeSource"]],[[[1,"\\n"],[41,[51,[30,0,["isRunning"]]],[[[41,[51,[30,0,["done"]]],[[[1,"                "],[10,0],[12],[1,"\\n                    "],[8,[39,22],null,[["@controller","@compositionManager","@width","@frameIndex","@start","@end","@stripeMin","@stripeMax","@onFrameChanged","@actionUpdate"],[[30,3],[30,3,["compositionManager"]],720,[30,0,["frameIndex"]],[30,0,["startFrame"]],[30,0,["endFrame"]],[30,0,["activeSource","itemData","time","in"]],[30,0,["activeSource","itemData","time","out"]],[30,0,["onFrameChanged"]],[30,0,["onStartEndUpdated"]]]],null],[1,"\\n                "],[13],[1,"\\n                "],[10,0],[12],[1,"\\n                    "],[10,"br"],[12],[13],[1,"\\n                    "],[8,[39,23],null,[["@label","@obj","@property","@min","@max","@action"],["start tracking on frame",[30,0],"startFrame",0,[30,0,["endFrame"]],null]],null],[1,"\\n\\n                    "],[8,[39,23],null,[["@label","@obj","@property","@min","@max","@action"],["stop tracking on frame",[30,0],"endFrame",[30,0,["startFrame"]],[30,0,["compositionData","time","end"]],null]],null],[1,"\\n                "],[13],[1,"\\n\\n                "],[10,0],[14,0,"buttons"],[12],[1,"\\n\\n"],[41,[28,[37,2],[[30,0,["currentStep"]],3],null],[[[1,"                        "],[11,1],[24,1,"b_start"],[24,0,"button"],[4,[38,6],["click",[30,0,["startTracking"]]],null],[12],[1,"Start"],[13],[1,"\\n"]],[]],null],[1,"\\n                "],[13],[1,"\\n"]],[]],null]],[]],null],[1,"\\n"],[41,[30,0,["isRunning"]],[[[1,"                    "],[10,0],[12],[1,"\\n                        tracking from #"],[1,[30,0,["startFrame"]]],[1," to #"],[1,[30,0,["endFrame"]]],[1,"\\n                        "],[10,"br"],[12],[13],[10,"br"],[12],[13],[1,"\\n                        "],[10,"label"],[14,0,"frameIndex"],[12],[13],[1,"\\n                    "],[13],[1,"\\n                    "],[10,0],[12],[1,"\\n                        \\n                    "],[13],[1,"\\n                    "],[10,0],[14,0,"buttons"],[12],[1,"\\n                        "],[11,1],[24,0,"button"],[4,[38,6],["click",[30,0,["abortTracking"]]],null],[12],[1,"stop"],[13],[1,"\\n                    "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["done"]],[[[1,"\\n                    "],[10,0],[12],[1,"\\n                        "],[8,[39,22],null,[["@controller","@compositionManager","@width","@frameIndex","@start","@end","@stripeMin","@stripeMax","@onFrameChanged","@actionUpdate"],[[30,3],[30,3,["compositionManager"]],720,[30,0,["frameIndex"]],[30,0,["startFrame"]],[30,0,["endFrame"]],[30,0,["activeSource","itemData","time","in"]],[30,0,["activeSource","itemData","time","out"]],[30,0,["onFrameChanged"]],null]],null],[1,"\\n                    "],[13],[1,"\\n\\n                    "],[10,0],[12],[1,"\\n                        "],[10,"br"],[12],[13],[1,"\\n                        "],[10,2],[14,0,"completed"],[12],[1,"\\n                            Tracking completed \\n                            "],[10,"br"],[12],[13],[1,"\\n                            from #"],[1,[30,0,["startFrame"]]],[1," to #"],[1,[30,0,["lastFrameBaked"]]],[1,"\\n                        "],[13],[1,"\\n                    "],[13],[1,"\\n\\n                    "],[10,0],[14,0,"buttons"],[12],[1,"\\n                        "],[11,1],[24,0,"button cancel"],[4,[38,6],["click",[30,0,["reset"]]],null],[12],[1,"Reset"],[13],[1,"\\n                         \\n                        "],[11,1],[24,0,"button"],[4,[38,6],["click",[30,0,["closeTool"]]],null],[12],[1,"Quit"],[13],[1,"\\n                    "],[13],[1,"           \\n\\n"]],[]],null],[1,"\\n            "]],[]],null],[1,"\\n        "],[13],[1,"\\n\\n    "],[13],[1,"\\n"]],[]],[[[1,"    "],[10,0],[14,1,"motionTracking"],[12],[1,"\\n        "],[10,"header"],[12],[1,"\\n            "],[10,"h2"],[12],[1,"Motion tracking"],[13],[1,"\\n            "],[11,1],[24,0,"b_close"],[4,[38,6],["click",[30,0,["closeTool"]]],null],[12],[13],[1,"\\n        "],[13],[1,"\\n        "],[10,0],[12],[1,"\\n            "],[10,2],[14,0,"notOn3D warning"],[12],[1,"This is a 3D composition,"],[10,"br"],[12],[13],[1,"the motion tracking tool can only be used on 2D compositions."],[13],[1,"\\n        "],[13],[1,"\\n    "],[13],[1,"\\n"]],[]]],[1,"\\n"],[13],[1,"\\n"]],["item","item","@controller"],["div","if","eq","header","h2","span","on","canvas","svg","p","a","ui/property-title","br","unless","ul","each","-track-array","li","fn","img","label","ol","ui/mini-timeline","ui/property-number"]]',moduleName:"pikimov/components/project/tools/motion-tracking.hbs",isStrictMode:!1})
let m=e.default=(l=class extends o.default{constructor(){super(...arguments),s(this,"controller",null),s(this,"compositionManager",null),s(this,"compositionData",null),s(this,"toolMotionTracking",null),s(this,"activeSource",null),s(this,"activeTarget",null),s(this,"sceneItemsA",[]),s(this,"sceneItemsB",[]),s(this,"sceneItemA",null),s(this,"sceneItemB",null),s(this,"visibilityArray",[]),s(this,"zoom",100),s(this,"startPosition",{}),s(this,"frameIndex",0),s(this,"startFrame",0),s(this,"endFrame",0),s(this,"lastFrameBaked",0),s(this,"currentStep",1),s(this,"isRunning",!1),s(this,"done",!1),s(this,"trackingCanvas",null),s(this,"allowedTypes",["video","composition","imageSequence"])
var e=this
if(e.controller=e.args.controller,e.compositionManager=e.controller.compositionManager,e.compositionData=e.controller.activeCompositionData,"3D"!=e.compositionManager.cameraType){e.startFrame=1*e.controller.currentFrame,e.endFrame=1*e.compositionData.time.end
var t=e.compositionManager.getDimensions();(t.width>=1920||t.height>=1080)&&(e.zoom=50),e.controller.getters.getAllCompositionItems(e.compositionData).forEach(function(t){e.visibilityArray["item_"+t.compUid]=t.hidden}),e.sceneItemsA=e.controller.getters.getAllCompositionSceneItems(e.compositionManager,"group"),e.sceneItemsB=e.controller.getters.getAllCompositionSceneItems(e.compositionManager,e.allowedTypes),(0,n.next)(function(){e.controller.setCompositionDisplayZoom(e.zoom)
var t=document.querySelector("#compositionCanvas")
e.trackingCanvas=document.querySelector("#motionTracking canvas"),e.trackingCanvas.width=t.width,e.trackingCanvas.height=t.height,e.ghost=document.querySelector("#motionTracking .ghost"),e.toolMotionTracking=new i.default(e.controller,e),$("#motionTracking .overCanvas").hide()})}}onFrameChanged(e){(0,r.set)(this,"frameIndex",e),this.updatePreview(e)}onStartEndUpdated(e,t){(0,r.set)(this,"startFrame",e),(0,r.set)(this,"endFrame",t)}setStartFrame(e){(0,r.set)(this,"startFrame",e)}setEndFrame(e){(0,r.set)(this,"endFrame",e)}updatePreview(e){var t=this
t.compositionManager.refreshComposition(e),t.compositionManager.getReadyToRender(function(){var o=t.compositionManager.canvas
if(t.trackingCanvas.getContext("2d").drawImage(o,0,0),t.done){if(e>t.lastFrameBaked)return void(t.ghost.style.display="none")
t.ghost.style.display="block"
var r=t.sceneItemA.itemData.position.keyframes
r&&r.forEach(function(o){if(o.frame==e){var r=o.values
t.ghost.style.left=r.x/100*t.zoom+"px",t.ghost.style.top=r.y/100*t.zoom+"px"}})}})}hideAllItemsButSource(){this.compositionManager.sceneItems.forEach(function(e){e.itemData.hidden=!0})
var e=this.activeSource
e&&(e.itemData.hidden=void 0,e.getParents().forEach(function(e){e.itemData.hidden=void 0}))}addGroup(){var e=this,t=e.controller,o=e.compositionManager,r=new compositionsUtils(t,e.compositionData),n=r.addItem("group",null)
r=null
var i={itemData:t.getters.getCompItemByCompUid(e.compositionData,n)}
o.compositionBuilder.addToQueue(i),o.compositionBuilder.processQueue(function(){var r=t.getters.getSceneItemByCompUid(o,n)
e.selectItemA(r),e.setSceneItemA(r),e.hideAllItemsButSource(),e.updatePreview(e.startFrame),t.needSaving()})}setupGhostInteract(){var e=this
interact("#motionTracking .ghost").unset()
const t=interact("#motionTracking .ghost")
var o=e.compositionManager.currentFrame,r=e.zoom/100,n=e.sceneItemA.getTransformAt(o)
const i={x:Math.round(n.position.x*r),y:Math.round(n.position.y*r)}
t.draggable({modifiers:[interact.modifiers.restrict({restriction:"parent"})],listeners:{move(t){i.x+=t.dx,i.y+=t.dy,e.updateGhostCSS(i.x,i.y)},start(){},end(){e.startPosition.x=Math.round(i.x),e.startPosition.y=Math.round(i.y)}}})}updateGhostCSS(e,t){var o=this
o.ghost.style.left=e+"px",o.ghost.style.top=t+"px"
var r=(document.querySelector("#motionTracking .composition").clientWidth-o.trackingCanvas.clientWidth)/2
r<0&&(r=0),e+=r,t<90&&(e<370&&$("#motionTracking .topHelp").addClass("right"),e>700&&$("#motionTracking .topHelp").removeClass("right")),t>430&&(e<330&&$("#motionTracking .itemsSelector").addClass("right"),e>750&&$("#motionTracking .itemsSelector").removeClass("right"))}selectItemA(e){(0,r.set)(this,"activeTarget",e)}selectItemB(e){var t=this
$("#motionTracking .overCanvas").show(),(0,r.set)(t,"activeSource",e),t.hideAllItemsButSource()
var o=1*e.itemData.time.in,n=e.itemData.time.out
o<0&&(o=0),n>1*t.compositionData.time.end&&(n=1*t.compositionData.time.end),t.onFrameChanged(o),t.setStartFrame(o),t.setEndFrame(n)}setSceneItemA(e){var t=this;(0,r.set)(t,"sceneItemA",e),(0,r.set)(t,"currentStep",3)
var o=t.zoom/100,n=t.sceneItemA.getTransformAt(t.frameIndex),i=Math.round(n.position.x*o),a=Math.round(n.position.y*o)
t.startPosition.x=i,t.startPosition.y=a,t.updateGhostCSS(i,a),$(t.ghost).show(),t.setupGhostInteract()}setSceneItemB(e){(0,r.set)(this,"sceneItemB",e),(0,r.set)(this,"currentStep",2)}startTracking(){var e=this;(0,r.set)(e,"isRunning",!0),(0,r.set)(e,"lastFrameBaked",0),$(e.ghost).css({"pointer-events":"none"})
var t={startFrame:1*e.startFrame,endFrame:1*e.endFrame}
gaEvent({event:"tool - motion tracking - start"}),console.log("start tool - motion tracking"),(0,n.next)(function(){e.toolMotionTracking.startBaking(t,e.sceneItemA,e.startPosition)})}abortTracking(){var e=this
e.toolMotionTracking.stopBaking(),(0,r.set)(e,"done",!1),$(e.ghost).css({"pointer-events":"auto"}),e.controller.setFrame(e.startFrame)}onTrackingDone(e){var t=this;(0,r.set)(t,"lastFrameBaked",e),(0,r.set)(t,"isRunning",!1),(0,r.set)(t,"done",!0),t.updatePreview(t.startFrame)}reset(){var e=this,t=e.controller,o=e.compositionManager,n=e.sceneItemA.itemData.position.keyframes,i=[]
n.forEach(function(t){t.frame>=e.startFrame&&t.frame<=e.endFrame&&i.push(t)}),t.keyframesUtils.deleteKeys(i),(0,r.set)(e,"activeSource",null),(0,r.set)(e,"activeTarget",null),(0,r.set)(e,"sceneItemA",null),(0,r.set)(e,"sceneItemB",null),(0,r.set)(e,"sceneItemsA",t.getters.getAllCompositionSceneItems(o,"group")),(0,r.set)(e,"sceneItemsB",t.getters.getAllCompositionSceneItems(o,e.allowedTypes)),(0,r.set)(e,"currentStep",1),$(e.ghost).css({"pointer-events":"auto"}),$(e.ghost).hide(),(0,r.set)(e,"done",!1)}closeTool(){var e=this,t=e.controller
if(e.isRunning&&e.toolMotionTracking.stopBaking(),(0,r.set)(t,"currentTool",null),t.getters.getAllCompositionItems(e.compositionData).forEach(function(t){t.hidden=e.visibilityArray["item_"+t.compUid]}),e.sceneItemB&&(e.sceneItemB.itemData.hidden=void 0),e.sceneItemA){e.sceneItemA.itemData.hidden=void 0
var o=e.sceneItemA.getJsonData()
t.selectionUtils.selectItem(o)}t.setFrame(1*e.startFrame),t.rebuildTimelineComponent()}},c(l.prototype,"onFrameChanged",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"onFrameChanged"),l.prototype),c(l.prototype,"onStartEndUpdated",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"onStartEndUpdated"),l.prototype),c(l.prototype,"setStartFrame",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"setStartFrame"),l.prototype),c(l.prototype,"setEndFrame",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"setEndFrame"),l.prototype),c(l.prototype,"addGroup",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"addGroup"),l.prototype),c(l.prototype,"selectItemA",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"selectItemA"),l.prototype),c(l.prototype,"selectItemB",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"selectItemB"),l.prototype),c(l.prototype,"setSceneItemA",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"setSceneItemA"),l.prototype),c(l.prototype,"setSceneItemB",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"setSceneItemB"),l.prototype),c(l.prototype,"startTracking",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"startTracking"),l.prototype),c(l.prototype,"abortTracking",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"abortTracking"),l.prototype),c(l.prototype,"reset",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"reset"),l.prototype),c(l.prototype,"closeTool",[r.action],Object.getOwnPropertyDescriptor(l.prototype,"closeTool"),l.prototype),l);(0,t.setComponentTemplate)(u,m)}),define("pikimov/components/project/tools/remove-bg",["exports","@ember/component","@glimmer/component","@ember/object","@ember/runloop","@ember/template-factory"],function(e,t,o,r,n,i){var a
function l(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function s(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const c=(0,i.createTemplateFactory)({id:"4n2wVu82",block:'[[[10,0],[14,1,"UI_MT"],[14,0,"modal"],[12],[1,"\\n\\n    "],[10,0],[14,1,"removeBg"],[12],[1,"\\n        "],[10,"header"],[12],[1,"\\n            "],[10,"h2"],[12],[1,"Remove background"],[13],[1,"\\n"],[41,[51,[30,0,["isRunning"]]],[[[1,"            "],[11,1],[24,0,"b_close"],[4,[38,5],["click",[30,0,["closeTool"]]],null],[12],[13],[1,"\\n"]],[]],null],[1,"        "],[13],[1,"\\n\\n        "],[10,0],[14,0,"composition"],[12],[1,"\\n\\n            "],[10,0],[14,0,"overCanvas scrollbar"],[12],[1,"\\n                "],[10,"canvas"],[12],[13],[1,"\\n            "],[13],[1,"\\n\\n            "],[10,0],[14,0,"topHelp"],[12],[1,"\\n\\n"],[41,[51,[30,0,["isRunning"]]],[[[1,"\\n                    "],[10,2],[12],[1,"Use this tool to remove the background from a video"],[13],[1,"\\n"]],[]],[[[1,"                    "],[10,"br"],[12],[13],[1,"\\n                    "],[10,2],[12],[1,"Please be patient, the process can be VERY long"],[13],[1,"\\n"]],[]]],[1,"\\n            "],[13],[1,"\\n            \\n\\n"],[41,[28,[37,10],[[30,0,["currentStep"]],1],null],[[[1,"                "],[10,0],[14,0,"itemsSelector"],[12],[1,"\\n                    "],[8,[39,11],null,null,[["default"],[[[[1,"Choose the source"]],[]]]]],[1,"\\n                    "],[10,"br"],[12],[13],[1,"\\n\\n"],[41,[51,[30,0,["sceneItemsB","length"]]],[[[1,"                        "],[10,1],[14,0,"warning"],[12],[1,"There is no possible source"],[13],[1,"\\n"]],[]],null],[1,"\\n                    "],[10,"ul"],[14,0,"scrollbar notranslate"],[12],[1,"\\n"],[42,[28,[37,14],[[28,[37,14],[[30,0,["sceneItemsB"]]],null]],null],null,[[[1,"                        "],[11,"li"],[16,0,[29,["grid ",[52,[28,[37,10],[[30,0,["activeSource"]],[30,1]],null],"active"]]]],[4,[38,5],["click",[28,[37,16],[[30,0,["selectItemB"]],[30,1]],null]],null],[12],[1,"\\n                            "],[10,1],[12],[41,[30,1,["thumbnail"]],[[[10,"img"],[15,"src",[29,[[30,1,["thumbnail","src"]]]]],[14,"alt","."],[14,0,"thumbnail"],[12],[13]],[]],null],[13],[1,"\\n                            "],[10,"label"],[12],[1,[30,1,["name"]]],[13],[1,"\\n                        "],[13],[1,"\\n"]],[1]],null],[1,"                    "],[13],[1,"\\n\\n"],[41,[30,0,["activeSource"]],[[[1,"                        "],[11,1],[24,0,"button"],[4,[38,5],["click",[28,[37,16],[[30,0,["setsceneItemS"]],[30,0,["activeSource"]]],null]],null],[12],[1,"next"],[13],[1,"\\n"]],[]],[[[1,"                        "],[10,1],[14,0,"button"],[14,5,"visibility:hidden"],[12],[1," "],[13],[1,"\\n"]],[]]],[1,"                "],[13],[1," \\n"]],[]],null],[1,"\\n"],[41,[28,[37,10],[[30,0,["currentStep"]],2],null],[[[1,"                "],[10,0],[14,0,"itemsSelector"],[12],[1,"\\n                    "],[8,[39,11],null,null,[["default"],[[[[1,"Choose a folder to save the generated mask"]],[]]]]],[1,"\\n                    "],[10,"br"],[12],[13],[1,"\\n\\n                    "],[8,[39,19],null,null,[["default"],[[[[1,"it is recommended to save the mask in the same folder as other project assets"]],[]]]]],[1,"\\n\\n                    "],[11,1],[24,0,"button"],[4,[38,5],["click",[30,0,["chooseFolderAction"]]],null],[12],[1,"choose folder"],[13],[1,"\\n                "],[13],[1," \\n"]],[]],null],[1,"\\n        "],[13],[1,"\\n\\n        "],[10,0],[14,0,"settings"],[12],[1,"\\n\\n            "],[10,0],[12],[1,"\\n"],[41,[30,0,["isRunning"]],[[[1,"                \\n                "],[10,2],[12],[1,"\\n                    Frame "],[1,[28,[35,20],[[30,0,["nbFramesBaked"]]],null]],[1," / "],[1,[30,0,["nbFramesToBake"]]],[1," \\n                    "],[10,"br"],[12],[13],[10,"br"],[12],[13],[1,"\\n                    "],[10,0],[14,0,"progressBar"],[12],[1,"\\n                        "],[10,0],[14,0,"filler"],[12],[13],[1,"\\n                    "],[13],[1,"\\n                "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["done"]],[[[1,"                    "],[10,"video"],[14,"controls",""],[14,1,"removeBgResult"],[12],[13],[1,"\\n"]],[]],null],[1,"            "],[13],[1,"\\n\\n"],[41,[51,[30,0,["done"]]],[[[1,"            "],[10,0],[12],[1,"\\n\\n"],[41,[51,[30,0,["isRunning"]]],[[[41,[28,[37,10],[[30,0,["currentStep"]],3],null],[[[1,"\\n                    "],[10,0],[14,0,"startEnd"],[12],[1,"\\n                        "],[10,"br"],[12],[13],[1,"\\n                        "],[8,[39,22],null,[["@label","@obj","@property","@min","@max","@action"],["start on frame",[30,0],"startFrame",0,[30,0,["endFrame"]],null]],null],[1,"\\n\\n                        "],[8,[39,22],null,[["@label","@obj","@property","@min","@max","@action"],["stop on frame",[30,0],"endFrame",[30,0,["startFrame"]],[30,0,["compositionData","time","end"]],null]],null],[1,"\\n                    "],[13],[1,"\\n\\n"]],[]],null]],[]],null],[1,"\\n"],[41,[30,0,["isRunning"]],[[[41,[28,[37,23],[[30,0,["nbFramesBaked"]],1],null],[[[1,"                        "],[10,"br"],[12],[13],[1,"\\n                        Total time estimated: "],[1,[30,0,["total_time_estimated_m"]]],[1," "],[41,[28,[37,23],[[30,0,["total_time_estimated_m"]],1],null],[[[1,"minutes"]],[]],[[[1,"minute"]],[]]],[1,"\\n                        "],[10,"br"],[12],[13],[10,"br"],[12],[13],[1,"\\n                        Time remaining: "],[1,[30,0,["total_time_remaining_m"]]],[1," "],[41,[28,[37,23],[[30,0,["total_time_remaining_m"]],1],null],[[[1,"minutes"]],[]],[[[1,"minute"]],[]]],[1,"\\n"]],[]],null]],[]],null],[1,"\\n            "],[13],[1,"\\n\\n            "],[10,0],[14,0,"buttons"],[12],[1,"\\n\\n"],[41,[28,[37,10],[[30,0,["currentStep"]],3],null],[[[1,"\\n"],[41,[51,[30,0,["isRunning"]]],[[[1,"                    "],[11,1],[24,1,"b_start"],[24,0,"button"],[4,[38,5],["click",[30,0,["start"]]],null],[12],[1,"Start"],[13],[1,"\\n                    "],[10,"br"],[12],[13],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["isRunning"]],[[[1,"                        "],[11,1],[24,0,"button red"],[4,[38,5],["click",[30,0,["abort"]]],null],[12],[1,"Abort"],[13],[1,"\\n"]],[]],null]],[]],null],[1,"\\n            "],[13],[1,"\\n"]],[]],null],[1,"\\n        "],[13],[1,"\\n    "],[13],[1,"\\n\\n"],[13]],["item"],["div","header","h2","unless","span","on","canvas","p","br","if","eq","ui/property-title","ul","each","-track-array","li","fn","img","label","ui/property-note","plus-one","video","ui/property-number","mt"]]',moduleName:"pikimov/components/project/tools/remove-bg.hbs",isStrictMode:!1})
let u=e.default=(a=class extends o.default{constructor(){super(...arguments),l(this,"controller",null),l(this,"compositionManager",null),l(this,"compositionData",null),l(this,"removeBg",null),l(this,"visibilityArray",[]),l(this,"zoom",100),l(this,"activeSource",null),l(this,"sceneItemsB",[]),l(this,"sceneItemS",null),l(this,"nbFramesToBake",0),l(this,"nbFramesBaked",0),l(this,"startFrame",0),l(this,"endFrame",10),l(this,"frameIndex",0),l(this,"currentStep",1),l(this,"isRunning",!1),l(this,"isAborted",!1),l(this,"done",!1),l(this,"toolCanvas",null),l(this,"start_time",0),l(this,"total_time_estimated",0),l(this,"total_time_remaining",0),l(this,"total_time_estimated_m",0),l(this,"total_time_remaining_m",0),l(this,"fileName",null),l(this,"directoryHandle",null),l(this,"fileHandle",null),l(this,"allowedTypes",["image","video","imageSequence"])
var e=this
e.controller=e.args.controller,e.compositionManager=e.controller.compositionManager,e.compositionData=e.controller.activeCompositionData,e.controller.getters.getAllCompositionItems(e.compositionData).forEach(function(t){e.visibilityArray["item_"+t.compUid]=t.hidden})
var t=e.compositionManager.getDimensions()
t.width*t.height>2073600&&(e.zoom=50),e.sceneItemsB=e.controller.getters.getAllCompositionSceneItems(e.compositionManager,e.allowedTypes),(0,n.next)(function(){e.controller.setCompositionDisplayZoom(e.zoom)
var t=e.compositionManager.canvas
e.toolCanvas=document.querySelector("#removeBg canvas"),e.toolCanvas.width=t.width,e.toolCanvas.height=t.height}),e.loadTRModule()}async loadTRModule(){await async function(e){return new Promise((t,o)=>{const r=document.createElement("script")
r.src=e,r.type="module",r.onload=()=>t(),r.onerror=()=>o(new Error(`Failed to load script: ${e}`)),document.head.appendChild(r)})}("js/tr/remove-bg.js")}async selectFolder(){var e=this
try{e.directoryHandle=await window.showDirectoryPicker()
var t=new Date,o=(t.getHours()+100).toString().substring(1)+(t.getMinutes()+100).toString().substring(1)+(t.getSeconds()+100).toString().substring(1)
e.fileName="remove-bg-mask-"+e.sceneItemS.name+"_"+o+".mp4"}catch(r){return console.log(r.name),console.error("remove bg - Catch error selecting directory:",r),!1}return!0}async saveVideoFile(){var e=this
try{e.fileHandle=await e.directoryHandle.getFileHandle(e.fileName,{create:!0})}catch(r){if(console.log(r.name),console.error("Catch error getFileHandle:",r),r&&"NotAllowedError"==r.name)return openModal({h2:"Denied",p:"Saving file has been denied",callbackYes:function(){e.saveFileModal()}}),!1}var t=$("#removeBgResult")[0],o=await async function(e){const t=await fetch(e.src)
return await t.blob()}(t)
return await async function(t){try{const o=await e.fileHandle.createWritable()
await o.write(t),await o.close(),console.log("Video mask saved successfully")}catch(r){console.error("Error saving video:",r)}}(o),console.log("remove BG video mask saved"),!0}async startJob(){var e=this
e.startFrame*=1,e.endFrame*=1,e.frameIndex=e.startFrame,(0,r.set)(e,"nbFramesToBake",e.endFrame-e.startFrame+1),(0,r.set)(e,"isRunning",!0),(0,r.set)(e,"done",!1),e.removeBg=new c_removeBg(e.controller,e.toolCanvas.width,e.toolCanvas.height),e.removeBg.getReady(async function(){e.start_time=new Date,e.doOneFrame()})}async importMaskFile(){var e=this
var t=[await e.fileHandle.getFile()]
e.controller.libraryManager.importFiles(t)
var o=setInterval(function(){e.controller.isCompositionReady&&(clearInterval(o),o=null,e.setupMaskItem())},200)}setupMaskItem(){var e=this
console.log("remove bg setup mask item")
var t=e.compositionManager.sceneItems[0].itemData;(0,r.set)(t.time,"in",e.startFrame),(0,r.set)(t.time,"out",e.endFrame),t.mask={enabled:1,type:"luma"}
var o=100/e.zoom*100
t.scale.values={x:o,y:o,z:100}
var n=e.sceneItemS.parentCompUid,i=e.sceneItemS.localIndex
n||i--
var a=new compositionsUtils(e.controller,e.compositionData,null)
a.setNewOrder(n,i)||console.log("error mask reordering"),a=null}hideAllItemsButSource(){this.compositionManager.sceneItems.forEach(function(e){e.itemData.hidden=!0})
var e=this.activeSource
e&&(e.itemData.hidden=void 0,e.getParents().forEach(function(e){e.itemData.hidden=void 0}))}updatePreview(e){var t=this
t.compositionManager.refreshComposition(e),t.compositionManager.getReadyToRender(function(){var e=t.compositionManager.canvas
t.toolCanvas.getContext("2d").drawImage(e,0,0)})}selectItemB(e){var t=this;(0,r.set)(t,"activeSource",e),t.hideAllItemsButSource()
var o=1*e.itemData.time.in,n=e.itemData.time.out
o<0&&(o=0),n>1*t.compositionData.time.end&&(n=1*t.compositionData.time.end),t.startFrame=o,t.endFrame=n,t.updatePreview(o)}setsceneItemS(e){(0,r.set)(this,"sceneItemS",e),(0,r.set)(this,"currentStep",2)}async chooseFolderAction(){await this.selectFolder()?(0,r.set)(this,"currentStep",3):alert("a folder must be selected")}start(){this.isAborted=!1,gaEvent({event:"tool - remove bg - start"}),this.startJob()}abort(){console.log("--- abort ---"),this.isAborted=!0}doOneFrame(){var e=this
if(e.isAborted)return console.log("process has been aborted"),void(0,r.set)(e,"isRunning",!1)
var t=e.compositionManager.canvas
e.compositionManager.refreshComposition(e.frameIndex),e.compositionManager.getReadyToRender(async function(){console.log("do one frame",e.frameIndex),e.toolCanvas.getContext("2d").drawImage(t,0,0),requestAnimationFrame(async function(){if(!e.isDestroyed){var t=await RawImage.fromCanvas(e.toolCanvas),o=new Date
if(await e.removeBg.doOneFrame(t),!e.isDestroyed){var i=new Date,a=Math.floor(i-o),l=Math.floor(i-e.start_time)
console.log("frameTime",Math.floor(a/1e3)),console.log("totalTime",Math.floor(l/1e3)),e.frameIndex++,(0,r.set)(e,"nbFramesBaked",e.nbFramesBaked+1)
var s=Math.floor(e.nbFramesBaked/e.nbFramesToBake*100)
s<.1&&(s=.1),e.total_time_estimated=Math.round(l/s*100/1e3),e.total_time_remaining=Math.round(e.total_time_estimated-l/1e3),(0,r.set)(e,"total_time_estimated_m",Math.round(e.total_time_estimated/60)),(0,r.set)(e,"total_time_remaining_m",Math.round(e.total_time_remaining/60)),console.log("%",s," total t est.",e.total_time_estimated),$("#removeBg .progressBar .filler").css({width:s+"%"}),(0,n.next)(function(){e.frameIndex<=1*e.endFrame?e.doOneFrame():e.onCompleted(t)})}}})})}onCompleted(e){var t=this
console.log("remove bg: completed"),gaEvent({event:"tool - remove bg - completed"}),t.controller.getters.getAllCompositionItems(t.compositionData).forEach(function(e){e.hidden=t.visibilityArray["item_"+e.compUid]}),(0,r.set)(t,"isRunning",!1),(0,r.set)(t,"done",!0)
t.removeBg.finalizeVideoFile(function(){var e="win-mixkit-ethereal-fairy-win-sound-2019.mp3",o=100*Math.random()
o>33&&(e="megaman2-victory.mp3"),o>66&&(e="zelda-item-fanfare.mp3")
var r=new Audio("audios/"+e)
r.volume=.6,r.play(),t.saveFileModal()})}saveFileModal(){var e=this,t="total time: "+e.total_time_estimated_m+" minutes"
e.total_time_estimated_m<2&&(t="total time: "+e.total_time_estimated_m+" minute"),openModal({h2:"Task completed",p:t,yesButton:"save result",noButton:"cancel",callbackYes:async function(){await e.saveVideoFile()&&(await e.importMaskFile(),e.closeTool())},callbackNo:function(){e.closeTool()}})}closeTool(){this.isRunning,(0,r.set)(this.controller,"currentTool",null)}},s(a.prototype,"selectItemB",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"selectItemB"),a.prototype),s(a.prototype,"setsceneItemS",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"setsceneItemS"),a.prototype),s(a.prototype,"chooseFolderAction",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"chooseFolderAction"),a.prototype),s(a.prototype,"start",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"start"),a.prototype),s(a.prototype,"abort",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"abort"),a.prototype),s(a.prototype,"closeTool",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"closeTool"),a.prototype),a);(0,t.setComponentTemplate)(c,u)}),define("pikimov/components/project/tools/transcribe",["exports","@ember/component","@glimmer/component","@ember/object","pikimov/classes/tools/transcribe","@ember/template-factory"],function(e,t,o,r,n,i){var a
function l(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function s(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const c=(0,i.createTemplateFactory)({id:"36Mk1HD6",block:'[[[10,0],[14,1,"UI_transcribe"],[14,0,"modal"],[12],[1,"\\n\\n    "],[10,0],[12],[1,"\\n        "],[10,"header"],[12],[1,"\\n            "],[10,"h2"],[12],[1,"Subtitles generator"],[13],[1,"\\n"],[41,[51,[30,0,["isRunning"]]],[[[1,"            "],[11,1],[24,0,"b_close"],[4,[38,5],["click",[30,0,["closeTool"]]],null],[12],[13],[1,"\\n"]],[]],null],[1,"        "],[13],[1,"\\n\\n        "],[10,0],[14,0,"settings"],[12],[1,"\\n\\n"],[41,[51,[30,0,["isRunning"]]],[[[41,[51,[30,0,["done"]]],[[[1,"                "],[10,0],[14,0,"help"],[12],[1,"\\n                    "],[10,2],[12],[1,"Use this tool to generate video subtitles."],[13],[1,"\\n                    "],[10,"ol"],[12],[1,"\\n                        "],[10,"li"],[12],[1,"Choose the item to use as an audio source"],[13],[1,"\\n"],[1,"                        "],[10,"li"],[12],[1,"Click Start"],[13],[1,"\\n                    "],[13],[1,"\\n\\n                    "],[10,"br"],[12],[13],[10,"br"],[12],[13],[1,"\\n                    "],[10,1],[14,0,"warning"],[12],[1,"Only works with english language"],[13],[1,"\\n                "],[13],[1,"\\n\\n"],[41,[30,0,["isReady"]],[[[1,"                "],[10,0],[14,0,"items"],[12],[1,"\\n\\n                    "],[10,0],[12],[1,"\\n                        "],[8,[39,11],null,null,[["default"],[[[[1,"Select audio source"]],[]]]]],[1,"\\n"],[41,[51,[30,0,["sceneItemsB","length"]]],[[[1,"                        "],[10,1],[14,0,"warning"],[12],[1,"no audio source in composition"],[13],[1,"\\n"]],[]],null],[1,"                        "],[10,"ul"],[14,0,"scrollbar notranslate"],[12],[1,"\\n"],[42,[28,[37,14],[[28,[37,14],[[30,0,["sceneItemsB"]]],null]],null],null,[[[1,"                                "],[11,"li"],[16,0,[29,[[52,[28,[37,15],[[30,0,["activeSource"]],[30,1]],null],"active"]]]],[4,[38,5],["click",[28,[37,16],[[30,0,["selectItemB"]],[30,1]],null]],null],[12],[1,"\\n                                    "],[10,"i"],[14,0,"bx bx-music"],[12],[13],[1,"\\n                                    "],[10,"label"],[12],[1,[30,1,["name"]]],[13],[1,"\\n                                "],[13],[1,"\\n"]],[1]],null],[1,"                        "],[13],[1,"\\n\\n"],[41,[30,0,["activeSource"]],[[[1,"                            "],[10,"br"],[12],[13],[1,"\\n                            "],[11,1],[24,0,"button"],[4,[38,5],["click",[28,[37,16],[[30,0,["setSceneItemB"]],[30,0,["activeSource"]]],null]],null],[12],[1,"start"],[13],[1,"\\n"]],[]],[[[1,"                            "],[10,1],[14,0,"button"],[14,5,"visibility:hidden"],[12],[1," "],[13],[1,"\\n"]],[]]],[1,"\\n                    "],[13],[1,"\\n\\n                "],[13],[1,"\\n"]],[]],[[[1,"                    "],[10,0],[12],[1,"\\n                        Loading tool... \\n                        "],[10,"br"],[12],[13],[10,"br"],[12],[13],[1,"\\n                        "],[10,"img"],[14,"src","images/loading.gif"],[14,0,"loading"],[14,"alt",""],[12],[13],[1,"\\n                    "],[13],[1,"\\n"]],[]]],[1,"\\n"]],[]],null]],[]],null],[1,"\\n"],[41,[30,0,["isRunning"]],[[[1,"                "],[10,0],[12],[1,"\\n                    Processing, please wait, this can take a while... \\n                    "],[10,"br"],[12],[13],[10,"br"],[12],[13],[1,"\\n                    "],[10,"img"],[14,"src","images/loading.gif"],[14,0,"loading"],[14,"alt",""],[12],[13],[1,"\\n                "],[13],[1,"\\n"]],[]],null],[1,"\\n        "],[13],[1,"\\n\\n    "],[13],[1,"\\n\\n"],[13],[1,"\\n"]],["item"],["div","header","h2","unless","span","on","p","ol","li","br","if","ui/property-title","ul","each","-track-array","eq","fn","i","label","img"]]',moduleName:"pikimov/components/project/tools/transcribe.hbs",isStrictMode:!1})
let u=e.default=(a=class extends o.default{constructor(){super(...arguments),l(this,"controller",null),l(this,"compositionManager",null),l(this,"tool_transcribe",null),l(this,"activeSource",null),l(this,"sceneItemsB",[]),l(this,"sceneItemA",null),l(this,"sceneItemB",null),l(this,"startFrame",0),l(this,"endFrame",0),l(this,"isLoaded",!1),l(this,"isRunning",!1),l(this,"done",!1)
var e=this
e.controller=e.args.controller,e.compositionManager=e.controller.compositionManager,e.sceneItemsB=e.controller.getters.getAllCompositionSceneItems(e.compositionManager,["audio"]),e.tool_transcribe=new n.default(e.controller,e)}selectItemB(e){(0,r.set)(this,"activeSource",e)}setSceneItemB(e){(0,r.set)(this,"sceneItemB",e),this.addText()}addText(){var e=this,t=e.controller,o=e.compositionManager,n=new compositionsUtils(t,o.compositionData),i=n.addItem("text",null)
n=null
var a=null
e.sceneItemB&&(a=e.sceneItemB.compUid),startLoading()
o.buildComposition(async function(){stopLoading()
var n=t.getters.getSceneItemByCompUid(o,i),l=o.getDimensions(),s=Math.floor(l.width/30)
s<20&&(s=20),n.itemData.params[1].value=s
var c=10*Math.floor(80*l.width/100/10)
if(c<100&&(c=100),n.itemData.box={enabled:1,width:c},n.itemData.position.values.y=Math.round(4*l.height/5),_effects.forEach(function(e){if("shadow"==e.type){var t=structuredClone(e.params)
t[1].value=Math.floor(s/10)
var o={type:e.type,name:e.name,enabled:!0,open:!0,params:t}
n.addEffect(o)}}),e.sceneItemA=n,a){var u=t.getters.getSceneItemByCompUid(o,a)
e.selectItemB(u),(0,r.set)(e,"sceneItemB",u)}o.refreshComposition(t.currentFrame),o.getReadyToRender(null),(0,r.set)(e,"sceneItemsB",t.getters.getAllCompositionSceneItems(o,["audio"])),await e.start(),t.needSaving()})}async start(){var e=this
gaEvent({event:"tool - subtitles - start"}),(0,r.set)(e,"isRunning",!0)
var t=await e.tool_transcribe.start(e.sceneItemB)
requestAnimationFrame(function(){if(!e.isDestroyed){var o=e.sceneItemA.itemData,n=o.params[0];(0,r.set)(n,"useKeyframes",!0),(0,r.set)(n,"keyframes",structuredClone(t)),n.keyframes.forEach(function(t){t.uid=e.controller.keyframesUtils.generateKeyUid()})
var i=e.sceneItemB.itemData.time;(0,r.set)(o.time,"in",1*i.in),(0,r.set)(o.time,"out",1*i.out),(0,r.set)(e,"isRunning",!1),t.length?openModal({h2:"Transcription completed",p:"Carefully check spelling!",callbackYes:function(){e.closeTool()}}):openModal({h2:"No text detected",p:"No text has been generated",callbackYes:function(){e.closeTool()}}),e.controller.refreshAndRender()}})}closeTool(){var e=this
e.isRunning,(0,r.set)(e.controller,"currentTool",null),e.compositionManager.buildCompositionThenSelect()}},s(a.prototype,"selectItemB",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"selectItemB"),a.prototype),s(a.prototype,"setSceneItemB",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"setSceneItemB"),a.prototype),s(a.prototype,"addText",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"addText"),a.prototype),s(a.prototype,"start",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"start"),a.prototype),s(a.prototype,"closeTool",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"closeTool"),a.prototype),a);(0,t.setComponentTemplate)(c,u)}),define("pikimov/components/project/tutorials/tutorials",["exports","@ember/component","@glimmer/component","@ember/template-factory"],function(e,t,o,r){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const n=(0,r.createTemplateFactory)({id:"g10K7M73",block:'[[[10,0],[14,1,"tutorials"],[14,0,"modal"],[12],[1,"\\n\\n    "],[10,0],[12],[1,"\\n\\n        "],[10,"header"],[12],[1,"\\n            "],[10,"h2"],[12],[1,"Tutorials"],[13],[1,"\\n            "],[11,1],[24,0,"b_close"],[4,[38,4],["click",[30,1,["toogleTutorials"]]],null],[12],[13],[1,"\\n        "],[13],[1,"\\n\\n        "],[10,0],[12],[1,"\\n"],[1,"            "],[10,3],[14,0,"oneTutorial"],[14,"target","_blank"],[14,6,"https://www.youtube.com/watch?v=h1kk2gA_xhw"],[12],[1,"   \\n                "],[10,"img"],[14,"src","images/tutorials/thumb-tutorial-01.png"],[14,"alt","tutorial"],[12],[13],[1,"\\n            "],[13],[1,"   \\n\\n            "],[10,3],[14,0,"oneTutorial"],[14,"target","_blank"],[14,6,"https://www.youtube.com/watch?v=IfkEayDIKUU"],[12],[1,"         \\n                "],[10,"img"],[14,"src","images/tutorials/thumb-tutorial-02.png"],[14,"alt","tutorial"],[12],[13],[1,"\\n            "],[13],[1,"    \\n\\n            "],[10,3],[14,0,"oneTutorial"],[14,"target","_blank"],[14,6,"https://www.youtube.com/watch?v=Nfs7A1unqz0"],[12],[1,"         \\n                "],[10,"img"],[14,"src","images/tutorials/thumb-tutorial-03.png"],[14,"alt","tutorial"],[12],[13],[1,"\\n            "],[13],[1," \\n\\n            "],[10,3],[14,0,"oneTutorial"],[14,"target","_blank"],[14,6,"https://www.youtube.com/watch?v=Db7NDiFrnzk"],[12],[1,"         \\n                "],[10,"img"],[14,"src","images/tutorials/thumb-tutorial-04.png"],[14,"alt","tutorial"],[12],[13],[1,"\\n            "],[13],[1,"\\n\\n            "],[10,3],[14,0,"oneTutorial"],[14,"target","_blank"],[14,6,"https://www.youtube.com/watch?v=2J2xXWqfv8M"],[12],[1,"         \\n                "],[10,"img"],[14,"src","images/tutorials/thumb-tutorial-05.png"],[14,"alt","tutorial"],[12],[13],[1,"\\n            "],[13],[1,"    \\n\\n            "],[10,3],[14,0,"oneTutorial"],[14,"target","_blank"],[14,6,"https://www.youtube.com/watch?v=c6k0TwJTIh0"],[12],[1,"         \\n                "],[10,"img"],[14,"src","images/tutorials/thumb-tutorial-06.png"],[14,"alt","tutorial"],[12],[13],[1,"\\n            "],[13],[1,"  \\n\\n            "],[10,3],[14,0,"oneTutorial"],[14,"target","_blank"],[14,6,"https://www.youtube.com/watch?v=5MZBb2XHSCs"],[12],[1,"         \\n                "],[10,"img"],[14,"src","images/tutorials/thumb-tutorial-07.png"],[14,"alt","tutorial"],[12],[13],[1,"\\n            "],[13],[1,"  \\n\\n        "],[13],[1,"\\n\\n        "],[10,0],[14,0,"german"],[12],[1,"\\n            "],[10,"h2"],[12],[1,"More tutorials"],[13],[1,"\\n\\n            "],[10,3],[14,0,"button pikimovGerman"],[14,6,"https://www.youtube.com/@PikimovGerman"],[14,"target","_blank"],[12],[10,"img"],[14,"src","images/flag-de.svg"],[14,"alt","de"],[12],[13],[1,"German language tutorials"],[13],[1,"\\n        "],[13],[1,"\\n    "],[13],[1,"\\n"],[13],[1,"\\n"]],["@parent"],["div","header","h2","span","on","a","img"]]',moduleName:"pikimov/components/project/tutorials/tutorials.hbs",isStrictMode:!1})
class i extends o.default{constructor(){super(...arguments)}}e.default=i,(0,t.setComponentTemplate)(n,i)}),define("pikimov/components/ui/file-input",["exports","@ember/component","@glimmer/component","@ember/template-factory"],function(e,t,o,r){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const n=(0,r.createTemplateFactory)({id:"OXEnKhWj",block:'[[[10,0],[14,0,"fileInput"],[12],[1,"\\n    "],[10,1],[14,0,"button"],[12],[1,[30,1]],[13],[1,"\\n"],[41,[30,2],[[[1,"    "],[11,"input"],[16,"accept",[29,[[30,3]]]],[24,"multiple",""],[24,4,"file"],[4,[38,4],["change",[30,4]],null],[12],[13],[1,"\\n"]],[]],[[[1,"    "],[11,"input"],[16,"accept",[29,[[30,3]]]],[24,4,"file"],[4,[38,4],["change",[30,4]],null],[12],[13],[1,"\\n"]],[]]],[13],[1,"\\n"]],["@label","@multiple","@accept","@action"],["div","span","if","input","on"]]',moduleName:"pikimov/components/ui/file-input.hbs",isStrictMode:!1})
class i extends o.default{constructor(){super(...arguments)}}e.default=i,(0,t.setComponentTemplate)(n,i)})
define("pikimov/components/ui/mini-timeline",["exports","@ember/component","@glimmer/component","@ember/object","@ember/template","@ember/runloop","@ember/template-factory"],function(e,t,o,r,n,i,a){var l,s,c
function u(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function m(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const p=(0,a.createTemplateFactory)({id:"xy6q2CfV",block:'[[[1,[30,0,["argsStartEndChanged"]]],[1,"\\n"],[10,0],[14,1,"miniTimeline"],[12],[1,"\\n\\n    "],[10,0],[12],[1,"\\n        "],[10,"label"],[14,0,"tl_frameIndex"],[12],[1,[30,1]],[1," / "],[1,[30,0,["compositionData","time","end"]]],[13],[1,"\\n"],[1,"    "],[13],[1,"\\n    "],[10,0],[14,0,"miniTimelineUI"],[12],[1,"\\n        "],[10,0],[14,0,"timeBar notranslate"],[12],[1,"\\n            "],[10,0],[14,0,"times"],[12],[13],[1,"\\n            "],[10,0],[14,0,"timeCursor"],[15,5,[30,0,["cssTimeCursor"]]],[12],[10,1],[14,0,"bar"],[12],[13],[13],[1,"\\n        "],[13],[1,"\\n        "],[10,0],[14,0,"timeline"],[12],[1,"\\n            "],[10,0],[14,0,"startEnd"],[15,5,[30,0,["cssStartEnd"]]],[12],[13],[1,"\\n        "],[13],[1,"\\n    "],[13],[1,"\\n\\n"],[13]],["@frameIndex"],["div","label","span"]]',moduleName:"pikimov/components/ui/mini-timeline.hbs",isStrictMode:!1})
let d=e.default=(l=(0,r.computed)("args.frameIndex"),s=(0,r.computed)("args.start","args.end"),c=class extends o.default{constructor(){super(...arguments),u(this,"compositionData",null),u(this,"componentWidth",520),u(this,"width",500),u(this,"zoom",1),u(this,"start",0),u(this,"end",0)
var e=this
e.compositionData=e.args.compositionManager.compositionData,e.componentWidth=1*e.args.width,e.width=e.componentWidth-20,e.zoom=e.width/(1*e.compositionData.time.end+1),e.start=1*e.args.start,e.end=1*e.args.end,(0,i.next)(function(){$("#miniTimeline").css({width:e.width+"px"}),e.addClickEvents(),e.drawBars(),e.addTimes(),e.addResizeEvent()})}addResizeEvent(){var e=this,t=document.querySelector("#miniTimeline .startEnd"),o={}
const r=interact("#miniTimeline .startEnd")
r.styleCursor(!1),r.resizable({edges:{left:!0,right:!0},margin:10,listeners:{move(r){var n=t,i=e.zoom,a={in:0,out:0},l=parseFloat(n.getAttribute("data-x"))||0
r.edges.left&&(l+=r.deltaRect.left,a.in=Math.round(l/i)),r.edges.right&&(l+=r.deltaRect.width,a.out=Math.round(l/i)),n.setAttribute("data-x",l),e.updateStartEnd(o,a)},start(){o={start:1*e.args.start,end:1*e.args.end},t.setAttribute("data-x",0)},end(){}},modifiers:[interact.modifiers.restrictEdges({outer:"parent"}),interact.modifiers.restrictSize({min:{width:10}})]})}updateStartEnd(e,t){var o=this.args,r=e.start+t.in,n=e.end+t.out
r<1*o.stripeMin&&(r=1*o.stripeMin),n>1*o.stripeMax&&(n=1*o.stripeMax),r==o.start&&n==o.end||o.actionUpdate&&o.actionUpdate(r,n)}calculateStep(e){var t=1
return e<50&&(t=2),e<20&&(t=5),e<10&&(t=10),e<5&&(t=20),e<2&&(t=60),e<1&&(t=120),t}drawBars(){var e=this,t=document.querySelector("#miniTimeline .timeBar"),o=e.zoom*e.compositionData.frameRate,r=o*e.calculateStep(o),n="repeating-linear-gradient(to right,"
n+="transparent 0, transparent "+(r-1)+"px, #aaaaaa "+(r-1)+"px, #aaaaaa "+r+"px",n+=")",t.style.backgroundImage=n}addTimes(){var e=this,t=$("#miniTimeline .timeBar .times")[0]
t.innerHTML=""
var o,r=e.compositionData.time.end,n=e.compositionData.frameRate,i=Math.floor(r/n)+1,a=e.zoom*n,l=e.calculateStep(a)
for(o=0;o<=i;o+=l)if(0!=o){var s=document.createElement("span"),c=formatSeconds(o)
s.innerText=c,s.style.left=Math.round(o*a)+"px",t.appendChild(s)}}get cssTimeCursor(){var e=Math.round(this.args.frameIndex*this.zoom)
return(0,n.htmlSafe)(`left:${e}px;`)}get cssStartEnd(){var e=this
e.start=1*e.args.start,e.end=1*e.args.end
var t=Math.round(e.start*e.zoom),o=Math.round((e.end-e.start)*e.zoom)
return(0,n.htmlSafe)(`left:${t}px;width:${o}px;`)}addClickEvents(){var e=this
$("#miniTimeline .timeBar").on("mousedown",function(t){var o=$(this).offset().left,r=t.pageX-o,n=Math.round(r/e.zoom)
e.setFrame(n)})
const t=interact("#miniTimeline .timeBar")
t.styleCursor(!1)
var o=0
const r={x:0}
t.draggable({lockAxis:"x",modifiers:[interact.modifiers.restrict({})],listeners:{move(t){r.x+=t.dx
var n=Math.round(r.x/e.zoom)
e.setFrame(o+n)},start(){r.x=0,o=e.args.frameIndex},end(){}}})}setFrame(e){var t=this
e<0&&(e=0),e>1*t.compositionData.time.end&&(e=1*t.compositionData.time.end),e!==t.args.frameIndex&&t.args.onFrameChanged(e)}},m(c.prototype,"cssTimeCursor",[l],Object.getOwnPropertyDescriptor(c.prototype,"cssTimeCursor"),c.prototype),m(c.prototype,"cssStartEnd",[s],Object.getOwnPropertyDescriptor(c.prototype,"cssStartEnd"),c.prototype),c);(0,t.setComponentTemplate)(p,d)}),define("pikimov/components/ui/multi-select",["exports","@ember/component","@ember/runloop","@glimmer/component","@ember/template-factory"],function(e,t,o,r,n){function i(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const a=(0,n.createTemplateFactory)({id:"svsxuyiR",block:'[[[41,[30,0,["options"]],[[[11,"select"],[16,1,[29,[[30,0,["domID"]]]]],[24,"multiple",""],[24,0,"multiple"],[4,[38,2],["change",[28,[37,3],[[30,1],[30,2]],null]],null],[12],[1,"\\n"],[42,[28,[37,5],[[28,[37,5],[[30,0,["options"]]],null]],null],null,[[[1,"        "],[10,"option"],[15,2,[30,3,["value"]]],[15,"selected",[30,3,["selected"]]],[15,"disabled",[30,3,["disabled"]]],[12],[1,[30,3,["name"]]],[13],[1,"\\n"]],[3]],null],[13],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["groups"]],[[[11,"select"],[16,1,[29,[[30,0,["domID"]]]]],[24,"multiple",""],[24,0,"multiple"],[4,[38,2],["change",[28,[37,3],[[30,1],[30,2]],null]],null],[12],[1,"\\n"],[42,[28,[37,5],[[28,[37,5],[[30,0,["groups"]]],null]],null],null,[[[1,"        "],[10,"optgroup"],[15,"label",[29,[[30,4,["name"]]]]],[12],[1,"\\n"],[42,[28,[37,5],[[28,[37,5],[[30,4,["items"]]],null]],null],null,[[[1,"            "],[10,"option"],[15,2,[30,5,["value"]]],[15,"selected",[30,5,["selected"]]],[15,"disabled",[30,5,["disabled"]]],[12],[1,"\\n                "],[1,[30,5,["name"]]],[1,"\\n            "],[13],[1,"\\n"]],[5]],null],[1,"        "],[13],[1,"\\n"]],[4]],null],[13],[1,"\\n"]],[]],null]],["@action","@actionParam","item","oneGroup","item"],["if","select","on","fn","each","-track-array","option","optgroup"]]',moduleName:"pikimov/components/ui/multi-select.hbs",isStrictMode:!1})
class l extends r.default{constructor(){super(...arguments),i(this,"placeholder","Select elements"),i(this,"domID",null),i(this,"options",[]),i(this,"groups",[])
var e=this
e.domID="multiSelect"+Math.floor(8999*Math.random())+1e3
var t=e.args
t.options&&t.groups&&console.log("error multiselect: cannot use both options + groups"),t.placeholder&&(e.placeholder=t.placeholder),t.options&&t.options.forEach(function(o,r){var n=o[t.valueProperty],i=o[t.nameProperty],a=!1,l=!1
o.disabled&&(l=!0),t.selected&&t.selected.forEach(function(e){e==n&&(a=!0)}),e.options.push({index:r,value:n,name:i,selected:a,disabled:l})}),t.groups&&t.groups.forEach(function(o,r){var n=o.name,i=[]
o.items&&o.items.forEach(function(e,o){var r=e[t.valueProperty],n=e[t.nameProperty],a=!1,l=!1
e.disabled&&(l=!0),t.selected&&t.selected.forEach(function(e){e==r&&(a=!0)}),i.push({index:o,value:r,name:n,selected:a,disabled:l})}),e.groups.push({name:n,items:i})}),(0,o.next)(function(){const o=$("#"+e.domID).SumoSelect({placeholder:e.placeholder,search:!0,searchText:"Enter here",captionFormatAllSelected:"all selected ({0})",up:t.up,csvDispCount:0})
t.width&&$(o.parentElement).css({width:1*t.width+"px"})})}}e.default=l,(0,t.setComponentTemplate)(a,l)}),define("pikimov/components/ui/property-checkbox",["exports","@ember/component","@glimmer/component","@ember/object","@ember/template-factory"],function(e,t,o,r,n){var i,a
function l(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function s(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const c=(0,n.createTemplateFactory)({id:"DdV079EN",block:'[[[10,0],[15,0,[29,["property checkbox ",[52,[30,1],"sub"]]]],[12],[1,"\\n    "],[10,"label"],[12],[1,[30,2]],[1,"\\n        "],[41,[30,3],[[[10,"i"],[14,0,"fa fa-question-circle tooltip"],[12],[10,1],[14,0,"tooltiptext p50"],[12],[1,[30,3]],[13],[13]],[]],null],[1," "],[18,6,null],[1,"\\n    "],[13],[1,"\\n    "],[10,0],[14,0,"checkbox noLabels"],[12],[1,"\\n        "],[11,"input"],[16,1,[29,[[30,0,["domID"]]]]],[16,"checked",[30,0,["computed_checkTest"]]],[24,4,"checkbox"],[4,[38,7],["change",[28,[37,8],[[30,0,["componentAction"]],[30,4],[30,5]],null]],null],[12],[13],[1,"\\n        "],[10,"label"],[15,"for",[29,[[30,0,["domID"]]]]],[12],[1," "],[13],[1,"\\n    "],[13],[1,"\\n"],[13],[1,"\\n"]],["@subProperty","@label","@toolTip","@obj","@objProperty","&default"],["div","if","label","i","span","yield","input","on","fn"]]',moduleName:"pikimov/components/ui/property-checkbox.hbs",isStrictMode:!1})
let u=e.default=(i=(0,r.computed)("args.valueToTrackBoolean"),a=class extends o.default{constructor(){super(...arguments),l(this,"domID",null),l(this,"trueOrFalse",!0),this.domID="cbx"+Math.floor(8999*Math.random())+1e3,this.args.notTrue&&(this.trueOrFalse=!1)}get computed_checkTest(){var e=this.args.valueToTrackBoolean
if(this.trueOrFalse){if(e)return!0
if(!e)return!1}else{if(e)return!1
if(!e)return!0}return!1}componentAction(e,t){var o=0
$("#"+this.domID).is(":checked")&&(o=1),this.args.action(e,t,o)}},s(a.prototype,"computed_checkTest",[i],Object.getOwnPropertyDescriptor(a.prototype,"computed_checkTest"),a.prototype),s(a.prototype,"componentAction",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"componentAction"),a.prototype),a);(0,t.setComponentTemplate)(c,u)}),define("pikimov/components/ui/property-color",["exports","@ember/component","@glimmer/component","@ember/object","@ember/template","@ember/template-factory"],function(e,t,o,r,n,i){var a,l,s
function c(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function u(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const m=(0,i.createTemplateFactory)({id:"S0sqB4Mh",block:'[[[10,0],[15,0,[29,["property",[30,0,["extraClasses"]]]]],[12],[1,"\\n    "],[41,[30,1],[[[10,"label"],[12],[1,[30,1]],[1,"\\n        "],[41,[30,2],[[[10,"i"],[14,0,"fa fa-question-circle tooltip"],[12],[10,1],[14,0,"tooltiptext p50"],[12],[1,[30,2]],[13],[13]],[]],null],[1,"\\n    "],[13]],[]],null],[1,"\\n\\n"],[1,"\\n    "],[10,0],[14,0,"colors"],[12],[1,"\\n        "],[11,1],[16,0,[29,["colorDisk",[52,[30,3]," disabled"]]]],[16,5,[30,0,["cssColor1"]]],[4,[38,5],["click",[28,[37,6],[[30,0,["openColorPicker"]],1],null]],null],[12],[13],[1,"\\n        "],[8,[39,7],[[24,0,"color1"],[4,[38,5],["change",[30,5]],null]],[["@type","@value"],["color",[30,4]]],null],[1,"\\n"],[41,[30,6],[[[1,"        "],[11,1],[16,0,[29,["colorDisk",[52,[30,3]," disabled"]]]],[16,5,[30,0,["cssColor2"]]],[4,[38,5],["click",[28,[37,6],[[30,0,["openColorPicker"]],2],null]],null],[12],[13],[1,"\\n        "],[8,[39,7],[[24,0,"color2"],[4,[38,5],["change",[30,5]],null]],[["@type","@value"],["color",[30,6]]],null]],[]],null],[1,"\\n\\n"],[1,"    "],[13],[1,"\\n\\n"],[13],[1,"\\n"]],["@label","@toolTip","@disabled","@value","@action","@value2"],["div","if","label","i","span","on","fn","input"]]',moduleName:"pikimov/components/ui/property-color.hbs",isStrictMode:!1})
let p=e.default=(a=(0,r.computed)("args.value"),l=(0,r.computed)("args.value2"),s=class extends o.default{constructor(){super(...arguments),c(this,"extraClasses","")
var e=this.args
if(e.subProperty&&(this.extraClasses+=" sub"),e.label||(this.extraClasses+=" noLabel"),"color___disabled"==e.type){next(function(){jscolor.install()})}}get cssColor1(){var e=`background-color:${this.args.value};`
return(0,n.htmlSafe)(e)}get cssColor2(){var e=`background-color:${this.args.value2};`
return(0,n.htmlSafe)(e)}openColorPicker(e){event.target.parentElement.querySelector("input.color"+e).click()}},u(s.prototype,"cssColor1",[a],Object.getOwnPropertyDescriptor(s.prototype,"cssColor1"),s.prototype),u(s.prototype,"cssColor2",[l],Object.getOwnPropertyDescriptor(s.prototype,"cssColor2"),s.prototype),u(s.prototype,"openColorPicker",[r.action],Object.getOwnPropertyDescriptor(s.prototype,"openColorPicker"),s.prototype),s);(0,t.setComponentTemplate)(m,p)}),define("pikimov/components/ui/property-note",["exports","@ember/component","@ember/component/template-only","@ember/template-factory"],function(e,t,o,r){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const n=(0,r.createTemplateFactory)({id:"0lam1Cxm",block:'[[[10,0],[14,0,"property noGrid note"],[12],[1,"\\n    "],[10,2],[12],[1,[30,1]],[18,2,null],[13],[1,"\\n"],[13],[1,"\\n"]],["@note","&default"],["div","p","yield"]]',moduleName:"pikimov/components/ui/property-note.hbs",isStrictMode:!1})
e.default=(0,t.setComponentTemplate)(n,(0,o.default)(void 0,"property-note"))}),define("pikimov/components/ui/property-number",["exports","@ember/component","@glimmer/component","@ember/runloop","@ember/object","@ember/template-factory"],function(e,t,o,r,n,i){var a
function l(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const s=(0,i.createTemplateFactory)({id:"Lqutkfxt",block:'[[[10,0],[15,0,[29,["property",[30,0,["extraClasses"]],[52,[30,1]," disabled"]]]],[15,1,[29,[[30,0,["domID"]]]]],[12],[1,"\\n"],[41,[30,2],[[[1,"    "],[10,"label"],[12],[1,[30,2]],[1,"\\n        "],[41,[30,3],[[[10,"i"],[14,0,"fa fa-question-circle tooltip"],[12],[10,1],[14,0,"tooltiptext p50"],[12],[1,[30,3]],[13],[13]],[]],null],[1,"\\n    "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[1,"    "],[10,0],[14,0,"number"],[12],[1,"\\n        "],[8,[39,5],[[24,"draggable","false"],[24,0,"value"],[16,"disabled",[30,1]],[4,[38,7],["input__disabled",[30,0,["localChangeAction"]]],null],[4,[38,7],["change",[28,[37,8],[[30,0,["localChangeAction"]],"change"],null]],null]],[["@type","@value"],["number",[28,[37,6],[[30,4],[30,5]],null]]],null],[41,[30,6],[[[10,"label"],[14,0,"unit notranslate"],[12],[41,[30,0,["spaceBeforeUnit"]],[[[1," "]],[]],null],[1,[30,6]],[13]],[]],null],[1,"\\n    "],[13],[1,"\\n\\n"],[13],[1,"\\n"]],["@disabled","@label","@toolTip","@obj","@property","@unit"],["div","if","label","i","span","input","get","on","fn"]]',moduleName:"pikimov/components/ui/property-number.hbs",isStrictMode:!1})
let c=e.default=(a=class extends o.default{constructor(){super(...arguments),l(this,"extraClasses",""),l(this,"spaceBeforeUnit",!1),l(this,"domID",null),l(this,"domInput",null),l(this,"mouseStart",null),l(this,"mouseNow",null),l(this,"valueStart",null),l(this,"timerLongPress",!1),l(this,"isLongPress",!1),l(this,"isScrubbing",!1),l(this,"divider",1)
var e=this
e.domID="number_"+(Math.floor(8999*Math.random())+1e3)
var t=e.args
t.extraClasses&&(e.extraClasses=" "+t.extraClasses),t.subProperty&&(e.extraClasses+=" sub"),t.label||(e.extraClasses+=" noLabel"),t.long&&(e.extraClasses+=" long"),t.noTranslate&&(e.extraClasses+=" notranslate"),t.disableMouseMove||(0,r.next)(function(){var o=!1,r=$("#"+e.domID).find("input")
const i=r[0]
e.domInput=i,i&&(i.addEventListener("dragstart",e=>(e.preventDefault(),!1)),r.mousedown(function(t){o=!0,e.mouseStart={x:t.clientX,y:t.clientY},e.mouseNow={x:t.clientX,y:t.clientY},e.valueStart=1*r.val(),e.timerLongPress=setTimeout(function(){e.mouseNow.x==e.mouseStart.x&&e.mouseNow.y==e.mouseStart.y&&(e.isLongPress=!0,e.isScrubbing=!0,r.blur(),r.addClass("scrubbing"))},200)}),$(document).mouseup(function(){o=!1,e.timerLongPress&&clearTimeout(e.timerLongPress),e.isLongPress&&(t.action&&t.action(!0),e.isLongPress=!1,e.isScrubbing=!1,r.removeClass("scrubbing"))}),$(document).mousemove(function(i){if(o&&(e.mouseNow={x:i.clientX,y:i.clientY}),e.isScrubbing){var a=e.mouseStart.x-e.mouseNow.x,l=e.mouseStart.y-e.mouseNow.y,s=e.valueStart-Math.floor(a/e.divider)+Math.floor(l/e.divider)
void 0!==t.min&&s<1*t.min&&(s=1*t.min),void 0!==t.max&&s>1*t.max&&(s=1*t.max),s!=1*r.val()&&((0,n.set)(t.obj,t.property,s),t.action&&t.action(!1))}}))})}localChangeAction(e){var t=this.args,o=!1
if("change"==e){o=!0
var r=1*t.obj[t.property]
void 0!==t.min&&r<1*t.min&&(r=1*t.min),void 0!==t.max&&r>1*t.max&&(r=1*t.max),(0,n.set)(t.obj,t.property,r)}t.action&&t.action(o)}},u=a.prototype,m="localChangeAction",p=[n.action],d=Object.getOwnPropertyDescriptor(a.prototype,"localChangeAction"),f=a.prototype,v={},Object.keys(d).forEach(function(e){v[e]=d[e]}),v.enumerable=!!v.enumerable,v.configurable=!!v.configurable,("value"in v||v.initializer)&&(v.writable=!0),v=p.slice().reverse().reduce(function(e,t){return t(u,m,e)||e},v),f&&void 0!==v.initializer&&(v.value=v.initializer?v.initializer.call(f):void 0,v.initializer=void 0),void 0===v.initializer&&Object.defineProperty(u,m,v),a)
var u,m,p,d,f,v;(0,t.setComponentTemplate)(s,c)}),define("pikimov/components/ui/property-radio",["exports","@ember/component","@glimmer/component","@ember/object","@ember/template-factory"],function(e,t,o,r,n){var i
function a(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const l=(0,n.createTemplateFactory)({id:"VgTrpLw5",block:'[[[1,"\\n"],[10,0],[15,0,[29,["property radio ",[30,1]]]],[12],[1,"\\n    "],[10,0],[14,0,"radioContainer"],[12],[10,"label"],[15,"for",[29,[[30,0,["radioGroupName"]],"_1"]]],[12],[1,[30,2]],[13],[1,"\\n        "],[11,"input"],[16,3,[29,[[30,0,["radioGroupName"]]]]],[16,1,[29,[[30,0,["radioGroupName"]],"_1"]]],[16,"checked",[28,[37,3],[[30,3],[30,4]],null]],[24,4,"radio"],[4,[38,4],["change",[28,[37,5],[[30,0,["componentAction"]],[30,5],[30,6],[30,4]],null]],null],[12],[13],[1,"\\n        "],[10,1],[14,0,"checkmark"],[12],[13],[1,"\\n    "],[13],[1,"\\n    "],[10,0],[14,0,"radioContainer"],[12],[10,"label"],[15,"for",[29,[[30,0,["radioGroupName"]],"_2"]]],[12],[1,[30,7]],[13],[1,"\\n        "],[11,"input"],[16,3,[29,[[30,0,["radioGroupName"]]]]],[16,1,[29,[[30,0,["radioGroupName"]],"_2"]]],[16,"checked",[28,[37,3],[[30,3],[30,8]],null]],[24,4,"radio"],[4,[38,4],["change",[28,[37,5],[[30,0,["componentAction"]],[30,5],[30,6],[30,8]],null]],null],[12],[13],[1,"\\n        "],[10,1],[14,0,"checkmark"],[12],[13],[1,"\\n    "],[13],[1,"\\n"],[13],[1,"\\n"]],["@extraClasses","@label1","@valueToTrack","@value1","@obj","@objProperty","@label2","@value2"],["div","label","input","eq","on","fn","span"]]',moduleName:"pikimov/components/ui/property-radio.hbs",isStrictMode:!1})
let s=e.default=(i=class extends o.default{constructor(){super(...arguments),a(this,"radioGroupName",null),this.radioGroupName="radio_"+(Math.floor(8999*Math.random())+1e3)}componentAction(e,t,o){this.args.action(e,t,o)}},c=i.prototype,u="componentAction",m=[r.action],p=Object.getOwnPropertyDescriptor(i.prototype,"componentAction"),d=i.prototype,f={},Object.keys(p).forEach(function(e){f[e]=p[e]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=m.slice().reverse().reduce(function(e,t){return t(c,u,e)||e},f),d&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(d):void 0,f.initializer=void 0),void 0===f.initializer&&Object.defineProperty(c,u,f),i)
var c,u,m,p,d,f;(0,t.setComponentTemplate)(l,s)}),define("pikimov/components/ui/property-range",["exports","@ember/component","@glimmer/component","@ember/object","@ember/template-factory"],function(e,t,o,r,n){var i
function a(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const l=(0,n.createTemplateFactory)({id:"joS6q6RE",block:'[[[10,0],[15,0,[29,["property",[30,0,["extraClasses"]],[52,[30,1]," disabled"]]]],[12],[1,"\\n"],[41,[30,2],[[[1,"    "],[10,"label"],[12],[1,[30,2]],[1,"\\n        "],[41,[30,3],[[[10,"i"],[14,0,"fa fa-question-circle tooltip"],[12],[10,1],[14,0,"tooltiptext p50"],[12],[1,[30,3]],[13],[13]],[]],null],[1,"\\n    "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[1,"\\n"],[1,"\\n    "],[10,0],[14,0,"range"],[12],[1,"\\n        "],[8,[39,5],[[24,"tabindex","-1"],[16,"min",[30,0,["minRangeInput"]]],[16,"max",[30,0,["maxRangeInput"]]],[16,"step",[30,0,["step"]]],[16,"disabled",[30,1]],[4,[38,6],["input__",[30,5]],null],[4,[38,6],["change__",[30,5]],null],[4,[38,6],["input__",[30,0,["localChangeAction"]]],null],[4,[38,6],["mouseup__",[30,5]],null],[4,[38,6],["mousemove",[28,[37,7],[[30,0,["localChangeAction"]],false],null]],null],[4,[38,6],["change",[28,[37,7],[[30,0,["localChangeAction"]],true],null]],null]],[["@type","@value"],["range",[30,4]]],null],[10,1],[14,0,"details"],[12],[41,[30,6],[[[10,"label"],[14,0,"value"],[12],[1,[30,4]],[13]],[]],null],[41,[30,7],[[[8,[39,5],[[24,0,"value"],[24,"maxlength","5"],[16,"min",[30,8]],[16,"max",[30,9]],[16,"disabled",[30,1]],[4,[38,6],["change",[28,[37,7],[[30,5],true],null]],null]],[["@type","@value"],["number",[30,4]]],null]],[]],null],[41,[30,10],[[[10,"label"],[14,0,"unit notranslate"],[12],[41,[30,0,["spaceBeforeUnit"]],[[[1," "]],[]],null],[1,[30,10]],[13]],[]],null],[13],[1,"\\n    "],[13],[1,"\\n\\n"],[13],[1,"\\n"]],["@disabled","@label","@toolTip","@value","@action","@displayValue","@displayInput","@min","@max","@unit"],["div","if","label","i","span","input","on","fn"]]',moduleName:"pikimov/components/ui/property-range.hbs",isStrictMode:!1})
let s=e.default=(i=class extends o.default{constructor(){super(...arguments),a(this,"extraClasses",""),a(this,"spaceBeforeUnit",!1),a(this,"isFirstChangedDetected",!0),a(this,"step",1),a(this,"minRangeInput",0),a(this,"maxRangeInput",100),a(this,"previousValue",null)
var e=this.args
e.noGrid&&(this.extraClasses+=" noGrid"),e.label||(this.extraClasses+=" noLabel"),e.subProperty&&(this.extraClasses+=" sub"),void 0!==e.minRangeInput?this.minRangeInput=e.minRangeInput:this.minRangeInput=e.min,void 0!==e.maxRangeInput?this.maxRangeInput=e.maxRangeInput:this.maxRangeInput=e.max,e.step&&(this.step=1*e.step),this.previousValue=this.args.value}localChangeAction(e){var t=this.args;(e||this.previousValue!=t.value)&&(this.previousValue=t.value,t.action&&t.action(e))}},c=i.prototype,u="localChangeAction",m=[r.action],p=Object.getOwnPropertyDescriptor(i.prototype,"localChangeAction"),d=i.prototype,f={},Object.keys(p).forEach(function(e){f[e]=p[e]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=m.slice().reverse().reduce(function(e,t){return t(c,u,e)||e},f),d&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(d):void 0,f.initializer=void 0),void 0===f.initializer&&Object.defineProperty(c,u,f),i)
var c,u,m,p,d,f;(0,t.setComponentTemplate)(l,s)}),define("pikimov/components/ui/property-select",["exports","@ember/component","@glimmer/component","@ember/object","@ember/template-factory"],function(e,t,o,r,n){var i
function a(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const l=(0,n.createTemplateFactory)({id:"MxJcupH/",block:'[[[10,0],[15,0,[29,["property select",[30,0,["extraClasses"]],[52,[30,1]," disabled"]]]],[12],[1,"\\n"],[1,"    "],[41,[30,2],[[[10,"label"],[12],[1,[30,2]],[13]],[]],null],[1,"\\n    "],[10,0],[12],[1,"\\n        "],[11,"select"],[16,0,[29,[[30,0,["selectExtraClasses"]]]]],[16,"disabled",[30,1]],[4,[38,4],["change",[30,0,["setValue"]]],null],[12],[1,"\\n"],[42,[28,[37,6],[[28,[37,6],[[30,3]],null]],null],null,[[[1,"                "],[10,"option"],[15,2,[30,4,["value"]]],[15,"selected",[28,[37,8],[[30,5],[30,4,["value"]]],null]],[15,"disabled",[30,4,["disabled"]]],[12],[1,"\\n                    "],[1,[30,4,["name"]]],[1,"\\n                "],[13],[1,"\\n"]],[4]],null],[1,"        "],[13],[1,"\\n    "],[13],[1,"\\n"],[13],[1,"\\n"]],["@disabled","@label","@options","item","@valueToTrack"],["div","if","label","select","on","each","-track-array","option","eq"]]',moduleName:"pikimov/components/ui/property-select.hbs",isStrictMode:!1})
let s=e.default=(i=class extends o.default{constructor(){super(...arguments),a(this,"extraClasses",""),a(this,"selectExtraClasses","")
var e=this.args
e.label||(this.extraClasses+=" noLabel"),e.noTranslate&&(this.extraClasses+=" notranslate"),e.small&&(this.selectExtraClasses+=" small"),e.long&&(this.selectExtraClasses+=" long")}setValue(){var e=$(event.target).val()
this.args.setValue(this.args.target,this.args.targetProperty,e)}},c=i.prototype,u="setValue",m=[r.action],p=Object.getOwnPropertyDescriptor(i.prototype,"setValue"),d=i.prototype,f={},Object.keys(p).forEach(function(e){f[e]=p[e]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=m.slice().reverse().reduce(function(e,t){return t(c,u,e)||e},f),d&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(d):void 0,f.initializer=void 0),void 0===f.initializer&&Object.defineProperty(c,u,f),i)
var c,u,m,p,d,f;(0,t.setComponentTemplate)(l,s)}),define("pikimov/components/ui/property-selector",["exports","@ember/component","@glimmer/component","@ember/object","@ember/template-factory"],function(e,t,o,r,n){var i
function a(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const l=(0,n.createTemplateFactory)({id:"VukfV3Q4",block:'[[[1,"\\n"],[10,0],[15,0,[29,["property selector ",[30,1]]]],[12],[1,"\\n        "],[41,[30,2],[[[10,"label"],[12],[1,[30,2]],[1,"\\n        "],[41,[30,3],[[[10,"i"],[14,0,"fa fa-question-circle tooltip"],[12],[10,1],[14,0,"tooltiptext p50"],[12],[1,[30,3]],[13],[13]],[]],null],[1,"\\n    "],[13]],[]],null],[1,"\\n\\n"],[41,[30,4],[[[1,"    "],[10,0],[12],[1,"\\n\\n"],[41,[30,5],[[[42,[28,[37,6],[[28,[37,6],[[30,0,["array"]]],null]],null],null,[[[1,"            "],[10,0],[14,0,"radioContainer"],[12],[1,"\\n                "],[11,"input"],[16,3,[29,[[30,0,["radioGroupName"]]]]],[16,1,[29,[[30,0,["radioGroupName"]],"_",[30,7]]]],[16,"checked",[28,[37,8],[[30,8],[30,6,["value"]]],null]],[24,4,"radio"],[4,[38,9],["change",[28,[37,10],[[30,0,["componentAction"]],[30,9],[30,10],[30,6,["value"]]],null]],null],[12],[13],[1,"\\n                "],[10,"label"],[15,"for",[29,[[30,0,["radioGroupName"]],"_",[30,7]]]],[15,0,[29,["fa ",[30,6,["label"]]]]],[12],[13],[1,"\\n            "],[13],[1,"\\n"]],[6,7]],null]],[]],[[[42,[28,[37,6],[[28,[37,6],[[30,0,["array"]]],null]],null],null,[[[1,"            "],[10,0],[14,0,"radioContainer"],[12],[1,"\\n                "],[11,"input"],[16,3,[29,[[30,0,["radioGroupName"]]]]],[16,1,[29,[[30,0,["radioGroupName"]],"_",[30,12]]]],[16,"checked",[28,[37,8],[[30,8],[30,11,["value"]]],null]],[24,4,"radio"],[4,[38,9],["change",[28,[37,10],[[30,0,["componentAction"]],[30,9],[30,10],[30,11,["value"]]],null]],null],[12],[13],[1,"\\n                "],[10,"label"],[15,"for",[29,[[30,0,["radioGroupName"]],"_",[30,12]]]],[12],[1,[30,11,["label"]]],[13],[1,"\\n            "],[13],[1,"\\n"]],[11,12]],null]],[]]],[1,"    "],[13],[1,"\\n"]],[]],[[[1,"    "],[10,0],[12],[1,"\\n        "],[10,0],[14,0,"radioContainer"],[12],[1,"\\n            "],[11,"input"],[16,3,[29,[[30,0,["radioGroupName"]]]]],[16,1,[29,[[30,0,["radioGroupName"]],"_1"]]],[16,"checked",[28,[37,8],[[30,8],[30,13]],null]],[24,4,"radio"],[4,[38,9],["change",[28,[37,10],[[30,0,["componentAction"]],[30,9],[30,10],[30,13]],null]],null],[12],[13],[1,"\\n            "],[10,"label"],[15,"for",[29,[[30,0,["radioGroupName"]],"_1"]]],[12],[1,[30,14]],[13],[1,"\\n        "],[13],[1,"\\n        "],[10,0],[14,0,"radioContainer"],[12],[1,"\\n            "],[11,"input"],[16,3,[29,[[30,0,["radioGroupName"]]]]],[16,1,[29,[[30,0,["radioGroupName"]],"_2"]]],[16,"checked",[28,[37,8],[[30,8],[30,15]],null]],[24,4,"radio"],[4,[38,9],["change",[28,[37,10],[[30,0,["componentAction"]],[30,9],[30,10],[30,15]],null]],null],[12],[13],[1,"\\n            "],[10,"label"],[15,"for",[29,[[30,0,["radioGroupName"]],"_2"]]],[12],[1,[30,16]],[13],[1,"\\n        "],[13],[1,"\\n    "],[13],[1,"\\n"]],[]]],[13]],["@extraClasses","@label","@toolTip","@labels","@useFaIcons","onePair","index","@valueToTrack","@obj","@objProperty","onePair","index","@value1","@label1","@value2","@label2"],["div","if","label","i","span","each","-track-array","input","eq","on","fn"]]',moduleName:"pikimov/components/ui/property-selector.hbs",isStrictMode:!1})
let s=e.default=(i=class extends o.default{constructor(){var e
if(super(...arguments),a(this,"radioGroupName",null),a(this,"array",[]),this.radioGroupName="radio_"+Math.floor(8999*Math.random())+1e3,this.args.labels)for(e=0;e<this.args.labels.length;e++)this.array.push({label:this.args.labels[e],value:this.args.values[e]})}componentAction(e,t,o){this.args.action(e,t,o)}},c=i.prototype,u="componentAction",m=[r.action],p=Object.getOwnPropertyDescriptor(i.prototype,"componentAction"),d=i.prototype,f={},Object.keys(p).forEach(function(e){f[e]=p[e]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=m.slice().reverse().reduce(function(e,t){return t(c,u,e)||e},f),d&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(d):void 0,f.initializer=void 0),void 0===f.initializer&&Object.defineProperty(c,u,f),i)
var c,u,m,p,d,f;(0,t.setComponentTemplate)(l,s)}),define("pikimov/components/ui/property-separator",["exports","@ember/component","@ember/component/template-only","@ember/template-factory"],function(e,t,o,r){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const n=(0,r.createTemplateFactory)({id:"KZztJXMC",block:'[[[10,0],[14,0,"propertySeparator"],[12],[13],[1,"\\n"]],[],["div"]]',moduleName:"pikimov/components/ui/property-separator.hbs",isStrictMode:!1})
e.default=(0,t.setComponentTemplate)(n,(0,o.default)(void 0,"property-separator"))}),define("pikimov/components/ui/property-title",["exports","@ember/component","@glimmer/component","@ember/object","@ember/template-factory"],function(e,t,o,r,n){var i
function a(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const l=(0,n.createTemplateFactory)({id:"HQmzQ9tc",block:'[[[10,0],[15,0,[29,["propertiesTitle ",[52,[30,1],"noBorder"],[30,0,["extraClasses"]]]]],[12],[1,"\\n    "],[10,"h3"],[12],[1,[30,2]],[18,7,null],[13],[1,"\\n"],[41,[30,3],[[[1,"    "],[10,0],[14,0,"checkbox"],[12],[1,"\\n        "],[11,"input"],[16,1,[29,[[30,0,["domID"]]]]],[16,"checked",[28,[37,5],[[30,4],[30,0,["trueOrFalse"]]],null]],[24,4,"checkbox"],[4,[38,6],["change",[28,[37,7],[[30,0,["componentAction"]],[30,5],[30,6]],null]],null],[12],[13],[1,"\\n        "],[10,"label"],[15,"for",[29,[[30,0,["domID"]]]]],[12],[1," "],[13],[1,"\\n    "],[13],[1,"\\n"]],[]],null],[13],[1,"\\n"]],["@noBorder","@title","@checkbox","@valueToTrackBoolean","@obj","@objProperty","&default"],["div","if","h3","yield","input","eq","on","fn","label"]]',moduleName:"pikimov/components/ui/property-title.hbs",isStrictMode:!1})
let s=e.default=(i=class extends o.default{constructor(){super(...arguments),a(this,"domID",null),a(this,"trueOrFalse",!0),a(this,"extraClasses","")
var e=this
e.domID="cbxTitle"+Math.floor(8999*Math.random())+1e3,e.args.notTrue&&(e.trueOrFalse=!1),e.args.noTranslate&&(e.extraClasses+=" notranslate")}componentAction(e,t){var o=0
$("#"+this.domID).is(":checked")&&(o=1),this.args.action(e,t,o)}},c=i.prototype,u="componentAction",m=[r.action],p=Object.getOwnPropertyDescriptor(i.prototype,"componentAction"),d=i.prototype,f={},Object.keys(p).forEach(function(e){f[e]=p[e]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=m.slice().reverse().reduce(function(e,t){return t(c,u,e)||e},f),d&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(d):void 0,f.initializer=void 0),void 0===f.initializer&&Object.defineProperty(c,u,f),i)
var c,u,m,p,d,f;(0,t.setComponentTemplate)(l,s)}),define("pikimov/components/ui/property-toggle",["exports","@ember/component","@glimmer/component","@ember/object","@ember/template-factory"],function(e,t,o,r,n){var i,a
function l(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function s(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const c=(0,n.createTemplateFactory)({id:"2NHMaOJd",block:'[[[10,0],[15,0,[29,["property ",[52,[30,1],"sub"]]]],[12],[1,"\\n    "],[10,"label"],[12],[1,[30,2]],[1,"\\n        "],[41,[30,3],[[[10,"i"],[14,0,"fa fa-question-circle tooltip"],[12],[10,1],[14,0,"tooltiptext p50"],[12],[1,[30,3]],[13],[13]],[]],null],[1," "],[18,9,null],[1,"\\n    "],[13],[1,"\\n"],[41,[51,[30,4]],[[[1,"    "],[10,0],[14,0,"toggle"],[12],[1,"\\n        "],[10,"label"],[14,0,"before"],[12],[1,[30,5]],[13],[1,"\\n        "],[11,"input"],[16,1,[29,[[30,0,["domID"]]]]],[16,"checked",[30,0,["computed_checkTest"]]],[24,4,"checkbox"],[4,[38,8],["change",[28,[37,9],[[30,0,["componentAction"]],[30,6],[30,7]],null]],null],[12],[13],[1,"\\n        "],[10,"label"],[15,"for",[29,[[30,0,["domID"]]]]],[12],[1,[30,8]],[13],[1,"\\n    "],[13],[1,"\\n"]],[]],[[[1,"    "],[10,0],[14,0,"toggle noLabels"],[12],[1,"\\n        "],[11,"input"],[16,1,[29,[[30,0,["domID"]]]]],[16,"checked",[30,0,["computed_checkTest"]]],[24,4,"checkbox"],[4,[38,8],["change",[28,[37,9],[[30,0,["componentAction"]],[30,6],[30,7]],null]],null],[12],[13],[1,"\\n        "],[10,"label"],[15,"for",[29,[[30,0,["domID"]]]]],[12],[1," "],[13],[1,"\\n    "],[13],[1,"\\n"]],[]]],[1,"\\n"],[13],[1,"\\n"]],["@subProperty","@label","@toolTip","@noLabels","@labelCheck1","@obj","@objProperty","@labelCheck2","&default"],["div","if","label","i","span","yield","unless","input","on","fn"]]',moduleName:"pikimov/components/ui/property-toggle.hbs",isStrictMode:!1})
let u=e.default=(i=(0,r.computed)("args.valueToTrackBoolean"),a=class extends o.default{constructor(){super(...arguments),l(this,"domID",null),l(this,"trueOrFalse",!0),this.domID="cbx"+Math.floor(8999*Math.random())+1e3,this.args.notTrue&&(this.trueOrFalse=!1),this.args.noLabels||this.args.labelCheck1||this.args.labelCheck2||console.log("UI property: missing labels")}get computed_checkTest(){var e=this,t=e.args.valueToTrackBoolean
if(e.trueOrFalse){if(t)return!0
if(!t)return!1}if(!e.trueOrFalse){if(t)return!1
if(!t)return!0}return!1}componentAction(e,t){var o=0
$("#"+this.domID).is(":checked")&&(o=1),this.args.action(e,t,o)}},s(a.prototype,"computed_checkTest",[i],Object.getOwnPropertyDescriptor(a.prototype,"computed_checkTest"),a.prototype),s(a.prototype,"componentAction",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"componentAction"),a.prototype),a);(0,t.setComponentTemplate)(c,u)}),define("pikimov/components/ui/property",["exports","@ember/component","@glimmer/component","@ember/object","@ember/runloop","@ember/template-factory"],function(e,t,o,r,n,i){var a
function l(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function s(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const c=(0,i.createTemplateFactory)({id:"kf7c6sUF",block:'[[[10,0],[15,0,[29,["property",[30,0,["extraClasses"]],[52,[30,1]," disabled"]]]],[12],[1,"\\n"],[41,[30,2],[[[1,"    "],[10,"label"],[12],[1,[30,2]],[1,"\\n        "],[41,[30,3],[[[10,"i"],[14,0,"fa fa-question-circle tooltip"],[12],[10,1],[14,0,"tooltiptext p50"],[12],[1,[30,3]],[13],[13]],[]],null],[1,"\\n    "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[1,"\\n"],[41,[28,[37,5],[[30,4],"number"],null],[[[1,"    "],[10,0],[14,0,"number"],[12],[1,"\\n        "],[8,[39,6],[[24,0,"value"],[4,[38,7],["change",[30,6]],null],[4,[38,7],["input___",[30,6]],null]],[["@type","@value"],["number",[30,5]]],null],[41,[30,7],[[[10,"label"],[14,0,"unit"],[12],[41,[30,0,["spaceBeforeUnit"]],[[[1," "]],[]],null],[1,[30,7]],[13]],[]],null],[1,"\\n    "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[41,[28,[37,5],[[30,4],"text"],null],[[[41,[30,8],[[[1,"        "],[10,0],[14,0,"text long"],[12],[1,"\\n            "],[8,[39,6],[[24,"autocomplete","off"],[16,"placeholder",[30,9]],[16,"maxlength",[30,0,["maxlength"]]],[16,"disabled",[30,1]],[4,[38,7],["input",[30,0,["onInput"]]],null],[4,[38,7],["change",[28,[37,8],[[30,6],true],null]],null]],[["@type","@value"],["text",[30,5]]],null],[1,"\\n        "],[13],[1,"\\n"]],[]],[[[1,"        "],[10,0],[14,0,"text"],[12],[3," class name not used in css "],[1,"\\n            "],[8,[39,6],[[24,"autocomplete","off"],[16,"placeholder",[30,9]],[16,"maxlength",[30,0,["maxlength"]]],[16,"disabled",[30,1]],[4,[38,7],["input",[30,0,["onInput"]]],null],[4,[38,7],["change",[28,[37,8],[[30,6],true],null]],null]],[["@type","@value"],["text",[30,5]]],null],[1,"\\n        "],[13],[1,"\\n"]],[]]]],[]],null],[1,"\\n"],[41,[28,[37,5],[[30,4],"textarea"],null],[[[1,"    "],[10,0],[14,0,"textarea"],[12],[1,"\\n        "],[8,[39,9],[[24,0,"scrollbar"],[16,"maxlength",[30,0,["maxlength"]]],[16,"placeholder",[30,9]],[16,"spellcheck",[30,0,["spellcheck"]]],[16,"disabled",[30,1]],[4,[38,7],["keyup",[30,6]],null]],[["@value"],[[30,5]]],null],[1,"    "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[13],[1,"\\n"]],["@disabled","@label","@toolTip","@type","@value","@action","@unit","@long","@placeholder"],["div","if","label","i","span","eq","input","on","fn","textarea"]]',moduleName:"pikimov/components/ui/property.hbs",isStrictMode:!1})
let u=e.default=(a=class extends o.default{constructor(){super(...arguments),l(this,"extraClasses",""),l(this,"spaceBeforeUnit",!1),l(this,"maxlength",40),l(this,"spellcheck",!0)
var e=this.args
"number"==e.type&&console.error("OBS property number"),"textarea"==e.type&&(this.maxlength=500),e.long&&(this.extraClasses+=" long"),e.type||(this.extraClasses+=" noGrid"),e.label||(this.extraClasses+=" noLabel"),"text"==e.type&&e.long&&(this.extraClasses+=" noGrid"),"textarea"==e.type&&e.long&&(this.extraClasses+=" noGrid"),e.subProperty&&(this.extraClasses+=" sub"),e.hiddenInput&&(this.extraClasses+=" hiddenInput"),e.maxlength&&(this.maxlength=e.maxlength),!1===e.spellcheck&&(this.spellcheck=!1),"number"==e.type&&console.log("OBS - property type number"),e.unit&&"%"!=e.unit&&(this.spaceBeforeUnit=!0)}onInput(){var e=this.args;(0,n.next)(function(){e.action()})}onKeyUp(){}},s(a.prototype,"onInput",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"onInput"),a.prototype),s(a.prototype,"onKeyUp",[r.action],Object.getOwnPropertyDescriptor(a.prototype,"onKeyUp"),a.prototype),a);(0,t.setComponentTemplate)(c,u)}),define("pikimov/components/ui/single-select",["exports","@ember/component","@ember/runloop","@glimmer/component","@ember/template-factory"],function(e,t,o,r,n){function i(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const a=(0,n.createTemplateFactory)({id:"gTTKfBSg",block:'[[[1,"\\nNOT USED??\\n"],[11,"select"],[16,1,[29,[[30,0,["domID"]]]]],[24,0,"multiple scrollbar"],[4,[38,1],["change",[28,[37,2],[[30,1],[30,2]],null]],null],[12],[1,"\\n\\n"],[41,[30,0,["options"]],[[[1,"        "],[10,"option"],[14,2,""],[12],[1,[30,0,["placeholder"]]],[13],[1,"\\n"],[42,[28,[37,6],[[28,[37,6],[[30,0,["options"]]],null]],null],null,[[[1,"            "],[10,"option"],[15,2,[30,3,["value"]]],[15,"selected",[30,3,["selected"]]],[15,"disabled",[30,3,["disabled"]]],[12],[1,[30,3,["name"]]],[13],[1,"\\n"]],[3]],null]],[]],null],[1,"\\n"],[41,[30,0,["groups"]],[[[1,"        "],[10,"option"],[14,2,""],[12],[1,[30,0,["placeholder"]]],[13],[1,"\\n"],[42,[28,[37,6],[[28,[37,6],[[30,0,["groups"]]],null]],null],null,[[[1,"            "],[10,"optgroup"],[15,"label",[29,[[30,4,["name"]]]]],[12],[1,"\\n"],[42,[28,[37,6],[[28,[37,6],[[30,4,["items"]]],null]],null],null,[[[1,"                "],[10,"option"],[15,2,[30,5,["value"]]],[15,"selected",[30,5,["selected"]]],[15,"disabled",[30,5,["disabled"]]],[12],[1,[30,5,["name"]]],[13],[1,"\\n"]],[5]],null],[1,"            "],[13],[1,"\\n"]],[4]],null]],[]],null],[1,"\\n"],[13]],["@action","@actionParam","item","oneGroup","item"],["select","on","fn","if","option","each","-track-array","optgroup"]]',moduleName:"pikimov/components/ui/single-select.hbs",isStrictMode:!1})
class l extends r.default{constructor(){super(...arguments),i(this,"placeholder","Select element"),i(this,"domID",null),i(this,"options",[]),i(this,"groups",[])
var e=this
e.domID="singleSelect"+Math.floor(8999*Math.random())+1e3
var t=e.args
t.options&&t.groups&&console.log("error singleselect: cannot use both options + groups"),t.placeholder&&(e.placeholder=t.placeholder),t.options&&t.options.forEach(function(o,r){var n=o[t.valueProperty],i=o[t.nameProperty],a=!1,l=!1
o.disabled&&(l=!0),t.selected&&t.selected.forEach(function(e){e==n&&(a=!0)}),e.options.push({index:r,value:n,name:i,selected:a,disabled:l})}),t.groups&&t.groups.forEach(function(o,r){var n=o.name,i=[]
o.items&&o.items.forEach(function(e,o){var r=e[t.valueProperty],n=e[t.nameProperty],a=!1,l=!1
e.disabled&&(l=!0),t.selected&&t.selected.forEach(function(e){e==r&&(a=!0)}),i.push({index:o,value:r,name:n,selected:a,disabled:l})}),e.groups.push({name:n,items:i})}),(0,o.next)(function(){const o=$("#"+e.domID).SumoSelect({search:!0,searchText:"Enter here",up:t.up})
t.width&&$(o.parentElement).css({width:1*t.width+"px"})})}}e.default=l,(0,t.setComponentTemplate)(a,l)}),define("pikimov/components/ui/tutorial-bubble",["exports","@ember/component","@glimmer/component","@ember/object","@ember/template-factory"],function(e,t,o,r,n){var i
function a(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const l=(0,n.createTemplateFactory)({id:"KL7f7Qwr",block:'[[[10,0],[15,0,[29,["tutorial ",[52,[30,1],[30,1]]," ",[52,[30,2],"animated"]," ",[52,[30,3],"closeButton"]]]],[15,1,[29,[[30,0,["domID"]]]]],[12],[1,"\\n\\n"],[18,4,null],[1,"\\n\\n"],[41,[30,3],[[[11,1],[24,0,"b_close"],[4,[38,4],["click",[30,0,["closeTutorial"]]],null],[12],[13]],[]],null],[1,"\\n"],[13],[1,"\\n"]],["@extraClasses","@animated","@closeButton","&default"],["div","if","yield","span","on"]]',moduleName:"pikimov/components/ui/tutorial-bubble.hbs",isStrictMode:!1})
let s=e.default=(i=class extends o.default{constructor(){super(...arguments),a(this,"domID",null),this.domID="tutorial"+Math.floor(8999*Math.random())+1e3}closeTutorial(){document.querySelector("#"+this.domID).style.display="none"}},c=i.prototype,u="closeTutorial",m=[r.action],p=Object.getOwnPropertyDescriptor(i.prototype,"closeTutorial"),d=i.prototype,f={},Object.keys(p).forEach(function(e){f[e]=p[e]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=m.slice().reverse().reduce(function(e,t){return t(c,u,e)||e},f),d&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(d):void 0,f.initializer=void 0),void 0===f.initializer&&Object.defineProperty(c,u,f),i)
var c,u,m,p,d,f;(0,t.setComponentTemplate)(l,s)}),define("pikimov/controllers/alpha-tester",["exports","@ember/controller","@ember/runloop","pikimov/classes/shaders/shaders-common","pikimov/classes/passes/blend-pass"],function(e,t,o,r,n){function i(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{constructor(){super(...arguments),i(this,"renderer",null),i(this,"composer",null),i(this,"renderTargetOut0",null),i(this,"finalComposer",null),i(this,"scene",null),i(this,"camera",null),i(this,"canvas",null),i(this,"canvas_width",1e3),i(this,"canvas_height",500),i(this,"stacks",[])
var e=this
console.log("ALPHA TESTER")
var t=e.getSize()
e.renderTargetOut0=new THREE.WebGLRenderTarget(t.width,t.height,{}),e.renderTargetOut0.texture.needsUpdate=!0,(0,o.next)(async function(){e.canvas=document.querySelector("#canvas"),e.canvas.width=e.canvas_width,e.canvas.height=e.canvas_height,e.canvas.style.outline="1px solid red",canvas.style.background="red",e.createScene(),e.createCamera(),e.createRenderer(),e.createComposer(),await e.createStack(0),e.stacks[0].items.forEach(function(t){e.scene.add(t.threejsObj)}),e.renderer.setClearColor(16777215,0),e.renderComposer(),window._canvasDebugY=10,e.addToCanvasDebug("name",0,e.renderTargetOut0),e.renderer.setRenderTarget(null),e.renderer.setClearColor(16777215,1),e.renderer.clear(),e.createFinalComposer(),e.renderFinalComposer()})}getSize(){return{width:this.canvas_width,height:this.canvas_height}}createScene(){this.scene=new THREE.Scene}createCamera(){var e=this,t=e.getSize(),o=t.width,r=t.height
e.camera=new THREE.OrthographicCamera(o/-2,o/2,r/2,r/-2,1,2e3),e.camera.position.set(0,0,1e3)}createRenderer(){var e=this
const t=e.canvas_width,o=e.canvas_height
e.renderer=new THREE.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0,powerPreference:"high-performance",canvas:e.canvas,premultipliedAlpha:!0}),e.renderer.setSize(t,o),e.renderer.setPixelRatio(1),e.renderer.setClearColor(16777215,0),e.renderer.setPixelRatio(1)}async createStack(e){}createComposer(){}createFinalComposer(){}render(){var e=this
console.log("just render"),e.renderer.render(e.scene,e.camera)}renderComposer(){console.log("render composer"),console.log(this.composer),this.composer.render()}renderFinalComposer(){var e=this
e.renderTargetOut0.texture.needsUpdate=!0,console.log("render final composer"),e.renderer.setRenderTarget(null),e.finalComposer.render()}addToCanvasDebug(e,t,o){}}e.default=a}),define("pikimov/controllers/composer-tester",["exports","@ember/controller","@ember/runloop","pikimov/classes/shaders/shaders-common"],function(e,t,o,r){function n(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class i extends t.default{constructor(){super(...arguments),n(this,"renderer",null),n(this,"composer",null),n(this,"scene",null),n(this,"camera",null),n(this,"canvas",null),n(this,"canvas_width",800),n(this,"canvas_height",600)
var e=this
console.log("COMPOSER TESTER"),(0,o.next)(function(){e.canvas=document.querySelector("#canvas"),e.canvas.width=e.canvas_width,e.canvas.height=e.canvas_height,e.canvas.style.outline="1px solid red",e.maskPass()})}getSize(){return{width:this.canvas_width,height:this.canvas_height}}createScene(){var e=this
const t=e.canvas_width,o=e.canvas_height
e.camera=new THREE.PerspectiveCamera(70,t/o,.01,10),e.camera.position.z=1,e.scene=new THREE.Scene
const r=new THREE.BoxGeometry(.5,.5,.5),n=new THREE.MeshBasicMaterial({color:16724736})
n.depthWrite=!1,n.stencilWrite=!0,n.stencilRef=1,n.stencilFunc=THREE.AlwaysStencilFunc,n.stencilZPass=THREE.ReplaceStencilOp
const i=new THREE.Mesh(r,n)
i.rotation.set(1,2,3),e.scene.add(i)
const a=new THREE.SphereGeometry(2),l=new THREE.MeshBasicMaterial({color:255})
l.stencilWrite=!0,l.stencilRef=1,l.stencilFunc=THREE.EqualStencilFunc
const s=new THREE.Mesh(a,l)
s.position.set(1,0,-1.5),i.renderOrder=2,e.scene.add(s)}createRenderer(){var e=this
const t=e.canvas_width,o=e.canvas_height
e.canvas.style.background="cyan",e.renderer=new THREE.WebGLRenderer({antialias:!0,stencil:!0,canvas:e.canvas}),e.renderer.setSize(t,o),e.renderer.setPixelRatio(1)}createComposer(){var e=this,t=e.getSize()
e.composer=new EffectComposer(e.renderer),e.renderTarget=new THREE.WebGLRenderTarget(t.width,t.height,{stencilBuffer:!0}),e.composer=new EffectComposer(e.renderer,e.renderTarget),e.renderPass=new RenderPass(e.scene,e.camera),e.renderPass.name="render pass",e.renderPass.clearStencil=!0,e.composer.addPass(e.renderPass),e.shader={},e.shader.vertexShader=r._commonVertexShader,e.shader.fragmentShader="varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform float u_value;\n\nvoid main()\n{\n    mediump vec4 tColorIn = texture(tDiffuse, vUv);\n    mediump float lum = (tColorIn.r + tColorIn.g + tColorIn.b )/3.0;\n    mediump vec4 tColorGrayscale = vec4(lum, lum, lum, tColorIn.a);\n    gl_FragColor = mix(tColorIn, tColorGrayscale, u_value);\n}",e.shader.uniforms={tDiffuse:{value:null},u_value:{value:.9}},e.shaderPass=new ShaderPass(e.shader),e.shaderPass.material.stencilWrite=!0,e.shaderPass.material.stencilRef=1,e.shaderPass.material.stencilFunc=THREE.AlwaysStencilFunc,e.shaderPass.material.stencilFunc=THREE.NotEqualStencilFunc,e.composer.addPass(e.shaderPass)}render(){var e=this
console.log("just render"),e.renderer.render(e.scene,e.camera)}renderComposer(){console.log("render composer"),console.log(this.composer),this.composer.render()}demo(){const e=new THREE.Scene,t=new THREE.PerspectiveCamera(36,window.innerWidth/window.innerHeight,1,100)
t.position.set(4,5,4)
var o=document.querySelector("#canvas")
const r=new THREE.WebGLRenderer({antialias:!0,stencil:!0,canvas:o})
r.shadowMap.enabled=!0,r.setPixelRatio(1),r.setSize(window.innerWidth,window.innerHeight),r.setClearColor(4537447),window.addEventListener("resize",function(){t.aspect=window.innerWidth/window.innerHeight,t.updateProjectionMatrix(),r.setSize(window.innerWidth,window.innerHeight)})
const n=new OrbitControlsXRPlus(t,r.domElement)
n.minDistance=2,n.maxDistance=20,n.update(),function(){const t=new THREE.PlaneGeometry,o=new THREE.MeshPhongMaterial({color:"green"})
o.side=THREE.DoubleSide,o.depthWrite=!1,o.stencilWrite=!0,o.stencilRef=1,o.stencilFunc=THREE.AlwaysStencilFunc,o.stencilZPass=THREE.ReplaceStencilOp
const r=new THREE.Mesh(t,o)
e.add(r)
const n=new THREE.BoxHelper(r,"white")
e.add(n)
const i=new THREE.MeshBasicMaterial({color:"blue"})
i.side=THREE.DoubleSide,i.stencilWrite=!0,i.stencilRef=1,i.stencilFunc=THREE.NotEqualStencilFunc
const a=new THREE.Mesh(t,i)
a.position.x=-.5,a.position.y=.5,a.position.z=-.1,e.add(a)}(),function o(){requestAnimationFrame(o),r.render(e,t)}()}maskPass(){return}}e.default=i}),define("pikimov/controllers/css3-tester",["exports","@ember/controller","@ember/runloop"],function(e,t,o){function r(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class n extends t.default{constructor(){super(...arguments),r(this,"scene",null),r(this,"renderer",null),r(this,"threejsWidget",null)
var e=this
console.log("css3 TESTER"),(0,o.next)(function(){e.createRenderer(),e.addWidget(),e.animate()})}createRenderer(){}animate(){return}addWidget(){}}e.default=n}),define("pikimov/controllers/curves-tester",["exports","@ember/controller","@ember/runloop"],function(e,t,o){function r(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class n extends t.default{constructor(){super(...arguments),r(this,"isDragging",!1),r(this,"activeHandle",null),r(this,"compositionData",null),r(this,"propertyJson",null),r(this,"scaleX",4),r(this,"scaleY",3),r(this,"minValue",0),r(this,"maxValue",10),r(this,"width",200),r(this,"height",100),r(this,"valueName","p"),r(this,"domSVG",null),r(this,"handlesColor","#ff0000")
var e=this
console.log("CURVES TESTER"),e.compositionData=_devProject.compositions[0],(0,o.next)(function(){e.valueName="p",e.propertyJson=_devProject.compositions[0].items[0].params[0],e.updateMinMax(e.propertyJson),e.createSVG()
var t=e.propertyJson.keyframes[0]
Object.keys(t.values).forEach(function(t){e.doProperty(e.propertyJson,t)}),e.addClickEvents()
var o=document.querySelector("#propertyCurve")
$(o).css({outline:"1px solid blue"}),$(o).on("mousedown",function(t){var r=$(o).offset(),n=t.pageX-r.left,i=Math.floor(n/e.scaleX),a=e.getValueAt(e.propertyJson,"z",i)
a=Math.round(100*a)/100,$("#value50").text(i+": "+a)})})}updateMinMax(e){var t=this
t.minValue=0,t.maxValue=10,e.keyframes.forEach(function(e){Object.keys(e.values).forEach(function(o){var r=t.getKeyframeValue(e,o)
r<t.minValue&&(t.minValue=r),r>t.maxValue&&(t.maxValue=r)})}),t.height=t.maxValue-t.minValue,console.log("min max",t.minValue,t.maxValue,"height",t.height)}createSVG(){}doProperty(e,t){}addClickEvents(){}convertKeyToCustom(e){}buildOneKeyframe(e,t,o,r){}updatePath(e,t){}getKeyframeValue(e,t){return e.values[t]}getHandlesPositionByKeyIndex(e,t,o){}getValueAt(e,t,o){var r,n=this,i=0
for(r=0;r<e.keyframes.length;r++)if(e.keyframes[r].frame>o){i=r-1
break}var a=e.keyframes[i],l=e.keyframes[i+1],s=n.getKeyframeValue(a,t),c=n.getKeyframeValue(l,t),u=a.frame,m=n.height-s,p=l.frame,d=n.height-c,f=n.getHandlesPositionByKeyIndex(e,t,i),v={x:u,y:m},h={x:f.handle1x,y:f.handle1y},g={x:f.handle2x,y:f.handle2y},y={x:p,y:d},b=n.getYatX(v,h,g,y,o)
return n.height-b}getYatX(e,t,o,r,n){function i(e,t,o,r,n){return(1-e)**3*t.x+3*(1-e)**2*e*o.x+3*(1-e)*e**2*r.x+e**3*n.x}const a=function(e,t,o,r,n){let a=function(e,t,o,r,n,a=1e-4){let l=0,s=1,c=.5
for(;s-l>a;)c=(l+s)/2,i(c,t,o,r,n)<e?l=c:s=c
return c}(e,t,o,r,n)
return function(e,t,o,r,n){return(1-e)**3*t.y+3*(1-e)**2*e*o.y+3*(1-e)*e**2*r.y+e**3*n.y}(a,t,o,r,n)}(n,e,t,o,r)
return a}}e.default=n}),define("pikimov/controllers/index",["exports","@ember/controller","@ember/runloop","@ember/service"],function(e,t,o,r){var n,i,a
function l(e,t,o,r){o&&Object.defineProperty(e,t,{enumerable:o.enumerable,configurable:o.configurable,writable:o.writable,value:o.initializer?o.initializer.call(r):void 0})}function s(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(n=class extends t.default{constructor(){super(...arguments),l(this,"router",i,this),l(this,"fileHandler",a,this),this.addClickEvents()}addClickEvents(){var e=this;(0,o.next)(function(){$("#b_newProject").on("click",function(){e.goToNewProject()}),$("#b_openProject").on("click",function(){e.goToOpenProject()})
var t=$("#splashScreen .selector h3")
t.eq(0).on("click",function(){$("#splashScreen .demos").show(),$("#splashScreen .tutorials").hide(),t.removeClass("active"),t.eq(0).addClass("active")}),t.eq(1).on("click",function(){$("#splashScreen .demos").hide(),$("#splashScreen .tutorials").show(),t.removeClass("active"),t.eq(1).addClass("active")}),$("#splashScreen .demos video, #splashScreen .demos p").on("click",function(t){_isNewProject=!0,_demoProjectName=$(t.target).parent().attr("data-demoname"),e.router.transitionTo("project")})
var o=document.querySelector("#splashScreen")
o.addEventListener("dragenter",function(e){e.preventDefault(),e.stopPropagation(),e.dataTransfer.types.includes("Files")&&$("#splashScreen").addClass("isFileDragover")}),o.addEventListener("dragover",function(e){e.preventDefault(),e.stopPropagation()}),o.addEventListener("dragleave",function(t){t.fromElement||e.dragEnd(t)}),o.addEventListener("drop",function(t){if(t.dataTransfer.types.includes("Files")){const o=t.dataTransfer.files[0]
if(o)"pikimov"==getFileExtension(o.name)&&(e.fileHandler.setFile(o),e.router.transitionTo("project"))}e.dragEnd(t)})})}dragEnd(e){e.preventDefault(),e.stopPropagation(),$("#splashScreen").removeClass("isFileDragover")}goToNewProject(){console.log("home - new project"),_isNewProject=!0,_demoProjectName=null,this.router.transitionTo("project")}goToOpenProject(){console.log("home - open project"),_isNewProject=!1,_demoProjectName=null,this.router.transitionTo("project")}},i=s(n.prototype,"router",[r.service],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a=s(n.prototype,"fileHandler",[r.service],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n)}),define("pikimov/controllers/project",["exports","@ember/controller","@ember/object","@ember/runloop","@ember/service","@glimmer/tracking","@sentry/ember","pikimov/classes/managers/ui-manager","pikimov/classes/managers/composition-manager","pikimov/classes/managers/library-manager","pikimov/classes/managers/raycast-manager","pikimov/classes/managers/renderers-manager"],function(e,t,o,r,n,i,a,l,s,c,u,m){var p,d,f,v
function h(e,t,o,r){o&&Object.defineProperty(e,t,{enumerable:o.enumerable,configurable:o.configurable,writable:o.writable,value:o.initializer?o.initializer.call(r):void 0})}function g(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function y(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(p=class extends t.default{constructor(){super(...arguments),h(this,"router",d,this),h(this,"fileHandler",f,this),g(this,"projectData",null),g(this,"projectName",null),g(this,"unsaved",!1),g(this,"mustAbortJobs",!1),g(this,"activeComposition",null),g(this,"isCompositionReady",!1),h(this,"currentFrame",v,this),g(this,"currentFPS",1),g(this,"skippedFrames",0),g(this,"skippedWorkersFrames",0),g(this,"compositionDisplayZoom",50),g(this,"timelineZoom",0),g(this,"timelineScrollLeft",0),g(this,"timelineComponent",null),g(this,"getters",new getters(this)),g(this,"uiManager",null),g(this,"compositionManager",null),g(this,"libraryManager",null),g(this,"c_raycastManager",null),g(this,"renderersManager",null),g(this,"projectUtils",null),g(this,"playbackUtils",null),g(this,"toolbarUtils",null),g(this,"controlsUtils",null),g(this,"selectionUtils",null),g(this,"timelineUtils",null),g(this,"keyframesUtils",null)
g(this,"historyUtils",null),g(this,"selectionItemsUpdater",0),g(this,"selectionKeysUpdater",0),g(this,"clipBoardUpdater",0),g(this,"inputsUpdater",0),g(this,"currentTool",null),g(this,"isFilesSelectorOpen",!1),g(this,"isDemosListOpen",!1),g(this,"isProjectsListOpen",!1),g(this,"isNewProjectDialogOpen",!1),g(this,"isNewCompositionDialogOpen",!1),g(this,"isExportOpen",!1),g(this,"isShortcutsOpen",!1),g(this,"isFreeShapeEditorOpen",!1),g(this,"exportCompleted",!1),g(this,"contextLostDuringExport",!1),g(this,"usedExportSecondChance",!1),g(this,"minRenderZoom",.5),g(this,"iframeSrc","iframe/?v="+_appVersion),g(this,"workspace","landscape")
var e=this
"localhost"===location.hostname&&(e.iframeSrc="iframe/index.html"),_config.sentry&&(window._doSentry=e.doSentry),_keyboardUtils.setPointerToController(this),_autosaveUtils.setPointerToController(this),e.projectUtils=new projectUtils(this),e.playbackUtils=new playbackUtils(this),e.selectionUtils=new selectionUtils(this),e.timelineUtils=new timelineUtils(this),e.toolbarUtils=new toolbarUtils(this),e.controlsUtils=new controlsUtils(this),e.keyframesUtils=new keyframesUtils(this),e.historyUtils=new historyUtils(this),e.uiManager=new l.default(this),e.raycastManager=new u.default(this),_config.useRenderersManager&&(e.renderersManager=new m.default(this)),window.logProject=function(){var t=JSON.parse(JSON.stringify(e.projectData))
return void 0!==e.projectVariables&&(t.variables=JSON.parse(JSON.stringify(e.projectVariables))),t}}didTransition(e){var t=this
t.mustAbortJobs=!1,t.isFilesSelectorOpen=!1,t.isDemosListOpen=!1,t.isProjectsListOpen=!1,t.isNewProjectDialogOpen=!1,t.isNewCompositionDialogOpen=!1,t.isExportOpen=!1,t.currentTool=null
var o=null,n=structuredClone(_newProjectJson)
if(_config.isDebug){o="DEV project",n=_devProject
n=t.projectUtils.addMissingData(n)}(0,r.next)(function(){t.uiManager.resizeHandler(),t.startFullScreenAPI()
const r=t.fileHandler.getFile()
return r?(t.fileHandler.clearFile(),void t.projectUtils.openProjectFromDrop(r)):_demoProjectName?(t.openDemoProject(_demoProjectName),void(_demoProjectName=null)):void(e?_config.isDebug?(console.log("load dev project"),t.loadProject(n,o)):t.toggleProperty("isNewProjectDialogOpen"):t.projectUtils.openProject())})}willTransition(){var e=this
e.mustAbortJobs=!0,removeModal(),e.isCompositionReady&&e.closeProject()}emberSet(e,t,r){(0,o.set)(e,t,r)}doSentry(e,t=null){a.captureMessage(e,{extra:t})}get activeCompositionData(){return this.compositionManager?this.compositionManager.compositionData:(console.error("compositionManager is NULL"),null)}backToIndex(){console.log("back to index")
var e=this
e.controlsUtils&&(e.controlsUtils.eventsAdded=!1),e.router.transitionTo("index")}triggerSelectionItemsUpdater(){(0,o.set)(this,"selectionItemsUpdater",Math.random())}triggerClipoardUpdater(){console.log("** trigger clipboard Updater **"),(0,o.set)(this,"clipBoardUpdater",Math.random())}triggerRefreshInputsValues(){(0,o.set)(this,"inputsUpdater",Math.random())}addNewDialogVideoFile(e,t,o){gaEvent({event:"new composition from video"})
var r=o.file,n=r.name,i=o.properties,a=generateItemLibUid(e),l={name:n.split(".").slice(0,-1).join("."),type:"video",libUid:a,filename:n,width:i.width,height:i.height,duration:Math.floor(100*i.durationS)/100,filesize:r.size,audioTracks:i.audioTracks,nbAudioChannels:i.nbAudioChannels,compositionPropertiesFile:r}
e.library.push(l)
var s=new compositionsUtils(this,t)
s.addNewDialogVideoToComposition(l),s=null}createNewProject(e,t,o){gaEvent({event:"new project"}),gaEvent({event:"new comp "+t.cameraType})
var r=e.projectUtils.createNewProjectData(t)
if(o){var n=r.compositions[0]
e.addNewDialogVideoFile(r,n,o)}e.loadProject(r,"new project")}createNewComposition(e,t,r){gaEvent({event:"new comp "+t.cameraType})
var n=e.projectData,i=!1
"3D"==t.cameraType&&(i=!0)
var a=structuredClone(_newCompositionJson)
a.uid=generateCompositionUid(n),a.name="composition "+(n.compositions.length+1),a.frameRate=t.frameRate,a.cameraType=t.cameraType,a.settings.grid.enabled=i,a.dimensions=t.dimensions,a.time.end=t.duration_frames-1,a.time.end<1&&(a.time.end=1)
var l=[...n.compositions,a];(0,o.set)(e.projectData,"compositions",l)
var s=(n=e.projectData).compositions.length-1
e.setActiveComposition(s),e.needSaving()}async openDemoProject(e){console.log("* * open demo:",e),gaEvent({event:"open demo | "+e})
var t="demos/"+e+".pikimov"
try{const r=await fetch(t)
let n=await r.text()
var o=JSON.parse(n);(o=this.projectUtils.addMissingData(o)).isDemo=!0,this.loadProject(o,e)}catch(r){console.log(r),alert("Failed to load demo project")}}async loadProject(e,t){var n=this
function i(){(0,r.next)(function(){(0,o.set)(n,"projectName",t),(0,o.set)(n,"projectData",e),_config.isDebug&&(console.log("- - project json data - -"),console.log(n.projectData)),_cDotData=n.projectData,n.libraryManager=new c.default(n),n.libraryManager.loadProjectLibrary()})}console.log("* * load project * *"),startLoading(),await n.closeProject(),_usage.nbRenderers=0,_config.features.expressions?window._moduleExpressionsLoaded||window._moduleExpressionsLoading?i():(window._moduleExpressionsLoading=!0,Module().then(function(e){window._moduleExpressions=e,e.ccall("credits"),window._moduleExpressionsLoading=!1,window._moduleExpressionsLoaded=!0,i()})):i()}setActiveComposition(e){var t=this
startLoading()
var n=!1
t.activeComposition||(n=!0),t.closeActiveComposition(),(0,o.set)(t,"activeComposition",t.projectData.compositions[e]),t.uiManager.setInitialZoom(),t.currentFrame=0,t.historyUtils.clearHistory(),(0,r.next)(function(){t.initCompositionManager(),t.selectionUtils.holdFirstItem(),n&&t.uiManager.setBestGrid(),t.addToHistory("composition","open composition")})}async closeProject(){var e=this
await e.projectUtils.closeProject(),e.closeActiveComposition(),e.libraryManager&&(e.libraryManager.destroyItems(),e.libraryManager=null),e.projectName=null,(0,o.set)(e,"projectData",null),(0,o.set)(e,"timelineZoom",0),_cDotData=null,e.needSaving(!1)}closeActiveComposition(){var e=this
e.setCompositionReadyFlag(!1),(0,o.set)(e,"activeComposition",null),e.compositionManager&&(e.compositionManager.close(),e.playbackUtils.stop(),e.selectionUtils.clearSelection(),e.compositionManager=null,e.toolbarUtils.setTool(null),e.renderersManager&&e.renderersManager.destroyAllRenderers())}initCompositionManager(){var e=this
console.log("- - build"),console.time("- - build"),e.set("skippedFrames",0),e.set("skippedWorkersFrames",0),(0,o.set)(e,"compositionManager",new s.default(e,e.activeComposition,0)),e.compositionManager.isActive=!0,document.getElementById("compositionCanvas").remove()
var t=document.createElement("canvas")
t.id="compositionCanvas"
document.getElementById("overCanvas").prepend(t),e.compositionManager.load(t),e.raycastManager.eventsAdded=!1,e.raycastManager.addCanvasMouseEvents(e.compositionManager.canvas)
e.compositionManager.buildComposition(function(){(0,r.next)(function(){console.timeEnd("- - build"),e.onCompositionItemsReady()})})}onCompositionItemsReady(){var e=this.compositionManager
"3D"==e.cameraType&&(this.controlsUtils.createTransformControls(),(0,o.set)(e.renderEngine,"activeView","editor"),e.setView("editor")),stopLoading()}setCompositionReadyFlag(e=!0){console.warn("comp ready =>",e),this.isCompositionReady!=e&&(0,o.set)(this,"isCompositionReady",e)}restartRender(){this.compositionManager.enableRendering(),this.compositionManager.setFrame(0)}stopRender(){this.compositionManager.disableRendering(),this.playbackUtils.stop()}setFrame(e){var t=this
if(e<0&&(e=0),t.activeComposition){var r=t.getters.getCompositionNbFrames(t.activeComposition)
e>=r&&(e=r-1)}(0,o.set)(t,"currentFrame",e),t.compositionManager.isReady&&!t.compositionManager.isExporting&&t.refreshAndRender()}refreshComposition(){console.warn("OBS - refreshComposition"),this.refreshAndRender()}refreshAndRender(){var e=this
e.compositionManager.refreshComposition(e.currentFrame),e.timelineComponent.refreshCurveEditor(),e.compositionManager.requestRender()}refreshAndSelect(){console.log("* refreshAndSelect *"),this.compositionManager.renderEngine.disposeFinalComposer(),this.refreshAndRender()}rebuildTimelineComponent(){var e=this
console.log("rebuild TimelineComponent"),e.setCompositionReadyFlag(!1),requestAnimationFrame(function(){e.setCompositionReadyFlag(!0),requestAnimationFrame(function(){e.uiManager.resizeHandler(),e.selectionUtils.updateDom()})})}setCompositionDisplayZoom(e){e<12.5&&(e=12.5),e>400&&(e=400),(0,o.set)(this,"compositionDisplayZoom",e),e>100?$("#compositionCanvas").addClass("pixelated"):$("#compositionCanvas").removeClass("pixelated"),this.compositionManager.resizeCanvas()}deleteSelection(e){var t=this,o=t.selectionUtils.selectionArray
if("keyframes"==e&&o.keys.length&&(console.log("delete keys"),t.keyframesUtils.deleteKeys(o.keys),t.selectionUtils.clearKeysSelection()),"items"==e){if(0==t.selectionUtils.getNbItemsSelected())return
t.deleteSelectedItems()}}deleteSelectedItems(){var e=this.selectionUtils.selectionArray.items
this.deleteItems(e)}deleteItems(e){var t=this
function o(e){var r=!0,n=t.getters.getSceneItemByCompUid(t.compositionManager,e)
return!!n&&(n.getChildren().forEach(function(e){r&&(r=o(e.compUid))}),"camera"==n.type&&(r=!1),"cameraTarget"==n.type&&(r=!1),!!r&&(t.compositionManager.removeItemByCompUid(e),!0))}console.log("delete items x",e.length),e.forEach(function(e){o(e.compUid)})
var r=new compositionsUtils(t,t.activeComposition)
r.rebuildSoft(),r=null,t.selectionUtils.clearItemsSelection(!1),t.addToHistory("composition","delete item(s)")}addToHistory(e,t,o={}){!0===o&&(console.log("OBS - addToHistory true: ",t),o={needRebuild:!0}),this.historyUtils.addToHistory(e,t,o)}updateTimeline(){this.timelineComponent.rebuild()}needSaving(e=!0){this.unsaved!=e&&this.set("unsaved",e)}reopenComposition(){var e=this,t=e.activeComposition.uid,r=e.currentFrame
e.closeActiveComposition()
var n=e.getters.getCompositionByUid(e.projectData,t);(0,o.set)(e,"activeComposition",n),e.currentFrame=r,e.initCompositionManager()}closeAllmenus(){this.removeContextMenusDom(),(0,o.set)(this.timelineComponent,"isAddItemSelectorOpen",!1)}removeContextMenusDom(){var e=document.getElementById("contextMenu")
e&&e.remove(),(e=document.getElementById("keyGhost"))&&e.remove(),(e=document.getElementById("splitGhost"))&&e.remove()}closeExport(e=!0){var t=this
_exportedVideo&&_exportedVideo.src&&URL.revokeObjectURL(_exportedVideo.src),(0,o.set)(t,"isExportOpen",!1),e&&(startLoading(),t.reopenComposition(),t.setFrame(0))}onExportCompleted(e){console.log("on export complete",e)
var t=this
if(t.usedExportSecondChance&&(t.usedExportSecondChance=!1,gaEvent({event:"export - used 2nd chance"})),_exportedSequence){$("#download").hide()
var n=_exportedSequence.width+"  "+_exportedSequence.height+" px"
n+="\n\n"+_exportedSequence.nbImages+" images saved in '"+_exportedSequence.folder+"'",n+="\n \n",$("#exportVideoInfos").text(n)}if(_exportedVideo){_exportedVideo.src=webkitURL.createObjectURL(_exportedVideo.blob),document.getElementById("exportVideo")||console.Console.error("error dom exportVideo")
var i=$("#exportVideo")[0]
i.addEventListener("loadedmetadata",function(e){(0,r.next)(function(){if(!i)return
const e=i.getBoundingClientRect()
if(0!=e.width&&Math.floor(e.width)!=e.width){var t=Math.floor(e.width)+1
console.log("video size -> ",e.width,t),$("#exportVideo").css({minWidth:t+"px"})}})}),i.src=_exportedVideo.src,$("#exportVideo").show(),$("#exportVideo").focus()
n=_exportedVideo.width+"  "+_exportedVideo.height+" px"
n+=" @ "+_exportedVideo.frameRate+" fps",n+="\n"+_exportedVideo.fileSize+" KB",n+="\n"+_exportedVideo.videoCodec,_exportedVideo.videoBitrate&&(n+=" "+_exportedVideo.videoBitrate/1e6+" Mbps"),_exportedVideo.audioCodec&&(n+="\n"+_exportedVideo.audioCodec),$("#exportVideoInfos").text(n),$("#download").on("click",function(){gaEvent({event:"export mp4 - download"})})
var a=$("#download")[0]
a.href=_exportedVideo.src
var l=t.projectName,s="."+_exportedVideo.format
"c"!=e?(a.download=l+"_"+_exportedVideo.width+"_"+_exportedVideo.height+s,a.download=e+"_"+a.download):a.download=l+"_"+_exportedVideo.width+"_"+_exportedVideo.height+s
var c=$("#download_debug")[0]
c&&(c.href=_exportedVideo.src,c.download=l+"_"+_exportedVideo.width+"_"+_exportedVideo.height+"_"+_exportedVideo.videoBitrate/1e6+"M_"+_exportedVideo.videoCodec+".mp4")}setTimeout(function(){t.compositionManager.isExporting=!1,(0,o.set)(t,"exportCompleted",!0),$("#exportProgress").hide(),$("#exportCompleted").show()
var e="win-mixkit-ethereal-fairy-win-sound-2019.mp3",r=100*Math.random()
r>33&&(e="megaman2-victory.mp3"),r>66&&(e="zelda-item-fanfare.mp3")
var n=new Audio("audios/"+e)
n.volume=.6,n.play()},100)}preventDefault(){event.preventDefault()}dropFile(){var e=this
if(document.querySelector("#newProjectDialog"))return event.preventDefault(),!1
event.dataTransfer.types.includes("Files")&&(_config.isDebug&&console.log("dropping a file"),e.isCompositionReady&&e.libraryManager.dropFiles(event)),e.uiManager.dragEnd(),event.preventDefault()}startFullScreenAPI(){var e,t=this,o=!1
if(document.addEventListener("fullscreenchange",function(){var e=null
document.fullscreenElement&&(e=document.fullscreenElement.nodeName),e?($("#b_fullScreen").html('<i class="bx bx-exit-fullscreen"></i>exit'),o=!0):($("#b_fullScreen").html('<i class="bx bx-fullscreen"></i>full screen'),o=!1),t.uiManager.willChangeFullScreenState=!0}),document.fullscreenEnabled){$("#b_fullScreen").on("click",(e=document.documentElement,function(){if(o)document.exitFullscreen()
else{gaEvent({event:"full screen"})
var t=e.requestFullscreen()
t&&t.catch&&t.catch(function(e){console.log("Cannot acquire fullscreen mode: "+e)})}}))}}countWebGLContexts(e){_nbContexts+=e,_config.isDebug&&console.log("%c nb Contexts "+_nbContexts,"background: #602020; color: #ffe433")}clickPatreonButton(){event.stopPropagation(),gaEvent({event:"click patreon button"})}},d=y(p.prototype,"router",[n.service],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),f=y(p.prototype,"fileHandler",[n.service],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v=y(p.prototype,"currentFrame",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),y(p.prototype,"preventDefault",[o.action],Object.getOwnPropertyDescriptor(p.prototype,"preventDefault"),p.prototype),y(p.prototype,"dropFile",[o.action],Object.getOwnPropertyDescriptor(p.prototype,"dropFile"),p.prototype),p)}),define("pikimov/controllers/tests",["exports","@ember/controller","@ember/runloop"],function(e,t,o){function r(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class n extends t.default{constructor(){super(...arguments),r(this,"renderer",null),r(this,"scene",null),r(this,"camera",null),r(this,"canvas_width",800),r(this,"canvas_height",400),r(this,"objects",[])
var e=this
console.log("TESTS"),(0,o.next)(function(){e.doItAll()})}async doItAll(){var e=this
e.createRenderer(),await e.populateScene(),e.render()}createRenderer(){}async populateScene(){}render(){var e=this
e.renderer.clear(),e.renderer.render(e.scene,e.camera)}}e.default=n}),define("pikimov/controllers/ui",["exports","@ember/controller","@ember/object"],function(e,t,o){var r
function n(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function i(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(r=class extends t.default{constructor(){super(...arguments),n(this,"randomForPreview",123456),n(this,"ec",{projectFolder:"aaa/",data:{library:[]}}),n(this,"data",{name:"Dave",userName:"John Doe",itemPosition:"fixed",library:[],color:"#ff33cc",color2:"#ffb000",range:10,number:123,text:"txt lorem ipsum",longText:"txt lorem ipsum long text",uid:null,uid2:123,bgAlpha:60,bgColor:"#404040",textColor:"#ff33cc",png2:"aaa.png",radioData:{useImage:1,useImage2:1},checkboxData:{useImage:1},checkboxData2:{useImage:0},item:{},item2:{url:"aaa.jpg"},background:{fit:"cover"},singleSelectOptions:[{value:"Anna",name:"choose Anna"},{value:"Dave",name:"choose Dave"},{value:"Clment",name:"choose Clment"}],overlayData:{},materialType:"MeshBasicMaterial"}),n(this,"currentTool","removePoint"),n(this,"getters",null)
this.getters=new getters(this)}needSaving(){console.log("need saving")}editItem(e){console.log("ui.js edit item |",e)}editItemRange(){console.log("ui.js edit item range"),console.log(this.data.range)}editCheckBoxItem(e,t,r){console.log("ui.js checkbox item |",r),(0,o.set)(e,t,r),console.log(this.data.checkboxData.useImage),console.log(this.data.checkboxData2.useImage)}editRadioItem(e,t,r){console.log("ui.js radio item |",r),(0,o.set)(e,t,r),console.log("this.data.radioData.useImage",this.data.radioData.useImage)}editRadioItem2(e,t,r){console.log("ui.js radio item2 |",r),(0,o.set)(e,t,r),console.log(this.data.radioData.useImage2)}dragEnter(){}openLibrary(){console.log("open library")}deleteBackground(){}removeBackground(){console.log("removeBackground")}setBackgroundFit(e,t){console.log("set backgroudn fit",t),(0,o.set)(e,"fit",t)}setSelectValue(e,t,r){console.log("set select value |",r),(0,o.set)(e,t,r)}uploadFile(e){console.log("upload file"),console.log(e)}toolBarAction(){console.log("toolBarAction")}toggleTool(e){(0,o.set)(this,"currentTool",e)}},i(r.prototype,"needSaving",[o.action],Object.getOwnPropertyDescriptor(r.prototype,"needSaving"),r.prototype),i(r.prototype,"editItem",[o.action],Object.getOwnPropertyDescriptor(r.prototype,"editItem"),r.prototype),i(r.prototype,"editItemRange",[o.action],Object.getOwnPropertyDescriptor(r.prototype,"editItemRange"),r.prototype),i(r.prototype,"editCheckBoxItem",[o.action],Object.getOwnPropertyDescriptor(r.prototype,"editCheckBoxItem"),r.prototype),i(r.prototype,"editRadioItem",[o.action],Object.getOwnPropertyDescriptor(r.prototype,"editRadioItem"),r.prototype),i(r.prototype,"editRadioItem2",[o.action],Object.getOwnPropertyDescriptor(r.prototype,"editRadioItem2"),r.prototype),i(r.prototype,"dragEnter",[o.action],Object.getOwnPropertyDescriptor(r.prototype,"dragEnter"),r.prototype),i(r.prototype,"openLibrary",[o.action],Object.getOwnPropertyDescriptor(r.prototype,"openLibrary"),r.prototype),i(r.prototype,"deleteBackground",[o.action],Object.getOwnPropertyDescriptor(r.prototype,"deleteBackground"),r.prototype),i(r.prototype,"removeBackground",[o.action],Object.getOwnPropertyDescriptor(r.prototype,"removeBackground"),r.prototype),i(r.prototype,"setBackgroundFit",[o.action],Object.getOwnPropertyDescriptor(r.prototype,"setBackgroundFit"),r.prototype),i(r.prototype,"setSelectValue",[o.action],Object.getOwnPropertyDescriptor(r.prototype,"setSelectValue"),r.prototype),i(r.prototype,"uploadFile",[o.action],Object.getOwnPropertyDescriptor(r.prototype,"uploadFile"),r.prototype),i(r.prototype,"toolBarAction",[o.action],Object.getOwnPropertyDescriptor(r.prototype,"toolBarAction"),r.prototype),i(r.prototype,"toggleTool",[o.action],Object.getOwnPropertyDescriptor(r.prototype,"toggleTool"),r.prototype),r)}),define("pikimov/data-adapter",["exports","@ember-data/debug/data-adapter"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.default}})}),define("pikimov/helpers/app-version",["exports","@ember/component/helper","pikimov/config/environment","ember-cli-app-version/utils/regexp"],function(e,t,o,r){function n(e,t={}){const n=o.default.APP.version
let i=t.versionOnly||t.hideSha,a=t.shaOnly||t.hideVersion,l=null
return i&&(t.showExtended&&(l=n.match(r.versionExtendedRegExp)),l||(l=n.match(r.versionRegExp))),a&&(l=n.match(r.shaRegExp)),l?l[0]:n}Object.defineProperty(e,"__esModule",{value:!0}),e.appVersion=n,e.default=void 0
e.default=(0,t.helper)(n)}),define("pikimov/helpers/array-at",["exports","@ember/component/helper"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.helper)(function(e){return e[0][e[1]]})}),define("pikimov/helpers/css-font-family",["exports","@ember/component/helper","@ember/template"],function(e,t,o){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.helper)(function(e){var t=e[0]
return(0,o.htmlSafe)("font-family:'"+t+"';")})}),define("pikimov/helpers/eq",["exports","@ember/component/helper"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.helper)(function(e){return 2==e.length&&e[0]==e[1]||(4==e.length&&e[0]==e[1]&&e[2]==e[3]||6==e.length&&e[0]==e[1]&&e[2]==e[3]&&e[4]==e[5])})}),define("pikimov/helpers/excerpt",["exports","@ember/component/helper"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.helper)(function(e){var t=e[0],o=e[1]
return null==t?"":(t.length==o+1||t.length>o&&(t=t.substr(0,o)+"..."),t)})})
define("pikimov/helpers/file-tooltip",["exports","@ember/component/helper","@ember/template"],function(e,t,o){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.helper)(function(e){var t=e[0],r=t.name,n=t.filesize
return n&&(r+=n<2097152?" "+Math.floor(n/1024)+" KB":" "+Math.floor(n/1024/1024)+" MB"),t.frameRate&&(r+=" @"+t.frameRate+"fps"),t.nbAudioChannels&&(1==t.nbAudioChannels&&(r+=" | "+t.nbAudioChannels+" audio channel"),t.nbAudioChannels>1&&(r+=" | "+t.nbAudioChannels+" audio channels")),(0,o.htmlSafe)(r)})}),define("pikimov/helpers/format-duration",["exports","@ember/component/helper"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.helper)(function(e){if(void 0===e[0])return null
var t=e[0]
return formatSeconds(t)})}),define("pikimov/helpers/frame-to-time",["exports","@ember/component/helper","@ember/template"],function(e,t,o){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.helper)(function(e){var t=1e3*e[0]/e[1],r=parseInt(t/1e3/60)
t-=60*r*1e3
var n=parseInt(t/1e3),i=parseInt((t-1e3*n)/10)
return n<10&&(n="0"+n),i<10&&(i="0"+i),r>0?(0,o.htmlSafe)(r+":"+n+":"+i):(0,o.htmlSafe)(n+":"+i)})}),define("pikimov/helpers/get-config-feature",["exports","@ember/component/helper"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.helper)(function(e){var t=e[0]
return _config.features[t]})}),define("pikimov/helpers/get-config",["exports","@ember/component/helper"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.helper)(function(e){var t=e[0]
return _config[t]})}),define("pikimov/helpers/is-debug",["exports","@ember/component/helper"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.helper)(function(e){return 1==_config.isDebug})}),define("pikimov/helpers/lt",["exports","@ember/component/helper"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.helper)(function(e){return 1*e[0]<1*e[1]})}),define("pikimov/helpers/minus-one",["exports","@ember/component/helper"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.helper)(function(e){return parseInt(e[0])-1})}),define("pikimov/helpers/mt",["exports","@ember/component/helper"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.helper)(function(e){return void 0!==e[0]&&(null!==e[0]&&1*e[0]>1*e[1])})}),define("pikimov/helpers/neq",["exports","@ember/component/helper"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.helper)(function(e){return e[0]!=e[1]})}),define("pikimov/helpers/not-undefined",["exports","@ember/component/helper"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.helper)(function(e){return void 0!==e[0]})}),define("pikimov/helpers/page-title",["exports","ember-page-title/helpers/page-title"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.default}})}),define("pikimov/helpers/plus-one",["exports","@ember/component/helper"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.helper)(function(e){return parseInt(e[0])+1})}),define("pikimov/helpers/remove-seconds",["exports","@ember/component/helper","@ember/template"],function(e,t,o){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.helper)(function(e){var t=e[0].split(":").slice(0,2).join(":")
return(0,o.htmlSafe)(t)})}),define("pikimov/initializers/app-version",["exports","ember-cli-app-version/initializer-factory","pikimov/config/environment"],function(e,t,o){let r,n
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,o.default.APP&&(r=o.default.APP.name,n=o.default.APP.version)
e.default={name:"App Version",initialize:(0,t.default)(r,n)}}),define("pikimov/initializers/ember-data",["exports","@ember-data/request-utils/deprecation-support"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default={name:"ember-data",initialize(e){e.registerOptionsForType("serializer",{singleton:!1}),e.registerOptionsForType("adapter",{singleton:!1})}}}),define("pikimov/instance-initializers/sentry-performance",["exports","@sentry/ember/instance-initializers/sentry-performance"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(e,"initialize",{enumerable:!0,get:function(){return t.initialize}})}),define("pikimov/router",["exports","@ember/routing/router","pikimov/config/environment","@sentry/ember"],function(e,t,o,r){function n(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class i extends t.default{constructor(...e){super(...e),n(this,"location",o.default.locationType),n(this,"rootURL",o.default.rootURL)}}e.default=i,i.map(function(){function e(){$("#intro").remove()}if($("#splashScreen").hide(),$.fn.onClassChange=function(e){return $(this).each((t,o)=>{new MutationObserver(t=>{t.forEach(t=>e&&e(t.target,t.target.className))}).observe(o,{attributes:!0,attributeFilter:["class"]})})},$("html").onClassChange((e,t)=>{if("translated-ltr"==t){var o=$(e).attr("lang")
gaEvent({event:"translated to "+o.toUpperCase()})}}),_config.isDebug&&($("body").addClass("dev"),e()),_browser.mobile){e(),openModal({h2:"Pikimov is not for mobile devices",p:"To use Pikimov, visit pikimov.com on Chrome on a computer",buttons:!1})
var t=document.querySelector("#alertModal .text")
if(_browser.share){var o=document.createElement("span")
o.className="button",o.innerHTML='<i class="bx bxs-share-alt"></i>&nbsp;Share this link',$(o).css({fontSize:"13px",padding:"5px 10px",height:"auto"}),t.appendChild(o),$(o).on("click",function(){gaEvent({event:"tap share button"}),navigator.share({title:" Pikimov ",text:"Free motion design editor",url:"https://pikimov.com"}).then(function(){gaEvent({event:"shared on mobile"})}).catch(function(e){console.log("share api error"),console.log(e)})})}var n=document.createElement("div")
return n.innerHTML='<br><br><p>Follow Pikimov</p><p class="social"><a href="https://twitter.com/pikilipita" target="_blank"><img src="images/icon-x.svg" alt="x"></a><a href="https://bsky.app/profile/pikilipita.com" target="_blank"><img src="images/icon-bluesky.svg" alt="reddit"></a><a href="https://www.youtube.com/@pikimov" target="_blank"><img src="images/icon-youtube.svg" alt="youtube"></a><a href="https://www.tiktok.com/@pikilipita" target="_blank"><img src="images/icon-tiktok.svg" alt="tiktok"></a></p>',t.appendChild(n),$("#alertModal .text div p").css({marginBottom:"10px"}),$("#alertModal .social").css({whiteSpace:"normal"}),$("#alertModal .social a").css({display:"inline-block",padding:"4px",fontSize:"0",margin:"0 8px"}),void $("#alertModal .social img").css({height:"23px",width:"23px"})}var i=!1
null!==new URLSearchParams(window.location.search).get("allowfirefox")&&(console.log("-- Let Firefox pass --"),i=!0)
var a=_browser.name,l=!0
if(_config.isDebug&&(l=!1),l){if(!i&&"firefox"==a)return openModal({h2:"Oops!",p:"Unfortunately Pikimov cannot be used in Firefox.\n\nSeveral key features are currently missing from Firefox.\n\nPlease use Chrome or Edge for now",buttons:!1}),void e()
if("safari"==a)return openModal({h2:"Oops!",p:"Unfortunately Pikimov cannot be used in Safari.\n\nSeveral key features are missing from Safari.\n\nPlease use Chrome or Edge for now",buttons:!1}),void e()
if(i&&"firefox"==a);else{var s=!1
if("chrome"!=a&&"edge"!=a||(s=!0),"opera"==a&&"linux"!=_browser.os&&(s=!0),"opera"==a&&"linux"==_browser.os)return openModal({h2:"Opera is not yet supported on Linux",p:"Please use Chrome or Edge for now",buttons:!1}),void e()
if(!s)return openModal({h2:"This web browser is not yet supported ("+a+")",p:"Please use Chrome or Edge for now",buttons:!1}),void e()}}var c,u,m,p,d,f=128
return"chrome"==a&&_browser.version<f?(openModal({h2:"Browser version not supported",p:"Please update Chrome to version 128 minimum",buttons:!1}),void e()):"edge"==a&&_browser.version<f?(openModal({h2:"Browser version not supported",p:"Please update Edge to version 128 minimum",buttons:!1}),void e()):"opera"==a&&_browser.version<120?(openModal({h2:"Browser version not supported",p:"Please update Opera to version 120 minimum",buttons:!1}),void e()):_browser.webgl2?(_config.introMessage&&openModal({h2:_config.introMessage.h2,p:_config.introMessage.p}),c=$("#intro .redFull"),u=$("#intro .redLogo"),m=$("#intro .logo"),p=$("#intro .v"),d=0,d+=400,setTimeout(function(){c.css({right:0})},d),d+=500,setTimeout(function(){u.css({opacity:1}),c.css({left:"100%"})},d),d+=800,setTimeout(function(){m.css({filter:"invert(0)"}),u.css({boxShadow:"0 0 80px 0 #909090"}),p.css({display:"block"})},d),d+=50,setTimeout(function(){u.css({transition:"box-shadow .5s",boxShadow:"0 0 20px 0 transparent"}),p.css({width:"160px",left:"290px",top:"-90px",opacity:1}),$("#intro .since2024").css({opacity:1})},d),d+=2e3,setTimeout(function(){$("#intro").addClass("fadeOutIntro")},d),d+=1e3,setTimeout(function(){e()},d),this.route("project",{path:"/project"}),this.route("ui"),void(_config.isDebug&&(this.route("composer-tester"),this.route("tests"),this.route("curves-tester"),this.route("css3-tester"),this.route("alpha-tester")))):(openModal({h2:"Oops!",p:"Unfortunately you cannot use Pikimov on this web browser\n\n(missing webGL2 support)",buttons:!1}),_config.sentry&&r.captureMessage("No webGL2 support",{extra:{browser:_browser}}),e(),void gaEvent({event:"error - no webGL2"}))})}),define("pikimov/routes/alpha-tester",["exports","@ember/routing/route","@ember/object"],function(e,t,o){var r
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(r=class extends t.default{didTransition(){$("#splashScreen").hide()}},n=r.prototype,i="didTransition",a=[o.action],l=Object.getOwnPropertyDescriptor(r.prototype,"didTransition"),s=r.prototype,c={},Object.keys(l).forEach(function(e){c[e]=l[e]}),c.enumerable=!!c.enumerable,c.configurable=!!c.configurable,("value"in c||c.initializer)&&(c.writable=!0),c=a.slice().reverse().reduce(function(e,t){return t(n,i,e)||e},c),s&&void 0!==c.initializer&&(c.value=c.initializer?c.initializer.call(s):void 0,c.initializer=void 0),void 0===c.initializer&&Object.defineProperty(n,i,c),r)
var n,i,a,l,s,c}),define("pikimov/routes/composer-tester",["exports","@ember/routing/route","@ember/object"],function(e,t,o){var r
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(r=class extends t.default{didTransition(){$("#splashScreen").hide()}},n=r.prototype,i="didTransition",a=[o.action],l=Object.getOwnPropertyDescriptor(r.prototype,"didTransition"),s=r.prototype,c={},Object.keys(l).forEach(function(e){c[e]=l[e]}),c.enumerable=!!c.enumerable,c.configurable=!!c.configurable,("value"in c||c.initializer)&&(c.writable=!0),c=a.slice().reverse().reduce(function(e,t){return t(n,i,e)||e},c),s&&void 0!==c.initializer&&(c.value=c.initializer?c.initializer.call(s):void 0,c.initializer=void 0),void 0===c.initializer&&Object.defineProperty(n,i,c),r)
var n,i,a,l,s,c}),define("pikimov/routes/css3-tester",["exports","@ember/routing/route","@ember/object"],function(e,t,o){var r
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(r=class extends t.default{didTransition(){$("#splashScreen").hide()}},n=r.prototype,i="didTransition",a=[o.action],l=Object.getOwnPropertyDescriptor(r.prototype,"didTransition"),s=r.prototype,c={},Object.keys(l).forEach(function(e){c[e]=l[e]}),c.enumerable=!!c.enumerable,c.configurable=!!c.configurable,("value"in c||c.initializer)&&(c.writable=!0),c=a.slice().reverse().reduce(function(e,t){return t(n,i,e)||e},c),s&&void 0!==c.initializer&&(c.value=c.initializer?c.initializer.call(s):void 0,c.initializer=void 0),void 0===c.initializer&&Object.defineProperty(n,i,c),r)
var n,i,a,l,s,c}),define("pikimov/routes/curves-tester",["exports","@ember/routing/route","@ember/object"],function(e,t,o){var r
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(r=class extends t.default{didTransition(){$("#splashScreen").hide()}},n=r.prototype,i="didTransition",a=[o.action],l=Object.getOwnPropertyDescriptor(r.prototype,"didTransition"),s=r.prototype,c={},Object.keys(l).forEach(function(e){c[e]=l[e]}),c.enumerable=!!c.enumerable,c.configurable=!!c.configurable,("value"in c||c.initializer)&&(c.writable=!0),c=a.slice().reverse().reduce(function(e,t){return t(n,i,e)||e},c),s&&void 0!==c.initializer&&(c.value=c.initializer?c.initializer.call(s):void 0,c.initializer=void 0),void 0===c.initializer&&Object.defineProperty(n,i,c),r)
var n,i,a,l,s,c}),define("pikimov/routes/index",["exports","@ember/routing/route","@ember/object","@ember/service"],function(e,t,o,r){var n,i
function a(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function l(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(n=class extends t.default{constructor(...e){var t,o,r,n
super(...e),t=this,o="router",n=this,(r=i)&&Object.defineProperty(t,o,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0}),a(this,"innerHTML",null)}didTransition(){_config.sentry&&console.log("enter INDEX"),this.innerHTML&&($("#splashScreen").html(this.innerHTML),this.controllerFor("index").addClickEvents()),stopLoading(),$("#splashScreen").show()}willTransition(){_config.sentry&&console.log("leave INDEX"),this.innerHTML=$("#splashScreen").html(),$("#splashScreen").hide(),$("#splashScreen").html("")}},i=l(n.prototype,"router",[r.service],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),l(n.prototype,"didTransition",[o.action],Object.getOwnPropertyDescriptor(n.prototype,"didTransition"),n.prototype),l(n.prototype,"willTransition",[o.action],Object.getOwnPropertyDescriptor(n.prototype,"willTransition"),n.prototype),n)}),define("pikimov/routes/project",["exports","@ember/routing/route","@ember/object","@ember/service"],function(e,t,o,r){var n,i
function a(e,t,o,r,n){var i={}
return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce(function(o,r){return r(e,t,o)||o},i),n&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(n):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(n=class extends t.default{constructor(...e){var t,o,r,n
super(...e),t=this,o="router",n=this,(r=i)&&Object.defineProperty(t,o,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})}model(e){}didTransition(){this.controllerFor("project").didTransition(_isNewProject)}willTransition(){_config.sentry&&console.log("leave PROJECT"),this.controllerFor("project").willTransition()}},i=a(n.prototype,"router",[r.service],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a(n.prototype,"didTransition",[o.action],Object.getOwnPropertyDescriptor(n.prototype,"didTransition"),n.prototype),a(n.prototype,"willTransition",[o.action],Object.getOwnPropertyDescriptor(n.prototype,"willTransition"),n.prototype),n)}),define("pikimov/routes/tests",["exports","@ember/routing/route","@ember/object"],function(e,t,o){var r
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(r=class extends t.default{didTransition(){$("#splashScreen").hide()}},n=r.prototype,i="didTransition",a=[o.action],l=Object.getOwnPropertyDescriptor(r.prototype,"didTransition"),s=r.prototype,c={},Object.keys(l).forEach(function(e){c[e]=l[e]}),c.enumerable=!!c.enumerable,c.configurable=!!c.configurable,("value"in c||c.initializer)&&(c.writable=!0),c=a.slice().reverse().reduce(function(e,t){return t(n,i,e)||e},c),s&&void 0!==c.initializer&&(c.value=c.initializer?c.initializer.call(s):void 0,c.initializer=void 0),void 0===c.initializer&&Object.defineProperty(n,i,c),r)
var n,i,a,l,s,c}),define("pikimov/routes/ui",["exports","@ember/routing/route","@ember/object"],function(e,t,o){var r
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(r=class extends t.default{didTransition(){$("#splashScreen").hide()}},n=r.prototype,i="didTransition",a=[o.action],l=Object.getOwnPropertyDescriptor(r.prototype,"didTransition"),s=r.prototype,c={},Object.keys(l).forEach(function(e){c[e]=l[e]}),c.enumerable=!!c.enumerable,c.configurable=!!c.configurable,("value"in c||c.initializer)&&(c.writable=!0),c=a.slice().reverse().reduce(function(e,t){return t(n,i,e)||e},c),s&&void 0!==c.initializer&&(c.value=c.initializer?c.initializer.call(s):void 0,c.initializer=void 0),void 0===c.initializer&&Object.defineProperty(n,i,c),r)
var n,i,a,l,s,c}),define("pikimov/services/file-handler",["exports","@ember/service"],function(e,t){function o(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e
var o=e[Symbol.toPrimitive]
if(void 0!==o){var r=o.call(e,t||"default")
if("object"!=typeof r)return r
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string")
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{constructor(...e){super(...e),o(this,"file",null)}setFile(e){this.file=e}getFile(){return this.file}clearFile(){this.file=null}}e.default=r}),define("pikimov/services/page-title",["exports","ember-page-title/services/page-title"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.default}})}),define("pikimov/services/store",["exports","@ember/debug","ember-data/store"],function(e,t,o){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return o.default}})}),define("pikimov/templates/alpha-tester",["exports","@ember/template-factory"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.createTemplateFactory)({id:"vf3Y3uWT",block:'[[[10,0],[14,1,"composerTester"],[14,5,"padding:5px;"],[12],[1,"\\n\\n    "],[10,"h2"],[12],[1,"alpha tester"],[13],[1,"\\n\\n    "],[10,0],[12],[1,"\\n        "],[10,"canvas"],[14,1,"canvas"],[12],[13],[1,"\\n    "],[13],[1,"\\n\\n    "],[10,"img"],[14,"src","images/alpha-test-ref.png"],[12],[13],[1,"\\n\\n    "],[10,0],[14,1,"yoyo"],[12],[13],[1,"\\n\\n"],[13],[1,"\\n"]],[],["div","h2","canvas","img"]]',moduleName:"pikimov/templates/alpha-tester.hbs",isStrictMode:!1})})
define("pikimov/templates/application",["exports","@ember/template-factory"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.createTemplateFactory)({id:"cE9o7hNx",block:'[[[10,0],[14,0,"app"],[12],[1,"\\n"],[46,[28,[37,2],null,null],null,null,null],[1,"\\n"],[13],[1,"\\n\\n"],[10,0],[14,1,"loading"],[12],[1,"\\n    "],[10,0],[14,1,"innerLoading"],[12],[1,"\\n        "],[10,0],[14,0,"spinner"],[12],[13],[1,"\\n        "],[10,2],[14,0,"percent"],[12],[13],[1,"\\n    "],[13],[1,"\\n"],[13],[1,"\\n\\n"],[10,0],[14,1,"notifications"],[12],[13],[1,"\\n"]],[],["div","component","-outlet","p"]]',moduleName:"pikimov/templates/application.hbs",isStrictMode:!1})}),define("pikimov/templates/composer-tester",["exports","@ember/template-factory"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.createTemplateFactory)({id:"MW9rrnan",block:'[[[10,0],[14,1,"composerTester"],[12],[1,"\\n\\n    "],[10,"h2"],[12],[1,"composer tester"],[13],[1,"\\n\\n    "],[10,0],[12],[1,"\\n        "],[10,"canvas"],[14,1,"canvas"],[12],[13],[1,"\\n    "],[13],[1,"\\n\\n"],[13],[1,"\\n"]],[],["div","h2","canvas"]]',moduleName:"pikimov/templates/composer-tester.hbs",isStrictMode:!1})}),define("pikimov/templates/css3-tester",["exports","@ember/template-factory"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.createTemplateFactory)({id:"ZWChqPt3",block:'[[[10,0],[14,1,"videoTester"],[12],[1,"\\n\\n    "],[10,"h2"],[12],[1,"css3 tester"],[13],[1,"\\n\\n    "],[10,0],[14,1,"container"],[12],[13],[1,"\\n\\n"],[13],[1,"\\n"]],[],["div","h2"]]',moduleName:"pikimov/templates/css3-tester.hbs",isStrictMode:!1})}),define("pikimov/templates/curves-tester",["exports","@ember/template-factory"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.createTemplateFactory)({id:"SHaEGcXG",block:'[[[1,"\\n"],[10,0],[14,1,"videoTester"],[14,5,"background:#404040;"],[12],[1,"\\n\\n    "],[10,"h2"],[12],[1,"curves tester"],[13],[1,"\\n\\n    "],[10,0],[14,1,"container"],[12],[1,"\\n\\n        "],[10,"br"],[12],[13],[1,"\\n        "],[10,"svg"],[14,1,"path1"],[14,"width","100"],[14,"height","100"],[14,"xmlns","http://www.w3.org/2000/svg","http://www.w3.org/2000/xmlns/"],[12],[1,"\\n\\n            "],[10,"line"],[14,"x1","50"],[14,"x2","50"],[14,"y1","10"],[14,"y2","90"],[14,"stroke","#aaaaaa"],[14,"stroke-width","1"],[12],[13],[1,"\\n\\n            "],[10,"path"],[14,"d","M 10 20 C 110 30, 40 120, 130 140"],[14,"stroke","white"],[14,"fill","transparent"],[12],[13],[1,"\\n\\n            "],[10,"line"],[14,0,"bar1"],[14,"x1","10"],[14,"x2","50"],[14,"y1","10"],[14,"y2","50"],[14,"stroke","#aaaaaa"],[14,"stroke-width","1"],[12],[13],[1,"\\n            "],[10,"rect"],[14,0,"handle1"],[14,"x","10"],[14,"y","10"],[14,"width","10"],[14,"height","10"],[14,"fill","red"],[12],[13],[1,"\\n\\n            "],[10,"line"],[14,0,"bar2"],[14,"x1","10"],[14,"x2","50"],[14,"y1","10"],[14,"y2","50"],[14,"stroke","#aaaaaa"],[14,"stroke-width","1"],[12],[13],[1,"\\n            "],[10,"rect"],[14,0,"handle2"],[14,"x","50"],[14,"y","50"],[14,"width","10"],[14,"height","10"],[14,"fill","blue"],[12],[13],[1,"\\n        "],[13],[1,"\\n\\n        "],[10,"label"],[14,1,"value50"],[14,5,"color:black;"],[12],[1,"xx"],[13],[1,"\\n\\n        "],[10,"br"],[12],[13],[1,"\\n\\n        "],[10,0],[14,1,"curvesEditor"],[12],[13],[1,"\\n\\n    "],[13],[1,"\\n\\n"],[13]],[],["div","h2","br","svg","line","path","rect","label"]]',moduleName:"pikimov/templates/curves-tester.hbs",isStrictMode:!1})}),define("pikimov/templates/index",["exports","@ember/template-factory"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.createTemplateFactory)({id:"WDcFzU9n",block:'[[[10,0],[14,1,"index"],[12],[13],[1,"\\n"]],[],["div"]]',moduleName:"pikimov/templates/index.hbs",isStrictMode:!1})}),define("pikimov/templates/project",["exports","@ember/template-factory"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.createTemplateFactory)({id:"8xx+Q4wr",block:'[[[11,"section"],[24,1,"project"],[16,0,[29,[[30,0,["workspace"]]]]],[4,[38,1],["dragenter",[30,0,["preventDefault"]]],null],[4,[38,1],["dragover",[30,0,["preventDefault"]]],null],[4,[38,1],["drop",[30,0,["dropFile"]]],null],[12],[1,"\\n\\n    "],[8,[39,2],null,[["@controller"],[[30,0]]],null],[1,"\\n\\n"],[41,[28,[37,4],[[30,0,["workspace"]],"landscape"],null],[[[1,"\\n        "],[10,0],[14,1,"projectTop"],[12],[1,"\\n\\n            "],[8,[39,6],null,[["@controller"],[[30,0]]],null],[1,"\\n\\n            "],[8,[39,7],null,[["@controller"],[[30,0]]],null],[1,"\\n\\n            "],[8,[39,8],null,[["@controller"],[[30,0]]],null],[1,"\\n\\n            "],[10,0],[14,1,"yoyo"],[12],[1,"\\n                "],[10,"iframe"],[15,"src",[29,[[30,0,["iframeSrc"]]]]],[12],[13],[1,"\\n            "],[13],[1,"\\n        "],[13],[1,"\\n\\n        \\n"],[41,[30,0,["isCompositionReady"]],[[[1,"            "],[8,[39,10],null,[["@controller"],[[30,0]]],null],[1,"\\n"]],[]],null],[1,"\\n"]],[]],null],[1,"\\n\\n\\n"],[41,[28,[37,4],[[30,0,["workspace"]],"portrait"],null],[[[1,"\\n        "],[10,0],[14,1,"workspace"],[12],[1,"\\n            "],[10,0],[14,1,"projectLeft"],[12],[1,"\\n\\n                "],[8,[39,7],null,[["@controller"],[[30,0]]],null],[1,"\\n                \\n            "],[13],[1,"\\n\\n            "],[10,0],[14,0,"resizer-v"],[12],[13],[1,"\\n            "],[10,0],[14,1,"projectRight"],[12],[1,"\\n\\n                "],[10,0],[14,1,"columns"],[12],[1,"\\n                    "],[8,[39,6],null,[["@controller"],[[30,0]]],null],[1,"\\n\\n                    "],[8,[39,8],null,[["@controller"],[[30,0]]],null],[1,"\\n\\n                    "],[10,0],[14,1,"yoyo"],[12],[1,"\\n                        "],[10,"iframe"],[15,"src",[29,[[30,0,["iframeSrc"]]]]],[12],[13],[1,"\\n                    "],[13],[1,"\\n                "],[13],[1,"\\n\\n"],[41,[30,0,["isCompositionReady"]],[[[1,"                    "],[8,[39,10],null,[["@controller"],[[30,0]]],null],[1,"\\n"]],[]],null],[1,"            "],[13],[1,"\\n        \\n        "],[13],[1,"\\n\\n"]],[]],null],[1,"\\n\\n"],[41,[28,[37,4],[[30,0,["currentTool"]],"motionTracking"],null],[[[1,"        "],[8,[39,11],null,[["@controller"],[[30,0]]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[28,[37,4],[[30,0,["currentTool"]],"transcribe"],null],[[[1,"        "],[8,[39,12],null,[["@controller"],[[30,0]]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[28,[37,4],[[30,0,["currentTool"]],"removeBg"],null],[[[1,"        "],[8,[39,13],null,[["@controller"],[[30,0]]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[28,[37,4],[[30,0,["currentTool"]],"depthEstimation"],null],[[[1,"        "],[8,[39,14],null,[["@controller"],[[30,0]]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["isFilesSelectorOpen"]],[[[1,"        "],[8,[39,15],null,[["@controller"],[[30,0]]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["isDemosListOpen"]],[[[1,"        "],[8,[39,16],null,[["@controller"],[[30,0]]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["isProjectsListOpen"]],[[[1,"        "],[8,[39,17],null,[["@controller"],[[30,0]]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["isNewProjectDialogOpen"]],[[[1,"        "],[8,[39,18],null,[["@controller","@what","@title","@createAction"],[[30,0],"project","New project",[30,0,["createNewProject"]]]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["isNewCompositionDialogOpen"]],[[[1,"        "],[8,[39,18],null,[["@controller","@what","@title","@createAction"],[[30,0],"composition","New composition",[30,0,["createNewComposition"]]]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["isExportOpen"]],[[[1,"        "],[8,[39,19],null,[["@controller"],[[30,0]]],null],[1,"\\n"]],[]],null],[1,"\\n"],[13],[1,"\\n"]],[],["section","on","project/main-header/main-header","if","eq","div","project/left-column","project/composition/composition","project/right-column","iframe","project/timeline/timeline","project/tools/motion-tracking","project/tools/transcribe","project/tools/remove-bg","project/tools/depth-estimation","project/open/files-locator","project/demos/demos","project/open/open","project/new/new","project/export/settings"]]',moduleName:"pikimov/templates/project.hbs",isStrictMode:!1})}),define("pikimov/templates/tests",["exports","@ember/template-factory"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.createTemplateFactory)({id:"7bVJnFV7",block:'[[[1,"\\n"],[10,0],[14,1,"composerTester"],[14,5,"background:#707070;"],[12],[1,"\\n\\n    "],[10,"h2"],[12],[1,"tests"],[13],[1,"\\n\\n    "],[10,0],[12],[1,"\\n        "],[10,"canvas"],[14,1,"canvas"],[12],[13],[1,"\\n    "],[13],[1,"\\n\\n    "],[10,0],[14,1,"drawing"],[12],[13],[1,"\\n\\n"],[13],[1,"\\n"]],[],["div","h2","canvas"]]',moduleName:"pikimov/templates/tests.hbs",isStrictMode:!1})}),define("pikimov/templates/ui",["exports","@ember/template-factory"],function(e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.createTemplateFactory)({id:"fgD2TzR5",block:'[[[10,0],[14,1,"ui_page_test"],[12],[1,"\\n\\n"],[1,"\\n"],[10,0],[12],[1,"\\n"],[1,"\\n    "],[8,[39,1],null,[["@title"],["Property title"]],null],[1,"\\n    "],[8,[39,1],null,null,[["default"],[[[[1,"Property title with yield"]],[]]]]],[1,"\\n\\n    "],[8,[39,1],null,[["@title","@checkbox","@obj","@objProperty","@valueToTrackBoolean","@action"],["Property title with toggle",true,[30,0,["data","checkboxData"]],"useImage",[30,0,["data","checkboxData","useImage"]],[30,0,["editCheckBoxItem"]]]],null],[1,"\\n\\n    "],[8,[39,2],null,[["@label"],["property just label"]],null],[1,"\\n\\n    "],[8,[39,2],null,[["@type","@placeholder","@maxlength","@value","@action"],["text","property no nabel",10,null,[30,0,["editItem"]]]],null],[1,"\\n\\n    "],[8,[39,3],null,[["@label","@value","@min","@max","@action"],["property range",[30,0,["data","range"]],0,100,[30,0,["editItemRange"]]]],null],[1,"\\n\\n    "],[8,[39,4],null,null,null],[1,"\\n\\n    "],[8,[39,3],null,[["@label","@value","@min","@max","@action","@toolTip"],["property with tooltip",[30,0,["data","range"]],0,100,[30,0,["editItemRange"]],"lorem ipsum"]],null],[1,"\\n\\n    "],[8,[39,3],null,[["@label","@value","@min","@max","@action","@displayValue"],["property range with value",[30,0,["data","range"]],0,200,[30,0,["editItemRange"]],true]],null],[1,"\\n\\n    "],[8,[39,3],null,[["@label","@value","@min","@max","@step","@action","@displayValue"],["property range with step",[30,0,["data","range"]],0,200,25,[30,0,["editItemRange"]],true]],null],[1,"\\n\\n    "],[8,[39,3],null,[["@label","@value","@min","@max","@action","@displayValue","@unit"],["prop.range with value + unit",[30,0,["data","range"]],0,200,[30,0,["editItemRange"]],true,"cm"]],null],[1,"\\n\\n    "],[8,[39,3],null,[["@label","@value","@min","@max","@action","@displayInput"],["property range with input",[30,0,["data","range"]],0,100,[30,0,["editItemRange"]],true]],null],[1,"\\n\\n    "],[8,[39,3],null,[["@label","@value","@min","@max","@minRangeInput","@maxRangeInput","@action","@displayInput"],["minRangeInput + maxRangeInput",[30,0,["data","range"]],0,100,10,90,[30,0,["editItemRange"]],true]],null],[1,"\\n\\n    "],[8,[39,3],null,[["@label","@value","@min","@max","@action","@displayInput","@disabled"],["property range disabled",[30,0,["data","range"]],0,100,[30,0,["editItemRange"]],true,true]],null],[1,"\\n\\n    "],[8,[39,3],null,[["@label","@value","@min","@max","@minRangeInput","@maxRangeInput","@displayInput","@action","@noGrid","@unit"],["property range noGrid",[30,0,["data","range"]],0,100,0,200,true,[30,0,["editItemRange"]],true,"px"]],null],[1,"\\n\\n    "],[10,"br"],[12],[13],[1,"\\n    __"],[1,[30,0,["data","number"]]],[1,"__\\n    "],[10,"br"],[12],[13],[1,"\\n    \\n    "],[8,[39,6],null,[["@label","@obj","@property","@min","@max","@action"],["property number",[30,0,["data"]],"number",0,100,[30,0,["editItem"]]]],null],[1,"\\n\\n    "],[8,[39,6],null,[["@label","@obj","@property","@min","@max","@unit","@action"],["property number with unit",[30,0,["data"]],"number",0,100,"px",[30,0,["editItem"]]]],null],[1,"\\n\\n"],[1,"    "],[8,[39,6],null,[["@obj","@property","@min","@max","@unit","@action"],[[30,0,["data"]],"number",0,100,"px",[30,0,["editItem"]]]],null],[1,"\\n\\n    "],[8,[39,6],null,[["@label","@obj","@property","@min","@max","@unit","@disabled","@action"],["property number disabled",[30,0,["data"]],"number",0,100,"px",true,[30,0,["editItem"]]]],null],[1,"\\n\\n    "],[10,0],[14,0,"properties_x2"],[12],[1,"\\n        "],[8,[39,6],null,[["@label","@obj","@property","@min","@max","@action"],["property x2 number",[30,0,["data"]],"number",0,100,[30,0,["editItem"]]]],null],[1,"\\n        "],[10,"label"],[12],[1,"x"],[13],[1,"\\n        "],[8,[39,6],null,[["@obj","@property","@min","@max","@action"],[[30,0,["data"]],"number",0,100,[30,0,["editItem"]]]],null],[1,"\\n        "],[10,"label"],[14,0,"unit"],[12],[1," px"],[13],[1,"\\n    "],[13],[1,"\\n\\n    "],[10,0],[14,0,"properties_x2"],[12],[1,"\\n        "],[8,[39,6],null,[["@label","@obj","@property","@min","@max","@action"],["property x2 number",[30,0,["data"]],"number",0,100,[30,0,["editItem"]]]],null],[1,"\\n        "],[10,"label"],[12],[1,"x"],[13],[1,"\\n        "],[8,[39,6],null,[["@obj","@property","@min","@max","@action"],[[30,0,["data"]],"number",0,100,[30,0,["editItem"]]]],null],[1,"\\n    "],[13],[1,"\\n\\n    "],[10,0],[14,0,"properties_x3"],[12],[1,"\\n        "],[8,[39,6],null,[["@label","@obj","@property","@min","@max","@action"],["property x3 number",[30,0,["data"]],"number",0,100,[30,0,["editItem"]]]],null],[1,"\\n        "],[10,"label"],[12],[1,"x"],[13],[1,"\\n        "],[8,[39,6],null,[["@obj","@property","@min","@max","@action"],[[30,0,["data"]],"number",0,100,[30,0,["editItem"]]]],null],[1,"\\n        "],[10,"label"],[12],[1,"x"],[13],[1,"\\n        "],[8,[39,6],null,[["@obj","@property","@min","@max","@action"],[[30,0,["data"]],"number",0,100,[30,0,["editItem"]]]],null],[1,"\\n        "],[10,"label"],[14,0,"unit"],[12],[1," px"],[13],[1,"\\n    "],[13],[1,"\\n\\n    "],[8,[39,2],null,[["@type","@label","@placeholder","@value","@action"],["text","property text","the place holder",[30,0,["data","text"]],[30,0,["editItem"]]]],null],[1,"\\n\\n    "],[8,[39,2],null,[["@type","@label","@placeholder","@maxlength","@value","@action"],["text","p. text max length 10","the place holder",10,[30,0,["data","text"]],[30,0,["editItem"]]]],null],[1,"\\n\\n    "],[8,[39,2],null,[["@type","@label","@placeholder","@disabled","@value","@action"],["text","p. txt disabled","the place holder",true,[30,0,["data","text"]],[30,0,["editItem"]]]],null],[1,"\\n\\n    "],[8,[39,2],null,[["@type","@label","@maxlength","@placeholder","@value","@action","@long"],["text","property long text",30,"the place holder",[30,0,["data","text"]],[30,0,["editItem"]],true]],null],[1,"\\n\\n    "],[8,[39,2],null,[["@type","@label","@maxlength","@placeholder","@value","@action"],["textarea","property textarea",150,"the place holder textarea",[30,0,["data","longText"]],[30,0,["editItem"]]]],null],[1,"\\n\\n"],[13],[1,"\\n\\n\\n\\n\\n"],[10,0],[12],[1,"\\n\\n    "],[8,[39,8],null,[["@note"],["1: no smoothing, 5: very smooth\\n        (use smoothing if the composition is shaking too much)"]],null],[1,"\\n\\n    "],[8,[39,8],null,null,[["default"],[[[[1,"yield 1: no smoothing, 5: very smooth\\n        (use smoothing if the composition is shaking too much)\\n    "]],[]]]]],[1,"\\n\\n    "],[8,[39,9],null,[["@label","@value","@action"],["property color",[30,0,["data","color"]],[30,0,["editItem"]]]],null],[1,"\\n\\n    "],[8,[39,9],null,[["@label","@value","@action","@subProperty"],["sub property color",[30,0,["data","color"]],[30,0,["editItem"]],true]],null],[1,"\\n\\n\\n    "],[8,[39,9],null,[["@label","@value","@value2","@action"],["property color x2",[30,0,["data","color"]],[30,0,["data","color2"]],[30,0,["editItem"]]]],null],[1,"\\n\\n    "],[8,[39,10],null,[["@label","@labelCheck1","@labelCheck2","@obj","@objProperty","@valueToTrackBoolean","@action"],["property toggle","yes","no",[30,0,["data","checkboxData"]],"useImage",[30,0,["data","checkboxData","useImage"]],[30,0,["editCheckBoxItem"]]]],null],[1,"\\n\\n    "],[8,[39,10],null,[["@label","@obj","@objProperty","@valueToTrackBoolean","@noLabels","@action"],["property toggle no labels",[30,0,["data","checkboxData2"]],"useImage",[30,0,["data","checkboxData2","useImage"]],true,[30,0,["editCheckBoxItem"]]]],null],[1,"\\n\\n    "],[8,[39,11],null,[["@label","@labelCheck1","@labelCheck2","@obj","@objProperty","@valueToTrackBoolean","@action"],["property checkbox","oui","non",[30,0,["data","checkboxData"]],"useImage",[30,0,["data","checkboxData","useImage"]],[30,0,["editCheckBoxItem"]]]],null],[1,"\\n\\n    "],[8,[39,11],null,[["@label","@labelCheck1","@labelCheck2","@obj","@objProperty","@valueToTrackBoolean","@notTrue","@action"],["property checkbox + notTrue","oui","non",[30,0,["data","checkboxData"]],"useImage",[30,0,["data","checkboxData","useImage"]],true,[30,0,["editCheckBoxItem"]]]],null],[1,"\\n\\n    "],[8,[39,12],null,[["@label1","@label2","@value1","@value2","@obj","@objProperty","@valueToTrack","@action"],["property no","property yes",0,1,[30,0,["data","radioData"]],"useImage",[30,0,["data","radioData","useImage"]],[30,0,["editRadioItem"]]]],null],[1,"\\n\\n    "],[8,[39,12],null,[["@label1","@label2","@value1","@value2","@obj","@objProperty","@valueToTrack","@action"],["J D","C C","John Doe","Clment C",[30,0,["data"]],"userName",[30,0,["data","userName"]],[30,0,["editRadioItem"]]]],null],[1,"\\n\\n"],[1,"    "],[8,[39,13],null,[["@label","@label1","@label2","@value1","@value2","@obj","@objProperty","@valueToTrack","@action"],["position","fixed","responsive","fixed","responsive",[30,0,["data"]],"itemPosition",[30,0,["data","itemPosition"]],[30,0,["editRadioItem"]]]],null],[1,"\\n\\n\\n\\n    "],[10,"br"],[12],[13],[1,"\\n    useImage ==> "],[1,[30,0,["data","radioData","useImage"]]],[1,"\\n    "],[10,"br"],[12],[13],[1,"\\n    userName ==> "],[1,[30,0,["data","userName"]]],[1,"\\n    "],[10,"br"],[12],[13],[1,"\\n    position ==> "],[1,[30,0,["data","itemPosition"]]],[1,"\\n\\n\\n    "],[8,[39,1],null,[["@title"],["set image from library"]],null],[1,"\\n\\n    fit: "],[1,[30,0,["data","background","fit"]]],[1,"\\n\\n    "],[8,[39,1],null,[["@title"],["import image from hard drive"]],null],[1,"\\n\\n    "],[8,[39,1],null,[["@title"],[[30,0,["data","name"]]]],null],[1,"\\n\\n    "],[8,[39,14],null,[["@label","@options","@setValue","@target","@targetProperty","@valueToTrack"],["select a name",[30,0,["data","singleSelectOptions"]],[30,0,["setSelectValue"]],[30,0,["data"]],"name",[30,0,["data","name"]]]],null],[1,"\\n\\n    "],[8,[39,14],null,[["@label","@options","@setValue","@target","@targetProperty","@valueToTrack","@disabled"],["p select disabled",[30,0,["data","singleSelectOptions"]],[30,0,["setSelectValue"]],[30,0,["data"]],"name",[30,0,["data","name"]],true]],null],[1,"\\n\\n    "],[8,[39,14],null,[["@options","@setValue","@target","@targetProperty","@valueToTrack"],[[30,0,["data","singleSelectOptions"]],[30,0,["setSelectValue"]],[30,0,["data"]],"name",[30,0,["data","name"]]]],null],[1,"\\n\\n    "],[8,[39,1],null,[["@title"],["End of property components"]],null],[1,"\\n\\n"],[13],[1,"\\n\\n\\n\\n"],[10,0],[12],[1,"\\n\\n    "],[10,1],[14,0,"b_close"],[14,5,"right:50px;"],[12],[13],[1,"\\n    "],[10,1],[14,0,"b_close inverted"],[14,5,"right:80px;"],[12],[13],[1,"\\n\\n    "],[10,"br"],[12],[13],[1,"\\n\\n    "],[10,0],[14,0,"toolBar"],[12],[1,"\\n        "],[11,1],[24,0,"button circle plus"],[4,[38,16],["click",[30,0,["toolBarAction"]]],null],[12],[13],[1," "],[10,"label"],[12],[1,"add a page"],[13],[1,"\\n\\n        "],[11,1],[24,0,"buttonIcon tooltip"],[4,[38,16],["click",[30,0,["toolBarAction"]]],null],[12],[10,"i"],[14,0,"fa fa-trash-o"],[12],[13],[10,1],[14,0,"tooltiptext p85 down"],[12],[1,"Delete page"],[13],[13],[1,"\\n        "],[11,1],[24,0,"buttonIcon tooltip duplicate"],[4,[38,16],["click",[30,0,["toolBarAction"]]],null],[12],[10,"i"],[14,0,"bx bx-copy"],[12],[13],[10,1],[14,0,"tooltiptext p85 down"],[12],[1,"Duplicate page"],[13],[13],[1,"\\n    "],[13],[1,"\\n\\n    "],[10,0],[14,0,"tabs sitting"],[12],[1,"\\n        "],[11,0],[24,0,"active"],[4,[38,16],["click",[28,[37,18],[[30,0,["editItem"]],"tab1"],null]],null],[12],[1,"hierarchy"],[13],[1,"\\n        "],[11,0],[16,0,[29,[[52,[28,[37,20],[[30,0,["selectTab"]],"scenes"],null],"active"]]]],[4,[38,16],["click",[28,[37,18],[[30,0,["editItem"]],"tab2"],null]],null],[12],[1,"pages"],[13],[1,"\\n        "],[11,0],[16,0,[29,[[52,[28,[37,20],[[30,0,["selectTab"]],"materials"],null],"active"]]]],[4,[38,16],["click",[28,[37,18],[[30,0,["editItem"]],"tab3"],null]],null],[12],[1,"materials"],[13],[1,"\\n        "],[11,0],[16,0,[29,[[52,[28,[37,20],[[30,0,["selectTab"]],"lights"],null],"active"]]]],[4,[38,16],["click",[28,[37,18],[[30,0,["editItem"]],"tab4"],null]],null],[12],[1,"lighting"],[13],[1,"\\n    "],[13],[1,"\\n\\n    "],[10,"br"],[12],[13],[1,"\\n    \\n    "],[10,0],[12],[1,"\\n        "],[8,[39,1],null,[["@title"],[".button"]],null],[1,"\\n\\n        "],[10,1],[14,0,"button"],[12],[1,"a button"],[13],[1,"\\n        "],[10,1],[14,0,"button alt"],[12],[1,"a button alt"],[13],[1,"\\n        "],[10,1],[14,0,"button active"],[12],[1,"a button active"],[13],[1,"\\n\\n        "],[10,"br"],[12],[13],[1,"\\n        \\n        "],[10,1],[14,0,"button green"],[12],[1,"a button green"],[13],[1,"\\n        "],[10,1],[14,0,"button red"],[12],[1,"a button red"],[13],[1,"\\n        \\n        "],[10,"br"],[12],[13],[1,"\\n        \\n        "],[10,1],[14,0,"button yes"],[12],[1,"a button yes"],[13],[1,"\\n        "],[10,1],[14,0,"button no"],[12],[1,"a button no"],[13],[1,"\\n\\n        "],[10,"br"],[12],[13],[1,"\\n\\n        "],[10,1],[14,0,"button disabled"],[12],[1,"a button disabled"],[13],[1,"\\n        "],[10,1],[14,0,"button pink"],[12],[1,"a button pink"],[13],[1,"\\n        "],[10,"br"],[12],[13],[1,"\\n\\n        "],[8,[39,1],null,[["@title"],[".buttonIcon"]],null],[1,"\\n\\n        "],[10,1],[14,0,"buttonIcon"],[12],[10,"i"],[14,0,"bx bx-unlink"],[12],[13],[13],[1,"\\n        "],[10,1],[14,0,"buttonIcon"],[12],[10,"i"],[14,0,"fa fa-eye"],[12],[13],[13],[1,"\\n        "],[10,1],[14,0,"buttonIcon"],[12],[10,"i"],[14,0,"fa fa-clone"],[12],[13],[13],[1,"\\n        "],[10,1],[14,0,"buttonIcon"],[12],[10,"i"],[14,0,"bx bx-copy"],[12],[13],[13],[1,"\\n        "],[10,1],[14,0,"buttonIcon tooltip"],[12],[1,"\\n            "],[10,"i"],[14,0,"bx bx-unlink"],[12],[13],[1,"\\n            "],[10,1],[14,0,"tooltiptext"],[12],[1,"Unlink"],[13],[1,"\\n        "],[13],[1,"\\n\\n    \\n        "],[10,"br"],[12],[13],[1,"pathTools 30px"],[10,"br"],[12],[13],[1,"\\n\\n        "],[10,0],[14,5,"height:30px;outline:1px solid #886644;"],[12],[1,"\\n\\n            "],[11,1],[16,0,[29,["ui_toolIcon tooltip ",[52,[28,[37,20],[[30,0,["currentTool"]],"removePoint"],null],"on"]]]],[4,[38,16],["click",[28,[37,18],[[30,0,["toggleTool"]],"removePoint"],null]],null],[12],[1,"\\n                "],[10,"img"],[14,"draggable","false"],[14,"src","icons/keyframe-minus-in.svg"],[12],[13],[1,"\\n                "],[10,1],[14,0,"tooltiptext p50"],[12],[1,"Delete point"],[13],[1,"\\n            "],[13],[1,"\\n\\n            "],[11,1],[16,0,[29,["ui_toolIcon tooltip ",[52,[28,[37,20],[[30,0,["currentTool"]],"addPoint"],null],"on"]]]],[4,[38,16],["click",[28,[37,18],[[30,0,["toggleTool"]],"addPoint"],null]],null],[12],[1,"\\n                "],[10,"img"],[14,"draggable","false"],[14,"src","icons/keyframe-plus-in.svg"],[12],[13],[1,"\\n                "],[10,1],[14,0,"tooltiptext p50"],[12],[1,"Add point"],[13],[1,"\\n            "],[13],[1,"\\n\\n            "],[11,1],[16,0,[29,["ui_toolIcon tooltip ",[52,[28,[37,20],[[30,0,["currentTool"]],"convertPoint"],null],"on"]]]],[4,[38,16],["click",[28,[37,18],[[30,0,["toggleTool"]],"convertPoint"],null]],null],[12],[1,"\\n                "],[10,"img"],[14,"draggable","false"],[14,"src","icons/git-commit.svg"],[12],[13],[1,"\\n                "],[10,1],[14,0,"tooltiptext p50"],[12],[1,"Convert point"],[13],[1,"\\n            "],[13],[1,"\\n        "],[13],[1,"\\n\\n        "],[10,"br"],[12],[13],[1,"\\n        "],[10,1],[14,0,"warning"],[12],[1,"A warning message"],[13],[1,"\\n        "],[10,"br"],[12],[13],[1,"\\n        "],[10,1],[14,0,"warning"],[12],[1,"A warning message "],[10,"br"],[12],[13],[1,"multiline"],[13],[1,"\\n    "],[13],[1,"\\n\\n"],[13],[1,"\\n\\n\\n\\n"],[10,0],[12],[1,"\\n\\n    "],[8,[39,22],null,null,[["default"],[[[[1,"\\n        TutorialBubble\\n    "]],[]]]]],[1,"\\n\\n    "],[10,"br"],[12],[13],[10,"br"],[12],[13],[1,"\\n\\n    "],[8,[39,22],null,[["@animated"],[true]],[["default"],[[[[1,"\\n        TutorialBubble animated\\n    "]],[]]]]],[1,"\\n\\n    "],[8,[39,22],null,[["@closeButton"],[true]],[["default"],[[[[1,"\\n        TutorialBubble closeButton\\n    "]],[]]]]],[1,"\\n\\n    "],[8,[39,22],null,[["@extraClasses"],["aa bb"]],[["default"],[[[[1,"\\n        TutorialBubble extraClasses\\n    "]],[]]]]],[1,"\\n\\n"],[13],[1,"\\n\\n"],[13],[1,"\\n"]],[],["div","ui/property-title","ui/property","ui/property-range","ui/property-separator","br","ui/property-number","label","ui/property-note","ui/property-color","ui/property-toggle","ui/property-checkbox","ui/property-radio","ui/property-selector","ui/property-select","span","on","i","fn","if","eq","img","ui/tutorial-bubble"]]',moduleName:"pikimov/templates/ui.hbs",isStrictMode:!1})}),define("pikimov/transforms/boolean",["exports","@ember/debug","@ember-data/serializer/transform"],function(e,t,o){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return o.BooleanTransform}})}),define("pikimov/transforms/date",["exports","@ember/debug","@ember-data/serializer/transform"],function(e,t,o){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return o.DateTransform}})}),define("pikimov/transforms/number",["exports","@ember/debug","@ember-data/serializer/transform"],function(e,t,o){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return o.NumberTransform}})}),define("pikimov/transforms/string",["exports","@ember/debug","@ember-data/serializer/transform"],function(e,t,o){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return o.StringTransform}})}),define("pikimov/config/environment",[],function(){try{var e="pikimov/config/environment",t=document.querySelector('meta[name="'+e+'"]').getAttribute("content"),o={default:JSON.parse(decodeURIComponent(t))}
return Object.defineProperty(o,"__esModule",{value:!0}),o}catch(r){throw new Error('Could not read config from meta tag with name "'+e+'".')}}),runningTests||require("pikimov/app").default.create({name:"pikimov",version:"4.0.0+8b110f37"})